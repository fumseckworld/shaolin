<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- This file was created with the aha Ansi HTML Adapter. https://github.com/theZiz/aha -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xml+xhtml; charset=UTF-8" />
<title>symfony</title>
</head>
<body>
<pre>
 .travis.yml                                        |  14 <span style="color:green;">+</span><span style="color:red;">-</span>
 CHANGELOG-2.3.md                                   |   8 <span style="color:green;">+</span>
 CHANGELOG-2.4.md                                   |  55 <span style="color:green;">+++</span>
 CONTRIBUTORS.md                                    |  29 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Bridge/Doctrine/ContainerAwareEventManager.php |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../RegisterEventListenersAndSubscribersPass.php   |   9 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../CompilerPass/RegisterMappingsPass.php          |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Bridge/Doctrine/Logger/DbalLogger.php  |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 ...egisterEventListenersAndSubscribersPassTest.php |  33 <span style="color:green;">++</span>
 .../Doctrine/Tests/Logger/DbalLoggerTest.php       |   5 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Constraints/UniqueEntityValidatorTest.php      | 414 <span style="color:green;">++++++++++++++++++++</span>
 .../Validator/Constraints/UniqueValidatorTest.php  | 424 <span style="color:red;">---------------------</span>
 .../Bridge/Monolog/Handler/ConsoleHandler.php      |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Monolog/Tests/Handler/ConsoleHandlerTest.php   |  44 <span style="color:green;">+++</span>
 .../Propel1/Form/ChoiceList/ModelChoiceList.php    |   3 <span style="color:green;">+</span>
 .../Resources/views/Form/form_div_layout.html.twig |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../FrameworkBundle/Command/ServerRunCommand.php   |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Configuration.php          |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/config/fragment_renderer.xml         |   1 <span style="color:green;">+</span>
 .../Resources/config/router_dev.php                |   1 <span style="color:green;">+</span>
 .../Resources/config/router_prod.php               |   1 <span style="color:green;">+</span>
 .../Resources/config/schema/symfony-1.0.xsd        |   1 <span style="color:green;">+</span>
 .../views/Form/choice_widget_collapsed.html.php    |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Bundle/FrameworkBundle/Test/WebTestCase.php    |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Compiler/SerializerPassTest.php                |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Fixtures/php/full.php      |   1 <span style="color:green;">+</span>
 .../DependencyInjection/Fixtures/xml/full.xml      |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Fixtures/yml/full.yml      |   1 <span style="color:green;">+</span>
 .../DependencyInjection/FrameworkExtensionTest.php |   1 <span style="color:green;">+</span>
 .../Fixtures/Resources/views/translation.html.php  |  30 <span style="color:green;">++</span>
 .../Tests/Translation/PhpExtractorTest.php         |  25 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Translation/TranslatorTest.php           |  85 <span style="color:green;">++++</span><span style="color:red;">-</span>
 .../FrameworkBundle/Translation/PhpExtractor.php   |  82 <span style="color:green;">+++</span><span style="color:red;">-</span>
 .../Translation/PhpStringTokenParser.php           | 142 <span style="color:green;">+++++++</span>
 .../FrameworkBundle/Translation/Translator.php     |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../WebProfilerBundle/Command/ExportCommand.php    |  75 <span style="color:green;">++++</span>
 .../WebProfilerBundle/Command/ImportCommand.php    |  90 <span style="color:green;">+++++</span>
 .../Controller/ProfilerController.php              |  61 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Resources/config/commands.xml                  |  23 <span style="color:green;">++</span>
 .../Resources/views/Collector/time.html.twig       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/views/Profiler/admin.html.twig       |  35 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/views/Profiler/layout.html.twig      |  16 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/views/Profiler/toolbar.css.twig      |   1 <span style="color:green;">+</span>
 .../Tests/Command/ExportCommandTest.php            |  53 <span style="color:green;">+++</span>
 .../Tests/Command/ImportCommandTest.php            |  36 <span style="color:green;">++</span>
 .../WebProfilerBundle/Tests/Fixtures/profile.data  |   1 <span style="color:green;">+</span>
 src/Symfony/Component/BrowserKit/Client.php        |  24 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/BrowserKit/Tests/ClientTest.php      |  35 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/ClassLoader/ApcClassLoader.php       |   5 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/ClassLoader/XcacheClassLoader.php    |  32 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Config/Definition/BaseNode.php       |   1 <span style="color:green;">+</span>
 .../Definition/Builder/NumericNodeDefinition.php   |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Definition/Builder/ExprBuilderTest.php   |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Console/Application.php      |   2 <span style="color:green;">+</span>
 .../Console/Formatter/OutputFormatter.php          |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Console/Helper/DescriptorHelper.php  |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Console/Helper/DialogHelper.php      |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Console/Helper/TableHelper.php       |   2 <span style="color:green;">+</span>
 .../Console/Tests/Command/ListCommandTest.php      |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Formatter/OutputFormatterTest.php        |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/CssSelector/README.md        |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Compiler/AnalyzeServiceReferencesPass.php      |   4 <span style="color:green;">+</span>
 .../Component/DependencyInjection/Container.php    |  25 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Dumper/GraphvizDumper.php  |   5 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Dumper/PhpDumper.php       |   7 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DependencyInjection/Dumper/XmlDumper.php       |   3 <span style="color:green;">+</span>
 .../DependencyInjection/Loader/YamlFileLoader.php  |   2 <span style="color:green;">+</span>
 .../Compiler/AnalyzeServiceReferencesPassTest.php  |  20 <span style="color:green;">+</span>
 .../Compiler/CheckCircularReferencesPassTest.php   |  39 <span style="color:green;">++</span>
 .../Compiler/RemoveUnusedDefinitionsPassTest.php   |  27 <span style="color:green;">++</span>
 .../Tests/Dumper/GraphvizDumperTest.php            |   7 <span style="color:green;">+</span>
 .../Tests/Dumper/PhpDumperTest.php                 |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Fixtures/containers/container18.php      |  14 <span style="color:green;">+</span>
 .../Tests/Fixtures/graphviz/services18.dot         |   8 <span style="color:green;">+</span>
 .../Tests/Fixtures/php/services10.php              |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Fixtures/php/services11.php              |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Fixtures/php/services9.php               |  16 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Fixtures/php/services9_compiled.php      |  18 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Fixtures/xml/services9.xml               |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/DomCrawler/Crawler.php       |  23 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/DomCrawler/Form.php          |   5 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/DomCrawler/Tests/CrawlerTest.php     | 105 <span style="color:green;">++++</span><span style="color:red;">-</span>
 .../Component/DomCrawler/Tests/FormTest.php        |  22 <span style="color:green;">++</span>
 .../Component/EventDispatcher/EventDispatcher.php  |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../EventDispatcher/Tests/EventDispatcherTest.php  |  22 <span style="color:green;">++</span>
 src/Symfony/Component/ExpressionLanguage/Lexer.php |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../ExpressionLanguage/Tests/LexerTest.php         |   8 <span style="color:green;">+</span>
 src/Symfony/Component/Filesystem/Filesystem.php    |  12 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Finder/Adapter/AbstractFindAdapter.php         |   1 <span style="color:red;">-</span>
 src/Symfony/Component/Finder/Shell/Shell.php       |  14 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Finder/Tests/FinderTest.php  |  64 <span style="color:green;">++</span><span style="color:red;">--</span>
 .../Finder/Tests/Iterator/MockSplFileInfo.php      |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Form/ButtonBuilder.php       |   2 <span style="color:green;">+</span>
 src/Symfony/Component/Form/CallbackTransformer.php |  21 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../DateTimeToLocalizedStringTransformer.php       |   8 <span style="color:green;">+</span>
 .../ValueToDuplicatesTransformer.php               |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Form/Extension/Core/Type/DateType.php          |   6 <span style="color:green;">+</span>
 .../Form/Extension/Core/Type/LocaleType.php        |   1 <span style="color:red;">-</span>
 .../Form/Resources/translations/validators.eu.xlf  |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Form/Tests/CallbackTransformerTest.php         |  37 <span style="color:green;">++</span>
 .../DateTimeToRfc3339TransformerTest.php           |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../ValueToDuplicatesTransformerTest.php           |  23 <span style="color:green;">++</span>
 .../Validator/Constraints/FormValidatorTest.php    | 290 <span style="color:green;">+++++</span><span style="color:red;">---------</span>
 .../ViolationMapper/ViolationPathTest.php          |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpFoundation/BinaryFileResponse.php          |   2 <span style="color:green;">+</span>
 src/Symfony/Component/HttpFoundation/Request.php   |  15 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/HttpFoundation/ServerBag.php |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/HttpFoundation/Tests/RequestTest.php |  76 <span style="color:green;">+++</span><span style="color:red;">-</span>
 .../HttpFoundation/Tests/ResponseTest.php          |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpFoundation/Tests/ServerBagTest.php         |  29 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpKernel/Debug/TraceableEventDispatcher.php  |   5 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpKernel/EventListener/FragmentListener.php  |  22 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpKernel/EventListener/SessionListener.php   |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../EventListener/TestSessionListener.php          |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpKernel/Fragment/EsiFragmentRenderer.php    |  22 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../HttpKernel/Fragment/FragmentHandler.php        |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/HttpKernel/Kernel.php        |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/EventListener/FragmentListenerTest.php   |  13 <span style="color:red;">-</span>
 .../Tests/Fragment/EsiFragmentRendererTest.php     |  48 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../HttpKernel/Tests/HttpCache/HttpCacheTest.php   |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Intl/ResourceBundle/AbstractBundle.php         |   1 <span style="color:red;">-</span>
 .../Intl/Resources/bin/copy-stubs-to-component.php |   1 <span style="color:red;">-</span>
 src/Symfony/Component/Process/ExecutableFinder.php |   3 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Process/Process.php          |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Process/ProcessPipes.php     |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Process/Tests/AbstractProcessTest.php          |  58 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../Process/Tests/ExecutableFinderTest.php         |  55 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../Process/Tests/SigchildDisabledProcessTest.php  |  13 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Process/Tests/SigchildEnabledProcessTest.php   |  15 <span style="color:green;">+</span>
 .../Component/Process/Tests/SimpleProcessTest.php  |  51 <span style="color:green;">+++</span>
 .../Component/PropertyAccess/.gitattributes        |   2 <span style="color:red;">-</span>
 .../Component/PropertyAccess/StringUtil.php        |   3 <span style="color:green;">+</span>
 .../Tests/PropertyAccessorCollectionTest.php       |   1 <span style="color:red;">-</span>
 .../PropertyAccess/Tests/StringUtilTest.php        | 160 <span style="color:green;">++++</span><span style="color:red;">----</span>
 .../Component/Routing/Loader/XmlFileLoader.php     |  13 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Routing/Loader/schema/routing/routing-1.0.xsd  |   7 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Routing/Tests/Fixtures/null_values.xml         |  12 <span style="color:green;">+</span>
 .../Generator/Dumper/PhpGeneratorDumperTest.php    |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Routing/Tests/Loader/XmlFileLoaderTest.php     |  14 <span style="color:green;">+</span>
 .../Security/Acl/Dbal/MutableAclProvider.php       |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Core/Authorization/Voter/VoterInterface.php    |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Core/Encoder/BCryptPasswordEncoder.php         |   2 <span style="color:green;">+</span>
 .../Security/Core/Encoder/BasePasswordEncoder.php  |   2 <span style="color:green;">+</span>
 .../Constraints/UserPasswordValidatorTest.php      | 125 <span style="color:green;">+++</span><span style="color:red;">---</span>
 .../Component/Security/Core/Util/StringUtils.php   |  12 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Http/RememberMe/AbstractRememberMeServices.php |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Normalizer/GetSetMethodNormalizer.php          |  22 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Normalizer/GetSetMethodNormalizerTest.php      |  32 <span style="color:green;">++</span>
 src/Symfony/Component/Stopwatch/.gitattributes     |   2 <span style="color:red;">-</span>
 .../Stopwatch/Tests/StopwatchEventTest.php         |  19 <span style="color:red;">-</span>
 .../Component/Stopwatch/Tests/StopwatchTest.php    |  13 <span style="color:red;">-</span>
 .../Component/Translation/Loader/PhpFileLoader.php |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Translation/Tests/TranslatorTest.php |   3 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Translation/Translator.php   |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Validator/ConstraintValidator.php    | 125 <span style="color:green;">++++++</span>
 .../Component/Validator/ConstraintViolation.php    |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Constraints/AbstractComparisonValidator.php    |  38 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/AllValidator.php         |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/BlankValidator.php       |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/CardSchemeValidator.php  |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/ChoiceValidator.php      |  16 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/CollectionValidator.php  |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/CountryValidator.php     |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/CurrencyValidator.php    |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/DateValidator.php        |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/EmailValidator.php       |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/ExpressionValidator.php  |   1 <span style="color:green;">+</span>
 .../Validator/Constraints/FalseValidator.php       |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/FileValidator.php        |  22 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/IbanValidator.php        | 103 <span style="color:green;">++++</span><span style="color:red;">-</span>
 .../Validator/Constraints/IpValidator.php          |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Validator/Constraints/Isbn.php       |   3 <span style="color:green;">+</span>
 .../Validator/Constraints/IsbnValidator.php        | 101 <span style="color:green;">+++</span><span style="color:red;">--</span>
 .../Validator/Constraints/IssnValidator.php        |  35 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/LanguageValidator.php    |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/LengthValidator.php      |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/LocaleValidator.php      |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/LuhnValidator.php        |  49 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../Validator/Constraints/NotBlankValidator.php    |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/NullValidator.php        |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/RangeValidator.php       |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/RegexValidator.php       |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/TimeValidator.php        |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/TrueValidator.php        |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/TypeValidator.php        |   2 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Validator/Constraints/UrlValidator.php         |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Validator/Mapping/ClassMetadata.php  |   8 <span style="color:green;">+</span>
 .../Resources/translations/validators.af.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.ar.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.bg.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.ca.xlf       |  28 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.cs.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.cy.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.da.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.de.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.el.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.en.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.es.xlf       |  26 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.et.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.eu.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.fi.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.fr.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.gl.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.he.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.hr.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.hu.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.hy.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.id.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.it.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.ja.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.lt.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.mn.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.nb.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.nl.xlf       |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.no.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.pl.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.pt.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.pt_BR.xlf    |  14 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.ro.xlf       |  24 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.ru.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sk.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sl.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sq.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sr_Cyrl.xlf  |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sr_Latn.xlf  |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.sv.xlf       |  28 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.th.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.tr.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.uk.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.vi.xlf       |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.zh_CN.xlf    |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Resources/translations/validators.zh_TW.xlf    |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../AbstractComparisonValidatorTestCase.php        |  59 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../AbstractConstraintValidatorTest.php            | 194 <span style="color:green;">++++++++++</span>
 .../Tests/Constraints/AllValidatorTest.php         |  57 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/BlankValidatorTest.php       |  48 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/CallbackValidatorTest.php    | 197 <span style="color:green;">++++</span><span style="color:red;">------</span>
 .../Tests/Constraints/CardSchemeValidatorTest.php  |  44 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/ChoiceValidatorTest.php      | 146 <span style="color:green;">+++</span><span style="color:red;">----</span>
 .../Validator/Tests/Constraints/CollectionTest.php |   4 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../CollectionValidatorCustomArrayObjectTest.php   |  58 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/CollectionValidatorTest.php  | 219 <span style="color:green;">+++++</span><span style="color:red;">------</span>
 .../Constraints/CountValidatorCountableTest.php    |  17 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/CountValidatorTest.php       |  71 <span style="color:green;">++</span><span style="color:red;">--</span>
 .../Tests/Constraints/CountryValidatorTest.php     |  45 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/CurrencyValidatorTest.php    |  45 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/DateTimeValidatorTest.php    |  47 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/DateValidatorTest.php        |  47 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/EmailValidatorTest.php       |  43 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/EqualToValidatorTest.php     |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/ExpressionValidatorTest.php  | 196 <span style="color:green;">+++++</span><span style="color:red;">-----</span>
 .../Tests/Constraints/FalseValidatorTest.php       |  35 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/FileValidatorPathTest.php    |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/FileValidatorTest.php        | 241 <span style="color:green;">+++++++</span><span style="color:red;">-----</span>
 .../GreaterThanOrEqualValidatorTest.php            |   6 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/GreaterThanValidatorTest.php |  16 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/GroupSequenceTest.php        |  27 <span style="color:green;">++</span>
 .../Tests/Constraints/IbanValidatorTest.php        |  36 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/IdenticalToValidatorTest.php |  12 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/ImageValidatorTest.php       | 141 <span style="color:green;">+++</span><span style="color:red;">----</span>
 .../Tests/Constraints/IpValidatorTest.php          | 165 <span style="color:green;">+++</span><span style="color:red;">-----</span>
 .../Tests/Constraints/IsbnValidatorTest.php        |  99 <span style="color:green;">+++</span><span style="color:red;">--</span>
 .../Tests/Constraints/IssnValidatorTest.php        |  88 <span style="color:green;">+++</span><span style="color:red;">--</span>
 .../Tests/Constraints/LanguageValidatorTest.php    |  49 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/LengthValidatorTest.php      |  79 <span style="color:green;">++</span><span style="color:red;">--</span>
 .../Constraints/LessThanOrEqualValidatorTest.php   |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/LessThanValidatorTest.php    |  14 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/LocaleValidatorTest.php      |  43 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/LuhnValidatorTest.php        |  45 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/NotBlankValidatorTest.php    |  55 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../Tests/Constraints/NotEqualToValidatorTest.php  |  10 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Constraints/NotIdenticalToValidatorTest.php    |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/NotNullValidatorTest.php     |  30 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/NullValidatorTest.php        |  50 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/RangeValidatorTest.php       | 115 <span style="color:green;">+++</span><span style="color:red;">---</span>
 .../Tests/Constraints/RegexValidatorTest.php       |  43 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/TimeValidatorTest.php        |  48 <span style="color:green;">+</span><span style="color:red;">--</span>
 .../Tests/Constraints/TrueValidatorTest.php        |  37 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Tests/Constraints/TypeValidatorTest.php        | 127 <span style="color:green;">+++</span><span style="color:red;">---</span>
 .../Tests/Constraints/UrlValidatorTest.php         |  57 <span style="color:green;">++</span><span style="color:red;">-</span>
 .../Validator/Tests/Fixtures/Countable.php         |  27 <span style="color:green;">++</span>
 .../Validator/Tests/Fixtures/CustomArrayObject.php |  70 <span style="color:green;">++++</span>
 .../Component/Validator/Tests/Fixtures/Entity.php  |   1 <span style="color:green;">+</span>
 .../Tests/Fixtures/StubGlobalExecutionContext.php  |  69 <span style="color:green;">++++</span>
 .../Validator/Tests/Mapping/ClassMetadataTest.php  |  16 <span style="color:green;">+</span>
 .../Validator/Tests/ValidationVisitorTest.php      |  48 <span style="color:green;">+++</span>
 .../Component/Validator/ValidationVisitor.php      |  17 <span style="color:green;">+</span><span style="color:red;">-</span>
 src/Symfony/Component/Yaml/Inline.php              |  66 <span style="color:green;">+++</span><span style="color:red;">-</span>
 src/Symfony/Component/Yaml/Parser.php              |   8 <span style="color:green;">+</span><span style="color:red;">-</span>
 .../Component/Yaml/Tests/Fixtures/sfComments.yml   |   8 <span style="color:green;">+</span>
 src/Symfony/Component/Yaml/Tests/InlineTest.php    |  32 <span style="color:green;">++</span>
 src/Symfony/Component/Yaml/Tests/ParserTest.php    |  26 <span style="color:green;">++</span>
 292 files changed, 5142 insertions(+), 3341 deletions(-)

<span style="font-weight:bold;">diff --git a/.travis.yml b/.travis.yml</span>
<span style="font-weight:bold;">index 463a7d3e24..9d5b2fff64 100644</span>
<span style="font-weight:bold;">--- a/.travis.yml</span>
<span style="font-weight:bold;">+++ b/.travis.yml</span>
<span style="color:teal;">@@ -1,12 +1,12 @@</span>
language: php

php:
    - 5.3.3
    - 5.3
    - 5.4
    - 5.5
    - 5.6
    - hhvm-nightly

matrix:
    allow_failures:
<span style="color:teal;">@@ -22,7 +22,7 @@</span> before_script:
    - sh -c 'if [ &quot;$TRAVIS_PHP_VERSION&quot; != &quot;hhvm-nightly&quot; ]; then echo &quot;extension = memcached.so&quot; &gt;&gt; ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini; fi;'
    - sh -c 'if [ &quot;$TRAVIS_PHP_VERSION&quot; != &quot;hhvm-nightly&quot; ]; then echo &quot;extension = memcache.so&quot; &gt;&gt; ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini; fi;'
    - COMPOSER_ROOT_VERSION=dev-master composer --prefer-source --dev install
<span style="color:green;">#</span>    - sh -c 'if [ &quot;$TRAVIS_PHP_VERSION&quot; != &quot;5.3.3&quot; ]; then phpunit --self-update; fi;'

script:
    - ls -d src/Symfony/*/* | parallel --gnu --keep-order 'echo &quot;Running {} tests&quot;; phpunit --exclude-group tty,benchmark {};'
<span style="font-weight:bold;">diff --git a/CHANGELOG-2.3.md b/CHANGELOG-2.3.md</span>
<span style="font-weight:bold;">index 9b0b1f994e..c132013aa0 100644</span>
<span style="font-weight:bold;">--- a/CHANGELOG-2.3.md</span>
<span style="font-weight:bold;">+++ b/CHANGELOG-2.3.md</span>
<span style="color:teal;">@@ -7,6 +7,14 @@</span> in 2.3 minor versions.
To get the diff for a specific change, go to https://github.com/symfony/symfony/commit/XXX where XXX is the change hash
To get the diff between two versions, go to https://github.com/symfony/symfony/compare/v2.3.0...v2.3.1

<span style="color:green;">* 2.3.18 (2014-07-15)</span>

<span style="color:green;"> * [Security] Forced validate of locales passed to the translator</span>
<span style="color:green;"> * feature #11367 [HttpFoundation] Fix to prevent magic bytes injection in JSONP responses... (CVE-2014-4671) (Andrew Moore)</span>
<span style="color:green;"> * bug #11386 Remove Spaceless Blocks from Twig Form Templates (chrisguitarguy)</span>
<span style="color:green;"> * bug #9719 [TwigBundle] fix configuration tree for paths (mdavis1982, cordoval)</span>
<span style="color:green;"> * bug #11244 [HttpFoundation] Remove body-related headers when sending the response, if body is empty (SimonSimCity)</span>

* 2.3.17 (2014-07-07)

 * bug #11238 [Translation] Added unescaping of ids in PoFileLoader (JustBlackBird)
<span style="font-weight:bold;">diff --git a/CHANGELOG-2.4.md b/CHANGELOG-2.4.md</span>
<span style="font-weight:bold;">index 0136181652..f1bbdc6853 100644</span>
<span style="font-weight:bold;">--- a/CHANGELOG-2.4.md</span>
<span style="font-weight:bold;">+++ b/CHANGELOG-2.4.md</span>
<span style="color:teal;">@@ -7,6 +7,61 @@</span> in 2.4 minor versions.
To get the diff for a specific change, go to https://github.com/symfony/symfony/commit/XXX where XXX is the change hash
To get the diff between two versions, go to https://github.com/symfony/symfony/compare/v2.4.0...v2.4.1

<span style="color:green;">* 2.4.9 (2014-09-03)</span>

<span style="color:green;"> * security #11832 CVE-2014-6072 (fabpot)</span>
<span style="color:green;"> * security #11831 CVE-2014-5245 (stof)</span>
<span style="color:green;"> * security #11830 CVE-2014-4931 (aitboudad, Jérémy Derussé)</span>
<span style="color:green;"> * security #11829 CVE-2014-6061 (damz, fabpot)</span>
<span style="color:green;"> * security #11828 CVE-2014-5244 (nicolas-grekas, larowlan)</span>
<span style="color:green;"> * bug #10197 [FrameworkBundle] PhpExtractor bugfix and improvements (mtibben)</span>
<span style="color:green;"> * bug #11772 [Filesystem] Add FTP stream wrapper context option to enable overwrite (Damian Sromek)</span>
<span style="color:green;"> * bug #11788 [Yaml] fixed mapping keys containing a quoted # (hvt, fabpot)</span>
<span style="color:green;"> * bug #11160 [DoctrineBridge] Abstract Doctrine Subscribers with tags (merk)</span>
<span style="color:green;"> * bug #11768 [ClassLoader] Add a __call() method to XcacheClassLoader (tstoeckler)</span>
<span style="color:green;"> * bug #11726 [Filesystem Component] mkdir race condition fix #11626 (kcassam)</span>
<span style="color:green;"> * bug #11677 [YAML] resolve variables in inlined YAML (xabbuh)</span>
<span style="color:green;"> * bug #11639 [DependencyInjection] Fixed factory service not within the ServiceReferenceGraph. (boekkooi)</span>
<span style="color:green;"> * bug #11778 [Validator] Fixed wrong translations for Collection constraints (samicemalone)</span>
<span style="color:green;"> * bug #11756 [DependencyInjection] fix @return anno created by PhpDumper (jakubkulhan)</span>
<span style="color:green;"> * bug #11711 [DoctrineBridge] Fix empty parameter logging in the dbal logger (jakzal)</span>
<span style="color:green;"> * bug #11692 [DomCrawler] check for the correct field type (xabbuh)</span>
<span style="color:green;"> * bug #11672 [Routing] fix handling of nullable XML attributes (xabbuh)</span>
<span style="color:green;"> * bug #11624 [DomCrawler] fix the axes handling in a bc way (xabbuh)</span>
<span style="color:green;"> * bug #11676 [Form] Fixed #11675 ValueToDuplicatesTransformer accept &quot;0&quot; value (Nek-)</span>
<span style="color:green;"> * bug #11695 [Validators] Fixed failing tests requiring ICU 52.1 which are skipped otherwise (webmozart)</span>
<span style="color:green;"> * bug #11529 [WebProfilerBundle] Fixed double height of canvas (hason)</span>
<span style="color:green;"> * bug #11641 [WebProfilerBundle ] Fix toolbar vertical alignment (blaugueux)</span>
<span style="color:green;"> * bug #11559 [Validator] Convert objects to string in comparison validators (webmozart)</span>
<span style="color:green;"> * feature #11510 [HttpFoundation] MongoDbSessionHandler supports auto expiry via configurable expiry_field (catchamonkey)</span>
<span style="color:green;"> * bug #11408 [HttpFoundation] Update QUERY_STRING when overrideGlobals (yguedidi)</span>
<span style="color:green;"> * bug #11633 [FrameworkBundle] add missing attribute to XSD (xabbuh)</span>
<span style="color:green;"> * bug #11601 [Validator] Allow basic auth in url when using UrlValidator. (blaugueux)</span>
<span style="color:green;"> * bug #11609 [Console] fixed style creation when providing an unknown tag option (fabpot)</span>
<span style="color:green;"> * bug #10914 [HttpKernel] added an analyze of environment parameters for built-in server (mauchede)</span>
<span style="color:green;"> * bug #11598 [Finder] Shell escape and windows support (Gordon Franke, gimler)</span>
<span style="color:green;"> * bug #11499 [BrowserKit] Fixed relative redirects for ambiguous paths (pkruithof)</span>
<span style="color:green;"> * bug #11516 [BrowserKit] Fix browser kit redirect with ports (dakota)</span>
<span style="color:green;"> * bug #11545 [Bundle][FrameworkBundle] built-in server: exit when docroot does not exist (xabbuh)</span>
<span style="color:green;"> * bug #11560 Plural fix (1emming)</span>
<span style="color:green;"> * bug #11558 [DependencyInjection] Fixed missing 'factory-class' attribute in XmlDumper output (kerdany)</span>
<span style="color:green;"> * bug #11548 [Component][DomCrawler] fix axes handling in Crawler::filterXPath() (xabbuh)</span>
<span style="color:green;"> * bug #11422 [DependencyInjection] Self-referenced 'service_container' service breaks garbage collection (sun)</span>
<span style="color:green;"> * bug #11428 [Serializer] properly handle null data when denormalizing (xabbuh)</span>
<span style="color:green;"> * bug #10687 [Validator] Fixed string conversion in constraint violations (eagleoneraptor, webmozart)</span>
<span style="color:green;"> * bug #11475 [EventDispatcher] don't count empty listeners (xabbuh)</span>
<span style="color:green;"> * bug #11436 fix signal handling in wait() on calls to stop() (xabbuh, romainneutron)</span>
<span style="color:green;"> * bug #11469  [BrowserKit] Fixed server HTTP_HOST port uri conversion (bcremer, fabpot)</span>
<span style="color:green;"> * bug #11425 Fix issue described in #11421 (Ben, ben-rosio)</span>
<span style="color:green;"> * bug #11423 Pass a Scope instance instead of a scope name when cloning a container in the GrahpvizDumper (jakzal)</span>
<span style="color:green;"> * bug #11448 [MonologBridge] fixed Console handler priorities (fabpot)</span>
<span style="color:green;"> * bug #11120 [Process] Reduce I/O load on Windows platform (romainneutron)</span>
<span style="color:green;"> * bug #11342 [Form] Check if IntlDateFormatter constructor returned a valid object before using it (romainneutron)</span>
<span style="color:green;"> * bug #11439 [ExpressionLanguage] Fixed double quoted string literals containing sharps (pylebecq)</span>
<span style="color:green;"> * bug #11411 [Validator] Backported #11410 to 2.3: Object initializers are called only once per object (webmozart)</span>
<span style="color:green;"> * bug #11403 [Translator][FrameworkBundle] Added @ to the list of allowed chars in Translator (takeit)</span>
<span style="color:green;"> * bug #11381  [Process] Use correct test for empty string in UnixPipes (whs, romainneutron)</span>

* 2.4.8 (2014-07-15)

 * [Security] Forced validate of locales passed to the translator
<span style="font-weight:bold;">diff --git a/CONTRIBUTORS.md b/CONTRIBUTORS.md</span>
<span style="font-weight:bold;">index 007ceffdf4..ca9e441c93 100644</span>
<span style="font-weight:bold;">--- a/CONTRIBUTORS.md</span>
<span style="font-weight:bold;">+++ b/CONTRIBUTORS.md</span>
<span style="color:teal;">@@ -19,8 +19,8 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Ryan Weaver (weaverryan)
 - Lukas Kahwe Smith (lsmith)
 - Jeremy Mikola (jmikola)
<span style="color:red;"> - Jean-François Simon (jfsimon)</span>
 - Romain Neutron (romain)
 <span style="color:green;">- Jean-François Simon (jfsimon)</span>
 - Benjamin Eberlei (beberlei)
 - Igor Wiedler (igorw)
 - Hugo Hamon (hhamon)
<span style="color:teal;">@@ -44,18 +44,18 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Wouter De Jong (wouterj)
 - Eric Clemmons (ericclemmons)
 - Nicolas Grekas (nicolas-grekas)
 <span style="color:green;">- Andrej Hudec (pulzarraider)</span>
 - Deni
 - Henrik Westphal (snc)
 - Dariusz Górecki (canni)
<span style="color:red;"> - Andrej Hudec (pulzarraider)</span>
 - Arnout Boks (aboks)
 <span style="color:green;">- Christian Raue</span>
 - Michel Weimerskirch (mweimerskirch)
 - Lee McDermott
 - Brandon Turner
 - Douglas Greenshields (shieldo)
 - Daniel Holmes (dholmes)
 - Jordan Alliot (jalliot)
<span style="color:red;"> - Christian Raue</span>
 - John Wards (johnwards)
 - Fran Moreno (franmomu)
 - Bart van den Burg (burgov)
<span style="color:teal;">@@ -75,21 +75,21 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Fabien Pennequin (fabienpennequin)
 - Jacob Dreesen (jdreesen)
 - Gábor Egyed (1ed)
 <span style="color:green;">- Ait Boudad Abdellatif (aitboudad)</span>
 - Adrien Brault (adrienbrault)
 - Michal Piotrowski (eventhorizon)
<span style="color:red;"> - Ait Boudad Abdellatif (aitboudad)</span>
 - Robert Schönthal (digitalkaoz)
 - Juti Noppornpitak (shiroyuki)
 - Sebastian Hörl (blogsh)
 - Daniel Gomes (danielcsgomes)
 - Hidenori Goto (hidenorigoto)
 - Peter Kokot (maastermedia)
 <span style="color:green;">- Christian Flothmann (xabbuh)</span>
 - Jérémie Augustin (jaugustin)
 - David Buchmann (dbu)
 - Jérôme Tamarelle (gromnan)
 - Tigran Azatyan (tigranazatyan)
 - Javier Eguiluz (javier.eguiluz)
<span style="color:red;"> - Christian Flothmann (xabbuh)</span>
 - Rafael Dohms (rdohms)
 - Richard Shank (iampersistent)
 - Gordon Franke (gimler)
<span style="color:teal;">@@ -146,6 +146,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Manuel Reinhard (sprain)
 - Danny Berger (dpb587)
 - Xavier Montaña Carreras (xmontana)
 <span style="color:green;">- Michele Orselli (orso)</span>
 - Xavier Perez
 - Arjen Brouwer (arjenjb)
 - Katsuhiro OGAWA
<span style="color:teal;">@@ -168,7 +169,6 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Robert Kiss (kepten)
 - Kim Hemsø Rasmussen (kimhemsoe)
 - Wouter Van Hecke
<span style="color:red;"> - Michele Orselli (orso)</span>
 - Michael Holm (hollo)
 - Marc Weistroff (futurecat)
 - Pierre-Yves LEBECQ (pylebecq)
<span style="color:teal;">@@ -231,6 +231,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Ismael Ambrosi (iambrosi)
 - Shein Alexey
 - Issei Murasawa (issei_m)
 <span style="color:green;">- hacfi (hifi)</span>
 - Joe Lencioni
 - Kai
 - Xavier HAUSHERR
<span style="color:teal;">@@ -274,6 +275,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - François-Xavier de Guillebon (de-gui_f)
 - boombatower
 - Fabrice Bernhard (fabriceb)
 <span style="color:green;">- Clément Gautier (clementgautier)</span>
 - Fabian Lange (codingfabian)
 - Yoshio HANAWA
 - Baptiste Clavié (talus)
<span style="color:teal;">@@ -294,11 +296,11 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Maks Slesarenko
 - Markus Lanthaler (lanthaler)
 - Vicent Soria Durá (vicentgodella)
 <span style="color:green;">- Chris Wilkinson (thewilkybarkid)</span>
 - Ioan Negulescu
 - Andrew Udvare (audvare)
 - alexpods
 - Erik Trapman (eriktrapman)
<span style="color:red;"> - hacfi (hifi)</span>
 - De Cock Xavier (xdecock)
 - Alex Pott
 - Norbert Orzechowicz (norzechowicz)
<span style="color:teal;">@@ -365,6 +367,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Arturs Vonda
 - Sascha Grossenbacher
 - Ben Davies (bendavies)
 <span style="color:green;">- Simon Schick (simonsimcity)</span>
 - Hossein Bukhamsin
 - Paweł Wacławczyk (pwc)
 - Oleg Zinchenko (cystbear)
<span style="color:teal;">@@ -372,6 +375,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Johannes Klauss (cloppy)
 - Evan Villemez
 - fzerorubigd
 <span style="color:green;">- Benjamin Grandfond (benjamin)</span>
 - Tiago Brito (blackmx)
 - Richard van den Brand (ricbra)
 - develop
<span style="color:teal;">@@ -403,7 +407,6 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Marek Štípek (maryo)
 - John Bohn (jbohn)
 - Jakub Škvára (jskvara)
<span style="color:red;"> - Chris Wilkinson (thewilkybarkid)</span>
 - Andrew Hilobok (hilobok)
 - Christian Soronellas (theunic)
 - Jérôme Vieilledent (lolautruche)
<span style="color:teal;">@@ -532,7 +535,6 @@</span> Symfony2 is the result of the work of many people who made the code better
 - jfcixmedia
 - Martijn Evers
 - Benjamin Paap (benjaminpaap)
<span style="color:red;"> - Simon Schick (simonsimcity)</span>
 - Christian
 - Sergii Smertin (nfx)
 - Eddie Jaoude
<span style="color:teal;">@@ -550,6 +552,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Benoit Garret
 - DerManoMann
 - Asmir Mustafic (goetas)
 <span style="color:green;">- Julien Bianchi (jubianchi)</span>
 - Marcin Chwedziak
 - Roland Franssen (ro0)
 - Maciej Malarz
<span style="color:teal;">@@ -562,20 +565,22 @@</span> Symfony2 is the result of the work of many people who made the code better
 - kaiwa
 - Albert Ganiev (helios-ag)
 - Neil Katin
 <span style="color:green;">- David Otton</span>
 - peter
 - Artem Kolesnikov (tyomo4ka)
 - Gustavo Adrian
<span style="color:red;"> - Clément Gautier (clementgautier)</span>
 - Yannick
 - Luc Vieillescazes (iamluc)
 - Eduardo García Sanz (coma)
 - David de Boer (ddeboer)
 - Brooks Boyd
 - Roger Webb
 <span style="color:green;">- Dmitriy Simushev</span>
 - Max Voloshin (maxvoloshin)
 - Nicolas Fabre (nfabre)
 - Raul Rodriguez (raul782)
 - Patrick Landolt (scube)
 <span style="color:green;">- WybrenKoelmans</span>
 - Derek Lambert
 - Felicitus
 - Krzysztof Przybyszewski
<span style="color:teal;">@@ -730,6 +735,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - catch
 - Alexandre Segura
 - Josef Cech
 <span style="color:green;">- Nate (frickenate)</span>
 - Matthew Foster (mfoster)
 - Maximilian Reichel (phramz)
 - Paul Seiffert (seiffert)
<span style="color:teal;">@@ -750,7 +756,6 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Andrey Ryaguzov
 - Gunther Konig
 - František Bereň
<span style="color:red;"> - Benjamin Grandfond (benjamin)</span>
 - Christoph Nissle (derstoffel)
 - Ionel Scutelnicu (ionelscutelnicu)
 - Johnny Peck (johnnypeck)
<span style="color:teal;">@@ -875,6 +880,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Yorkie Chadwick (yorkie76)
 - Yanick Witschi
 - Ondrej Mirtes
 <span style="color:green;">- akimsko</span>
 - Youpie
 - srsbiz
 - Nicolas A. Bérard-Nault
<span style="color:teal;">@@ -1010,6 +1016,7 @@</span> Symfony2 is the result of the work of many people who made the code better
 - Adam Monsen (meonkeys)
 - ollie harridge (ollietb)
 - Paweł Szczepanek (pauluz)
 <span style="color:green;">- Christian López Espínola (penyaskito)</span>
 - Petr Jaroš (petajaros)
 - Philipp Hoffmann (philipphoffmann)
 - Alex Carol (picard89)
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/ContainerAwareEventManager.php b/src/Symfony/Bridge/Doctrine/ContainerAwareEventManager.php</span>
<span style="font-weight:bold;">index ac21ece6e0..5f6902d4a4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/ContainerAwareEventManager.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/ContainerAwareEventManager.php</span>
<span style="color:teal;">@@ -49,7 +49,7 @@</span> class ContainerAwareEventManager extends EventManager
    public function dispatchEvent($eventName, EventArgs $eventArgs = null)
    {
        if (isset($this-&gt;listeners[$eventName])) {
            $eventArgs =<span style="color:red;">$eventArgs ===</span> null <span style="color:green;">=== $eventArgs</span> ? EventArgs::getEmptyInstance() : $eventArgs;

            $initialized = isset($this-&gt;initialized[$eventName]);

<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPass.php b/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPass.php</span>
<span style="font-weight:bold;">index 62e71015bc..315522f92a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPass.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPass.php</span>
<span style="color:teal;">@@ -69,7 +69,6 @@</span> class RegisterEventListenersAndSubscribersPass implements CompilerPassInterface
            return $a &gt; $b ? -1 : 1;
        };


        if (!empty($taggedSubscribers)) {
            $subscribersPerCon = $this-&gt;groupByConnection($taggedSubscribers);
            foreach ($subscribersPerCon as $con =&gt; $subscribers) {
<span style="color:teal;">@@ -77,6 +76,10 @@</span> class RegisterEventListenersAndSubscribersPass implements CompilerPassInterface

                uasort($subscribers, $sortFunc);
                foreach ($subscribers as $id =&gt; $instance) {
                    <span style="color:green;">if ($container-&gt;getDefinition($id)-&gt;isAbstract()) {</span>
<span style="color:green;">                        throw new \InvalidArgumentException(sprintf('The abstract service &quot;%s&quot; cannot be tagged as a doctrine event subscriber.', $id));</span>
<span style="color:green;">                    }</span>

                    $em-&gt;addMethodCall('addEventSubscriber', array(new Reference($id)));
                }
            }
<span style="color:teal;">@@ -89,6 +92,10 @@</span> class RegisterEventListenersAndSubscribersPass implements CompilerPassInterface

                uasort($listeners, $sortFunc);
                foreach ($listeners as $id =&gt; $instance) {
                    <span style="color:green;">if ($container-&gt;getDefinition($id)-&gt;isAbstract()) {</span>
<span style="color:green;">                        throw new \InvalidArgumentException(sprintf('The abstract service &quot;%s&quot; cannot be tagged as a doctrine event listener.', $id));</span>
<span style="color:green;">                    }</span>

                    $em-&gt;addMethodCall('addEventListener', array(
                        array_unique($instance['event']),
                        isset($instance['lazy']) &amp;&amp; $instance['lazy'] ? $id : new Reference($id),
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterMappingsPass.php b/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterMappingsPass.php</span>
<span style="font-weight:bold;">index ac3ce490aa..e56baa1e48 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterMappingsPass.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/DependencyInjection/CompilerPass/RegisterMappingsPass.php</span>
<span style="color:teal;">@@ -74,7 +74,7 @@</span> abstract class RegisterMappingsPass implements CompilerPassInterface
     * @param string[]             $managerParameters list of container parameters
     *                                                that could hold the manager name
     * @param string               $driverPattern     pattern to get the metadata driver service names
     * @param <span style="color:red;">string</span><span style="color:green;">string|false</span>         $enabledParameter  service container parameter that must be
     *                                                present to enable the mapping. Set to false
     *                                                to not do any check, optional.
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/Logger/DbalLogger.php b/src/Symfony/Bridge/Doctrine/Logger/DbalLogger.php</span>
<span style="font-weight:bold;">index 3d103e215c..617dd5c3fa 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/Logger/DbalLogger.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/Logger/DbalLogger.php</span>
<span style="color:teal;">@@ -56,15 +56,15 @@</span> class DbalLogger implements SQLLogger
                }

                // non utf-8 strings break json encoding
                if <span style="color:red;">(!preg_match('#[\p{L}\p{N} ]#u',</span><span style="color:green;">(!preg_match('//u',</span> $params[$index])) {
                    $params[$index] = self::BINARY_DATA_VALUE;
                    continue;
                }

                // detect if the too long string must be shorten
                if <span style="color:red;">(function_exists('mb_detect_encoding') &amp;&amp; false !== $encoding = mb_detect_encoding($params[$index]))</span><span style="color:green;">(function_exists('mb_strlen'))</span> {
                    if (self::MAX_STRING_LENGTH &lt; mb_strlen($params[$index], <span style="color:red;">$encoding))</span><span style="color:green;">'UTF-8'))</span> {
                        $params[$index] = mb_substr($params[$index], 0, self::MAX_STRING_LENGTH - 6, <span style="color:red;">$encoding).'</span><span style="color:green;">'UTF-8').'</span> [...]';
                        continue;
                    }
                } else {
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/Tests/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPassTest.php b/src/Symfony/Bridge/Doctrine/Tests/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPassTest.php</span>
<span style="font-weight:bold;">index 424f448c5e..6e8cf639c8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/Tests/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPassTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/Tests/DependencyInjection/CompilerPass/RegisterEventListenersAndSubscribersPassTest.php</span>
<span style="color:teal;">@@ -13,9 +13,42 @@</span> namespace Symfony\Bridge\Doctrine\Tests\DependencyInjection\CompilerPass;

use Symfony\Bridge\Doctrine\DependencyInjection\CompilerPass\RegisterEventListenersAndSubscribersPass;
use Symfony\Component\DependencyInjection\ContainerBuilder;
<span style="color:green;">use Symfony\Component\DependencyInjection\Definition;</span>

class RegisterEventListenersAndSubscribersPassTest extends \PHPUnit_Framework_TestCase
{
    <span style="color:green;">/**</span>
<span style="color:green;">     * @expectedException InvalidArgumentException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testExceptionOnAbstractTaggedSubscriber()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = $this-&gt;createBuilder();</span>

<span style="color:green;">        $abstractDefinition = new Definition('stdClass');</span>
<span style="color:green;">        $abstractDefinition-&gt;setAbstract(true);</span>
<span style="color:green;">        $abstractDefinition-&gt;addTag('doctrine.event_subscriber');</span>

<span style="color:green;">        $container-&gt;setDefinition('a', $abstractDefinition);</span>

<span style="color:green;">        $this-&gt;process($container);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException InvalidArgumentException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testExceptionOnAbstractTaggedListener()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = $this-&gt;createBuilder();</span>

<span style="color:green;">        $abstractDefinition = new Definition('stdClass');</span>
<span style="color:green;">        $abstractDefinition-&gt;setAbstract(true);</span>
<span style="color:green;">        $abstractDefinition-&gt;addTag('doctrine.event_listener', array('event' =&gt; 'test'));</span>

<span style="color:green;">        $container-&gt;setDefinition('a', $abstractDefinition);</span>

<span style="color:green;">        $this-&gt;process($container);</span>
<span style="color:green;">    }</span>

    public function testProcessEventListenersWithPriorities()
    {
        $container = $this-&gt;createBuilder();
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/Tests/Logger/DbalLoggerTest.php b/src/Symfony/Bridge/Doctrine/Tests/Logger/DbalLoggerTest.php</span>
<span style="font-weight:bold;">index 741c894e33..0c39008d49 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/Tests/Logger/DbalLoggerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/Tests/Logger/DbalLoggerTest.php</span>
<span style="color:teal;">@@ -43,7 +43,10 @@</span> class DbalLoggerTest extends \PHPUnit_Framework_TestCase
        return array(
            array('SQL', null, array()),
            array('SQL', array(), array()),
            array('SQL', array('foo' =&gt; 'bar'), array('foo' =&gt; <span style="color:red;">'bar'))</span><span style="color:green;">'bar')),</span>
<span style="color:green;">            array('SQL', array('foo' =&gt; &quot;\x7F\xFF&quot;), array('foo' =&gt; DbalLogger::BINARY_DATA_VALUE)),</span>
<span style="color:green;">            array('SQL', array('foo' =&gt; &quot;bar\x7F\xFF&quot;), array('foo' =&gt; DbalLogger::BINARY_DATA_VALUE)),</span>
<span style="color:green;">            array('SQL', array('foo' =&gt; ''), array('foo' =&gt; '')),</span>
        );
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueEntityValidatorTest.php b/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueEntityValidatorTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..44dfc853df</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueEntityValidatorTest.php</span>
<span style="color:teal;">@@ -0,0 +1,414 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bridge\Doctrine\Tests\Validator\Constraints;</span>

<span style="color:green;">use Doctrine\Common\Persistence\ManagerRegistry;</span>
<span style="color:green;">use Doctrine\Common\Persistence\ObjectManager;</span>
<span style="color:green;">use Doctrine\Common\Persistence\ObjectRepository;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Test\DoctrineTestHelper;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Tests\Fixtures\CompositeIntIdEntity;</span>
<span style="color:green;">use Symfony\Component\Validator\Tests\Constraints\AbstractConstraintValidatorTest;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Tests\Fixtures\DoubleNameEntity;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity;</span>
<span style="color:green;">use Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntityValidator;</span>
<span style="color:green;">use Symfony\Component\Validator\Validator;</span>
<span style="color:green;">use Doctrine\ORM\Tools\SchemaTool;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">class UniqueEntityValidatorTest extends AbstractConstraintValidatorTest</span>
<span style="color:green;">{</span>
<span style="color:green;">    const EM_NAME = 'foo';</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var ObjectManager</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $em;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var ManagerRegistry</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $registry;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var ObjectRepository</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $repository;</span>

<span style="color:green;">    protected function setUp()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:green;">        $this-&gt;registry = $this-&gt;createRegistryMock($this-&gt;em);</span>
<span style="color:green;">        $this-&gt;createSchema($this-&gt;em);</span>

<span style="color:green;">        parent::setUp();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createRegistryMock(ObjectManager $em = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $registry = $this-&gt;getMock('Doctrine\Common\Persistence\ManagerRegistry');</span>
<span style="color:green;">        $registry-&gt;expects($this-&gt;any())</span>
<span style="color:green;">                 -&gt;method('getManager')</span>
<span style="color:green;">                 -&gt;with($this-&gt;equalTo(self::EM_NAME))</span>
<span style="color:green;">                 -&gt;will($this-&gt;returnValue($em));</span>

<span style="color:green;">        return $registry;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createRepositoryMock()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $repository = $this-&gt;getMockBuilder('Doctrine\Common\Persistence\ObjectRepository')</span>
<span style="color:green;">            -&gt;setMethods(array('findByCustom', 'find', 'findAll', 'findOneBy', 'findBy', 'getClassName'))</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        return $repository;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createEntityManagerMock($repositoryMock)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $em = $this-&gt;getMockBuilder('Doctrine\Common\Persistence\ObjectManager')</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $em-&gt;expects($this-&gt;any())</span>
<span style="color:green;">             -&gt;method('getRepository')</span>
<span style="color:green;">             -&gt;will($this-&gt;returnValue($repositoryMock))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $classMetadata = $this-&gt;getMock('Doctrine\Common\Persistence\Mapping\ClassMetadata');</span>
<span style="color:green;">        $classMetadata</span>
<span style="color:green;">            -&gt;expects($this-&gt;any())</span>
<span style="color:green;">            -&gt;method('hasField')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $reflParser = $this-&gt;getMockBuilder('Doctrine\Common\Reflection\StaticReflectionParser')</span>
<span style="color:green;">            -&gt;disableOriginalConstructor()</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $refl = $this-&gt;getMockBuilder('Doctrine\Common\Reflection\StaticReflectionProperty')</span>
<span style="color:green;">            -&gt;setConstructorArgs(array($reflParser, 'property-name'))</span>
<span style="color:green;">            -&gt;setMethods(array('getValue'))</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $refl</span>
<span style="color:green;">            -&gt;expects($this-&gt;any())</span>
<span style="color:green;">            -&gt;method('getValue')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $classMetadata-&gt;reflFields = array('name' =&gt; $refl);</span>
<span style="color:green;">        $em-&gt;expects($this-&gt;any())</span>
<span style="color:green;">             -&gt;method('getClassMetadata')</span>
<span style="color:green;">             -&gt;will($this-&gt;returnValue($classMetadata))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        return $em;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createValidator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new UniqueEntityValidator($this-&gt;registry);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function createSchema(ObjectManager $em)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $schemaTool = new SchemaTool($em);</span>
<span style="color:green;">        $schemaTool-&gt;createSchema(array(</span>
<span style="color:green;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity'),</span>
<span style="color:green;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\DoubleNameEntity'),</span>
<span style="color:green;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\CompositeIntIdEntity'),</span>
<span style="color:green;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity'),</span>
<span style="color:green;">        ));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * This is a functional test as there is a large integration necessary to get the validator working.</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testValidateUniqueness()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity1 = new SingleIntIdEntity(1, 'Foo');</span>
<span style="color:green;">        $entity2 = new SingleIntIdEntity(2, 'Foo');</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($entity1);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity2, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(), 'property.path.name', 'Foo');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testValidateCustomErrorPath()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">            'errorPath' =&gt; 'bar',</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity1 = new SingleIntIdEntity(1, 'Foo');</span>
<span style="color:green;">        $entity2 = new SingleIntIdEntity(2, 'Foo');</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($entity1);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity2, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(), 'property.path.bar', 'Foo');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testValidateUniquenessWithNull()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity1 = new SingleIntIdEntity(1, null);</span>
<span style="color:green;">        $entity2 = new SingleIntIdEntity(2, null);</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($entity1);</span>
<span style="color:green;">        $this-&gt;em-&gt;persist($entity2);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testValidateUniquenessWithIgnoreNull()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name', 'name2'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">            'ignoreNull' =&gt; false,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity1 = new DoubleNameEntity(1, 'Foo', null);</span>
<span style="color:green;">        $entity2 = new DoubleNameEntity(2, 'Foo', null);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($entity1);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity2, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(), 'property.path.name', 'Foo');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testValidateUniquenessUsingCustomRepositoryMethod()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">            'repositoryMethod' =&gt; 'findByCustom',</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $repository = $this-&gt;createRepositoryMock();</span>
<span style="color:green;">        $repository-&gt;expects($this-&gt;once())</span>
<span style="color:green;">             -&gt;method('findByCustom')</span>
<span style="color:green;">             -&gt;will($this-&gt;returnValue(array()))</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $this-&gt;em = $this-&gt;createEntityManagerMock($repository);</span>
<span style="color:green;">        $this-&gt;registry = $this-&gt;createRegistryMock($this-&gt;em);</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        $entity1 = new SingleIntIdEntity(1, 'foo');</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity1, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testValidateUniquenessWithUnrewoundArray()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">            'repositoryMethod' =&gt; 'findByCustom',</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity = new SingleIntIdEntity(1, 'foo');</span>

<span style="color:green;">        $repository = $this-&gt;createRepositoryMock();</span>
<span style="color:green;">        $repository-&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('findByCustom')</span>
<span style="color:green;">            -&gt;will(</span>
<span style="color:green;">                $this-&gt;returnCallback(function () use ($entity) {</span>
<span style="color:green;">                    $returnValue = array(</span>
<span style="color:green;">                        $entity,</span>
<span style="color:green;">                    );</span>
<span style="color:green;">                    next($returnValue);</span>

<span style="color:green;">                    return $returnValue;</span>
<span style="color:green;">                })</span>
<span style="color:green;">            )</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $this-&gt;em = $this-&gt;createEntityManagerMock($repository);</span>
<span style="color:green;">        $this-&gt;registry = $this-&gt;createRegistryMock($this-&gt;em);</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @group GH-1635</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testAssociatedEntity()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('single'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $entity1 = new SingleIntIdEntity(1, 'foo');</span>
<span style="color:green;">        $associated = new AssociationEntity();</span>
<span style="color:green;">        $associated-&gt;single = $entity1;</span>
<span style="color:green;">        $associated2 = new AssociationEntity();</span>
<span style="color:green;">        $associated2-&gt;single = $entity1;</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($entity1);</span>
<span style="color:green;">        $this-&gt;em-&gt;persist($associated);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($associated, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($associated2);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($associated2, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(), 'property.path.single', 1);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testAssociatedEntityWithNull()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('single'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">            'ignoreNull' =&gt; false,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $associated = new AssociationEntity();</span>
<span style="color:green;">        $associated-&gt;single = null;</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($associated);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($associated, $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\Validator\Exception\ConstraintDefinitionException</span>
<span style="color:green;">     * @expectedExceptionMessage Associated entities are not allowed to have more than one identifier field</span>
<span style="color:green;">     * @group GH-1635</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testAssociatedCompositeEntity()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('composite'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $composite = new CompositeIntIdEntity(1, 1, &quot;test&quot;);</span>
<span style="color:green;">        $associated = new AssociationEntity();</span>
<span style="color:green;">        $associated-&gt;composite = $composite;</span>

<span style="color:green;">        $this-&gt;em-&gt;persist($composite);</span>
<span style="color:green;">        $this-&gt;em-&gt;persist($associated);</span>
<span style="color:green;">        $this-&gt;em-&gt;flush();</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($associated, $constraint);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\Validator\Exception\ConstraintDefinitionException</span>
<span style="color:green;">     * @expectedExceptionMessage Object manager &quot;foo&quot; does not exist.</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testDedicatedEntityManagerNullObject()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            'em' =&gt; self::EM_NAME,</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $this-&gt;em = null;</span>
<span style="color:green;">        $this-&gt;registry = $this-&gt;createRegistryMock($this-&gt;em);</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        $entity = new SingleIntIdEntity(1, null);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity, $constraint);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\Validator\Exception\ConstraintDefinitionException</span>
<span style="color:green;">     * @expectedExceptionMessage Unable to find the object manager associated with an entity of class &quot;Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity&quot;</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testEntityManagerNullObject()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new UniqueEntity(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">            'fields' =&gt; array('name'),</span>
<span style="color:green;">            // no &quot;em&quot; option set</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        $this-&gt;em = null;</span>
<span style="color:green;">        $this-&gt;registry = $this-&gt;createRegistryMock($this-&gt;em);</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        $entity = new SingleIntIdEntity(1, null);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($entity, $constraint);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueValidatorTest.php b/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueValidatorTest.php</span>
<span style="font-weight:bold;">deleted file mode 100644</span>
<span style="font-weight:bold;">index c96418de4a..0000000000</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Doctrine/Tests/Validator/Constraints/UniqueValidatorTest.php</span>
<span style="font-weight:bold;">+++ /dev/null</span>
<span style="color:teal;">@@ -1,424 +0,0 @@</span>
<span style="color:red;">&lt;?php</span>

<span style="color:red;">/*</span>
<span style="color:red;"> * This file is part of the Symfony package.</span>
<span style="color:red;"> *</span>
<span style="color:red;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:red;"> *</span>
<span style="color:red;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:red;"> * file that was distributed with this source code.</span>
<span style="color:red;"> */</span>

<span style="color:red;">namespace Symfony\Bridge\Doctrine\Tests\Validator\Constraints;</span>

<span style="color:red;">use Symfony\Bridge\Doctrine\Test\DoctrineTestHelper;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Tests\Fixtures\CompositeIntIdEntity;</span>
<span style="color:red;">use Symfony\Component\Validator\DefaultTranslator;</span>
<span style="color:red;">use Symfony\Component\Validator\Tests\Fixtures\FakeMetadataFactory;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Tests\Fixtures\DoubleNameEntity;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity;</span>
<span style="color:red;">use Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntityValidator;</span>
<span style="color:red;">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span style="color:red;">use Symfony\Component\Validator\Validator;</span>
<span style="color:red;">use Doctrine\ORM\Tools\SchemaTool;</span>

<span style="color:red;">class UniqueValidatorTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:red;">{</span>
<span style="color:red;">    protected function createRegistryMock($entityManagerName, $em)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $registry = $this-&gt;getMock('Doctrine\Common\Persistence\ManagerRegistry');</span>
<span style="color:red;">        $registry-&gt;expects($this-&gt;any())</span>
<span style="color:red;">                 -&gt;method('getManager')</span>
<span style="color:red;">                 -&gt;with($this-&gt;equalTo($entityManagerName))</span>
<span style="color:red;">                 -&gt;will($this-&gt;returnValue($em));</span>

<span style="color:red;">        return $registry;</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function createRepositoryMock()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $repository = $this-&gt;getMockBuilder('Doctrine\Common\Persistence\ObjectRepository')</span>
<span style="color:red;">            -&gt;setMethods(array('findByCustom', 'find', 'findAll', 'findOneBy', 'findBy', 'getClassName'))</span>
<span style="color:red;">            -&gt;getMock()</span>
<span style="color:red;">        ;</span>

<span style="color:red;">        return $repository;</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function createEntityManagerMock($repositoryMock)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $em = $this-&gt;getMockBuilder('Doctrine\Common\Persistence\ObjectManager')</span>
<span style="color:red;">            -&gt;getMock()</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $em-&gt;expects($this-&gt;any())</span>
<span style="color:red;">             -&gt;method('getRepository')</span>
<span style="color:red;">             -&gt;will($this-&gt;returnValue($repositoryMock))</span>
<span style="color:red;">        ;</span>

<span style="color:red;">        $classMetadata = $this-&gt;getMock('Doctrine\Common\Persistence\Mapping\ClassMetadata');</span>
<span style="color:red;">        $classMetadata</span>
<span style="color:red;">            -&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('hasField')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $reflParser = $this-&gt;getMockBuilder('Doctrine\Common\Reflection\StaticReflectionParser')</span>
<span style="color:red;">            -&gt;disableOriginalConstructor()</span>
<span style="color:red;">            -&gt;getMock()</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $refl = $this-&gt;getMockBuilder('Doctrine\Common\Reflection\StaticReflectionProperty')</span>
<span style="color:red;">            -&gt;setConstructorArgs(array($reflParser, 'property-name'))</span>
<span style="color:red;">            -&gt;setMethods(array('getValue'))</span>
<span style="color:red;">            -&gt;getMock()</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $refl</span>
<span style="color:red;">            -&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getValue')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $classMetadata-&gt;reflFields = array('name' =&gt; $refl);</span>
<span style="color:red;">        $em-&gt;expects($this-&gt;any())</span>
<span style="color:red;">             -&gt;method('getClassMetadata')</span>
<span style="color:red;">             -&gt;will($this-&gt;returnValue($classMetadata))</span>
<span style="color:red;">        ;</span>

<span style="color:red;">        return $em;</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function createValidatorFactory($uniqueValidator)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $validatorFactory = $this-&gt;getMock('Symfony\Component\Validator\ConstraintValidatorFactoryInterface');</span>
<span style="color:red;">        $validatorFactory-&gt;expects($this-&gt;any())</span>
<span style="color:red;">                         -&gt;method('getInstance')</span>
<span style="color:red;">                         -&gt;with($this-&gt;isInstanceOf('Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity'))</span>
<span style="color:red;">                         -&gt;will($this-&gt;returnValue($uniqueValidator));</span>

<span style="color:red;">        return $validatorFactory;</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function createValidator($entityManagerName, $em, $validateClass = null, $uniqueFields = null, $errorPath = null, $repositoryMethod = 'findBy', $ignoreNull = true)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (!$validateClass) {</span>
<span style="color:red;">            $validateClass = 'Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity';</span>
<span style="color:red;">        }</span>
<span style="color:red;">        if (!$uniqueFields) {</span>
<span style="color:red;">            $uniqueFields = array('name');</span>
<span style="color:red;">        }</span>

<span style="color:red;">        $registry = $this-&gt;createRegistryMock($entityManagerName, $em);</span>

<span style="color:red;">        $uniqueValidator = new UniqueEntityValidator($registry);</span>

<span style="color:red;">        $metadata = new ClassMetadata($validateClass);</span>
<span style="color:red;">        $constraint = new UniqueEntity(array(</span>
<span style="color:red;">            'fields' =&gt; $uniqueFields,</span>
<span style="color:red;">            'em' =&gt; $entityManagerName,</span>
<span style="color:red;">            'errorPath' =&gt; $errorPath,</span>
<span style="color:red;">            'repositoryMethod' =&gt; $repositoryMethod,</span>
<span style="color:red;">            'ignoreNull' =&gt; $ignoreNull</span>
<span style="color:red;">        ));</span>
<span style="color:red;">        $metadata-&gt;addConstraint($constraint);</span>

<span style="color:red;">        $metadataFactory = new FakeMetadataFactory();</span>
<span style="color:red;">        $metadataFactory-&gt;addMetadata($metadata);</span>
<span style="color:red;">        $validatorFactory = $this-&gt;createValidatorFactory($uniqueValidator);</span>

<span style="color:red;">        return new Validator($metadataFactory, $validatorFactory, new DefaultTranslator());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    private function createSchema($em)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $schemaTool = new SchemaTool($em);</span>
<span style="color:red;">        $schemaTool-&gt;createSchema(array(</span>
<span style="color:red;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity'),</span>
<span style="color:red;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\DoubleNameEntity'),</span>
<span style="color:red;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\CompositeIntIdEntity'),</span>
<span style="color:red;">            $em-&gt;getClassMetadata('Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity'),</span>
<span style="color:red;">        ));</span>
<span style="color:red;">    }</span>

<span style="color:red;">    /**</span>
<span style="color:red;">     * This is a functional test as there is a large integration necessary to get the validator working.</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function testValidateUniqueness()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em);</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, 'Foo');</span>
<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), &quot;No violations found on entity before it is saved to the database.&quot;);</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), &quot;No violations found on entity after it was saved to the database.&quot;);</span>

<span style="color:red;">        $entity2 = new SingleIntIdEntity(2, 'Foo');</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity2);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count(), &quot;Violation found on entity with conflicting entity existing in the database.&quot;);</span>

<span style="color:red;">        $violation = $violationsList[0];</span>
<span style="color:red;">        $this-&gt;assertEquals('This value is already used.', $violation-&gt;getMessage());</span>
<span style="color:red;">        $this-&gt;assertEquals('name', $violation-&gt;getPropertyPath());</span>
<span style="color:red;">        $this-&gt;assertEquals('Foo', $violation-&gt;getInvalidValue());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateCustomErrorPath()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, null, null, 'bar');</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, 'Foo');</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $entity2 = new SingleIntIdEntity(2, 'Foo');</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity2);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count(), &quot;Violation found on entity with conflicting entity existing in the database.&quot;);</span>

<span style="color:red;">        $violation = $violationsList[0];</span>
<span style="color:red;">        $this-&gt;assertEquals('This value is already used.', $violation-&gt;getMessage());</span>
<span style="color:red;">        $this-&gt;assertEquals('bar', $violation-&gt;getPropertyPath());</span>
<span style="color:red;">        $this-&gt;assertEquals('Foo', $violation-&gt;getInvalidValue());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateUniquenessWithNull()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em);</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, null);</span>
<span style="color:red;">        $entity2 = new SingleIntIdEntity(2, null);</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;persist($entity2);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), &quot;No violations found on entity having a null value.&quot;);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateUniquenessWithIgnoreNull()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $validateClass = 'Symfony\Bridge\Doctrine\Tests\Fixtures\DoubleNameEntity';</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, $validateClass, array('name', 'name2'), 'bar', 'findby', false);</span>

<span style="color:red;">        $entity1 = new DoubleNameEntity(1, 'Foo', null);</span>
<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), &quot;No violations found on entity before it is saved to the database.&quot;);</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), &quot;No violations found on entity after it was saved to the database.&quot;);</span>

<span style="color:red;">        $entity2 = new DoubleNameEntity(2, 'Foo', null);</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity2);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count(), &quot;Violation found on entity with conflicting entity existing in the database.&quot;);</span>

<span style="color:red;">        $violation = $violationsList[0];</span>
<span style="color:red;">        $this-&gt;assertEquals('This value is already used.', $violation-&gt;getMessage());</span>
<span style="color:red;">        $this-&gt;assertEquals('bar', $violation-&gt;getPropertyPath());</span>
<span style="color:red;">        $this-&gt;assertEquals('Foo', $violation-&gt;getInvalidValue());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateUniquenessAfterConsideringMultipleQueryResults()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em);</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, 'foo');</span>
<span style="color:red;">        $entity2 = new SingleIntIdEntity(2, 'foo');</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;persist($entity2);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count(), 'Violation found on entity with conflicting entity existing in the database.');</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity2);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count(), 'Violation found on entity with conflicting entity existing in the database.');</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateUniquenessUsingCustomRepositoryMethod()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = 'foo';</span>
<span style="color:red;">        $repository = $this-&gt;createRepositoryMock();</span>
<span style="color:red;">        $repository-&gt;expects($this-&gt;once())</span>
<span style="color:red;">             -&gt;method('findByCustom')</span>
<span style="color:red;">             -&gt;will($this-&gt;returnValue(array()))</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $em = $this-&gt;createEntityManagerMock($repository);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, null, array(), null, 'findByCustom');</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, 'foo');</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity1);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count(), 'Violation is using custom repository method.');</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testValidateUniquenessWithUnrewoundArray()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entity = new SingleIntIdEntity(1, 'foo');</span>

<span style="color:red;">        $entityManagerName = 'foo';</span>
<span style="color:red;">        $repository = $this-&gt;createRepositoryMock();</span>
<span style="color:red;">        $repository-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('findByCustom')</span>
<span style="color:red;">            -&gt;will(</span>
<span style="color:red;">                $this-&gt;returnCallback(function () use ($entity) {</span>
<span style="color:red;">                    $returnValue = array(</span>
<span style="color:red;">                        $entity,</span>
<span style="color:red;">                    );</span>
<span style="color:red;">                    next($returnValue);</span>

<span style="color:red;">                    return $returnValue;</span>
<span style="color:red;">                })</span>
<span style="color:red;">            )</span>
<span style="color:red;">        ;</span>
<span style="color:red;">        $em = $this-&gt;createEntityManagerMock($repository);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, null, array(), null, 'findByCustom');</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($entity);</span>
<span style="color:red;">        $this-&gt;assertCount(0, $violationsList, 'Violation is using unrewound array as return value in the repository method.');</span>
<span style="color:red;">    }</span>

<span style="color:red;">    /**</span>
<span style="color:red;">     * @group GH-1635</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function testAssociatedEntity()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, 'Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity', array('single'));</span>

<span style="color:red;">        $entity1 = new SingleIntIdEntity(1, 'foo');</span>
<span style="color:red;">        $associated = new AssociationEntity();</span>
<span style="color:red;">        $associated-&gt;single = $entity1;</span>

<span style="color:red;">        $em-&gt;persist($entity1);</span>
<span style="color:red;">        $em-&gt;persist($associated);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($associated);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count());</span>

<span style="color:red;">        $associated2 = new AssociationEntity();</span>
<span style="color:red;">        $associated2-&gt;single = $entity1;</span>

<span style="color:red;">        $em-&gt;persist($associated2);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($associated2);</span>
<span style="color:red;">        $this-&gt;assertEquals(1, $violationsList-&gt;count());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testAssociatedEntityWithNull()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, 'Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity', array('single'), null, 'findBy', false);</span>

<span style="color:red;">        $associated = new AssociationEntity();</span>
<span style="color:red;">        $associated-&gt;single = null;</span>

<span style="color:red;">        $em-&gt;persist($associated);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $violationsList = $validator-&gt;validate($associated);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $violationsList-&gt;count());</span>
<span style="color:red;">    }</span>

<span style="color:red;">    /**</span>
<span style="color:red;">     * @group GH-1635</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function testAssociatedCompositeEntity()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $entityManagerName = &quot;foo&quot;;</span>
<span style="color:red;">        $em = DoctrineTestHelper::createTestEntityManager();</span>
<span style="color:red;">        $this-&gt;createSchema($em);</span>
<span style="color:red;">        $validator = $this-&gt;createValidator($entityManagerName, $em, 'Symfony\Bridge\Doctrine\Tests\Fixtures\AssociationEntity', array('composite'));</span>

<span style="color:red;">        $composite = new CompositeIntIdEntity(1, 1, &quot;test&quot;);</span>
<span style="color:red;">        $associated = new AssociationEntity();</span>
<span style="color:red;">        $associated-&gt;composite = $composite;</span>

<span style="color:red;">        $em-&gt;persist($composite);</span>
<span style="color:red;">        $em-&gt;persist($associated);</span>
<span style="color:red;">        $em-&gt;flush();</span>

<span style="color:red;">        $this-&gt;setExpectedException(</span>
<span style="color:red;">            'Symfony\Component\Validator\Exception\ConstraintDefinitionException',</span>
<span style="color:red;">            'Associated entities are not allowed to have more than one identifier field'</span>
<span style="color:red;">        );</span>
<span style="color:red;">        $violationsList = $validator-&gt;validate($associated);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testDedicatedEntityManagerNullObject()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $uniqueFields = array('name');</span>
<span style="color:red;">        $entityManagerName = 'foo';</span>

<span style="color:red;">        $registry = $this-&gt;getMock('Doctrine\Common\Persistence\ManagerRegistry');</span>

<span style="color:red;">        $constraint = new UniqueEntity(array(</span>
<span style="color:red;">            'fields' =&gt; $uniqueFields,</span>
<span style="color:red;">            'em' =&gt; $entityManagerName,</span>
<span style="color:red;">        ));</span>

<span style="color:red;">        $uniqueValidator = new UniqueEntityValidator($registry);</span>

<span style="color:red;">        $entity = new SingleIntIdEntity(1, null);</span>

<span style="color:red;">        $this-&gt;setExpectedException(</span>
<span style="color:red;">            'Symfony\Component\Validator\Exception\ConstraintDefinitionException',</span>
<span style="color:red;">            'Object manager &quot;foo&quot; does not exist.'</span>
<span style="color:red;">        );</span>

<span style="color:red;">        $uniqueValidator-&gt;validate($entity, $constraint);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function testEntityManagerNullObject()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $uniqueFields = array('name');</span>

<span style="color:red;">        $registry = $this-&gt;getMock('Doctrine\Common\Persistence\ManagerRegistry');</span>

<span style="color:red;">        $constraint = new UniqueEntity(array(</span>
<span style="color:red;">            'fields' =&gt; $uniqueFields,</span>
<span style="color:red;">        ));</span>

<span style="color:red;">        $uniqueValidator = new UniqueEntityValidator($registry);</span>

<span style="color:red;">        $entity = new SingleIntIdEntity(1, null);</span>

<span style="color:red;">        $this-&gt;setExpectedException(</span>
<span style="color:red;">            'Symfony\Component\Validator\Exception\ConstraintDefinitionException',</span>
<span style="color:red;">            'Unable to find the object manager associated with an entity of class &quot;Symfony\Bridge\Doctrine\Tests\Fixtures\SingleIntIdEntity&quot;'</span>
<span style="color:red;">        );</span>

<span style="color:red;">        $uniqueValidator-&gt;validate($entity, $constraint);</span>
<span style="color:red;">    }</span>
<span style="color:red;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Monolog/Handler/ConsoleHandler.php b/src/Symfony/Bridge/Monolog/Handler/ConsoleHandler.php</span>
<span style="font-weight:bold;">index 58c249c97c..88658e7ade 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Monolog/Handler/ConsoleHandler.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Monolog/Handler/ConsoleHandler.php</span>
<span style="color:teal;">@@ -139,8 +139,8 @@</span> class ConsoleHandler extends AbstractProcessingHandler implements EventSubscribe
    public static function getSubscribedEvents()
    {
        return array(
            ConsoleEvents::COMMAND =&gt; <span style="color:red;">'onCommand',</span><span style="color:green;">array('onCommand', 255),</span>
            ConsoleEvents::TERMINATE =&gt; <span style="color:red;">'onTerminate'</span><span style="color:green;">array('onTerminate', -255),</span>
        );
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Monolog/Tests/Handler/ConsoleHandlerTest.php b/src/Symfony/Bridge/Monolog/Tests/Handler/ConsoleHandlerTest.php</span>
<span style="font-weight:bold;">index 3266543e7d..13fd2c037a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Monolog/Tests/Handler/ConsoleHandlerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Monolog/Tests/Handler/ConsoleHandlerTest.php</span>
<span style="color:teal;">@@ -13,7 +13,13 @@</span> namespace Symfony\Bridge\Monolog\Tests\Handler;

use Monolog\Logger;
use Symfony\Bridge\Monolog\Handler\ConsoleHandler;
<span style="color:green;">use Symfony\Component\Console\ConsoleEvents;</span>
<span style="color:green;">use Symfony\Component\Console\Event\ConsoleCommandEvent;</span>
<span style="color:green;">use Symfony\Component\Console\Event\ConsoleTerminateEvent;</span>
use Symfony\Component\Console\Output\OutputInterface;
<span style="color:green;">use Symfony\Component\Console\Output\BufferedOutput;</span>
<span style="color:green;">use Symfony\Component\EventDispatcher\EventDispatcher;</span>
<span style="color:green;">use Symfony\Component\Console\Command\Command;</span>

/**
 * Tests the ConsoleHandler and also the ConsoleFormatter.
<span style="color:teal;">@@ -156,4 +162,42 @@</span> class ConsoleHandlerTest extends \PHPUnit_Framework_TestCase

        $this-&gt;assertTrue($handler-&gt;handle($errorRecord), 'The handler finished handling the log as bubble is false.');
    }

    <span style="color:green;">public function testLogsFromListeners()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $output = new BufferedOutput();</span>
<span style="color:green;">        $output-&gt;setVerbosity(OutputInterface::VERBOSITY_DEBUG);</span>

<span style="color:green;">        $handler = new ConsoleHandler(null, false);</span>

<span style="color:green;">        $logger = new Logger('app');</span>
<span style="color:green;">        $logger-&gt;pushHandler($handler);</span>

<span style="color:green;">        $dispatcher = new EventDispatcher();</span>
<span style="color:green;">        $dispatcher-&gt;addListener(ConsoleEvents::COMMAND, function () use ($logger) {</span>
<span style="color:green;">            $logger-&gt;addInfo('Before command message.');</span>
<span style="color:green;">        });</span>
<span style="color:green;">        $dispatcher-&gt;addListener(ConsoleEvents::TERMINATE, function () use ($logger) {</span>
<span style="color:green;">            $logger-&gt;addInfo('Before terminate message.');</span>
<span style="color:green;">        });</span>

<span style="color:green;">        $dispatcher-&gt;addSubscriber($handler);</span>

<span style="color:green;">        $dispatcher-&gt;addListener(ConsoleEvents::COMMAND, function () use ($logger) {</span>
<span style="color:green;">            $logger-&gt;addInfo('After command message.');</span>
<span style="color:green;">        });</span>
<span style="color:green;">        $dispatcher-&gt;addListener(ConsoleEvents::TERMINATE, function () use ($logger) {</span>
<span style="color:green;">            $logger-&gt;addInfo('After terminate message.');</span>
<span style="color:green;">        });</span>

<span style="color:green;">        $event = new ConsoleCommandEvent(new Command('foo'), $this-&gt;getMock('Symfony\Component\Console\Input\InputInterface'), $output);</span>
<span style="color:green;">        $dispatcher-&gt;dispatch(ConsoleEvents::COMMAND, $event);</span>
<span style="color:green;">        $this-&gt;assertContains('Before command message.', $out = $output-&gt;fetch());</span>
<span style="color:green;">        $this-&gt;assertContains('After command message.', $out);</span>

<span style="color:green;">        $event = new ConsoleTerminateEvent(new Command('foo'), $this-&gt;getMock('Symfony\Component\Console\Input\InputInterface'), $output, 0);</span>
<span style="color:green;">        $dispatcher-&gt;dispatch(ConsoleEvents::TERMINATE, $event);</span>
<span style="color:green;">        $this-&gt;assertContains('Before terminate message.', $out = $output-&gt;fetch());</span>
<span style="color:green;">        $this-&gt;assertContains('After terminate message.', $out);</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Propel1/Form/ChoiceList/ModelChoiceList.php b/src/Symfony/Bridge/Propel1/Form/ChoiceList/ModelChoiceList.php</span>
<span style="font-weight:bold;">index 584e03968a..d3772987bf 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Propel1/Form/ChoiceList/ModelChoiceList.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Propel1/Form/ChoiceList/ModelChoiceList.php</span>
<span style="color:teal;">@@ -80,6 +80,9 @@</span> class ModelChoiceList extends ObjectChoiceList
     *                                                    Either an array if $choices is given,
     *                                                    or a ModelCriteria to be merged with the $queryObject.
     * @param PropertyAccessorInterface $propertyAccessor The reflection graph for reading property paths.
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws MissingOptionsException when no model class is given</span>
<span style="color:green;">     * @throws InvalidOptionsException when the model class cannot be found</span>
     */
    public function __construct($class, $labelPath = null, $choices = null, $queryObject = null, $groupPath = null, $preferred = array(), PropertyAccessorInterface $propertyAccessor = null)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Bridge/Twig/Resources/views/Form/form_div_layout.html.twig b/src/Symfony/Bridge/Twig/Resources/views/Form/form_div_layout.html.twig</span>
<span style="font-weight:bold;">index 4cdd828301..025ba908f0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bridge/Twig/Resources/views/Form/form_div_layout.html.twig</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bridge/Twig/Resources/views/Form/form_div_layout.html.twig</span>
<span style="color:teal;">@@ -54,7 +54,7 @@</span>
{% block choice_widget_collapsed -%}
    {% if required and empty_value is none and not empty_value_in_choices and not multiple -%}
        {% set required = false %}
    <span style="color:red;">{%</span><span style="color:green;">{%-</span> endif <span style="color:red;">%}</span><span style="color:green;">-%}</span>
    &lt;select {{ block('widget_attributes') }}{% if multiple %} multiple=&quot;multiple&quot;{% endif %}&gt;
        {% if empty_value is not none -%}
            &lt;option value=&quot;&quot;{% if required and value is empty %} selected=&quot;selected&quot;{% endif %}&gt;{{ empty_value|trans({}, translation_domain) }}&lt;/option&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Command/ServerRunCommand.php b/src/Symfony/Bundle/FrameworkBundle/Command/ServerRunCommand.php</span>
<span style="font-weight:bold;">index 63588d5264..3535167910 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Command/ServerRunCommand.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Command/ServerRunCommand.php</span>
<span style="color:teal;">@@ -81,6 +81,14 @@</span> EOF
     */
    protected function execute(InputInterface $input, OutputInterface $output)
    {
        <span style="color:green;">$documentRoot = $input-&gt;getOption('docroot');</span>

<span style="color:green;">        if (!is_dir($documentRoot)) {</span>
<span style="color:green;">            $output-&gt;writeln(sprintf('&lt;error&gt;The given document root directory &quot;%s&quot; does not exist&lt;/error&gt;', $documentRoot));</span>

<span style="color:green;">            return 1;</span>
<span style="color:green;">        }</span>

        $env = $this-&gt;getContainer()-&gt;getParameter('kernel.environment');

        if ('prod' === $env) {
<span style="color:teal;">@@ -96,7 +104,7 @@</span> EOF
        $output-&gt;writeln(sprintf(&quot;Server running on &lt;info&gt;http://%s&lt;/info&gt;\n&quot;, $input-&gt;getArgument('address')));

        $builder = new ProcessBuilder(array(PHP_BINARY, '-S', $input-&gt;getArgument('address'), $router));
        <span style="color:red;">$builder-&gt;setWorkingDirectory($input-&gt;getOption('docroot'));</span><span style="color:green;">$builder-&gt;setWorkingDirectory($documentRoot);</span>
        $builder-&gt;setTimeout(null);
        $builder-&gt;getProcess()-&gt;run(function ($type, $buffer) use ($output) {
            if (OutputInterface::VERBOSITY_VERBOSE &lt;= $output-&gt;getVerbosity()) {
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/DependencyInjection/Configuration.php b/src/Symfony/Bundle/FrameworkBundle/DependencyInjection/Configuration.php</span>
<span style="font-weight:bold;">index 0c1d1578c6..b7c57ff08f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/DependencyInjection/Configuration.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/DependencyInjection/Configuration.php</span>
<span style="color:teal;">@@ -41,7 +41,7 @@</span> class Configuration implements ConfigurationInterface
                -&gt;end()
                -&gt;arrayNode('trusted_proxies')
                    -&gt;beforeNormalization()
                        -&gt;ifTrue(function ($v) { return !is_array($v) &amp;&amp; <span style="color:red;">!is_null($v);</span><span style="color:green;">null !== $v;</span> })
                        -&gt;then(function ($v) { return is_bool($v) ? array() : preg_split('/\s*,\s*/', $v); })
                    -&gt;end()
                    -&gt;prototype('scalar')
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Resources/config/fragment_renderer.xml b/src/Symfony/Bundle/FrameworkBundle/Resources/config/fragment_renderer.xml</span>
<span style="font-weight:bold;">index a1beee30a1..a6320b7f04 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Resources/config/fragment_renderer.xml</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Resources/config/fragment_renderer.xml</span>
<span style="color:teal;">@@ -39,6 +39,7 @@</span>
            &lt;tag name=&quot;kernel.fragment_renderer&quot; /&gt;
            &lt;argument type=&quot;service&quot; id=&quot;esi&quot; on-invalid=&quot;null&quot; /&gt;
            &lt;argument type=&quot;service&quot; id=&quot;fragment.renderer.inline&quot; /&gt;
            <span style="color:green;">&lt;argument type=&quot;service&quot; id=&quot;uri_signer&quot; /&gt;</span>
            &lt;call method=&quot;setFragmentPath&quot;&gt;&lt;argument&gt;%fragment.path%&lt;/argument&gt;&lt;/call&gt;
        &lt;/service&gt;
    &lt;/services&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_dev.php b/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_dev.php</span>
<span style="font-weight:bold;">index 64c90b4bd2..9e70bf7acd 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_dev.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_dev.php</span>
<span style="color:teal;">@@ -25,6 +25,7 @@</span> if (is_file($_SERVER['DOCUMENT_ROOT'].DIRECTORY_SEPARATOR.$_SERVER['SCRIPT_NAME'
    return false;
}

<span style="color:green;">$_SERVER = array_merge($_SERVER, $_ENV);</span>
$_SERVER['SCRIPT_FILENAME'] = $_SERVER['DOCUMENT_ROOT'].DIRECTORY_SEPARATOR.'app_dev.php';

require 'app_dev.php';
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_prod.php b/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_prod.php</span>
<span style="font-weight:bold;">index 4278b4bba1..a3ef29d8db 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_prod.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Resources/config/router_prod.php</span>
<span style="color:teal;">@@ -25,6 +25,7 @@</span> if (is_file($_SERVER['DOCUMENT_ROOT'].DIRECTORY_SEPARATOR.$_SERVER['SCRIPT_NAME'
    return false;
}

<span style="color:green;">$_SERVER = array_merge($_SERVER, $_ENV);</span>
$_SERVER['SCRIPT_FILENAME'] = $_SERVER['DOCUMENT_ROOT'].DIRECTORY_SEPARATOR.'app.php';

require 'app.php';
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Resources/config/schema/symfony-1.0.xsd b/src/Symfony/Bundle/FrameworkBundle/Resources/config/schema/symfony-1.0.xsd</span>
<span style="font-weight:bold;">index 92c8952e48..2faeb690f8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Resources/config/schema/symfony-1.0.xsd</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Resources/config/schema/symfony-1.0.xsd</span>
<span style="color:teal;">@@ -113,6 +113,7 @@</span>
        &lt;xsd:attribute name=&quot;assets-version&quot; type=&quot;xsd:string&quot; /&gt;
        &lt;xsd:attribute name=&quot;assets-version-format&quot; type=&quot;xsd:string&quot; /&gt;
        &lt;xsd:attribute name=&quot;cache&quot; type=&quot;xsd:string&quot; /&gt;
        <span style="color:green;">&lt;xsd:attribute name=&quot;hinclude-default-template&quot; type=&quot;xsd:string&quot; /&gt;</span>
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name=&quot;form-resources&quot;&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form/choice_widget_collapsed.html.php b/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form/choice_widget_collapsed.html.php</span>
<span style="font-weight:bold;">index 345be23b03..be78e46e8c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form/choice_widget_collapsed.html.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Resources/views/Form/choice_widget_collapsed.html.php</span>
<span style="color:teal;">@@ -1,5 +1,5 @@</span>
&lt;select
    &lt;?php if ($required &amp;&amp;<span style="color:red;">$empty_value ===</span> null <span style="color:green;">=== $empty_value</span> &amp;&amp; $empty_value_in_choices === false &amp;&amp; $multiple === false):
        $required = false;
    endif; ?&gt;
    &lt;?php echo $view['form']-&gt;block($form, 'widget_attributes', array(
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Test/WebTestCase.php b/src/Symfony/Bundle/FrameworkBundle/Test/WebTestCase.php</span>
<span style="font-weight:bold;">index fcaf935a54..e282711a5b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Test/WebTestCase.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Test/WebTestCase.php</span>
<span style="color:teal;">@@ -69,14 +69,14 @@</span> abstract class WebTestCase extends \PHPUnit_Framework_TestCase
        }

        $dir = static::getPhpUnitCliConfigArgument();
        if <span style="color:red;">($dir</span><span style="color:green;">(null</span> === <span style="color:red;">null</span><span style="color:green;">$dir</span> &amp;&amp;
            (is_file(getcwd().DIRECTORY_SEPARATOR.'phpunit.xml') ||
            is_file(getcwd().DIRECTORY_SEPARATOR.'phpunit.xml.dist'))) {
            $dir = getcwd();
        }

        // Can't continue
        if <span style="color:red;">($dir</span><span style="color:green;">(null</span> === <span style="color:red;">null)</span><span style="color:green;">$dir)</span> {
            throw new \RuntimeException('Unable to guess the Kernel directory.');
        }

<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Compiler/SerializerPassTest.php b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Compiler/SerializerPassTest.php</span>
<span style="font-weight:bold;">index 5a048ed411..aa276b1e04 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Compiler/SerializerPassTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Compiler/SerializerPassTest.php</span>
<span style="color:teal;">@@ -96,7 +96,7 @@</span> class SerializerPassTest extends \PHPUnit_Framework_TestCase
          'Symfony\Bundle\FrameworkBundle\DependencyInjection\Compiler\SerializerPass',
          'findAndSortTaggedServices'
        );
        <span style="color:red;">$method-&gt;setAccessible(TRUE);</span><span style="color:green;">$method-&gt;setAccessible(true);</span>

        $actual = $method-&gt;invoke($serializerPass, 'tag', $container);

<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/php/full.php b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/php/full.php</span>
<span style="font-weight:bold;">index c4eff93492..0bc94f2e73 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/php/full.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/php/full.php</span>
<span style="color:teal;">@@ -56,6 +56,7 @@</span> $container-&gt;loadFromExtension('framework', array(
        'form'              =&gt; array(
            'resources'     =&gt; array('theme1', 'theme2')
        ),
        <span style="color:green;">'hinclude_default_template' =&gt; 'global_hinclude_template',</span>
    ),
    'translator' =&gt; array(
        'enabled'  =&gt; true,
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/xml/full.xml b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/xml/full.xml</span>
<span style="font-weight:bold;">index 8fd3e9b652..bfdaabc71f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/xml/full.xml</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/xml/full.xml</span>
<span style="color:teal;">@@ -13,7 +13,7 @@</span>
        &lt;framework:profiler only-exceptions=&quot;true&quot; enabled=&quot;false&quot; /&gt;
        &lt;framework:router resource=&quot;%kernel.root_dir%/config/routing.xml&quot; type=&quot;xml&quot; /&gt;
        &lt;framework:session gc-maxlifetime=&quot;90000&quot; gc-probability=&quot;1&quot; gc-divisor=&quot;108&quot; storage-id=&quot;session.storage.native&quot; handler-id=&quot;session.handler.native_file&quot; name=&quot;_SYMFONY&quot; cookie-lifetime=&quot;86400&quot; cookie-path=&quot;/&quot; cookie-domain=&quot;example.com&quot; cookie-secure=&quot;true&quot; cookie-httponly=&quot;true&quot; save-path=&quot;/path/to/sessions&quot; /&gt;
        &lt;framework:templating assets-version=&quot;SomeVersionScheme&quot; cache=&quot;/path/to/cache&quot; <span style="color:red;">&gt;</span><span style="color:green;">hinclude-default-template=&quot;global_hinclude_template&quot;&gt;</span>
            &lt;framework:loader&gt;loader.foo&lt;/framework:loader&gt;
            &lt;framework:loader&gt;loader.bar&lt;/framework:loader&gt;
            &lt;framework:engine&gt;php&lt;/framework:engine&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/yml/full.yml b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/yml/full.yml</span>
<span style="font-weight:bold;">index d013063916..0a159ddc34 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/yml/full.yml</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/Fixtures/yml/full.yml</span>
<span style="color:teal;">@@ -44,6 +44,7 @@</span> framework:
                base_urls: [&quot;http://images1.example.com&quot;, &quot;http://images2.example.com&quot;]
        form:
            resources:    [theme1, theme2]
        <span style="color:green;">hinclude_default_template: global_hinclude_template</span>
    translator:
        enabled:  true
        fallback: fr
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/FrameworkExtensionTest.php b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/FrameworkExtensionTest.php</span>
<span style="font-weight:bold;">index 94ba71d448..05220f32e2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/FrameworkExtensionTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/DependencyInjection/FrameworkExtensionTest.php</span>
<span style="color:teal;">@@ -180,6 +180,7 @@</span> abstract class FrameworkExtensionTest extends TestCase
        $this-&gt;assertEquals(array('php', 'twig'), $container-&gt;getParameter('templating.engines'), '-&gt;registerTemplatingConfiguration() sets a templating.engines parameter');

        $this-&gt;assertEquals(array('FrameworkBundle:Form', 'theme1', 'theme2'), $container-&gt;getParameter('templating.helper.form.resources'), '-&gt;registerTemplatingConfiguration() registers the theme and adds the base theme');
        <span style="color:green;">$this-&gt;assertEquals('global_hinclude_template', $container-&gt;getParameter('fragment.renderer.hinclude.global_template'), '-&gt;registerTemplatingConfiguration() registers the global hinclude.js template');</span>
    }

    public function testTemplatingAssetsHelperScopeDependsOnPackageArgumentScopes()
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/Fixtures/Resources/views/translation.html.php b/src/Symfony/Bundle/FrameworkBundle/Tests/Fixtures/Resources/views/translation.html.php</span>
<span style="font-weight:bold;">index 23631b9943..2167138a1e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/Fixtures/Resources/views/translation.html.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/Fixtures/Resources/views/translation.html.php</span>
<span style="color:teal;">@@ -1,3 +1,33 @@</span>
This template is used for translation message extraction tests
&lt;?php echo $view['translator']-&gt;trans('single-quoted key') ?&gt;
&lt;?php echo $view['translator']-&gt;trans(&quot;double-quoted key&quot;) ?&gt;
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans(&lt;&lt;&lt;EOF</span>
<span style="color:green;">heredoc key</span>
<span style="color:green;">EOF</span>
<span style="color:green;">) ?&gt;</span>
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans(&lt;&lt;&lt;'EOF'</span>
<span style="color:green;">nowdoc key</span>
<span style="color:green;">EOF</span>
<span style="color:green;">) ?&gt;</span>
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans(</span>
<span style="color:green;">    &quot;double-quoted key with whitespace and escaped \$\n\&quot; sequences&quot;</span>
<span style="color:green;">) ?&gt;</span>
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans(</span>
<span style="color:green;">    'single-quoted key with whitespace and nonescaped \$\n\' sequences'</span>
<span style="color:green;">) ?&gt;</span>
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans( &lt;&lt;&lt;EOF</span>
<span style="color:green;">heredoc key with whitespace and escaped \$\n sequences</span>
<span style="color:green;">EOF</span>
<span style="color:green;">) ?&gt;</span>
<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans( &lt;&lt;&lt;'EOF'</span>
<span style="color:green;">nowdoc key with whitespace and nonescaped \$\n sequences</span>
<span style="color:green;">EOF</span>
<span style="color:green;">) ?&gt;</span>

<span style="color:green;">&lt;?php echo $view['translator']-&gt;trans('single-quoted key with &quot;quote mark at the end&quot;') ?&gt;</span>

<span style="color:green;">&lt;?php echo $view['translator']-&gt;transChoice(</span>
<span style="color:green;">    '{0} There is no apples|{1} There is one apple|]1,Inf[ There are %count% apples',</span>
<span style="color:green;">    10,</span>
<span style="color:green;">    array('%count%' =&gt; 10)</span>
<span style="color:green;">) ?&gt;</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/PhpExtractorTest.php b/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/PhpExtractorTest.php</span>
<span style="font-weight:bold;">index d639f01806..52e20b874e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/PhpExtractorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/PhpExtractorTest.php</span>
<span style="color:teal;">@@ -27,10 +27,27 @@</span> class PhpExtractorTest extends TestCase
        // Act
        $extractor-&gt;extract(__DIR__.'/../Fixtures/Resources/views/', $catalogue);

        <span style="color:green;">$expectedHeredoc = &lt;&lt;&lt;EOF</span>
<span style="color:green;">heredoc key with whitespace and escaped \$\n sequences</span>
<span style="color:green;">EOF;</span>
<span style="color:green;">        $expectedNowdoc = &lt;&lt;&lt;'EOF'</span>
<span style="color:green;">nowdoc key with whitespace and nonescaped \$\n sequences</span>
<span style="color:green;">EOF;</span>
        // Assert
        <span style="color:red;">$this-&gt;assertCount(2, $catalogue-&gt;all('messages'), '-&gt;extract() should find 1 translation');</span>
<span style="color:red;">        $this-&gt;assertTrue($catalogue-&gt;has('single-quoted key'), '-&gt;extract() should find</span><span style="color:green;">$expectedCatalogue = array('messages' =&gt; array(</span>
<span style="color:green;">            'single-quoted key' =&gt; 'prefixsingle-quoted key',</span>
<span style="color:green;">            'double-quoted key' =&gt; 'prefixdouble-quoted key',</span>
<span style="color:green;">            'heredoc key' =&gt; 'prefixheredoc key',</span>
<span style="color:green;">            'nowdoc key' =&gt; 'prefixnowdoc key',</span>
<span style="color:green;">            &quot;double-quoted key with whitespace and escaped \$\n\&quot; sequences&quot; =&gt; &quot;prefixdouble-quoted key with whitespace and escaped \$\n\&quot; sequences&quot;,</span>
<span style="color:green;">            'single-quoted key with whitespace and nonescaped \$\n\' sequences' =&gt; 'prefixsingle-quoted key with whitespace and nonescaped \$\n\' sequences',</span>
<span style="color:green;">            'single-quoted key with &quot;quote mark at</span> the <span style="color:red;">&quot;single-quoted key&quot; message');</span>
<span style="color:red;">        $this-&gt;assertTrue($catalogue-&gt;has('double-quoted key'), '-&gt;extract() should find</span><span style="color:green;">end&quot;' =&gt; 'prefixsingle-quoted key with &quot;quote mark at</span> the <span style="color:red;">&quot;double-quoted key&quot; message');</span>
<span style="color:red;">        $this-&gt;assertEquals('prefixsingle-quoted key', $catalogue-&gt;get('single-quoted key'), '-&gt;extract() should apply &quot;prefix&quot; as prefix');</span><span style="color:green;">end&quot;',</span>
<span style="color:green;">            $expectedHeredoc =&gt; &quot;prefix&quot;.$expectedHeredoc,</span>
<span style="color:green;">            $expectedNowdoc =&gt; &quot;prefix&quot;.$expectedNowdoc,</span>
<span style="color:green;">            '{0} There is no apples|{1} There is one apple|]1,Inf[ There are %count% apples' =&gt; 'prefix{0} There is no apples|{1} There is one apple|]1,Inf[ There are %count% apples',</span>
<span style="color:green;">        ));</span>
<span style="color:green;">        $actualCatalogue = $catalogue-&gt;all();</span>

<span style="color:green;">        $this-&gt;assertEquals($expectedCatalogue, $actualCatalogue);</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/TranslatorTest.php b/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/TranslatorTest.php</span>
<span style="font-weight:bold;">index 715c44fade..a93dd5e845 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/TranslatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Tests/Translation/TranslatorTest.php</span>
<span style="color:teal;">@@ -45,7 +45,7 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
    {
        $translator = $this-&gt;getTranslator($this-&gt;getLoader());
        $translator-&gt;setLocale('fr');
        $translator-&gt;setFallbackLocales(array('en', 'es', 'pt-PT', 'pt_BR', <span style="color:red;">'fr.UTF-8'));</span><span style="color:green;">'fr.UTF-8', 'sr@latin'));</span>

        $this-&gt;assertEquals('foo (FR)', $translator-&gt;trans('foo'));
        $this-&gt;assertEquals('bar (EN)', $translator-&gt;trans('bar'));
<span style="color:teal;">@@ -55,6 +55,7 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('foobarfoo (PT-PT)', $translator-&gt;trans('foobarfoo'));
        $this-&gt;assertEquals('other choice 1 (PT-BR)', $translator-&gt;transChoice('other choice', 1));
        $this-&gt;assertEquals('foobarbaz (fr.UTF-8)', $translator-&gt;trans('foobarbaz'));
        <span style="color:green;">$this-&gt;assertEquals('foobarbax (sr@latin)', $translator-&gt;trans('foobarbax'));</span>
    }

    public function testTransWithCaching()
<span style="color:teal;">@@ -62,7 +63,7 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        // prime the cache
        $translator = $this-&gt;getTranslator($this-&gt;getLoader(), array('cache_dir' =&gt; $this-&gt;tmpDir));
        $translator-&gt;setLocale('fr');
        $translator-&gt;setFallbackLocales(array('en', 'es', 'pt-PT', 'pt_BR', <span style="color:red;">'fr.UTF-8'));</span><span style="color:green;">'fr.UTF-8', 'sr@latin'));</span>

        $this-&gt;assertEquals('foo (FR)', $translator-&gt;trans('foo'));
        $this-&gt;assertEquals('bar (EN)', $translator-&gt;trans('bar'));
<span style="color:teal;">@@ -72,12 +73,13 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('foobarfoo (PT-PT)', $translator-&gt;trans('foobarfoo'));
        $this-&gt;assertEquals('other choice 1 (PT-BR)', $translator-&gt;transChoice('other choice', 1));
        $this-&gt;assertEquals('foobarbaz (fr.UTF-8)', $translator-&gt;trans('foobarbaz'));
        <span style="color:green;">$this-&gt;assertEquals('foobarbax (sr@latin)', $translator-&gt;trans('foobarbax'));</span>

        // do it another time as the cache is primed now
        $loader = $this-&gt;getMock('Symfony\Component\Translation\Loader\LoaderInterface');
        $translator = $this-&gt;getTranslator($loader, array('cache_dir' =&gt; $this-&gt;tmpDir));
        $translator-&gt;setLocale('fr');
        $translator-&gt;setFallbackLocales(array('en', 'es', 'pt-PT', 'pt_BR', <span style="color:red;">'fr.UTF-8'));</span><span style="color:green;">'fr.UTF-8', 'sr@latin'));</span>

        $this-&gt;assertEquals('foo (FR)', $translator-&gt;trans('foo'));
        $this-&gt;assertEquals('bar (EN)', $translator-&gt;trans('bar'));
<span style="color:teal;">@@ -87,6 +89,17 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('foobarfoo (PT-PT)', $translator-&gt;trans('foobarfoo'));
        $this-&gt;assertEquals('other choice 1 (PT-BR)', $translator-&gt;transChoice('other choice', 1));
        $this-&gt;assertEquals('foobarbaz (fr.UTF-8)', $translator-&gt;trans('foobarbaz'));
        <span style="color:green;">$this-&gt;assertEquals('foobarbax (sr@latin)', $translator-&gt;trans('foobarbax'));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testTransWithCachingWithInvalidLocale()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $loader = $this-&gt;getMock('Symfony\Component\Translation\Loader\LoaderInterface');</span>
<span style="color:green;">        $translator = $this-&gt;getTranslator($loader, array('cache_dir' =&gt; $this-&gt;tmpDir), '\Symfony\Bundle\FrameworkBundle\Tests\Translation\TranslatorWithInvalidLocale');</span>
<span style="color:green;">        $translator-&gt;setLocale('invalid locale');</span>

<span style="color:green;">        $this-&gt;setExpectedException('\InvalidArgumentException');</span>
<span style="color:green;">        $translator-&gt;trans('foo');</span>
    }

    public function testGetLocale()
<span style="color:teal;">@@ -128,6 +141,49 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertSame('en', $translator-&gt;getLocale());
    }

    <span style="color:green;">public function testGetLocaleWithInvalidLocale()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $request = $this-&gt;getMock('Symfony\Component\HttpFoundation\Request');</span>

<span style="color:green;">        $request</span>
<span style="color:green;">            -&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('getLocale')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue('foo bar'))</span>
<span style="color:green;">        ;</span>
<span style="color:green;">        $request</span>
<span style="color:green;">            -&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('getDefaultLocale')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue('en-US'))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $container = $this-&gt;getMock('Symfony\Component\DependencyInjection\ContainerInterface');</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('isScopeActive')</span>
<span style="color:green;">            -&gt;with('request')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('has')</span>
<span style="color:green;">            -&gt;with('request')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(true))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;expects($this-&gt;any())</span>
<span style="color:green;">            -&gt;method('get')</span>
<span style="color:green;">            -&gt;with('request')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue($request))</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $translator = new Translator($container, new MessageSelector());</span>
<span style="color:green;">        $this-&gt;assertSame('en-US', $translator-&gt;getLocale());</span>
<span style="color:green;">    }</span>


    protected function getCatalogue($locale, $messages)
    {
        $catalogue = new MessageCatalogue($locale);
<span style="color:teal;">@@ -185,6 +241,13 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
                'foobarbaz' =&gt; 'foobarbaz (fr.UTF-8)',
            ))))
        ;
        <span style="color:green;">$loader</span>
<span style="color:green;">            -&gt;expects($this-&gt;at(6))</span>
<span style="color:green;">            -&gt;method('load')</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue($this-&gt;getCatalogue('sr@latin', array(</span>
<span style="color:green;">                'foobarbax' =&gt; 'foobarbax (sr@latin)',</span>
<span style="color:green;">            ))))</span>
<span style="color:green;">        ;</span>

        return $loader;
    }
<span style="color:teal;">@@ -201,9 +264,9 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        return $container;
    }

    public function getTranslator($loader, $options = <span style="color:red;">array())</span><span style="color:green;">array(), $translatorClass = '\Symfony\Bundle\FrameworkBundle\Translation\Translator')</span>
    {
        $translator = new <span style="color:red;">Translator(</span><span style="color:green;">$translatorClass(</span>
            $this-&gt;getContainer($loader),
            new MessageSelector(),
            array('loader' =&gt; array('loader')),
<span style="color:teal;">@@ -216,7 +279,19 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $translator-&gt;addResource('loader', 'foo', 'pt-PT'); // European Portuguese
        $translator-&gt;addResource('loader', 'foo', 'pt_BR'); // Brazilian Portuguese
        $translator-&gt;addResource('loader', 'foo', 'fr.UTF-8');
        <span style="color:green;">$translator-&gt;addResource('loader', 'foo', 'sr@latin'); // Latin Serbian</span>

        return $translator;
    }
}

<span style="color:green;">class TranslatorWithInvalidLocale extends Translator</span>
<span style="color:green;">{</span>
<span style="color:green;">    /**</span>
<span style="color:green;">     * {@inheritdoc}</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function setLocale($locale)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;locale = $locale;</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Translation/PhpExtractor.php b/src/Symfony/Bundle/FrameworkBundle/Translation/PhpExtractor.php</span>
<span style="font-weight:bold;">index 1b12c8ca9e..67de7da719 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Translation/PhpExtractor.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Translation/PhpExtractor.php</span>
<span style="color:teal;">@@ -23,7 +23,6 @@</span> use Symfony\Component\Translation\Extractor\ExtractorInterface;
class PhpExtractor implements ExtractorInterface
{
    const MESSAGE_TOKEN = 300;
<span style="color:red;">    const IGNORE_TOKEN = 400;</span>

    /**
     * Prefix for new found message.
<span style="color:teal;">@@ -39,15 +38,16 @@</span> class PhpExtractor implements ExtractorInterface
     */
    protected $sequences = array(
        array(
<span style="color:red;">            '$view',</span>
<span style="color:red;">            '[',</span>
<span style="color:red;">            '\'translator\'',</span>
<span style="color:red;">            ']',</span>
            '-&gt;',
            'trans',
            '(',
            self::MESSAGE_TOKEN,
        <span style="color:red;">')',</span><span style="color:green;">),</span>
<span style="color:green;">        array(</span>
<span style="color:green;">            '-&gt;',</span>
<span style="color:green;">            'transChoice',</span>
<span style="color:green;">            '(',</span>
<span style="color:green;">            self::MESSAGE_TOKEN,</span>
        ),
    );

<span style="color:teal;">@@ -76,6 +76,7 @@</span> class PhpExtractor implements ExtractorInterface
     * Normalizes a token.
     *
     * @param mixed $token
     <span style="color:green;">*</span>
     * @return string
     */
    protected function normalizeToken($token)
<span style="color:teal;">@@ -87,6 +88,56 @@</span> class PhpExtractor implements ExtractorInterface
        return $token;
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * Seeks to a non-whitespace token.</span>
<span style="color:green;">     */</span>
<span style="color:green;">    private function seekToNextReleventToken(\Iterator $tokenIterator)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        for (; $tokenIterator-&gt;valid(); $tokenIterator-&gt;next()) {</span>
<span style="color:green;">            $t = $tokenIterator-&gt;current();</span>
<span style="color:green;">            if (!is_array($t) || ($t[0] !== T_WHITESPACE)) {</span>
<span style="color:green;">                break;</span>
<span style="color:green;">            }</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Extracts the message from the iterator while the tokens</span>
<span style="color:green;">     * match allowed message tokens</span>
<span style="color:green;">     */</span>
<span style="color:green;">    private function getMessage(\Iterator $tokenIterator)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $message = '';</span>
<span style="color:green;">        $docToken = '';</span>

<span style="color:green;">        for (; $tokenIterator-&gt;valid(); $tokenIterator-&gt;next()) {</span>
<span style="color:green;">            $t = $tokenIterator-&gt;current();</span>
<span style="color:green;">            if (!is_array($t)) {</span>
<span style="color:green;">                break;</span>
<span style="color:green;">            }</span>

<span style="color:green;">            switch ($t[0]) {</span>
<span style="color:green;">                case T_START_HEREDOC:</span>
<span style="color:green;">                    $docToken = $t[1];</span>
<span style="color:green;">                    break;</span>
<span style="color:green;">                case T_ENCAPSED_AND_WHITESPACE:</span>
<span style="color:green;">                case T_CONSTANT_ENCAPSED_STRING:</span>
<span style="color:green;">                    $message .= $t[1];</span>
<span style="color:green;">                    break;</span>
<span style="color:green;">                case T_END_HEREDOC:</span>
<span style="color:green;">                    return PhpStringTokenParser::parseDocString($docToken, $message);</span>
<span style="color:green;">                default:</span>
<span style="color:green;">                    break 2;</span>
<span style="color:green;">            }</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if ($message) {</span>
<span style="color:green;">            $message = PhpStringTokenParser::parse($message);</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return $message;</span>
<span style="color:green;">    }</span>

    /**
     * Extracts trans message from PHP tokens.
     *
<span style="color:teal;">@@ -95,24 +146,27 @@</span> class PhpExtractor implements ExtractorInterface
     */
    protected function parseTokens($tokens, MessageCatalogue $catalog)
    {
        <span style="color:red;">foreach ($tokens as</span><span style="color:green;">$tokenIterator = new \ArrayIterator($tokens);</span>

<span style="color:green;">        for ($key = 0;</span> $key <span style="color:red;">=&gt; $token)</span><span style="color:green;">&lt; $tokenIterator-&gt;count(); $key++)</span> {
            foreach ($this-&gt;sequences as $sequence) {
                $message = '';
                <span style="color:green;">$tokenIterator-&gt;seek($key);</span>

                foreach ($sequence as<span style="color:red;">$id =&gt;</span> $item) {
                    <span style="color:green;">$this-&gt;seekToNextReleventToken($tokenIterator);</span>

                    if <span style="color:red;">($this-&gt;normalizeToken($tokens[$key + $id])</span><span style="color:green;">($this-&gt;normalizeToken($tokenIterator-&gt;current())</span> == $item) {
                        <span style="color:green;">$tokenIterator-&gt;next();</span>
                        continue;
                    } elseif (self::MESSAGE_TOKEN == $item) {
                        $message = <span style="color:red;">$this-&gt;normalizeToken($tokens[$key + $id]);</span>
<span style="color:red;">                    } elseif (self::IGNORE_TOKEN == $item) {</span>
<span style="color:red;">                        continue;</span><span style="color:green;">$this-&gt;getMessage($tokenIterator);</span>
<span style="color:green;">                        break;</span>
                    } else {
                        break;
                    }
                }

<span style="color:red;">                $message = trim($message, '\'&quot;');</span>

                if ($message) {
                    $catalog-&gt;set($message, $this-&gt;prefix.$message);
                    break;
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Translation/PhpStringTokenParser.php b/src/Symfony/Bundle/FrameworkBundle/Translation/PhpStringTokenParser.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..0b29792e52</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Translation/PhpStringTokenParser.php</span>
<span style="color:teal;">@@ -0,0 +1,142 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bundle\FrameworkBundle\Translation;</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * The following is derived from code at http://github.com/nikic/PHP-Parser</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * Copyright (c) 2011 by Nikita Popov</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * Some rights reserved.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * Redistribution and use in source and binary forms, with or without</span>
<span style="color:green;"> * modification, are permitted provided that the following conditions are</span>
<span style="color:green;"> * met:</span>
<span style="color:green;"> *</span>
<span style="color:green;"> *     * Redistributions of source code must retain the above copyright</span>
<span style="color:green;"> *       notice, this list of conditions and the following disclaimer.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> *     * Redistributions in binary form must reproduce the above</span>
<span style="color:green;"> *       copyright notice, this list of conditions and the following</span>
<span style="color:green;"> *       disclaimer in the documentation and/or other materials provided</span>
<span style="color:green;"> *       with the distribution.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> *     * The names of the contributors may not be used to endorse or</span>
<span style="color:green;"> *       promote products derived from this software without specific</span>
<span style="color:green;"> *       prior written permission.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span style="color:green;"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span style="color:green;"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span style="color:green;"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span style="color:green;"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span style="color:green;"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span style="color:green;"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span style="color:green;"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span style="color:green;"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span style="color:green;"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span style="color:green;"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span style="color:green;"> */</span>

<span style="color:green;">class PhpStringTokenParser</span>
<span style="color:green;">{</span>
<span style="color:green;">    protected static $replacements = array(</span>
<span style="color:green;">        '\\' =&gt; '\\',</span>
<span style="color:green;">        '$'  =&gt;  '$',</span>
<span style="color:green;">        'n'  =&gt; &quot;\n&quot;,</span>
<span style="color:green;">        'r'  =&gt; &quot;\r&quot;,</span>
<span style="color:green;">        't'  =&gt; &quot;\t&quot;,</span>
<span style="color:green;">        'f'  =&gt; &quot;\f&quot;,</span>
<span style="color:green;">        'v'  =&gt; &quot;\v&quot;,</span>
<span style="color:green;">        'e'  =&gt; &quot;\x1B&quot;,</span>
<span style="color:green;">    );</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Parses a string token.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param string $str String token content</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string The parsed string</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public static function parse($str)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $bLength = 0;</span>
<span style="color:green;">        if ('b' === $str[0]) {</span>
<span style="color:green;">            $bLength = 1;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if ('\'' === $str[$bLength]) {</span>
<span style="color:green;">            return str_replace(</span>
<span style="color:green;">                array('\\\\', '\\\''),</span>
<span style="color:green;">                array(  '\\',   '\''),</span>
<span style="color:green;">                substr($str, $bLength + 1, -1)</span>
<span style="color:green;">            );</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            return self::parseEscapeSequences(substr($str, $bLength + 1, -1), '&quot;');</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Parses escape sequences in strings (all string types apart from single quoted).</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param string      $str   String without quotes</span>
<span style="color:green;">     * @param null|string $quote Quote type</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string String with escape sequences parsed</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public static function parseEscapeSequences($str, $quote)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (null !== $quote) {</span>
<span style="color:green;">            $str = str_replace('\\' . $quote, $quote, $str);</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return preg_replace_callback(</span>
<span style="color:green;">            '~\\\\([\\\\$nrtfve]|[xX][0-9a-fA-F]{1,2}|[0-7]{1,3})~',</span>
<span style="color:green;">            array(__CLASS__, 'parseCallback'),</span>
<span style="color:green;">            $str</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public static function parseCallback($matches)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $str = $matches[1];</span>

<span style="color:green;">        if (isset(self::$replacements[$str])) {</span>
<span style="color:green;">            return self::$replacements[$str];</span>
<span style="color:green;">        } elseif ('x' === $str[0] || 'X' === $str[0]) {</span>
<span style="color:green;">            return chr(hexdec($str));</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            return chr(octdec($str));</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Parses a constant doc string.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param string $startToken Doc string start token content (&lt;&lt;&lt;SMTHG)</span>
<span style="color:green;">     * @param string $str        String token content</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string Parsed string</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public static function parseDocString($startToken, $str)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        // strip last newline (thanks tokenizer for sticking it into the string!)</span>
<span style="color:green;">        $str = preg_replace('~(\r\n|\n|\r)$~', '', $str);</span>

<span style="color:green;">        // nowdoc string</span>
<span style="color:green;">        if (false !== strpos($startToken, '\'')) {</span>
<span style="color:green;">            return $str;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return self::parseEscapeSequences($str, null);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/FrameworkBundle/Translation/Translator.php b/src/Symfony/Bundle/FrameworkBundle/Translation/Translator.php</span>
<span style="font-weight:bold;">index 94f2813aa3..683405c832 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/FrameworkBundle/Translation/Translator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/FrameworkBundle/Translation/Translator.php</span>
<span style="color:teal;">@@ -66,7 +66,11 @@</span> class Translator extends BaseTranslator
    public function getLocale()
    {
        if (null === $this-&gt;locale &amp;&amp; $this-&gt;container-&gt;isScopeActive('request') &amp;&amp; $this-&gt;container-&gt;has('request')) {
            <span style="color:red;">$this-&gt;locale = $this-&gt;container-&gt;get('request')-&gt;getLocale();</span><span style="color:green;">try {</span>
<span style="color:green;">                $this-&gt;setLocale($this-&gt;container-&gt;get('request')-&gt;getLocale());</span>
<span style="color:green;">            } catch (\InvalidArgumentException $e) {</span>
<span style="color:green;">                $this-&gt;setLocale($this-&gt;container-&gt;get('request')-&gt;getDefaultLocale());</span>
<span style="color:green;">            }</span>
        }

        return $this-&gt;locale;
<span style="color:teal;">@@ -87,6 +91,8 @@</span> class Translator extends BaseTranslator
            return parent::loadCatalogue($locale);
        }

        <span style="color:green;">$this-&gt;assertValidLocale($locale);</span>

        $cache = new ConfigCache($this-&gt;options['cache_dir'].'/catalogue.'.$locale.'.php', $this-&gt;options['debug']);
        if (!$cache-&gt;isFresh()) {
            $this-&gt;initialize();
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Command/ExportCommand.php b/src/Symfony/Bundle/WebProfilerBundle/Command/ExportCommand.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..b140e302b1</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Command/ExportCommand.php</span>
<span style="color:teal;">@@ -0,0 +1,75 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bundle\WebProfilerBundle\Command;</span>

<span style="color:green;">use Symfony\Component\Console\Command\Command;</span>
<span style="color:green;">use Symfony\Component\Console\Input\InputArgument;</span>
<span style="color:green;">use Symfony\Component\Console\Input\InputInterface;</span>
<span style="color:green;">use Symfony\Component\Console\Output\OutputInterface;</span>
<span style="color:green;">use Symfony\Component\HttpKernel\Profiler\Profiler;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * Exports a profile.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * @author Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">class ExportCommand extends Command</span>
<span style="color:green;">{</span>
<span style="color:green;">    private $profiler;</span>

<span style="color:green;">    public function __construct(Profiler $profiler = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;profiler = $profiler;</span>

<span style="color:green;">        parent::__construct();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * {@inheritdoc}</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function isEnabled()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (null === $this-&gt;profiler) {</span>
<span style="color:green;">            return false;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return parent::isEnabled();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function configure()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this</span>
<span style="color:green;">            -&gt;setName('profiler:export')</span>
<span style="color:green;">            -&gt;setDescription('Exports a profile')</span>
<span style="color:green;">            -&gt;setDefinition(array(</span>
<span style="color:green;">                new InputArgument('token', InputArgument::REQUIRED, 'The profile token'),</span>
<span style="color:green;">            ))</span>
<span style="color:green;">            -&gt;setHelp(&lt;&lt;&lt;EOF</span>
<span style="color:green;">The &lt;info&gt;%command.name%&lt;/info&gt; command exports a profile to the standard output:</span>

<span style="color:green;">&lt;info&gt;php %command.full_name% profile_token&lt;/info&gt;</span>
<span style="color:green;">EOF</span>
<span style="color:green;">            )</span>
<span style="color:green;">        ;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function execute(InputInterface $input, OutputInterface $output)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $token = $input-&gt;getArgument('token');</span>

<span style="color:green;">        if (!$profile = $this-&gt;profiler-&gt;loadProfile($token)) {</span>
<span style="color:green;">            throw new \LogicException(sprintf('Profile with token &quot;%s&quot; does not exist.', $token));</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $output-&gt;writeln($this-&gt;profiler-&gt;export($profile), OutputInterface::OUTPUT_RAW);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Command/ImportCommand.php b/src/Symfony/Bundle/WebProfilerBundle/Command/ImportCommand.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..70fecd45ea</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Command/ImportCommand.php</span>
<span style="color:teal;">@@ -0,0 +1,90 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bundle\WebProfilerBundle\Command;</span>

<span style="color:green;">use Symfony\Component\Console\Command\Command;</span>
<span style="color:green;">use Symfony\Component\Console\Input\InputArgument;</span>
<span style="color:green;">use Symfony\Component\Console\Input\InputInterface;</span>
<span style="color:green;">use Symfony\Component\Console\Output\OutputInterface;</span>
<span style="color:green;">use Symfony\Component\HttpKernel\Profiler\Profiler;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * Imports a profile.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * @author Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">class ImportCommand extends Command</span>
<span style="color:green;">{</span>
<span style="color:green;">    private $profiler;</span>

<span style="color:green;">    public function __construct(Profiler $profiler = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;profiler = $profiler;</span>

<span style="color:green;">        parent::__construct();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * {@inheritdoc}</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function isEnabled()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (null === $this-&gt;profiler) {</span>
<span style="color:green;">            return false;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return parent::isEnabled();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function configure()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this</span>
<span style="color:green;">            -&gt;setName('profiler:import')</span>
<span style="color:green;">            -&gt;setDescription('Imports a profile')</span>
<span style="color:green;">            -&gt;setDefinition(array(</span>
<span style="color:green;">                new InputArgument('filename', InputArgument::OPTIONAL, 'The profile path'),</span>
<span style="color:green;">            ))</span>
<span style="color:green;">            -&gt;setHelp(&lt;&lt;&lt;EOF</span>
<span style="color:green;">The &lt;info&gt;%command.name%&lt;/info&gt; command imports a profile:</span>

<span style="color:green;">&lt;info&gt;php %command.full_name% profile_filepath&lt;/info&gt;</span>

<span style="color:green;">You can also pipe the profile via STDIN:</span>

<span style="color:green;">&lt;info&gt;cat profile_file | php %command.full_name%&lt;/info&gt;</span>
<span style="color:green;">EOF</span>
<span style="color:green;">            )</span>
<span style="color:green;">        ;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function execute(InputInterface $input, OutputInterface $output)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $data = '';</span>
<span style="color:green;">        if ($input-&gt;getArgument('filename')) {</span>
<span style="color:green;">            $data = file_get_contents($input-&gt;getArgument('filename'));</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            if (0 !== ftell(STDIN)) {</span>
<span style="color:green;">                throw new \RuntimeException('Please provide a filename or pipe the profile to STDIN.');</span>
<span style="color:green;">            }</span>

<span style="color:green;">            while (!feof(STDIN)) {</span>
<span style="color:green;">                $data .= fread(STDIN, 1024);</span>
<span style="color:green;">            }</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (!$profile = $this-&gt;profiler-&gt;import($data)) {</span>
<span style="color:green;">            throw new \LogicException('The profile already exists in the database.');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $output-&gt;writeln(sprintf('Profile &quot;%s&quot; has been successfully imported.', $profile-&gt;getToken()));</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Controller/ProfilerController.php b/src/Symfony/Bundle/WebProfilerBundle/Controller/ProfilerController.php</span>
<span style="font-weight:bold;">index a106feae99..dea4f8883f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/WebProfilerBundle/Controller/ProfilerController.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Controller/ProfilerController.php</span>
<span style="color:teal;">@@ -111,33 +111,6 @@</span> class ProfilerController
        )), 200, array('Content-Type' =&gt; 'text/html'));
    }

<span style="color:red;">    /**</span>
<span style="color:red;">     * Exports data for a given token.</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @param string $token The profiler token</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @return Response A Response instance</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @throws NotFoundHttpException</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function exportAction($token)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (null === $this-&gt;profiler) {</span>
<span style="color:red;">            throw new NotFoundHttpException('The profiler must be enabled.');</span>
<span style="color:red;">        }</span>

<span style="color:red;">        $this-&gt;profiler-&gt;disable();</span>

<span style="color:red;">        if (!$profile = $this-&gt;profiler-&gt;loadProfile($token)) {</span>
<span style="color:red;">            throw new NotFoundHttpException(sprintf('Token &quot;%s&quot; does not exist.', $token));</span>
<span style="color:red;">        }</span>

<span style="color:red;">        return new Response($this-&gt;profiler-&gt;export($profile), 200, array(</span>
<span style="color:red;">            'Content-Type'        =&gt; 'text/plain',</span>
<span style="color:red;">            'Content-Disposition' =&gt; 'attachment; filename= '.$token.'.txt',</span>
<span style="color:red;">        ));</span>
<span style="color:red;">    }</span>

    /**
     * Purges all tokens.
     *
<span style="color:teal;">@@ -157,36 +130,6 @@</span> class ProfilerController
        return new RedirectResponse($this-&gt;generator-&gt;generate('_profiler_info', array('about' =&gt; 'purge')), 302, array('Content-Type' =&gt; 'text/html'));
    }

<span style="color:red;">    /**</span>
<span style="color:red;">     * Imports token data.</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @param Request $request The current HTTP Request</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @return Response A Response instance</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @throws NotFoundHttpException</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function importAction(Request $request)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (null === $this-&gt;profiler) {</span>
<span style="color:red;">            throw new NotFoundHttpException('The profiler must be enabled.');</span>
<span style="color:red;">        }</span>

<span style="color:red;">        $this-&gt;profiler-&gt;disable();</span>

<span style="color:red;">        $file = $request-&gt;files-&gt;get('file');</span>

<span style="color:red;">        if (empty($file) || !$file-&gt;isValid()) {</span>
<span style="color:red;">            return new RedirectResponse($this-&gt;generator-&gt;generate('_profiler_info', array('about' =&gt; 'upload_error')), 302, array('Content-Type' =&gt; 'text/html'));</span>
<span style="color:red;">        }</span>

<span style="color:red;">        if (!$profile = $this-&gt;profiler-&gt;import(file_get_contents($file-&gt;getPathname()))) {</span>
<span style="color:red;">            return new RedirectResponse($this-&gt;generator-&gt;generate('_profiler_info', array('about' =&gt; 'already_exists')), 302, array('Content-Type' =&gt; 'text/html'));</span>
<span style="color:red;">        }</span>

<span style="color:red;">        return new RedirectResponse($this-&gt;generator-&gt;generate('_profiler', array('token' =&gt; $profile-&gt;getToken())), 302, array('Content-Type' =&gt; 'text/html'));</span>
<span style="color:red;">    }</span>

    /**
     * Displays information page.
     *
<span style="color:teal;">@@ -310,7 +253,7 @@</span> class ProfilerController
    }

    /**
     * <span style="color:red;">Search</span><span style="color:green;">Renders the search</span> results.
     *
     * @param Request $request The current HTTP Request
     * @param string  $token   The token
<span style="color:teal;">@@ -351,7 +294,7 @@</span> class ProfilerController
    }

    /**
     * <span style="color:red;">Narrow</span><span style="color:green;">Narrows</span> the search bar.
     *
     * @param Request $request The current HTTP Request
     *
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Resources/config/commands.xml b/src/Symfony/Bundle/WebProfilerBundle/Resources/config/commands.xml</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..d85b54d38d</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Resources/config/commands.xml</span>
<span style="color:teal;">@@ -0,0 +1,23 @@</span>
<span style="color:green;">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>

<span style="color:green;">&lt;container xmlns=&quot;http://symfony.com/schema/dic/services&quot;</span>
<span style="color:green;">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span style="color:green;">    xsi:schemaLocation=&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;&gt;</span>

<span style="color:green;">    &lt;parameters&gt;</span>
<span style="color:green;">        &lt;parameter key=&quot;web_profiler.command.import.class&quot;&gt;Symfony\Bundle\WebProfilerBundle\Command\ImportCommand&lt;/parameter&gt;</span>
<span style="color:green;">        &lt;parameter key=&quot;web_profiler.command.export.class&quot;&gt;Symfony\Bundle\WebProfilerBundle\Command\ExportCommand&lt;/parameter&gt;</span>
<span style="color:green;">    &lt;/parameters&gt;</span>

<span style="color:green;">    &lt;services&gt;</span>
<span style="color:green;">        &lt;service id=&quot;web_profiler.command.import&quot; class=&quot;%web_profiler.command.import.class%&quot;&gt;</span>
<span style="color:green;">            &lt;argument type=&quot;service&quot; id=&quot;profiler&quot; on-invalid=&quot;null&quot; /&gt;</span>
<span style="color:green;">            &lt;tag name=&quot;console.command&quot; /&gt;</span>
<span style="color:green;">        &lt;/service&gt;</span>

<span style="color:green;">        &lt;service id=&quot;web_profiler.command.export&quot; class=&quot;%web_profiler.command.export.class%&quot;&gt;</span>
<span style="color:green;">            &lt;argument type=&quot;service&quot; id=&quot;profiler&quot; on-invalid=&quot;null&quot; /&gt;</span>
<span style="color:green;">            &lt;tag name=&quot;console.command&quot; /&gt;</span>
<span style="color:green;">        &lt;/service&gt;</span>
<span style="color:green;">    &lt;/services&gt;</span>
<span style="color:green;">&lt;/container&gt;</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Collector/time.html.twig b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Collector/time.html.twig</span>
<span style="font-weight:bold;">index 3de0473774..8fdedf95e9 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Collector/time.html.twig</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Collector/time.html.twig</span>
<span style="color:teal;">@@ -193,7 +193,6 @@</span>
                    x = request.left * ratio + space, // position
                    canvas = cache.get(elementId) || cache.set(elementId, document.getElementById(elementId)),
                    ctx    = canvas.getContext(&quot;2d&quot;),
<span style="color:red;">                    backingStoreRatio,</span>
                    scaleRatio,
                    devicePixelRatio;

<span style="color:teal;">@@ -206,11 +205,8 @@</span>

                // For retina displays so text and boxes will be crisp
                devicePixelRatio  = window.devicePixelRatio          == &quot;undefined&quot; ? 1 : window.devicePixelRatio;
<span style="color:red;">                backingStoreRatio = ctx.webkitBackingStorePixelRatio == &quot;undefined&quot; ? 1 : ctx.webkitBackingStorePixelRatio;</span>
                scaleRatio        = devicePixelRatio / 1;

<span style="color:red;">                canvasHeight += gapPerEvent * drawableEvents.length;</span>

                canvas.width  = width * scaleRatio;
                canvas.height = canvasHeight * scaleRatio;

<span style="color:teal;">@@ -363,14 +359,14 @@</span>
                var self = this;

                _requests.forEach(function(request) {
                    self.drawOne(request, <span style="color:red;">maxRequestTime,</span><span style="color:green;">_maxRequestTime,</span> threshold, width);
                });
            };

            this.getThreshold = function() {
                var threshold = Sfjs.getPreference(_storagePrefix + 'threshold');

                if <span style="color:red;">(threshold</span><span style="color:green;">(null</span> === <span style="color:red;">null)</span><span style="color:green;">threshold)</span> {
                    return _threshold;
                }

<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/admin.html.twig b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/admin.html.twig</span>
<span style="font-weight:bold;">index 3ca28ff162..a47b254a77 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/admin.html.twig</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/admin.html.twig</span>
<span style="color:teal;">@@ -1,27 +1,10 @@</span>
<span style="color:green;">{% if token is not empty %}</span>
    &lt;div class=&quot;search import clearfix&quot; id=&quot;adminBar&quot;&gt;
        &lt;h3&gt;
            &lt;img style=&quot;margin: 0 5px 0 0; vertical-align: middle; height: 16px&quot; width=&quot;16&quot; height=&quot;16&quot; alt=&quot;Import&quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADo0lEQVR42u2XS0hUURjHD5njA1oYbXQ2MqCmIu2iEEISUREEEURxFB8ovt+DEsLgaxBRQQeUxnQ0ZRYSQasgiDaFqxAy2jUtCjdCoEjFwHj6/+F+dbvN6PQAN37wm++c7/z/35x7uPcOo7TW58rFBs59A7GGQ51XBAIBlZmZuYOhE1zm/A/4PxvY3NwMO53OYEJCgp+nccqXXQc94D54boAxalyLNayNtra2NJmbmzvOyMj4cRqoKYK4AsZzc3Nft7e3f5qZmTnCpk8Ix6xxjRpDGzmkUU5Ozuu2trZP09PTR+vr6ycbGxtaWFtbC9fU1AQTExPdmNNzLSUlZXt4ePhANNGghlp6lDWkkcvlOsCX6LNYXV0N8BTS0tK2cDJfWIsFaumhV0lIIxzXl5WVFX0aPp8vhDwJbMnJyc6JiYkji8YP7oI4YowfmDX00KskOHG73UfLy8vahB/cBXFSW1pa2kPOA7RdqqysfGtaCyOXA2VGgmvUiJ5e9lD8qKioeOv1ejVZXFwMI5eLEWOFWgh5Etg4J0lJSTdwYiHxLSwseFi3Yg5qRE8veyh+TE1Nhebn5zWZnZ31mE2okTxmM6WlpS7xeDyeQ2Qb61bMQQ214mMPVVxc7MJuNBkfHz9EtplNmEcET4JPfL29va+i6azR19f3UnzV1dUrqqqqyocT0KSzs/OV1YB6ROrr67fF19TU9DSazhp1dXXPxdfS0vJQNTY2+sfGxjSpra19YTWgHhHs/pn40OhRNJ0lLuON+kF8ra2tY9yAe3R0VBMc6wfr84n6b1BDrfiam5snImgczObAq7ylv7//q/hGRkbuqMHBwTt4Q2nS3d39jSKzCfXfoKarq+ur+NhD1owLcNrt9h3OTXGrqKgoKJ6hoaFD5DhuIA43xiGyJoWFhUGKxYXaL3CNGtH39PR8Zg9jzREfH+8vKCgI4krDRu0GcGVnZ78ZGBg4ER/Wf+4OVzOMRhrwFE6ysrLe0EQzaopII65RI3p478lVp6am7uDmPJY11F44HI7dsrKyfc5Nnj1km5Lo6Oiw4cdnD1kLJSUl++np6btsQjhmzayB5x29uGp3fn5+EPMw66eBX8b3yHZlDdyRdtzN75F1LED7kR6gMA7E6HsMrqpogbv5KngM9Bk8MbTKwAYmQSiCdhd4wW0VazQ0NNwEXrALNDHGS+A2UFHIA3smj/rX4JvrT7GBSRDi/J8Db8e/JY/5jLj4Y3KxgfPfwHc53iL+IQDMOgAAAABJRU5ErkJggg==&quot;&gt;
            Admin
        &lt;/h3&gt;

<span style="color:red;">&lt;form action=&quot;{{ path('_profiler_import') }}&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span style="color:red;">        {% if token is not empty %}</span>        &lt;div style=&quot;margin-bottom: <span style="color:red;">10px&quot;&gt;</span>
<span style="color:red;">                &amp;#187;&amp;#160;&lt;a</span><span style="color:green;">10px&quot;&gt;&amp;#187;&amp;#160;&lt;a</span> href=&quot;{{ path('_profiler_purge', { 'token': token }) <span style="color:red;">}}&quot;&gt;Purge&lt;/a&gt;</span>
<span style="color:red;">            &lt;/div&gt;</span>
<span style="color:red;">            &lt;div style=&quot;margin-bottom: 10px&quot;&gt;</span>
<span style="color:red;">                &amp;#187;&amp;#160;&lt;a href=&quot;{{ path('_profiler_export', { 'token': token }) }}&quot;&gt;Export&lt;/a&gt;</span><span style="color:green;">}}&quot;&gt;Purge&lt;/a&gt;&lt;/div&gt;</span>
    &lt;/div&gt;
{% endif %}<span style="color:red;">&amp;#187;&amp;#160;&lt;label for=&quot;file&quot;&gt;Import&lt;/label&gt;&lt;br&gt;</span>
<span style="color:red;">        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;</span>
<span style="color:red;">        &lt;button type=&quot;submit&quot; class=&quot;sf-button&quot;&gt;</span>
<span style="color:red;">            &lt;span class=&quot;border-l&quot;&gt;</span>
<span style="color:red;">                &lt;span class=&quot;border-r&quot;&gt;</span>
<span style="color:red;">                    &lt;span class=&quot;btn-bg&quot;&gt;UPLOAD&lt;/span&gt;</span>
<span style="color:red;">                &lt;/span&gt;</span>
<span style="color:red;">            &lt;/span&gt;</span>
<span style="color:red;">        &lt;/button&gt;</span>
<span style="color:red;">        &lt;div class=&quot;clear-fix&quot;&gt;&lt;/div&gt;</span>
<span style="color:red;">    &lt;/form&gt;</span>
<span style="color:red;">&lt;/div&gt;</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/layout.html.twig b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/layout.html.twig</span>
<span style="font-weight:bold;">index 4cbecc0499..2933564de8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/layout.html.twig</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/layout.html.twig</span>
<span style="color:teal;">@@ -68,20 +68,20 @@</span>
                menu = document.getElementById('navigation'), savedState = Sfjs.getPreference('menu/displayState'),
                displayState, elem, className;

            if <span style="color:red;">(savedState == null)</span><span style="color:green;">(null === savedState)</span> {
                savedState = 'block';
            }

            displayState = state || <span style="color:red;">(savedState == 'block'</span><span style="color:green;">('block' === savedState</span> ? 'none' : 'block');

            if <span style="color:red;">(typeof doSave</span><span style="color:green;">('undefined'</span> === <span style="color:red;">'undefined')</span><span style="color:green;">typeof doSave)</span> {
                doSave = true;
            }

            document.getElementById('searchBar').style.display = displayState;
            document.getElementById('adminBar').style.display = displayState;

            if <span style="color:red;">(displayState == 'block')</span><span style="color:green;">('block' === displayState)</span> {
                Sfjs.removeClass(menu, 'collapsed-menu');
                Sfjs.removeClass(menu.parentNode.parentNode, 'collapsed-menu-parents');

<span style="color:teal;">@@ -107,7 +107,7 @@</span>
        }

        window.setTimeout(function() {
            if <span style="color:red;">(document.getElementById('menu-profiler') == null)</span><span style="color:green;">(null === document.getElementById('menu-profiler'))</span> {
                return;
            }

<span style="color:teal;">@@ -119,12 +119,12 @@</span>
            }

            for (elem in menuItems) {
                if (typeof(menuItems[elem].children) <span style="color:red;">!=</span><span style="color:green;">!==</span> 'undefined' &amp;&amp;
                    menuItems[elem].children.length &gt; 0) {
                    child = menuItems[elem].children[0]

                    if <span style="color:red;">(child.getAttribute('title') == '' ||</span><span style="color:green;">('' ===</span> child.getAttribute('title') <span style="color:red;">== null)</span><span style="color:green;">||</span>
<span style="color:green;">                        null === child.getAttribute('title'))</span> {
                        value = child.text.replace(/^\s+/g, '').split('\n')[0].replace(/\s+$/g, '');
                        child.setAttribute('title', value);
                    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/toolbar.css.twig b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/toolbar.css.twig</span>
<span style="font-weight:bold;">index 8e780c3155..85b30948ed 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/toolbar.css.twig</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Resources/views/Profiler/toolbar.css.twig</span>
<span style="color:teal;">@@ -22,6 +22,7 @@</span>
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    <span style="color:green;">vertical-align: baseline;</span>
}

.sf-toolbarreset {
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ExportCommandTest.php b/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ExportCommandTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..572e9b3978</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ExportCommandTest.php</span>
<span style="color:teal;">@@ -0,0 +1,53 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bundle\WebProfilerBundle\Tests\Command;</span>

<span style="color:green;">use Symfony\Bundle\WebProfilerBundle\Command\ExportCommand;</span>
<span style="color:green;">use Symfony\Component\Console\Tester\CommandTester;</span>
<span style="color:green;">use Symfony\Component\Console\Application;</span>
<span style="color:green;">use Symfony\Component\HttpKernel\Profiler\Profile;</span>

<span style="color:green;">class ExportCommandTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:green;">{</span>
<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \LogicException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testExecuteWithUnknownToken()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $profiler = $this</span>
<span style="color:green;">            -&gt;getMockBuilder('Symfony\Component\HttpKernel\Profiler\Profiler')</span>
<span style="color:green;">            -&gt;disableOriginalConstructor()</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $command = new ExportCommand($profiler);</span>
<span style="color:green;">        $commandTester = new CommandTester($command);</span>
<span style="color:green;">        $commandTester-&gt;execute(array('token' =&gt; 'TOKEN'));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testExecuteWithToken()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $profiler = $this</span>
<span style="color:green;">            -&gt;getMockBuilder('Symfony\Component\HttpKernel\Profiler\Profiler')</span>
<span style="color:green;">            -&gt;disableOriginalConstructor()</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $profile = new Profile('TOKEN');</span>
<span style="color:green;">        $profiler-&gt;expects($this-&gt;once())-&gt;method('loadProfile')-&gt;with('TOKEN')-&gt;will($this-&gt;returnValue($profile));</span>

<span style="color:green;">        $command = new ExportCommand($profiler);</span>
<span style="color:green;">        $commandTester = new CommandTester($command);</span>
<span style="color:green;">        $commandTester-&gt;execute(array('token' =&gt; 'TOKEN'));</span>
<span style="color:green;">        $this-&gt;assertEquals($profiler-&gt;export($profile), $commandTester-&gt;getDisplay());</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ImportCommandTest.php b/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ImportCommandTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..f5121c12d6</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Tests/Command/ImportCommandTest.php</span>
<span style="color:teal;">@@ -0,0 +1,36 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Bundle\WebProfilerBundle\Tests\Command;</span>

<span style="color:green;">use Symfony\Bundle\WebProfilerBundle\Command\ImportCommand;</span>
<span style="color:green;">use Symfony\Component\Console\Tester\CommandTester;</span>
<span style="color:green;">use Symfony\Component\Console\Application;</span>
<span style="color:green;">use Symfony\Component\HttpKernel\Profiler\Profile;</span>

<span style="color:green;">class ImportCommandTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:green;">{</span>
<span style="color:green;">    public function testExecute()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $profiler = $this</span>
<span style="color:green;">            -&gt;getMockBuilder('Symfony\Component\HttpKernel\Profiler\Profiler')</span>
<span style="color:green;">            -&gt;disableOriginalConstructor()</span>
<span style="color:green;">            -&gt;getMock()</span>
<span style="color:green;">        ;</span>

<span style="color:green;">        $profiler-&gt;expects($this-&gt;once())-&gt;method('import')-&gt;will($this-&gt;returnValue(new Profile('TOKEN')));</span>

<span style="color:green;">        $command = new ImportCommand($profiler);</span>
<span style="color:green;">        $commandTester = new CommandTester($command);</span>
<span style="color:green;">        $commandTester-&gt;execute(array('filename' =&gt; __DIR__.'/../Fixtures/profile.data'));</span>
<span style="color:green;">        $this-&gt;assertRegExp('/Profile &quot;TOKEN&quot; has been successfully imported\./', $commandTester-&gt;getDisplay());</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Bundle/WebProfilerBundle/Tests/Fixtures/profile.data b/src/Symfony/Bundle/WebProfilerBundle/Tests/Fixtures/profile.data</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..ab76cea63d</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Bundle/WebProfilerBundle/Tests/Fixtures/profile.data</span>
<span style="color:teal;">@@ -0,0 +1 @@</span>
<span style="color:green;">Tzo0NToiU3ltZm9ueVxDb21wb25lbnRcSHR0cEtlcm5lbFxQcm9maWxlclxQcm9maWxlIjo4OntzOjUyOiIAU3ltZm9ueVxDb21wb25lbnRcSHR0cEtlcm5lbFxQcm9maWxlclxQcm9maWxlAHRva2VuIjtzOjU6IlRPS0VOIjtzOjUzOiIAU3ltZm9ueVxDb21wb25lbnRcSHR0cEtlcm5lbFxQcm9maWxlclxQcm9maWxlAHBhcmVudCI7TjtzOjU1OiIAU3ltZm9ueVxDb21wb25lbnRcSHR0cEtlcm5lbFxQcm9maWxlclxQcm9maWxlAGNoaWxkcmVuIjthOjA6e31zOjU3OiIAU3ltZm9ueVxDb21wb25lbnRcSHR0cEtlcm5lbFxQcm9maWxlclxQcm9maWxlAGNvbGxlY3RvcnMiO2E6MDp7fXM6NDk6IgBTeW1mb255XENvbXBvbmVudFxIdHRwS2VybmVsXFByb2ZpbGVyXFByb2ZpbGUAaXAiO047czo1MzoiAFN5bWZvbnlcQ29tcG9uZW50XEh0dHBLZXJuZWxcUHJvZmlsZXJcUHJvZmlsZQBtZXRob2QiO047czo1MDoiAFN5bWZvbnlcQ29tcG9uZW50XEh0dHBLZXJuZWxcUHJvZmlsZXJcUHJvZmlsZQB1cmwiO047czo1MToiAFN5bWZvbnlcQ29tcG9uZW50XEh0dHBLZXJuZWxcUHJvZmlsZXJcUHJvZmlsZQB0aW1lIjtOO30=</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/BrowserKit/Client.php b/src/Symfony/Component/BrowserKit/Client.php</span>
<span style="font-weight:bold;">index a7a840112e..789ea38b5b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/BrowserKit/Client.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/BrowserKit/Client.php</span>
<span style="color:teal;">@@ -298,8 +298,8 @@</span> abstract class Client

        $uri = $this-&gt;getAbsoluteUri($uri);

        if <span style="color:red;">(isset($server['HTTP_HOST']))</span><span style="color:green;">(!empty($server['HTTP_HOST']))</span> {
            $uri = <span style="color:red;">preg_replace('{^(https?\://)'.parse_url($uri, PHP_URL_HOST).'}',</span><span style="color:green;">preg_replace('{^(https?\://)'.preg_quote($this-&gt;extractHost($uri)).'}',</span> '${1}'.$server['HTTP_HOST'], $uri);
        }

        if (isset($server['HTTPS'])) {
<span style="color:teal;">@@ -312,12 +312,7 @@</span> abstract class Client
            $server['HTTP_REFERER'] = $this-&gt;history-&gt;current()-&gt;getUri();
        }

        $server['HTTP_HOST'] = <span style="color:red;">parse_url($uri, PHP_URL_HOST);</span>

<span style="color:red;">        if ($port = parse_url($uri, PHP_URL_PORT)) {</span>
<span style="color:red;">            $server['HTTP_HOST'] .= ':'.$port;</span>
<span style="color:red;">        }</span><span style="color:green;">$this-&gt;extractHost($uri);</span>
        $server['HTTPS'] = 'https' == parse_url($uri, PHP_URL_SCHEME);

        $this-&gt;internalRequest = new Request($uri, $method, $parameters, $files, $this-&gt;cookieJar-&gt;allValues($uri), $server, $content);
<span style="color:teal;">@@ -607,11 +602,22 @@</span> abstract class Client

    private function updateServerFromUri($server, $uri)
    {
        $server['HTTP_HOST'] = <span style="color:red;">parse_url($uri, PHP_URL_HOST);</span><span style="color:green;">$this-&gt;extractHost($uri);</span>
        $scheme = parse_url($uri, PHP_URL_SCHEME);
        $server['HTTPS'] = null === $scheme ? $server['HTTPS'] : 'https' == $scheme;
        unset($server['HTTP_IF_NONE_MATCH'], $server['HTTP_IF_MODIFIED_SINCE']);

        return $server;
    }

    <span style="color:green;">private function extractHost($uri)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $host = parse_url($uri, PHP_URL_HOST);</span>

<span style="color:green;">        if ($port = parse_url($uri, PHP_URL_PORT)) {</span>
<span style="color:green;">            return $host.':'.$port;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return $host;</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/BrowserKit/Tests/ClientTest.php b/src/Symfony/Component/BrowserKit/Tests/ClientTest.php</span>
<span style="font-weight:bold;">index ca6898abb2..64d68e434e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/BrowserKit/Tests/ClientTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/BrowserKit/Tests/ClientTest.php</span>
<span style="color:teal;">@@ -210,6 +210,24 @@</span> class ClientTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('http://www.example.com/foo/bar', $client-&gt;getRequest()-&gt;getUri(), '-&gt;request() uses the previous request for relative URLs');
    }

    <span style="color:green;">public function testRequestURIConversionByServerHost()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $client = new TestClient();</span>

<span style="color:green;">        $server = array('HTTP_HOST' =&gt; 'www.exampl+e.com:8000');</span>
<span style="color:green;">        $parameters = array();</span>
<span style="color:green;">        $files = array();</span>

<span style="color:green;">        $client-&gt;request('GET', 'http://exampl+e.com', $parameters, $files, $server);</span>
<span style="color:green;">        $this-&gt;assertEquals('http://www.exampl+e.com:8000', $client-&gt;getRequest()-&gt;getUri(), '-&gt;request() uses HTTP_HOST to add port');</span>

<span style="color:green;">        $client-&gt;request('GET', 'http://exampl+e.com:8888', $parameters, $files, $server);</span>
<span style="color:green;">        $this-&gt;assertEquals('http://www.exampl+e.com:8000', $client-&gt;getRequest()-&gt;getUri(), '-&gt;request() uses HTTP_HOST to modify existing port');</span>

<span style="color:green;">        $client-&gt;request('GET', 'http://exampl+e.com:8000', $parameters, $files, $server);</span>
<span style="color:green;">        $this-&gt;assertEquals('http://www.exampl+e.com:8000', $client-&gt;getRequest()-&gt;getUri(), '-&gt;request() uses HTTP_HOST respects correct set port');</span>
<span style="color:green;">    }</span>

    public function testRequestReferer()
    {
        $client = new TestClient();
<span style="color:teal;">@@ -349,6 +367,19 @@</span> class ClientTest extends \PHPUnit_Framework_TestCase
        }
    }

    <span style="color:green;">public function testFollowRelativeRedirect()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $client = new TestClient();</span>
<span style="color:green;">        $client-&gt;setNextResponse(new Response('', 302, array('Location' =&gt; '/redirected')));</span>
<span style="color:green;">        $client-&gt;request('GET', 'http://www.example.com/foo/foobar');</span>
<span style="color:green;">        $this-&gt;assertEquals('http://www.example.com/redirected', $client-&gt;getRequest()-&gt;getUri(), '-&gt;followRedirect() follows a redirect if any');</span>

<span style="color:green;">        $client = new TestClient();</span>
<span style="color:green;">        $client-&gt;setNextResponse(new Response('', 302, array('Location' =&gt; '/redirected:1234')));</span>
<span style="color:green;">        $client-&gt;request('GET', 'http://www.example.com/foo/foobar');</span>
<span style="color:green;">        $this-&gt;assertEquals('http://www.example.com/redirected:1234', $client-&gt;getRequest()-&gt;getUri(), '-&gt;followRedirect() follows relative urls');</span>
<span style="color:green;">    }</span>

    public function testFollowRedirectWithMaxRedirects()
    {
        $client = new TestClient();
<span style="color:teal;">@@ -434,11 +465,11 @@</span> class ClientTest extends \PHPUnit_Framework_TestCase
        $headers = array(
            'HTTP_HOST'       =&gt; 'www.example.com:8080',
            'HTTP_USER_AGENT' =&gt; 'Symfony2 BrowserKit',
            'HTTPS'           =&gt; <span style="color:red;">false</span><span style="color:green;">false,</span>
<span style="color:green;">            'HTTP_REFERER'    =&gt; 'http://www.example.com:8080/'</span>
        );

        $client = new TestClient();
<span style="color:red;">        $client-&gt;followRedirects(false);</span>
        $client-&gt;setNextResponse(new Response('', 302, array(
            'Location'    =&gt; 'http://www.example.com:8080/redirected',
        )));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/ClassLoader/ApcClassLoader.php b/src/Symfony/Component/ClassLoader/ApcClassLoader.php</span>
<span style="font-weight:bold;">index 8ee49fb45d..513362a503 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/ClassLoader/ApcClassLoader.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/ClassLoader/ApcClassLoader.php</span>
<span style="color:teal;">@@ -15,7 +15,7 @@</span> namespace Symfony\Component\ClassLoader;
 * ApcClassLoader implements a wrapping autoloader cached in APC for PHP 5.3.
 *
 * It expects an object implementing a findFile method to find the file. This
 * <span style="color:red;">allow</span><span style="color:green;">allows</span> using it as a wrapper around the other loaders of the component (the
 * ClassLoader and the UniversalClassLoader for instance) but also around any
 * other autoloader following this convention (the Composer one for instance)
 *
<span style="color:teal;">@@ -46,7 +46,7 @@</span> class ApcClassLoader
    /**
     * The class loader object being decorated.
     *
     * @var <span style="color:red;">\Symfony\Component\ClassLoader\ClassLoader</span><span style="color:green;">object</span>
     *   A class loader object that implements the findFile() method.
     */
    protected $decorated;
<span style="color:teal;">@@ -133,5 +133,4 @@</span> class ApcClassLoader
    {
        return call_user_func_array(array($this-&gt;decorated, $method), $args);
    }

}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/ClassLoader/XcacheClassLoader.php b/src/Symfony/Component/ClassLoader/XcacheClassLoader.php</span>
<span style="font-weight:bold;">index 299a79af93..30096bc83f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/ClassLoader/XcacheClassLoader.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/ClassLoader/XcacheClassLoader.php</span>
<span style="color:teal;">@@ -12,7 +12,7 @@</span>
namespace Symfony\Component\ClassLoader;

/**
 * XcacheClassLoader implements a wrapping autoloader cached in <span style="color:red;">Xcache</span><span style="color:green;">XCache</span> for PHP 5.3.
 *
 * It expects an object implementing a findFile method to find the file. This
 * allows using it as a wrapper around the other loaders of the component (the
<span style="color:teal;">@@ -43,31 +43,35 @@</span> namespace Symfony\Component\ClassLoader;
class XcacheClassLoader
{
    private $prefix;

    <span style="color:green;">/**</span>
<span style="color:green;">     * @var object A class loader object that implements the findFile() method</span>
<span style="color:green;">     */</span>
    private <span style="color:red;">$classFinder;</span><span style="color:green;">$decorated;</span>

    /**
     * Constructor.
     *
     * @param string $prefix      <span style="color:red;">A</span><span style="color:green;">The XCache namespace</span> prefix to <span style="color:red;">create a namespace in Xcache</span><span style="color:green;">use.</span>
     * @param object <span style="color:red;">$classFinder An</span><span style="color:green;">$decorated   A class loader</span> object that implements <span style="color:green;">the</span> findFile() method.
     *
     * @throws \RuntimeException
     * @throws \InvalidArgumentException
     *
     * @api
     */
    public function __construct($prefix, <span style="color:red;">$classFinder)</span><span style="color:green;">$decorated)</span>
    {
        if <span style="color:red;">(!extension_loaded('Xcache'))</span><span style="color:green;">(!extension_loaded('xcache'))</span> {
            throw new \RuntimeException('Unable to use XcacheClassLoader as <span style="color:red;">Xcache</span><span style="color:green;">XCache</span> is not enabled.');
        }

        if <span style="color:red;">(!method_exists($classFinder,</span><span style="color:green;">(!method_exists($decorated,</span> 'findFile')) {
            throw new \InvalidArgumentException('The class finder must implement a &quot;findFile&quot; method.');
        }

        $this-&gt;prefix = $prefix;
        <span style="color:red;">$this-&gt;classFinder</span><span style="color:green;">$this-&gt;decorated</span> = <span style="color:red;">$classFinder;</span><span style="color:green;">$decorated;</span>
    }

    /**
<span style="color:teal;">@@ -116,10 +120,18 @@</span> class XcacheClassLoader
        if (xcache_isset($this-&gt;prefix.$class)) {
            $file = xcache_get($this-&gt;prefix.$class);
        } else {
            $file = <span style="color:red;">$this-&gt;classFinder-&gt;findFile($class);</span><span style="color:green;">$this-&gt;decorated-&gt;findFile($class);</span>
            xcache_set($this-&gt;prefix.$class, $file);
        }

        return $file;
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * Passes through all unknown calls onto the decorated object.</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function __call($method, $args)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return call_user_func_array(array($this-&gt;decorated, $method), $args);</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Config/Definition/BaseNode.php b/src/Symfony/Component/Config/Definition/BaseNode.php</span>
<span style="font-weight:bold;">index b9e48ce2a1..eb5ab59eeb 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Config/Definition/BaseNode.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Config/Definition/BaseNode.php</span>
<span style="color:teal;">@@ -292,6 +292,7 @@</span> abstract class BaseNode implements NodeInterface
     *
     * @return mixed The finalized value
     *
     <span style="color:green;">* @throws Exception</span>
     * @throws InvalidConfigurationException
     */
    final public function finalize($value)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Config/Definition/Builder/NumericNodeDefinition.php b/src/Symfony/Component/Config/Definition/Builder/NumericNodeDefinition.php</span>
<span style="font-weight:bold;">index 5b6e9550bf..ddd716d06a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Config/Definition/Builder/NumericNodeDefinition.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Config/Definition/Builder/NumericNodeDefinition.php</span>
<span style="color:teal;">@@ -12,7 +12,7 @@</span>
namespace Symfony\Component\Config\Definition\Builder;

/**
 * Abstract class that <span style="color:red;">contain</span><span style="color:green;">contains</span> common code of integer and float node <span style="color:red;">definition.</span><span style="color:green;">definitions.</span>
 *
 * @author David Jeanmonod &lt;david.jeanmonod@gmail.com&gt;
 */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Config/Tests/Definition/Builder/ExprBuilderTest.php b/src/Symfony/Component/Config/Tests/Definition/Builder/ExprBuilderTest.php</span>
<span style="font-weight:bold;">index fa6fce5e6b..c18c696c45 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Config/Tests/Definition/Builder/ExprBuilderTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Config/Tests/Definition/Builder/ExprBuilderTest.php</span>
<span style="color:teal;">@@ -182,7 +182,7 @@</span> class ExprBuilderTest extends \PHPUnit_Framework_TestCase
            -&gt;end()
            -&gt;end()
            -&gt;buildTree()
            <span style="color:red;">-&gt;finalize($config</span><span style="color:green;">-&gt;finalize(null</span> === <span style="color:red;">null</span><span style="color:green;">$config</span> ? array('key'=&gt;'value') : $config)
        ;
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Application.php b/src/Symfony/Component/Console/Application.php</span>
<span style="font-weight:bold;">index c28cd243d9..eaa68d3b57 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Application.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Application.php</span>
<span style="color:teal;">@@ -872,6 +872,8 @@</span> class Application
     * @param OutputInterface $output  An Output instance
     *
     * @return int 0 if everything went fine, or an error code
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws \Exception when the command being run threw an exception</span>
     */
    protected function doRunCommand(Command $command, InputInterface $input, OutputInterface $output)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Formatter/OutputFormatter.php b/src/Symfony/Component/Console/Formatter/OutputFormatter.php</span>
<span style="font-weight:bold;">index ca5f28731e..3813b542d4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Formatter/OutputFormatter.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Formatter/OutputFormatter.php</span>
<span style="color:teal;">@@ -215,7 +215,11 @@</span> class OutputFormatter implements OutputFormatterInterface
            } elseif ('bg' == $match[0]) {
                $style-&gt;setBackground($match[1]);
            } else {
                <span style="color:green;">try {</span>
                    $style-&gt;setOption($match[1]);
                <span style="color:green;">} catch (\InvalidArgumentException $e) {</span>
<span style="color:green;">                    return false;</span>
<span style="color:green;">                }</span>
            }
        }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Helper/DescriptorHelper.php b/src/Symfony/Component/Console/Helper/DescriptorHelper.php</span>
<span style="font-weight:bold;">index 932dd0f299..d58e0bf144 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Helper/DescriptorHelper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Helper/DescriptorHelper.php</span>
<span style="color:teal;">@@ -54,7 +54,7 @@</span> class DescriptorHelper extends Helper
     * @param object          $object
     * @param array           $options
     *
     * @throws \InvalidArgumentException <span style="color:green;">when the given format is not supported</span>
     */
    public function describe(OutputInterface $output, $object, array $options = array())
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Helper/DialogHelper.php b/src/Symfony/Component/Console/Helper/DialogHelper.php</span>
<span style="font-weight:bold;">index a68685e18c..244c29093d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Helper/DialogHelper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Helper/DialogHelper.php</span>
<span style="color:teal;">@@ -325,7 +325,7 @@</span> class DialogHelper extends InputAwareHelper
     * @param OutputInterface $output       An Output instance
     * @param string|array    $question     The question to ask
     * @param callable        $validator    A PHP callback
     * @param <span style="color:red;">int</span><span style="color:green;">int|false</span>       $attempts     Max number of times to ask before giving up (false by default, which means infinite)
     * @param string          $default      The default answer if none is given by the user
     * @param array           $autocomplete List of values to autocomplete
     *
<span style="color:teal;">@@ -354,7 +354,7 @@</span> class DialogHelper extends InputAwareHelper
     * @param OutputInterface $output    An Output instance
     * @param string|array    $question  The question to ask
     * @param callable        $validator A PHP callback
     * @param <span style="color:red;">int</span><span style="color:green;">int|false</span>       $attempts  Max number of times to ask before giving up (false by default, which means infinite)
     * @param bool            $fallback  In case the response can not be hidden, whether to fallback on non-hidden question or not
     *
     * @return string         The response
<span style="color:teal;">@@ -448,7 +448,7 @@</span> class DialogHelper extends InputAwareHelper
     * @param callable         $interviewer  A callable that will ask for a question and return the result
     * @param OutputInterface  $output       An Output instance
     * @param callable         $validator    A PHP callback
     * @param <span style="color:red;">int</span><span style="color:green;">int|false</span>        $attempts     Max number of times to ask before giving up ; false will ask infinitely
     *
     * @return string   The validated response
     *
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Helper/TableHelper.php b/src/Symfony/Component/Console/Helper/TableHelper.php</span>
<span style="font-weight:bold;">index 3281fc8cea..7bbf5be13b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Helper/TableHelper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Helper/TableHelper.php</span>
<span style="color:teal;">@@ -80,6 +80,8 @@</span> class TableHelper extends Helper
     * @param int $layout self::LAYOUT_*
     *
     * @return TableHelper
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws InvalidArgumentException when the table layout is not known</span>
     */
    public function setLayout($layout)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Tests/Command/ListCommandTest.php b/src/Symfony/Component/Console/Tests/Command/ListCommandTest.php</span>
<span style="font-weight:bold;">index 1df06f5d94..ca50874912 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Tests/Command/ListCommandTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Tests/Command/ListCommandTest.php</span>
<span style="color:teal;">@@ -50,7 +50,7 @@</span> EOF;
    public function testExecuteListsCommandsWithNamespaceArgument()
    {

        <span style="color:red;">require_once(realpath(__DIR__.'/../Fixtures/FooCommand.php'));</span><span style="color:green;">require_once realpath(__DIR__.'/../Fixtures/FooCommand.php');</span>
        $application = new Application();
        $application-&gt;add(new \FooCommand());
        $commandTester = new CommandTester($command = $application-&gt;get('list'));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php b/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php</span>
<span style="font-weight:bold;">index c8f0b987af..bdaf36caef 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php</span>
<span style="color:teal;">@@ -151,7 +151,7 @@</span> class OutputFormatterTest extends \PHPUnit_Framework_TestCase
    {
        $formatter = new OutputFormatter(true);

        $this-&gt;assertEquals(&quot;\033[32msome \033[0m\033[32m&lt;tag&gt;\033[0m\033[32m <span style="color:green;">\033[0m\033[32m&lt;setting=value&gt;\033[0m\033[32m</span> styled \033[0m\033[32m&lt;p&gt;\033[0m\033[32msingle-char tag\033[0m\033[32m&lt;/p&gt;\033[0m&quot;, $formatter-&gt;format('&lt;info&gt;some &lt;tag&gt; <span style="color:green;">&lt;setting=value&gt;</span> styled &lt;p&gt;single-char tag&lt;/p&gt;&lt;/info&gt;'));
    }

    public function testFormatLongString()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/CssSelector/README.md b/src/Symfony/Component/CssSelector/README.md</span>
<span style="font-weight:bold;">index 623649bedb..fae1d4bc9a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/CssSelector/README.md</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/CssSelector/README.md</span>
<span style="color:teal;">@@ -35,7 +35,7 @@</span> Resources
This component is a port of the Python lxml library, which is copyright Infrae
and distributed under the BSD license.

Current code is a port of <span style="color:red;">https://github.com/SimonSapin/cssselect@v0.7.1</span><span style="color:green;">https://github.com/SimonSapin/cssselect/releases/tag/v0.7.1</span>

You can run the unit tests with the following command:

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Compiler/AnalyzeServiceReferencesPass.php b/src/Symfony/Component/DependencyInjection/Compiler/AnalyzeServiceReferencesPass.php</span>
<span style="font-weight:bold;">index 4a907ece29..f488052596 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Compiler/AnalyzeServiceReferencesPass.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Compiler/AnalyzeServiceReferencesPass.php</span>
<span style="color:teal;">@@ -69,7 +69,11 @@</span> class AnalyzeServiceReferencesPass implements RepeatablePassInterface

            $this-&gt;currentId = $id;
            $this-&gt;currentDefinition = $definition;

            $this-&gt;processArguments($definition-&gt;getArguments());
            <span style="color:green;">if ($definition-&gt;getFactoryService()) {</span>
<span style="color:green;">                $this-&gt;processArguments(array(new Reference($definition-&gt;getFactoryService())));</span>
<span style="color:green;">            }</span>

            if (!$this-&gt;onlyConstructorArguments) {
                $this-&gt;processArguments($definition-&gt;getMethodCalls());
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Container.php b/src/Symfony/Component/DependencyInjection/Container.php</span>
<span style="font-weight:bold;">index b27df26442..3308d9f29a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Container.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Container.php</span>
<span style="color:teal;">@@ -197,6 +197,12 @@</span> class Container implements IntrospectableContainerInterface

        $id = strtolower($id);

        <span style="color:green;">if ('service_container' === $id) {</span>
<span style="color:green;">            // BC: 'service_container' is no longer a self-reference but always</span>
<span style="color:green;">            // $this, so ignore this call.</span>
<span style="color:green;">            // @todo Throw InvalidArgumentException in next major release.</span>
<span style="color:green;">            return;</span>
<span style="color:green;">        }</span>
        if (self::SCOPE_CONTAINER !== $scope) {
            if (!isset($this-&gt;scopedServices[$scope])) {
                throw new RuntimeException(sprintf('You cannot set service &quot;%s&quot; of inactive scope.', $id));
<span style="color:teal;">@@ -233,6 +239,10 @@</span> class Container implements IntrospectableContainerInterface
    {
        $id = strtolower($id);

        <span style="color:green;">if ('service_container' === $id) {</span>
<span style="color:green;">            return true;</span>
<span style="color:green;">        }</span>

        return isset($this-&gt;services[$id])
            || array_key_exists($id, $this-&gt;services)
            || isset($this-&gt;aliases[$id])
<span style="color:teal;">@@ -251,9 +261,10 @@</span> class Container implements IntrospectableContainerInterface
     *
     * @return object The associated service
     *
     * @throws InvalidArgumentException          if the service is not defined
     * @throws ServiceCircularReferenceException When a circular reference is detected
     * @throws ServiceNotFoundException          When the service is not defined
     <span style="color:green;">* @throws \Exception                        if an exception has been thrown when the service has been resolved</span>
     *
     * @see Reference
     *
<span style="color:teal;">@@ -269,6 +280,9 @@</span> class Container implements IntrospectableContainerInterface
            if ($strtolower) {
                $id = strtolower($id);
            }
            <span style="color:green;">if ('service_container' === $id) {</span>
<span style="color:green;">                return $this;</span>
<span style="color:green;">            }</span>
            if (isset($this-&gt;aliases[$id])) {
                $id = $this-&gt;aliases[$id];
            }
<span style="color:teal;">@@ -340,6 +354,12 @@</span> class Container implements IntrospectableContainerInterface
    {
        $id = strtolower($id);

        <span style="color:green;">if ('service_container' === $id) {</span>
<span style="color:green;">            // BC: 'service_container' was a synthetic service previously.</span>
<span style="color:green;">            // @todo Change to false in next major release.</span>
<span style="color:green;">            return true;</span>
<span style="color:green;">        }</span>

        return isset($this-&gt;services[$id]) || array_key_exists($id, $this-&gt;services);
    }

<span style="color:teal;">@@ -357,6 +377,7 @@</span> class Container implements IntrospectableContainerInterface
                $ids[] = self::underscore($match[1]);
            }
        }
        <span style="color:green;">$ids[] = 'service_container';</span>

        return array_unique(array_merge($ids, array_keys($this-&gt;services)));
    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Dumper/GraphvizDumper.php b/src/Symfony/Component/DependencyInjection/Dumper/GraphvizDumper.php</span>
<span style="font-weight:bold;">index 5ee1b7eea0..1ffe142af4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Dumper/GraphvizDumper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Dumper/GraphvizDumper.php</span>
<span style="color:teal;">@@ -17,6 +17,7 @@</span> use Symfony\Component\DependencyInjection\Parameter;
use Symfony\Component\DependencyInjection\ContainerInterface;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\ParameterBag\ParameterBag;
<span style="color:green;">use Symfony\Component\DependencyInjection\Scope;</span>

/**
 * GraphvizDumper dumps a service container as a graphviz file.
<span style="color:teal;">@@ -193,8 +194,8 @@</span> class GraphvizDumper extends Dumper
        $container-&gt;setDefinitions($this-&gt;container-&gt;getDefinitions());
        $container-&gt;setAliases($this-&gt;container-&gt;getAliases());
        $container-&gt;setResources($this-&gt;container-&gt;getResources());
        foreach ($this-&gt;container-&gt;getScopes() as <span style="color:red;">$scope)</span><span style="color:green;">$scope =&gt; $parentScope)</span> {
            <span style="color:red;">$container-&gt;addScope($scope);</span><span style="color:green;">$container-&gt;addScope(new Scope($scope, $parentScope));</span>
        }
        foreach ($this-&gt;container-&gt;getExtensions() as $extension) {
            $container-&gt;registerExtension($extension);
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Dumper/PhpDumper.php b/src/Symfony/Component/DependencyInjection/Dumper/PhpDumper.php</span>
<span style="font-weight:bold;">index 38ced88408..3755afdf14 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Dumper/PhpDumper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Dumper/PhpDumper.php</span>
<span style="color:teal;">@@ -428,7 +428,10 @@</span> class PhpDumper extends Dumper
     *
     * @param string     $id
     * @param Definition $definition
     <span style="color:green;">*</span>
     * @return string
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws ServiceCircularReferenceException when the container contains a circular reference</span>
     */
    private function addServiceInlinedDefinitionsSetup($id, $definition)
    {
<span style="color:teal;">@@ -510,7 +513,7 @@</span> class PhpDumper extends Dumper
        if ($definition-&gt;isSynthetic()) {
            $return[] = '@throws RuntimeException always since this service is expected to be injected dynamically';
        } elseif ($class = $definition-&gt;getClass()) {
            $return[] = sprintf(&quot;@return %s A %s instance.&quot;, 0 === strpos($class, '%') ? 'object' : <span style="color:red;">$class,</span><span style="color:green;">&quot;\\&quot;.$class,</span> $class);
        } elseif ($definition-&gt;getFactoryClass()) {
            $return[] = sprintf('@return object An instance returned by %s::%s().', $definition-&gt;getFactoryClass(), $definition-&gt;getFactoryMethod());
        } elseif ($definition-&gt;getFactoryService()) {
<span style="color:teal;">@@ -632,6 +635,8 @@</span> EOF;
     *
     * @param string     $id         A service identifier
     * @param Definition $definition A Definition instance
     <span style="color:green;">*</span>
<span style="color:green;">     * @return string|null</span>
     */
    private function addServiceSynchronizer($id, Definition $definition)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Dumper/XmlDumper.php b/src/Symfony/Component/DependencyInjection/Dumper/XmlDumper.php</span>
<span style="font-weight:bold;">index 31bec31b22..5cff9dcc4e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Dumper/XmlDumper.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Dumper/XmlDumper.php</span>
<span style="color:teal;">@@ -120,6 +120,9 @@</span> class XmlDumper extends Dumper
        if ($definition-&gt;getFactoryMethod()) {
            $service-&gt;setAttribute('factory-method', $definition-&gt;getFactoryMethod());
        }
        <span style="color:green;">if ($definition-&gt;getFactoryClass()) {</span>
<span style="color:green;">            $service-&gt;setAttribute('factory-class', $definition-&gt;getFactoryClass());</span>
<span style="color:green;">        }</span>
        if ($definition-&gt;getFactoryService()) {
            $service-&gt;setAttribute('factory-service', $definition-&gt;getFactoryService());
        }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Loader/YamlFileLoader.php b/src/Symfony/Component/DependencyInjection/Loader/YamlFileLoader.php</span>
<span style="font-weight:bold;">index 7281a76254..4f399a59fc 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Loader/YamlFileLoader.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Loader/YamlFileLoader.php</span>
<span style="color:teal;">@@ -243,6 +243,8 @@</span> class YamlFileLoader extends FileLoader
     * @param string $file
     *
     * @return array The file content
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws InvalidArgumentException when the given file is not a local file or when it does not exist</span>
     */
    protected function loadFile($file)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Compiler/AnalyzeServiceReferencesPassTest.php b/src/Symfony/Component/DependencyInjection/Tests/Compiler/AnalyzeServiceReferencesPassTest.php</span>
<span style="font-weight:bold;">index c99659e5a6..00322a22d0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Compiler/AnalyzeServiceReferencesPassTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Compiler/AnalyzeServiceReferencesPassTest.php</span>
<span style="color:teal;">@@ -97,6 +97,26 @@</span> class AnalyzeServiceReferencesPassTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertCount(2, $graph-&gt;getNode('a')-&gt;getInEdges());
    }

    <span style="color:green;">public function testProcessDetectsFactoryReferences()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = new ContainerBuilder();</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('foo', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryClass('stdClass')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance');</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('bar', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryService('foo')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance');</span>

<span style="color:green;">        $graph = $this-&gt;process($container);</span>

<span style="color:green;">        $this-&gt;assertTrue($graph-&gt;hasNode('foo'));</span>
<span style="color:green;">        $this-&gt;assertCount(1, $graph-&gt;getNode('foo')-&gt;getInEdges());</span>
<span style="color:green;">    }</span>

    protected function process(ContainerBuilder $container)
    {
        $pass = new RepeatedPass(array(new AnalyzeServiceReferencesPass()));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Compiler/CheckCircularReferencesPassTest.php b/src/Symfony/Component/DependencyInjection/Tests/Compiler/CheckCircularReferencesPassTest.php</span>
<span style="font-weight:bold;">index 085bc519b7..8183014c5b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Compiler/CheckCircularReferencesPassTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Compiler/CheckCircularReferencesPassTest.php</span>
<span style="color:teal;">@@ -48,6 +48,26 @@</span> class CheckCircularReferencesPassTest extends \PHPUnit_Framework_TestCase
        $this-&gt;process($container);
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\DependencyInjection\Exception\ServiceCircularReferenceException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testProcessWithFactory()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = new ContainerBuilder();</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('a', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryService('b')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance');</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('b', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryService('a')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance');</span>

<span style="color:green;">        $this-&gt;process($container);</span>
<span style="color:green;">    }</span>

    /**
     * @expectedException \Symfony\Component\DependencyInjection\Exception\ServiceCircularReferenceException
     */
<span style="color:teal;">@@ -61,6 +81,25 @@</span> class CheckCircularReferencesPassTest extends \PHPUnit_Framework_TestCase
        $this-&gt;process($container);
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\DependencyInjection\Exception\ServiceCircularReferenceException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testProcessDetectsIndirectCircularReferenceWithFactory()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = new ContainerBuilder();</span>

<span style="color:green;">        $container-&gt;register('a')-&gt;addArgument(new Reference('b'));</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('b', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryService('c')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance');</span>

<span style="color:green;">        $container-&gt;register('c')-&gt;addArgument(new Reference('a'));</span>

<span style="color:green;">        $this-&gt;process($container);</span>
<span style="color:green;">    }</span>

    /**
     * @expectedException \Symfony\Component\DependencyInjection\Exception\ServiceCircularReferenceException
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Compiler/RemoveUnusedDefinitionsPassTest.php b/src/Symfony/Component/DependencyInjection/Tests/Compiler/RemoveUnusedDefinitionsPassTest.php</span>
<span style="font-weight:bold;">index d7e55214a9..b3e451c551 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Compiler/RemoveUnusedDefinitionsPassTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Compiler/RemoveUnusedDefinitionsPassTest.php</span>
<span style="color:teal;">@@ -81,6 +81,33 @@</span> class RemoveUnusedDefinitionsPassTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertTrue($container-&gt;hasDefinition('bar'));
    }

    <span style="color:green;">public function testProcessWontRemovePrivateFactory()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = new ContainerBuilder();</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('foo', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryClass('stdClass')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance')</span>
<span style="color:green;">            -&gt;setPublic(false);</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('bar', 'stdClass')</span>
<span style="color:green;">            -&gt;setFactoryService('foo')</span>
<span style="color:green;">            -&gt;setFactoryMethod('getInstance')</span>
<span style="color:green;">            -&gt;setPublic(false);</span>

<span style="color:green;">        $container</span>
<span style="color:green;">            -&gt;register('foobar')</span>
<span style="color:green;">            -&gt;addArgument(new Reference('bar'));</span>

<span style="color:green;">        $this-&gt;process($container);</span>

<span style="color:green;">        $this-&gt;assertTrue($container-&gt;hasDefinition('foo'));</span>
<span style="color:green;">        $this-&gt;assertTrue($container-&gt;hasDefinition('bar'));</span>
<span style="color:green;">        $this-&gt;assertTrue($container-&gt;hasDefinition('foobar'));</span>
<span style="color:green;">    }</span>

    protected function process(ContainerBuilder $container)
    {
        $repeatedPass = new RepeatedPass(array(new AnalyzeServiceReferencesPass(), new RemoveUnusedDefinitionsPass()));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Dumper/GraphvizDumperTest.php b/src/Symfony/Component/DependencyInjection/Tests/Dumper/GraphvizDumperTest.php</span>
<span style="font-weight:bold;">index 0dc1ce8de1..3db11504ad 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Dumper/GraphvizDumperTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Dumper/GraphvizDumperTest.php</span>
<span style="color:teal;">@@ -62,4 +62,11 @@</span> class GraphvizDumperTest extends \PHPUnit_Framework_TestCase
        $dumper = new GraphvizDumper($container);
        $this-&gt;assertEquals(str_replace('%path%', __DIR__, file_get_contents(self::$fixturesPath.'/graphviz/services14.dot')), $dumper-&gt;dump(), '-&gt;dump() dumps services');
    }

    <span style="color:green;">public function testDumpWithScopes()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $container = include self::$fixturesPath.'/containers/container18.php';</span>
<span style="color:green;">        $dumper = new GraphvizDumper($container);</span>
<span style="color:green;">        $this-&gt;assertEquals(str_replace('%path%', __DIR__, file_get_contents(self::$fixturesPath.'/graphviz/services18.dot')), $dumper-&gt;dump(), '-&gt;dump() dumps services');</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Dumper/PhpDumperTest.php b/src/Symfony/Component/DependencyInjection/Tests/Dumper/PhpDumperTest.php</span>
<span style="font-weight:bold;">index 98b05d2501..8d5ea701a5 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Dumper/PhpDumperTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Dumper/PhpDumperTest.php</span>
<span style="color:teal;">@@ -140,7 +140,7 @@</span> class PhpDumperTest extends \PHPUnit_Framework_TestCase
        eval('?&gt;'.$dumper-&gt;dump(array('class' =&gt; 'Symfony_DI_PhpDumper_Test_Aliases')));

        $container = new \Symfony_DI_PhpDumper_Test_Aliases();
        $container-&gt;set('foo', $foo = new <span style="color:red;">\stdClass);</span><span style="color:green;">\stdClass());</span>
        $this-&gt;assertSame($foo, $container-&gt;get('foo'));
        $this-&gt;assertSame($foo, $container-&gt;get('alias_for_foo'));
        $this-&gt;assertSame($foo, $container-&gt;get('alias_for_alias'));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/containers/container18.php b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/containers/container18.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..0248ed4627</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/containers/container18.php</span>
<span style="color:teal;">@@ -0,0 +1,14 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">use Symfony\Component\DependencyInjection\ContainerBuilder;</span>
<span style="color:green;">use Symfony\Component\DependencyInjection\Scope;</span>

<span style="color:green;">$container = new ContainerBuilder();</span>
<span style="color:green;">$container-&gt;addScope(new Scope('request'));</span>
<span style="color:green;">$container-&gt;</span>
<span style="color:green;">    register('foo', 'FooClass')-&gt;</span>
<span style="color:green;">    setScope('request')</span>
<span style="color:green;">;</span>
<span style="color:green;">$container-&gt;compile();</span>

<span style="color:green;">return $container;</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/graphviz/services18.dot b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/graphviz/services18.dot</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..4fbcceef36</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/graphviz/services18.dot</span>
<span style="color:teal;">@@ -0,0 +1,8 @@</span>
<span style="color:green;">digraph sc {</span>
<span style="color:green;">  ratio=&quot;compress&quot;</span>
<span style="color:green;">  node [fontsize=&quot;11&quot; fontname=&quot;Arial&quot; shape=&quot;record&quot;];</span>
<span style="color:green;">  edge [fontsize=&quot;9&quot; fontname=&quot;Arial&quot; color=&quot;grey&quot; arrowhead=&quot;open&quot; arrowsize=&quot;0.5&quot;];</span>

<span style="color:green;">  node_foo [label=&quot;foo\nFooClass\n&quot;, shape=record, fillcolor=&quot;#eeeeee&quot;, style=&quot;filled&quot;];</span>
<span style="color:green;">  node_service_container [label=&quot;service_container\nSymfony\\Component\\DependencyInjection\\ContainerBuilder\n&quot;, shape=record, fillcolor=&quot;#9999ff&quot;, style=&quot;filled&quot;];</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services10.php b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services10.php</span>
<span style="font-weight:bold;">index ca9695adca..37927a6e70 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services10.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services10.php</span>
<span style="color:teal;">@@ -44,7 +44,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">stdClass</span><span style="color:green;">\stdClass</span> A stdClass instance.
     */
    protected function getTestService()
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services11.php b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services11.php</span>
<span style="font-weight:bold;">index 58697423f6..0dcd83845a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services11.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services11.php</span>
<span style="color:teal;">@@ -42,7 +42,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">stdClass</span><span style="color:green;">\stdClass</span> A stdClass instance.
     */
    protected function getFooService()
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9.php b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9.php</span>
<span style="font-weight:bold;">index 3fafcf1757..84036928bf 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9.php</span>
<span style="color:teal;">@@ -47,7 +47,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getBarService()
    {
<span style="color:teal;">@@ -64,7 +64,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Baz</span><span style="color:green;">\Baz</span> A Baz instance.
     */
    protected function getBazService()
    {
<span style="color:teal;">@@ -81,7 +81,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">stdClass</span><span style="color:green;">\stdClass</span> A stdClass instance.
     */
    protected function getDependsOnRequestService()
    {
<span style="color:teal;">@@ -98,7 +98,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Bar</span><span style="color:green;">\Bar</span> A Bar instance.
     */
    protected function getFactoryServiceService()
    {
<span style="color:teal;">@@ -111,7 +111,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getFooService()
    {
<span style="color:teal;">@@ -164,7 +164,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Foo</span><span style="color:green;">\Foo</span> A Foo instance.
     */
    protected function getFooWithInlineService()
    {
<span style="color:teal;">@@ -181,7 +181,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getMethodCall1Service()
    {
<span style="color:teal;">@@ -235,7 +235,7 @@</span> class ProjectServiceContainer extends Container
     * If you want to be able to request this service from the container directly,
     * make it public, otherwise you might end up with broken code.
     *
     * @return <span style="color:red;">Bar</span><span style="color:green;">\Bar</span> A Bar instance.
     */
    protected function getInlinedService()
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9_compiled.php b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9_compiled.php</span>
<span style="font-weight:bold;">index 9ea738db71..0dd611e90c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9_compiled.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/php/services9_compiled.php</span>
<span style="color:teal;">@@ -55,7 +55,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getBarService()
    {
<span style="color:teal;">@@ -72,7 +72,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Baz</span><span style="color:green;">\Baz</span> A Baz instance.
     */
    protected function getBazService()
    {
<span style="color:teal;">@@ -89,7 +89,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">stdClass</span><span style="color:green;">\stdClass</span> A stdClass instance.
     */
    protected function getDependsOnRequestService()
    {
<span style="color:teal;">@@ -106,7 +106,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Bar</span><span style="color:green;">\Bar</span> A Bar instance.
     */
    protected function getFactoryServiceService()
    {
<span style="color:teal;">@@ -119,7 +119,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getFooService()
    {
<span style="color:teal;">@@ -143,7 +143,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">BazClass</span><span style="color:green;">\BazClass</span> A BazClass instance.
     */
    protected function getFoo_BazService()
    {
<span style="color:teal;">@@ -157,7 +157,7 @@</span> class ProjectServiceContainer extends Container
    /**
     * Gets the 'foo_bar' service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getFooBarService()
    {
<span style="color:teal;">@@ -170,7 +170,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">Foo</span><span style="color:green;">\Foo</span> A Foo instance.
     */
    protected function getFooWithInlineService()
    {
<span style="color:teal;">@@ -192,7 +192,7 @@</span> class ProjectServiceContainer extends Container
     * This service is shared.
     * This method always returns the same instance of the service.
     *
     * @return <span style="color:red;">FooClass</span><span style="color:green;">\FooClass</span> A FooClass instance.
     */
    protected function getMethodCall1Service()
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/xml/services9.xml b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/xml/services9.xml</span>
<span style="font-weight:bold;">index e53b03ed70..294ad5c589 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DependencyInjection/Tests/Fixtures/xml/services9.xml</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DependencyInjection/Tests/Fixtures/xml/services9.xml</span>
<span style="color:teal;">@@ -6,7 +6,7 @@</span>
    &lt;parameter key=&quot;foo&quot;&gt;bar&lt;/parameter&gt;
  &lt;/parameters&gt;
  &lt;services&gt;
    &lt;service id=&quot;foo&quot; class=&quot;FooClass&quot; <span style="color:red;">factory-method=&quot;getInstance&quot;&gt;</span><span style="color:green;">factory-method=&quot;getInstance&quot; factory-class=&quot;FooClass&quot;&gt;</span>
      &lt;tag name=&quot;foo&quot; foo=&quot;foo&quot;/&gt;
      &lt;tag name=&quot;foo&quot; bar=&quot;bar&quot;/&gt;
      &lt;argument&gt;foo&lt;/argument&gt;
<span style="color:teal;">@@ -35,7 +35,7 @@</span>
      &lt;argument&gt;%foo_bar%&lt;/argument&gt;
      &lt;configurator service=&quot;foo.baz&quot; method=&quot;configure&quot;/&gt;
    &lt;/service&gt;
    &lt;service id=&quot;foo.baz&quot; class=&quot;%baz_class%&quot; <span style="color:red;">factory-method=&quot;getInstance&quot;&gt;</span><span style="color:green;">factory-method=&quot;getInstance&quot; factory-class=&quot;%baz_class%&quot;&gt;</span>
      &lt;configurator class=&quot;%baz_class%&quot; method=&quot;configureStatic1&quot;/&gt;
    &lt;/service&gt;
    &lt;service id=&quot;foo_bar&quot; class=&quot;%foo_class%&quot; scope=&quot;prototype&quot;/&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DomCrawler/Crawler.php b/src/Symfony/Component/DomCrawler/Crawler.php</span>
<span style="font-weight:bold;">index bbc36d71fd..deabe57226 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DomCrawler/Crawler.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DomCrawler/Crawler.php</span>
<span style="color:teal;">@@ -259,7 +259,9 @@</span> class Crawler extends \SplObjectStorage
    public function addNodeList(\DOMNodeList $nodes)
    {
        foreach ($nodes as $node) {
            <span style="color:green;">if ($node instanceof \DOMNode) {</span>
                $this-&gt;addNode($node);
            <span style="color:green;">}</span>
        }
    }

<span style="color:teal;">@@ -871,18 +873,22 @@</span> class Crawler extends \SplObjectStorage
            // BC for Symfony 2.4 and lower were elements were adding in a fake _root parent
            if (0 === strpos($expression, '/_root/')) {
                $expression = './'.substr($expression, 7);
            <span style="color:green;">} elseif (0 === strpos($expression, 'self::*/')) {</span>
<span style="color:green;">                $expression = './'.substr($expression, 8);</span>
            }

            // add prefix before absolute element selector
            if (empty($expression)) {
                $expression = $nonMatchingExpression;
            } elseif (0 === strpos($expression, '//')) {
                $expression = <span style="color:red;">'descendant-or-self::' . substr($expression,</span><span style="color:green;">'descendant-or-self::'.substr($expression,</span> 2);
            } elseif (0 === strpos($expression, './/')) {
                $expression = <span style="color:red;">'descendant-or-self::' . substr($expression,</span><span style="color:green;">'descendant-or-self::'.substr($expression,</span> 3);
            } elseif (0 === strpos($expression, './')) {
                $expression = <span style="color:red;">'self::' . substr($expression,</span><span style="color:green;">'self::'.substr($expression,</span> 2);
            } elseif <span style="color:green;">(0 === strpos($expression, 'child::')) {</span>
<span style="color:green;">                $expression = 'self::'.substr($expression, 7);</span>
<span style="color:green;">            } elseif</span> ('/' === <span style="color:red;">$expression[0])</span><span style="color:green;">$expression[0] || 0 === strpos($expression, 'self::'))</span> {
                // the only direct child in Symfony 2.4 and lower is _root, which is already handled previously
                // so let's drop the expression entirely
                $expression = $nonMatchingExpression;
<span style="color:teal;">@@ -890,9 +896,12 @@</span> class Crawler extends \SplObjectStorage
                // '.' is the fake root element in Symfony 2.4 and lower, which is excluded from results
                $expression = $nonMatchingExpression;
            } elseif (0 === strpos($expression, 'descendant::')) {
                $expression = <span style="color:red;">'descendant-or-self::' . substr($expression,</span><span style="color:green;">'descendant-or-self::'.substr($expression,</span> strlen('descendant::'));
            <span style="color:green;">} elseif (preg_match('/^(ancestor|ancestor-or-self|attribute|following|following-sibling|namespace|parent|preceding|preceding-sibling)::/', $expression)) {</span>
<span style="color:green;">                // the fake root has no parent, preceding or following nodes and also no attributes (even no namespace attributes)</span>
<span style="color:green;">                $expression = $nonMatchingExpression;</span>
            } elseif (0 !== strpos($expression, 'descendant-or-self::')) {
                $expression = <span style="color:red;">'self::' .$expression;</span><span style="color:green;">'self::'.$expression;</span>
            }
            $expressions[] = $parenthesis.$expression;
        }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DomCrawler/Form.php b/src/Symfony/Component/DomCrawler/Form.php</span>
<span style="font-weight:bold;">index 9895f30637..e0b9cfb062 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DomCrawler/Form.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DomCrawler/Form.php</span>
<span style="color:teal;">@@ -11,6 +11,7 @@</span>

namespace Symfony\Component\DomCrawler;

<span style="color:green;">use Symfony\Component\DomCrawler\Field\ChoiceFormField;</span>
use Symfony\Component\DomCrawler\Field\FormField;

/**
<span style="color:teal;">@@ -460,7 +461,9 @@</span> class Form extends Link implements \ArrayAccess
        if ('select' == $nodeName || 'input' == $nodeName &amp;&amp; 'checkbox' == strtolower($node-&gt;getAttribute('type'))) {
            $this-&gt;set(new Field\ChoiceFormField($node));
        } elseif ('input' == $nodeName &amp;&amp; 'radio' == strtolower($node-&gt;getAttribute('type'))) {
            <span style="color:green;">// there may be other fields with the same name that are no choice</span>
<span style="color:green;">            // fields already registered (see https://github.com/symfony/symfony/issues/11689)</span>
            if <span style="color:red;">($this-&gt;has($node-&gt;getAttribute('name')))</span><span style="color:green;">($this-&gt;has($node-&gt;getAttribute('name')) &amp;&amp; $this-&gt;get($node-&gt;getAttribute('name')) instanceof ChoiceFormField)</span> {
                $this-&gt;get($node-&gt;getAttribute('name'))-&gt;addChoice($node);
            } else {
                $this-&gt;set(new Field\ChoiceFormField($node));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DomCrawler/Tests/CrawlerTest.php b/src/Symfony/Component/DomCrawler/Tests/CrawlerTest.php</span>
<span style="font-weight:bold;">index d47d3c008e..72e9dadae5 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DomCrawler/Tests/CrawlerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DomCrawler/Tests/CrawlerTest.php</span>
<span style="color:teal;">@@ -400,8 +400,8 @@</span> EOF
        $this-&gt;assertCount(1, $crawler-&gt;filterXPath('//body'));
        $this-&gt;assertCount(1, $crawler-&gt;filterXPath('descendant-or-self::body'));
        $this-&gt;assertCount(1, $crawler-&gt;filterXPath('//div[@id=&quot;parent&quot;]')-&gt;filterXPath('./div'), 'A child selection finds only the current div');
        <span style="color:red;">$this-&gt;assertCount(2,</span><span style="color:green;">$this-&gt;assertCount(3,</span> $crawler-&gt;filterXPath('//div[@id=&quot;parent&quot;]')-&gt;filterXPath('descendant::div'), 'A descendant selector matches the current div and its child');
        <span style="color:red;">$this-&gt;assertCount(2,</span><span style="color:green;">$this-&gt;assertCount(3,</span> $crawler-&gt;filterXPath('//div[@id=&quot;parent&quot;]')-&gt;filterXPath('//div'), 'A descendant selector matches the current div and its child');
        $this-&gt;assertCount(5, $crawler-&gt;filterXPath('(//a | //div)//img'));
        $this-&gt;assertCount(7, $crawler-&gt;filterXPath('((//a | //div)//img | //ul)'));
        $this-&gt;assertCount(7, $crawler-&gt;filterXPath('( ( //a | //div )//img | //ul )'));
<span style="color:teal;">@@ -472,6 +472,106 @@</span> EOF
        $this-&gt;assertSame('Music', $crawler-&gt;text());
    }

    <span style="color:green;">public function testFilterXPathWithFakeRoot()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler();</span>
<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('.'), '-&gt;filterXPath() returns an empty result if the XPath references the fake root node');</span>
<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('/_root'), '-&gt;filterXPath() returns an empty result if the XPath references the fake root node');</span>
<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('self::*'), '-&gt;filterXPath() returns an empty result if the XPath references the fake root node');</span>
<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('self::_root'), '-&gt;filterXPath() returns an empty result if the XPath references the fake root node');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithAncestorAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//form');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('ancestor::*'), 'The fake root node has no ancestor nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithAncestorOrSelfAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//form');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('ancestor-or-self::*'), 'The fake root node has no ancestor nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithAttributeAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//form');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('attribute::*'), 'The fake root node has no attribute nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithAttributeAxisAfterElementAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertCount(3, $this-&gt;createTestCrawler()-&gt;filterXPath('//form/button/attribute::*'), '-&gt;filterXPath() handles attribute axes properly when they are preceded by an element filtering axis');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithChildAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//div[@id=&quot;parent&quot;]');</span>

<span style="color:green;">        $this-&gt;assertCount(1, $crawler-&gt;filterXPath('child::div'), 'A child selection finds only the current div');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithFollowingAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//a');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('following::div'), 'The fake root node has no following nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithFollowingSiblingAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//a');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('following-sibling::div'), 'The fake root node has no following nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithNamespaceAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//button');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('namespace::*'), 'The fake root node has no namespace nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithNamespaceAxisAfterElementAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//div[@id=&quot;parent&quot;]/namespace::*');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('namespace::*'), 'Namespace axes cannot be requested');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithParentAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//button');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('parent::*'), 'The fake root node has no parent nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithPrecedingAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//form');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('preceding::*'), 'The fake root node has no preceding nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithPrecedingSiblingAxis()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//form');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('preceding-sibling::*'), 'The fake root node has no preceding nodes');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testFilterXPathWithSelfAxes()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $crawler = $this-&gt;createTestCrawler()-&gt;filterXPath('//a');</span>

<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('self::a'), 'The fake root node has no &quot;real&quot; element name');</span>
<span style="color:green;">        $this-&gt;assertCount(0, $crawler-&gt;filterXPath('self::a/img'), 'The fake root node has no &quot;real&quot; element name');</span>
<span style="color:green;">        $this-&gt;assertCount(9, $crawler-&gt;filterXPath('self::*/a'));</span>
<span style="color:green;">    }</span>

    /**
     * @covers Symfony\Component\DomCrawler\Crawler::filter
     */
<span style="color:teal;">@@ -879,6 +979,7 @@</span> HTML;
                    &lt;/ul&gt;
                    &lt;div id=&quot;parent&quot;&gt;
                        &lt;div id=&quot;child&quot;&gt;&lt;/div&gt;
                        <span style="color:green;">&lt;div id=&quot;child2&quot; xmlns:foo=&quot;http://example.com&quot;&gt;&lt;/div&gt;</span>
                    &lt;/div&gt;
                    &lt;div id=&quot;sibling&quot;&gt;&lt;img /&gt;&lt;/div&gt;
                &lt;/body&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/DomCrawler/Tests/FormTest.php b/src/Symfony/Component/DomCrawler/Tests/FormTest.php</span>
<span style="font-weight:bold;">index 8f18f01086..4e3cad74b1 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/DomCrawler/Tests/FormTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/DomCrawler/Tests/FormTest.php</span>
<span style="color:teal;">@@ -802,6 +802,28 @@</span> class FormTest extends \PHPUnit_Framework_TestCase
        ));
    }

    <span style="color:green;">public function testDifferentFieldTypesWithSameName()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $dom = new \DOMDocument();</span>
<span style="color:green;">        $dom-&gt;loadHTML('</span>
<span style="color:green;">            &lt;html&gt;</span>
<span style="color:green;">                &lt;body&gt;</span>
<span style="color:green;">                    &lt;form action=&quot;/&quot;&gt;</span>
<span style="color:green;">                        &lt;input type=&quot;hidden&quot; name=&quot;option&quot; value=&quot;default&quot;&gt;</span>
<span style="color:green;">                        &lt;input type=&quot;radio&quot; name=&quot;option&quot; value=&quot;A&quot;&gt;</span>
<span style="color:green;">                        &lt;input type=&quot;radio&quot; name=&quot;option&quot; value=&quot;B&quot;&gt;</span>
<span style="color:green;">                        &lt;input type=&quot;hidden&quot; name=&quot;settings[1]&quot; value=&quot;0&quot;&gt;</span>
<span style="color:green;">                        &lt;input type=&quot;checkbox&quot; name=&quot;settings[1]&quot; value=&quot;1&quot; id=&quot;setting-1&quot;&gt;</span>
<span style="color:green;">                        &lt;button&gt;klickme&lt;/button&gt;</span>
<span style="color:green;">                    &lt;/form&gt;</span>
<span style="color:green;">                &lt;/body&gt;</span>
<span style="color:green;">            &lt;/html&gt;</span>
<span style="color:green;">        ');</span>
<span style="color:green;">        $form = new Form($dom-&gt;getElementsByTagName('form')-&gt;item(0), 'http://example.com');</span>

<span style="color:green;">        $this-&gt;assertInstanceOf('Symfony\Component\DomCrawler\Field\ChoiceFormField', $form-&gt;get('option'));</span>
<span style="color:green;">    }</span>

    protected function getFormFieldMock($name, $value = null)
    {
        $field = $this
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/EventDispatcher/EventDispatcher.php b/src/Symfony/Component/EventDispatcher/EventDispatcher.php</span>
<span style="font-weight:bold;">index ab140a669c..222a937141 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/EventDispatcher/EventDispatcher.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/EventDispatcher/EventDispatcher.php</span>
<span style="color:teal;">@@ -74,7 +74,7 @@</span> class EventDispatcher implements EventDispatcherInterface
            }
        }

        return <span style="color:red;">$this-&gt;sorted;</span><span style="color:green;">array_filter($this-&gt;sorted);</span>
    }

    /**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/EventDispatcher/Tests/EventDispatcherTest.php b/src/Symfony/Component/EventDispatcher/Tests/EventDispatcherTest.php</span>
<span style="font-weight:bold;">index 1e3282f8dd..efc0c29fab 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/EventDispatcher/Tests/EventDispatcherTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/EventDispatcher/Tests/EventDispatcherTest.php</span>
<span style="color:teal;">@@ -274,6 +274,28 @@</span> class EventDispatcherTest extends \PHPUnit_Framework_TestCase
        $dispatcher-&gt;removeListener('bug.62976', function () {});
        $this-&gt;assertTrue($dispatcher-&gt;hasListeners('bug.62976'));
    }

    <span style="color:green;">public function testHasListenersWhenAddedCallbackListenerIsRemoved()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $listener = function () {};</span>
<span style="color:green;">        $this-&gt;dispatcher-&gt;addListener('foo', $listener);</span>
<span style="color:green;">        $this-&gt;dispatcher-&gt;removeListener('foo', $listener);</span>
<span style="color:green;">        $this-&gt;assertFalse($this-&gt;dispatcher-&gt;hasListeners());</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testGetListenersWhenAddedCallbackListenerIsRemoved()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $listener = function () {};</span>
<span style="color:green;">        $this-&gt;dispatcher-&gt;addListener('foo', $listener);</span>
<span style="color:green;">        $this-&gt;dispatcher-&gt;removeListener('foo', $listener);</span>
<span style="color:green;">        $this-&gt;assertSame(array(), $this-&gt;dispatcher-&gt;getListeners());</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testHasListenersWithoutEventsReturnsFalseAfterHasListenersWithEventHasBeenCalled()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertFalse($this-&gt;dispatcher-&gt;hasListeners('foo'));</span>
<span style="color:green;">        $this-&gt;assertFalse($this-&gt;dispatcher-&gt;hasListeners());</span>
<span style="color:green;">    }</span>
}

class CallableClass
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/ExpressionLanguage/Lexer.php b/src/Symfony/Component/ExpressionLanguage/Lexer.php</span>
<span style="font-weight:bold;">index aba51bb3fb..26bb51d42e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/ExpressionLanguage/Lexer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/ExpressionLanguage/Lexer.php</span>
<span style="color:teal;">@@ -69,7 +69,7 @@</span> class Lexer

                $tokens[] = new Token(Token::PUNCTUATION_TYPE, $expression[$cursor], $cursor + 1);
                ++$cursor;
            } elseif <span style="color:red;">(preg_match('/&quot;([^#&quot;\\\\]*(?:\\\\.[^#&quot;\\\\]*)*)&quot;|\'([^\'\\\\]*(?:\\\\.[^\'\\\\]*)*)\'/As',</span><span style="color:green;">(preg_match('/&quot;([^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*)&quot;|\'([^\'\\\\]*(?:\\\\.[^\'\\\\]*)*)\'/As',</span> $expression, $match, null, $cursor)) {
                // strings
                $tokens[] = new Token(Token::STRING_TYPE, stripcslashes(substr($match[0], 1, -1)), $cursor + 1);
                $cursor += strlen($match[0]);
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/ExpressionLanguage/Tests/LexerTest.php b/src/Symfony/Component/ExpressionLanguage/Tests/LexerTest.php</span>
<span style="font-weight:bold;">index 25c1e5ac59..8af5c1c101 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/ExpressionLanguage/Tests/LexerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/ExpressionLanguage/Tests/LexerTest.php</span>
<span style="color:teal;">@@ -78,6 +78,14 @@</span> class LexerTest extends \PHPUnit_Framework_TestCase
                array(new Token('operator', '..', 1)),
                '..',
            ),
            <span style="color:green;">array(</span>
<span style="color:green;">                array(new Token('string', '#foo', 1)),</span>
<span style="color:green;">                &quot;'#foo'&quot;,</span>
<span style="color:green;">            ),</span>
<span style="color:green;">            array(</span>
<span style="color:green;">                array(new Token('string', '#foo', 1)),</span>
<span style="color:green;">                '&quot;#foo&quot;',</span>
<span style="color:green;">            ),</span>
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Filesystem/Filesystem.php b/src/Symfony/Component/Filesystem/Filesystem.php</span>
<span style="font-weight:bold;">index ca146aa816..fff751e82f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Filesystem/Filesystem.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Filesystem/Filesystem.php</span>
<span style="color:teal;">@@ -52,7 +52,8 @@</span> class Filesystem
        if ($doCopy) {
            // https://bugs.php.net/bug.php?id=64634
            $source = fopen($originFile, 'r');
            <span style="color:green;">// Stream context created to allow files overwrite when using FTP stream wrapper - disabled by default</span>
            $target = fopen($targetFile, <span style="color:red;">'w');</span><span style="color:green;">'w', null, stream_context_create(array('ftp' =&gt; array('overwrite' =&gt; true))));</span>
            stream_copy_to_stream($source, $target);
            fclose($source);
            fclose($target);
<span style="color:teal;">@@ -80,7 +81,14 @@</span> class Filesystem
            }

            if (true !== @mkdir($dir, $mode, true)) {
                <span style="color:green;">$error = error_get_last();</span>
<span style="color:green;">                if (!is_dir($dir)) {</span>
<span style="color:green;">                    // The directory was not created by a concurrent process. Let's throw an exception with a developer friendly error message if we have one</span>
<span style="color:green;">                    if ($error) {</span>
<span style="color:green;">                        throw new IOException(sprintf('Failed to create &quot;%s&quot;: %s.', $dir, $error['message']), 0, null, $dir);</span>
<span style="color:green;">                    }</span>
                    throw new IOException(sprintf('Failed to create <span style="color:red;">&quot;%s&quot;.',</span><span style="color:green;">&quot;%s&quot;',</span> $dir), 0, null, $dir);
                <span style="color:green;">}</span>
            }
        }
    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Finder/Adapter/AbstractFindAdapter.php b/src/Symfony/Component/Finder/Adapter/AbstractFindAdapter.php</span>
<span style="font-weight:bold;">index 5c7206240e..7f2a52fbcd 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Finder/Adapter/AbstractFindAdapter.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Finder/Adapter/AbstractFindAdapter.php</span>
<span style="color:teal;">@@ -16,7 +16,6 @@</span> use Symfony\Component\Finder\Iterator;
use Symfony\Component\Finder\Shell\Shell;
use Symfony\Component\Finder\Expression\Expression;
use Symfony\Component\Finder\Shell\Command;
<span style="color:red;">use Symfony\Component\Finder\Iterator\SortableIterator;</span>
use Symfony\Component\Finder\Comparator\NumberComparator;
use Symfony\Component\Finder\Comparator\DateComparator;

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Finder/Shell/Shell.php b/src/Symfony/Component/Finder/Shell/Shell.php</span>
<span style="font-weight:bold;">index 8586cbc3e5..d17f2fac35 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Finder/Shell/Shell.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Finder/Shell/Shell.php</span>
<span style="color:teal;">@@ -50,17 +50,19 @@</span> class Shell
     */
    public function testCommand($command)
    {
<span style="color:red;">        if (self::TYPE_WINDOWS === $this-&gt;type) {</span>
<span style="color:red;">            // todo: find a way to test if Windows command exists</span>
<span style="color:red;">            return false;</span>
<span style="color:red;">        }</span>

        if (!function_exists('exec')) {
            return false;
        }

        // todo: find a better way (command could not be available)
        <span style="color:red;">exec('command -v '.$command,</span><span style="color:green;">$testCommand = 'which ';</span>
<span style="color:green;">        if (self::TYPE_WINDOWS === $this-&gt;type) {</span>
<span style="color:green;">            $testCommand = 'where ';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $command = escapeshellcmd($command);</span>

<span style="color:green;">        exec($testCommand.$command,</span> $output, $code);

        return 0 === $code &amp;&amp; count($output) &gt; 0;
    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Finder/Tests/FinderTest.php b/src/Symfony/Component/Finder/Tests/FinderTest.php</span>
<span style="font-weight:bold;">index 9f9e47b646..598821d24f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Finder/Tests/FinderTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Finder/Tests/FinderTest.php</span>
<span style="color:teal;">@@ -728,17 +728,30 @@</span> class FinderTest extends Iterator\RealIteratorTestCase
        $finder-&gt;files()-&gt;in(self::$tmpDir);

        // make 'foo' directory non-readable
        <span style="color:red;">chmod(self::$tmpDir.DIRECTORY_SEPARATOR.'foo',</span><span style="color:green;">$testDir = self::$tmpDir.DIRECTORY_SEPARATOR.'foo';</span>
<span style="color:green;">        chmod($testDir,</span> 0333);

        <span style="color:green;">if (false === $couldRead = is_readable($testDir)) {</span>
            try {
                $this-&gt;assertIterator($this-&gt;toAbsolute(array('foo bar', 'test.php', 'test.py')), $finder-&gt;getIterator());
                $this-&gt;fail('Finder should throw an exception when opening a non-readable directory.');
            } catch (\Exception $e) {
                <span style="color:red;">$this-&gt;assertInstanceOf('Symfony\\Component\\Finder\\Exception\\AccessDeniedException',</span><span style="color:green;">$expectedExceptionClass = 'Symfony\\Component\\Finder\\Exception\\AccessDeniedException';</span>
<span style="color:green;">                if ($e instanceof \PHPUnit_Framework_ExpectationFailedException) {</span>
<span style="color:green;">                    $this-&gt;fail(sprintf(&quot;Expected exception:\n%s\nGot:\n%s\nWith comparison failure:\n%s&quot;, $expectedExceptionClass, 'PHPUnit_Framework_ExpectationFailedException', $e-&gt;getComparisonFailure()-&gt;getExpectedAsString()));</span>
<span style="color:green;">                }</span>

<span style="color:green;">                $this-&gt;assertInstanceOf($expectedExceptionClass,</span> $e);
            <span style="color:green;">}</span>
        }

        // restore original permissions
        <span style="color:red;">chmod(self::$tmpDir.DIRECTORY_SEPARATOR.'foo',</span><span style="color:green;">chmod($testDir,</span> 0777);
        <span style="color:green;">clearstatcache($testDir);</span>

<span style="color:green;">        if ($couldRead) {</span>
<span style="color:green;">            $this-&gt;markTestSkipped('could read test files while test requires unreadable');</span>
<span style="color:green;">        }</span>
    }

    /**
<span style="color:teal;">@@ -754,12 +767,20 @@</span> class FinderTest extends Iterator\RealIteratorTestCase
        $finder-&gt;files()-&gt;ignoreUnreadableDirs()-&gt;in(self::$tmpDir);

        // make 'foo' directory non-readable
        <span style="color:red;">chmod(self::$tmpDir.DIRECTORY_SEPARATOR.'foo',</span><span style="color:green;">$testDir = self::$tmpDir.DIRECTORY_SEPARATOR.'foo';</span>
<span style="color:green;">        chmod($testDir,</span> 0333);

        <span style="color:green;">if (false === ($couldRead = is_readable($testDir))) {</span>
            $this-&gt;assertIterator($this-&gt;toAbsolute(array('foo bar', 'test.php', 'test.py')), $finder-&gt;getIterator());
        <span style="color:green;">}</span>

        // restore original permissions
        <span style="color:red;">chmod(self::$tmpDir.DIRECTORY_SEPARATOR.'foo',</span><span style="color:green;">chmod($testDir,</span> 0777);
        <span style="color:green;">clearstatcache($testDir);</span>

<span style="color:green;">        if ($couldRead) {</span>
<span style="color:green;">            $this-&gt;markTestSkipped('could read test files while test requires unreadable');</span>
<span style="color:green;">        }</span>
    }

    private function buildTestData(array $tests)
<span style="color:teal;">@@ -820,25 +841,4 @@</span> class FinderTest extends Iterator\RealIteratorTestCase
        $this-&gt;assertIterator($expected, $finder);
        $this-&gt;assertIteratorInForeach($expected, $finder);
    }

<span style="color:red;">    public function testNonSeekableStream()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (!in_array('ftp', stream_get_wrappers())) {</span>
<span style="color:red;">            $this-&gt;markTestSkipped(sprintf('Unavailable stream &quot;%s&quot;.', 'ftp'));</span>
<span style="color:red;">        }</span>

<span style="color:red;">        try {</span>
<span style="color:red;">            $i = Finder::create()-&gt;in('ftp://ftp.mozilla.org/')-&gt;depth(0)-&gt;getIterator();</span>
<span style="color:red;">        } catch (\UnexpectedValueException $e) {</span>
<span style="color:red;">            $this-&gt;markTestSkipped(sprintf('Unsupported stream &quot;%s&quot;.', 'ftp'));</span>
<span style="color:red;">        }</span>

<span style="color:red;">        $contains = array(</span>
<span style="color:red;">            'ftp://ftp.mozilla.org'.DIRECTORY_SEPARATOR.'README',</span>
<span style="color:red;">            'ftp://ftp.mozilla.org'.DIRECTORY_SEPARATOR.'index.html',</span>
<span style="color:red;">            'ftp://ftp.mozilla.org'.DIRECTORY_SEPARATOR.'pub',</span>
<span style="color:red;">        );</span>

<span style="color:red;">        $this-&gt;assertIteratorInForeach($contains, $i);</span>
<span style="color:red;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Finder/Tests/Iterator/MockSplFileInfo.php b/src/Symfony/Component/Finder/Tests/Iterator/MockSplFileInfo.php</span>
<span style="font-weight:bold;">index a50e4c9fcc..c8608bf2d3 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Finder/Tests/Iterator/MockSplFileInfo.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Finder/Tests/Iterator/MockSplFileInfo.php</span>
<span style="color:teal;">@@ -50,7 +50,7 @@</span> class MockSplFileInfo extends \SplFileInfo

    public function isFile()
    {
        if <span style="color:red;">($this-&gt;type</span><span style="color:green;">(null</span> === <span style="color:red;">null)</span><span style="color:green;">$this-&gt;type)</span> {
            return preg_match('/file/', $this-&gt;getFilename());
        };

<span style="color:teal;">@@ -59,7 +59,7 @@</span> class MockSplFileInfo extends \SplFileInfo

    public function isDir()
    {
        if <span style="color:red;">($this-&gt;type</span><span style="color:green;">(null</span> === <span style="color:red;">null)</span><span style="color:green;">$this-&gt;type)</span> {
            return preg_match('/directory/', $this-&gt;getFilename());
        }

<span style="color:teal;">@@ -68,7 +68,7 @@</span> class MockSplFileInfo extends \SplFileInfo

    public function isReadable()
    {
        if <span style="color:red;">($this-&gt;mode</span><span style="color:green;">(null</span> === <span style="color:red;">null)</span><span style="color:green;">$this-&gt;mode)</span> {
            return preg_match('/r\+/', $this-&gt;getFilename());
        }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/ButtonBuilder.php b/src/Symfony/Component/Form/ButtonBuilder.php</span>
<span style="font-weight:bold;">index 806f3a49a2..69730d9d2e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/ButtonBuilder.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/ButtonBuilder.php</span>
<span style="color:teal;">@@ -495,6 +495,8 @@</span> class ButtonBuilder implements \IteratorAggregate, FormBuilderInterface
     *
     * @param bool $initialize
     *
     <span style="color:green;">* @return ButtonBuilder</span>
<span style="color:green;">     *</span>
     * @throws BadMethodCallException
     */
    public function setAutoInitialize($initialize)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/CallbackTransformer.php b/src/Symfony/Component/Form/CallbackTransformer.php</span>
<span style="font-weight:bold;">index c53c6df788..03459d4e8a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/CallbackTransformer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/CallbackTransformer.php</span>
<span style="color:teal;">@@ -18,24 +18,33 @@</span> class CallbackTransformer implements DataTransformerInterface
{
    /**
     * The callback used for forward transform
     * @var <span style="color:red;">\Closure</span><span style="color:green;">callable</span>
     */
    private $transform;

    /**
     * The callback used for reverse transform
     * @var <span style="color:red;">\Closure</span><span style="color:green;">callable</span>
     */
    private $reverseTransform;

    /**
     * Constructor.
     *
     * @param <span style="color:red;">\Closure</span><span style="color:green;">callable</span> $transform        The forward transform callback
     * @param <span style="color:red;">\Closure</span><span style="color:green;">callable</span> $reverseTransform The reverse transform callback
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws \InvalidArgumentException when the given callbacks is invalid</span>
     */
    public function <span style="color:red;">__construct(\Closure $transform, \Closure</span><span style="color:green;">__construct($transform,</span> $reverseTransform)
    {
        <span style="color:green;">if (!is_callable($transform)) {</span>
<span style="color:green;">            throw new \InvalidArgumentException('Argument 1 should be a callable');</span>
<span style="color:green;">        }</span>
<span style="color:green;">        if (!is_callable($reverseTransform)) {</span>
<span style="color:green;">            throw new \InvalidArgumentException('Argument 2 should be a callable');</span>
<span style="color:green;">        }</span>

        $this-&gt;transform = $transform;
        $this-&gt;reverseTransform = $reverseTransform;
    }
<span style="color:teal;">@@ -47,7 +56,7 @@</span> class CallbackTransformer implements DataTransformerInterface
     *
     * @return mixed The value in the transformed representation
     *
     * @throws UnexpectedTypeException       when the argument is not <span style="color:red;">a string</span><span style="color:green;">of the expected type</span>
     * @throws TransformationFailedException when the transformation fails
     */
    public function transform($data)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Extension/Core/DataTransformer/DateTimeToLocalizedStringTransformer.php b/src/Symfony/Component/Form/Extension/Core/DataTransformer/DateTimeToLocalizedStringTransformer.php</span>
<span style="font-weight:bold;">index 56a3ca928b..e992b01fc1 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Extension/Core/DataTransformer/DateTimeToLocalizedStringTransformer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Extension/Core/DataTransformer/DateTimeToLocalizedStringTransformer.php</span>
<span style="color:teal;">@@ -152,6 +152,8 @@</span> class DateTimeToLocalizedStringTransformer extends BaseDateTimeTransformer
     * Returns a preconfigured IntlDateFormatter instance
     *
     * @return \IntlDateFormatter
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws TransformationFailedException in case the date formatter can not be constructed.</span>
     */
    protected function getIntlDateFormatter()
    {
<span style="color:teal;">@@ -162,6 +164,12 @@</span> class DateTimeToLocalizedStringTransformer extends BaseDateTimeTransformer
        $pattern = $this-&gt;pattern;

        $intlDateFormatter = new \IntlDateFormatter(\Locale::getDefault(), $dateFormat, $timeFormat, $timezone, $calendar, $pattern);

        <span style="color:green;">// new \intlDateFormatter may return null instead of false in case of failure, see https://bugs.php.net/bug.php?id=66323</span>
<span style="color:green;">        if (!$intlDateFormatter) {</span>
<span style="color:green;">            throw new TransformationFailedException(intl_get_error_message(), intl_get_error_code());</span>
<span style="color:green;">        }</span>

        $intlDateFormatter-&gt;setLenient(false);

        return $intlDateFormatter;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Extension/Core/DataTransformer/ValueToDuplicatesTransformer.php b/src/Symfony/Component/Form/Extension/Core/DataTransformer/ValueToDuplicatesTransformer.php</span>
<span style="font-weight:bold;">index 618fc6b4a4..ffc9915fa4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Extension/Core/DataTransformer/ValueToDuplicatesTransformer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Extension/Core/DataTransformer/ValueToDuplicatesTransformer.php</span>
<span style="color:teal;">@@ -64,7 +64,7 @@</span> class ValueToDuplicatesTransformer implements DataTransformerInterface
        $emptyKeys = array();

        foreach ($this-&gt;keys as $key) {
            if <span style="color:red;">(!empty($array[$key]))</span><span style="color:green;">(isset($array[$key]) &amp;&amp; '' !== $array[$key] &amp;&amp; false !== $array[$key] &amp;&amp; array() !== $array[$key])</span> {
                if ($array[$key] !== $result) {
                    throw new TransformationFailedException(
                        'All values in the array should be the same'
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Extension/Core/Type/DateType.php b/src/Symfony/Component/Form/Extension/Core/Type/DateType.php</span>
<span style="font-weight:bold;">index 022a414932..1748d2e31f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Extension/Core/Type/DateType.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Extension/Core/Type/DateType.php</span>
<span style="color:teal;">@@ -77,6 +77,12 @@</span> class DateType extends AbstractType
                $calendar,
                $pattern
            );

            <span style="color:green;">// new \intlDateFormatter may return null instead of false in case of failure, see https://bugs.php.net/bug.php?id=66323</span>
<span style="color:green;">            if (!$formatter) {</span>
<span style="color:green;">                throw new InvalidOptionsException(intl_get_error_message(), intl_get_error_code());</span>
<span style="color:green;">            }</span>

            $formatter-&gt;setLenient(false);

            if ('choice' === $options['widget']) {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Extension/Core/Type/LocaleType.php b/src/Symfony/Component/Form/Extension/Core/Type/LocaleType.php</span>
<span style="font-weight:bold;">index c68c561a2d..4610c1b459 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Extension/Core/Type/LocaleType.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Extension/Core/Type/LocaleType.php</span>
<span style="color:teal;">@@ -13,7 +13,6 @@</span> namespace Symfony\Component\Form\Extension\Core\Type;

use Symfony\Component\Form\AbstractType;
use Symfony\Component\Intl\Intl;
<span style="color:red;">use Symfony\Component\Locale\Locale;</span>
use Symfony\Component\OptionsResolver\OptionsResolverInterface;

class LocaleType extends AbstractType
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Resources/translations/validators.eu.xlf b/src/Symfony/Component/Form/Resources/translations/validators.eu.xlf</span>
<span style="font-weight:bold;">index a07f786c72..ba741ab0fc 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Resources/translations/validators.eu.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Resources/translations/validators.eu.xlf</span>
<span style="color:teal;">@@ -12,7 +12,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;30&quot;&gt;
                &lt;source&gt;The CSRF token is invalid.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;CSFR</span><span style="color:green;">&lt;target&gt;CSRF</span> tokena ez da egokia.&lt;/target&gt;
            &lt;/trans-unit&gt;
        &lt;/body&gt;
    &lt;/file&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Tests/CallbackTransformerTest.php b/src/Symfony/Component/Form/Tests/CallbackTransformerTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..706bc076ec</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Tests/CallbackTransformerTest.php</span>
<span style="color:teal;">@@ -0,0 +1,37 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">namespace Symfony\Component\Form\Tests;</span>

<span style="color:green;">use Symfony\Component\Form\CallbackTransformer;</span>

<span style="color:green;">class CallbackTransformerTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:green;">{</span>
<span style="color:green;">    public function testTransform()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $transformer = new CallbackTransformer(</span>
<span style="color:green;">            function($value) { return $value.' has been transformed'; },</span>
<span style="color:green;">            function($value) { return $value.' has reversely been transformed'; }</span>
<span style="color:green;">        );</span>

<span style="color:green;">        $this-&gt;assertEquals('foo has been transformed', $transformer-&gt;transform('foo'));</span>
<span style="color:green;">        $this-&gt;assertEquals('bar has reversely been transformed', $transformer-&gt;reverseTransform('bar'));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @dataProvider invalidCallbacksProvider</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @expectedException \InvalidArgumentException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testConstructorWithInvalidCallbacks($transformCallback, $reverseTransformCallback)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        new CallbackTransformer($transformCallback, $reverseTransformCallback);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function invalidCallbacksProvider()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            array( null, function(){} ),</span>
<span style="color:green;">            array( function(){}, null ),</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/DateTimeToRfc3339TransformerTest.php b/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/DateTimeToRfc3339TransformerTest.php</span>
<span style="font-weight:bold;">index c8f3806086..16a7a4ad81 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/DateTimeToRfc3339TransformerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/DateTimeToRfc3339TransformerTest.php</span>
<span style="color:teal;">@@ -32,7 +32,7 @@</span> class DateTimeToRfc3339TransformerTest extends DateTimeTestCase
        $this-&gt;dateTimeWithoutSeconds = null;
    }

    public static function assertEquals($expected, $actual, $message = '', $delta = 0, $maxDepth = 10, $canonicalize = <span style="color:red;">FALSE,</span><span style="color:green;">false,</span> $ignoreCase = <span style="color:red;">FALSE)</span><span style="color:green;">false)</span>
    {
        if ($expected instanceof \DateTime &amp;&amp; $actual instanceof \DateTime) {
            $expected = $expected-&gt;format('c');
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/ValueToDuplicatesTransformerTest.php b/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/ValueToDuplicatesTransformerTest.php</span>
<span style="font-weight:bold;">index 2c5298da50..a8a088a95a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/ValueToDuplicatesTransformerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Tests/Extension/Core/DataTransformer/ValueToDuplicatesTransformerTest.php</span>
<span style="color:teal;">@@ -82,6 +82,29 @@</span> class ValueToDuplicatesTransformerTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertNull($this-&gt;transformer-&gt;reverseTransform($input));
    }

    <span style="color:green;">public function testReverseTransformEmptyArray()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $input = array(</span>
<span style="color:green;">            'a' =&gt; array(),</span>
<span style="color:green;">            'b' =&gt; array(),</span>
<span style="color:green;">            'c' =&gt; array(),</span>
<span style="color:green;">        );</span>

<span style="color:green;">        $this-&gt;assertNull($this-&gt;transformer-&gt;reverseTransform($input));</span>
<span style="color:green;">    }</span>


<span style="color:green;">    public function testReverseTransformZeroString()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $input = array(</span>
<span style="color:green;">            'a' =&gt; '0',</span>
<span style="color:green;">            'b' =&gt; '0',</span>
<span style="color:green;">            'c' =&gt; '0'</span>
<span style="color:green;">        );</span>

<span style="color:green;">        $this-&gt;assertSame('0', $this-&gt;transformer-&gt;reverseTransform($input));</span>
<span style="color:green;">    }</span>

    /**
     * @expectedException \Symfony\Component\Form\Exception\TransformationFailedException
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Tests/Extension/Validator/Constraints/FormValidatorTest.php b/src/Symfony/Component/Form/Tests/Extension/Validator/Constraints/FormValidatorTest.php</span>
<span style="font-weight:bold;">index 4d9c26b81c..bfb84a15f8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Tests/Extension/Validator/Constraints/FormValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Tests/Extension/Validator/Constraints/FormValidatorTest.php</span>
<span style="color:teal;">@@ -21,11 +21,12 @@</span> use Symfony\Component\Form\SubmitButtonBuilder;
use Symfony\Component\Validator\Constraint;
use Symfony\Component\Validator\Constraints\NotNull;
use Symfony\Component\Validator\Constraints\NotBlank;
<span style="color:green;">use Symfony\Component\Validator\Tests\Constraints\AbstractConstraintValidatorTest;</span>

/**
 * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;
 */
class FormValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    /**
     * @var \PHPUnit_Framework_MockObject_MockObject
<span style="color:teal;">@@ -40,12 +41,7 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
    /**
     * @var \PHPUnit_Framework_MockObject_MockObject
     */
    <span style="color:red;">private</span><span style="color:green;">protected</span> $serverParams;<span style="color:red;">/**</span>
<span style="color:red;">     * @var FormValidator</span>
<span style="color:red;">     */</span>
<span style="color:red;">    private $validator;</span>

    protected function setUp()
    {
<span style="color:teal;">@@ -55,32 +51,33 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            'Symfony\Component\Form\Extension\Validator\Util\ServerParams',
            array('getNormalizedIniPostMaxSize', 'getContentLength')
        );

        <span style="color:red;">$this-&gt;validator =</span><span style="color:green;">parent::setUp();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createValidator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return</span> new FormValidator($this-&gt;serverParams);
    }

    public function testValidate()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $options = array('validation_groups' =&gt; array('group1', 'group2'));
        $form = $this-&gt;getBuilder('name', '\stdClass', $options)
            -&gt;setData($object)
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidateConstraints()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $constraint1 = new NotNull(array('groups' =&gt; array('group1', 'group2')));
        $constraint2 = new NotBlank(array('groups' =&gt; 'group2'));
<span style="color:teal;">@@ -94,28 +91,20 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;getForm();

        // First default constraints
        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

        // Then custom constraints
        <span style="color:red;">$context-&gt;expects($this-&gt;at(2))</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($object, $constraint1,</span><span style="color:green;">$this-&gt;expectValidateValueAt(2,</span> 'data', <span style="color:green;">$object, $constraint1,</span> 'group1');
        <span style="color:red;">$context-&gt;expects($this-&gt;at(3))</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($object, $constraint2,</span><span style="color:green;">$this-&gt;expectValidateValueAt(3,</span> 'data', <span style="color:green;">$object, $constraint2,</span> 'group2');<span style="color:red;">$this-&gt;validator-&gt;initialize($context);</span>

        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontValidateIfParentWithoutCascadeValidation()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parent = $this-&gt;getBuilder('parent', null, array('cascade_validation' =&gt; false))
<span style="color:teal;">@@ -128,16 +117,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidateConstraintsEvenIfNoCascadeValidation()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $constraint1 = new NotNull(array('groups' =&gt; array('group1', 'group2')));
        $constraint2 = new NotBlank(array('groups' =&gt; 'group2'));
<span style="color:teal;">@@ -155,20 +143,16 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;getForm();
        $parent-&gt;add($form);

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($object, $constraint1,</span><span style="color:green;">$this-&gt;expectValidateValueAt(0,</span> 'data', <span style="color:green;">$object, $constraint1,</span> 'group1');
        <span style="color:red;">$context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($object, $constraint2,</span><span style="color:green;">$this-&gt;expectValidateValueAt(1,</span> 'data', <span style="color:green;">$object, $constraint2,</span> 'group2');

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontValidateIfNoValidationGroups()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $form = $this-&gt;getBuilder('name', '\stdClass', array(
<span style="color:teal;">@@ -179,16 +163,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontValidateConstraintsIfNoValidationGroups()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $constraint1 = $this-&gt;getMock('Symfony\Component\Validator\Constraint');
        $constraint2 = $this-&gt;getMock('Symfony\Component\Validator\Constraint');
<span style="color:teal;">@@ -204,16 +187,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        // Launch transformer
        $form-&gt;submit(array());

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontValidateIfNotSynchronized()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $form = $this-&gt;getBuilder('name', '\stdClass', array(
<span style="color:teal;">@@ -233,26 +215,18 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        // Launch transformer
        $form-&gt;submit('foo');

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with(</span>
<span style="color:red;">                'invalid_message_key',</span>
<span style="color:red;">                array('{{ value }}' =&gt; 'foo', '{{ foo }}' =&gt; 'bar'),</span>
<span style="color:red;">                'foo'</span>
<span style="color:red;">            );</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertViolation('invalid_message_key', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foo',</span>
<span style="color:green;">            '{{ foo }}' =&gt; 'bar'</span>
<span style="color:green;">        ), 'property.path', 'foo', null, Form::ERR_INVALID);</span>
    }

    public function testAddInvalidErrorEvenIfNoValidationGroups()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $form = $this-&gt;getBuilder('name', '\stdClass', array(
<span style="color:teal;">@@ -273,31 +247,24 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        // Launch transformer
        $form-&gt;submit('foo');

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with(</span>
<span style="color:red;">                'invalid_message_key',</span>
<span style="color:red;">                array('{{ value }}' =&gt; 'foo', '{{ foo }}' =&gt; 'bar'),</span>
<span style="color:red;">                'foo'</span>
<span style="color:red;">            );</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertViolation('invalid_message_key', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foo',</span>
<span style="color:green;">            '{{ foo }}' =&gt; 'bar'</span>
<span style="color:green;">        ), 'property.path', 'foo', null, Form::ERR_INVALID);</span>
    }

    public function testDontValidateConstraintsIfNotSynchronized()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $constraint1 = $this-&gt;getMock('Symfony\Component\Validator\Constraint');
        $constraint2 = $this-&gt;getMock('Symfony\Component\Validator\Constraint');

        $options = array(
            <span style="color:green;">'invalid_message' =&gt; 'invalid_message_key',</span>
            'validation_groups' =&gt; array('group1', 'group2'),
            'constraints' =&gt; array($constraint1, $constraint2),
        );
<span style="color:teal;">@@ -310,19 +277,20 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;getForm();

        // Launch transformer
        <span style="color:red;">$form-&gt;submit(array());</span><span style="color:green;">$form-&gt;submit('foo');</span>

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertViolation('invalid_message_key', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foo',</span>
<span style="color:green;">        ), 'property.path','foo', null, Form::ERR_INVALID);</span>
    }

    // https://github.com/symfony/symfony/issues/4359
    public function testDontMarkInvalidIfAnyChildIsNotSynchronized()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $failingTransformer = new CallbackTransformer(
<span style="color:teal;">@@ -344,55 +312,46 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        // Launch transformer
        $form-&gt;submit(array('child' =&gt; 'foo'));

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testHandleCallbackValidationGroups()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $options = array('validation_groups' =&gt; array($this, 'getValidationGroups'));
        $form = $this-&gt;getBuilder('name', '\stdClass', $options)
            -&gt;setData($object)
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontExecuteFunctionNames()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $options = array('validation_groups' =&gt; 'header');
        $form = $this-&gt;getBuilder('name', '\stdClass', $options)
            -&gt;setData($object)
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'header', true);</span><span style="color:green;">$object, 'header');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testHandleClosureValidationGroups()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $options = array('validation_groups' =&gt; function (FormInterface $form) {
            return array('group1', 'group2');
<span style="color:teal;">@@ -401,20 +360,16 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;setData($object)
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testUseValidationGroupOfClickedButton()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parent = $this-&gt;getBuilder('parent', null, array('cascade_validation' =&gt; true))
<span style="color:teal;">@@ -432,17 +387,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $parent-&gt;submit(array('name' =&gt; $object, 'submit' =&gt; ''));

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'button_group', true);</span><span style="color:green;">$object, 'button_group');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontUseValidationGroupOfUnclickedButton()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parent = $this-&gt;getBuilder('parent', null, array('cascade_validation' =&gt; true))
<span style="color:teal;">@@ -460,17 +413,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'form_group', true);</span><span style="color:green;">$object, 'form_group');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testUseInheritedValidationGroup()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parentOptions = array(
<span style="color:teal;">@@ -486,17 +437,15 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group', true);</span><span style="color:green;">$object, 'group');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testUseInheritedCallbackValidationGroup()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parentOptions = array(
<span style="color:teal;">@@ -512,20 +461,16 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testUseInheritedClosureValidationGroup()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');

        $parentOptions = array(
<span style="color:teal;">@@ -543,52 +488,43 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;setData($object);

        <span style="color:red;">$context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'group1', true);</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$object, 'group1');</span>
<span style="color:green;">        $this-&gt;expectValidateAt(1,</span> 'data', <span style="color:red;">'group2', true);</span><span style="color:green;">$object, 'group2');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testAppendPropertyPath()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $object = $this-&gt;getMock('\stdClass');
        $form = $this-&gt;getBuilder('name', '\stdClass')
            -&gt;setData($object)
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validate')</span>
<span style="color:red;">            -&gt;with($object,</span><span style="color:green;">$this-&gt;expectValidateAt(0,</span> 'data', <span style="color:red;">'Default', true);</span><span style="color:green;">$object, 'Default');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDontWalkScalars()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>

        $form = $this-&gt;getBuilder()
            -&gt;setData('scalar')
            -&gt;getForm();

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('validate');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testViolationIfExtraData()
    {
<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>

        $form = $this-&gt;getBuilder('parent', null, array('extra_fields_message' =&gt; 'Extra!'))
            -&gt;setCompound(true)
            -&gt;setDataMapper($this-&gt;getDataMapper())
<span style="color:teal;">@@ -597,18 +533,13 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase

        $form-&gt;submit(array('foo' =&gt; 'bar'));

        <span style="color:red;">$context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with(</span>
<span style="color:red;">                'Extra!',</span>
<span style="color:red;">                array('{{ extra_fields }}' =&gt; 'foo'),</span>
<span style="color:red;">                array('foo' =&gt; 'bar')</span>
<span style="color:red;">            );</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertViolation('Extra!', array(</span>
<span style="color:green;">            '{{ extra_fields }}' =&gt; 'foo'</span>
<span style="color:green;">        ), 'property.path', array('foo' =&gt; 'bar'));</span>
    }

    /**
<span style="color:teal;">@@ -623,26 +554,18 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;method('getNormalizedIniPostMaxSize')
            -&gt;will($this-&gt;returnValue($iniMax));

<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $options = array('post_max_size_message' =&gt; 'Max {{ max }}!');
        $form = $this-&gt;getBuilder('name', null, $options)-&gt;getForm();

        <span style="color:green;">$this-&gt;validator-&gt;validate($form, new Form());</span>

<span style="color:green;">        $violations = array();</span>

        for ($i = 0; $i &lt; $nbViolation; ++$i) {
            <span style="color:red;">if (0 === $i &amp;&amp; count($params) &gt; 0) {</span>
<span style="color:red;">                $context-&gt;expects($this-&gt;at($i))</span>
<span style="color:red;">                    -&gt;method('addViolation')</span>
<span style="color:red;">                    -&gt;with($options['post_max_size_message'], $params);</span>
<span style="color:red;">            } else {</span>
<span style="color:red;">                $context-&gt;expects($this-&gt;at($i))</span>
<span style="color:red;">                    -&gt;method('addViolation');</span>
<span style="color:red;">            }</span><span style="color:green;">$violations[] = $this-&gt;createViolation($options['post_max_size_message'], $params, 'property.path', $contentLength);</span>
        }

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
<span style="color:red;">        $this-&gt;validator-&gt;validate($form, new Form());</span><span style="color:green;">$this-&gt;assertViolations($violations);</span>
    }

    public function getPostMaxSizeFixtures()
<span style="color:teal;">@@ -668,7 +591,6 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;serverParams-&gt;expects($this-&gt;never())
            -&gt;method('getNormalizedIniPostMaxSize');

<span style="color:red;">        $context = $this-&gt;getMockExecutionContext();</span>
        $parent = $this-&gt;getBuilder()
            -&gt;setCompound(true)
            -&gt;setDataMapper($this-&gt;getDataMapper())
<span style="color:teal;">@@ -676,13 +598,11 @@</span> class FormValidatorTest extends \PHPUnit_Framework_TestCase
        $form = $this-&gt;getForm();
        $parent-&gt;add($form);

        <span style="color:red;">$context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>
<span style="color:red;">        $context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">$this-&gt;expectNoValidate();</span>

<span style="color:red;">        $this-&gt;validator-&gt;initialize($context);</span>
        $this-&gt;validator-&gt;validate($form, new Form());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Form/Tests/Extension/Validator/ViolationMapper/ViolationPathTest.php b/src/Symfony/Component/Form/Tests/Extension/Validator/ViolationMapper/ViolationPathTest.php</span>
<span style="font-weight:bold;">index 02df8f43eb..2dab4ffad7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Form/Tests/Extension/Validator/ViolationMapper/ViolationPathTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Form/Tests/Extension/Validator/ViolationMapper/ViolationPathTest.php</span>
<span style="color:teal;">@@ -126,7 +126,7 @@</span> class ViolationPathTest extends \PHPUnit_Framework_TestCase
    public function testGetParent($violationPath, $parentPath)
    {
        $path = new ViolationPath($violationPath);
        $parent =<span style="color:red;">$parentPath ===</span> null <span style="color:green;">=== $parentPath</span> ? null : new ViolationPath($parentPath);

        $this-&gt;assertEquals($parent, $path-&gt;getParent());
    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/BinaryFileResponse.php b/src/Symfony/Component/HttpFoundation/BinaryFileResponse.php</span>
<span style="font-weight:bold;">index 986dde1ac6..e9e4455c94 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/BinaryFileResponse.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/BinaryFileResponse.php</span>
<span style="color:teal;">@@ -61,6 +61,8 @@</span> class BinaryFileResponse extends Response
     * @param null|string         $contentDisposition The type of Content-Disposition to set automatically with the filename
     * @param bool                $autoEtag           Whether the ETag header should be automatically set
     * @param bool                $autoLastModified   Whether the Last-Modified header should be automatically set
     <span style="color:green;">*</span>
<span style="color:green;">     * @return BinaryResponse The created response</span>
     */
    public static function create($file = null, $status = 200, $headers = array(), $public = true, $contentDisposition = null, $autoEtag = false, $autoLastModified = true)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/Request.php b/src/Symfony/Component/HttpFoundation/Request.php</span>
<span style="font-weight:bold;">index f59edf5327..06d98c8580 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/Request.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/Request.php</span>
<span style="color:teal;">@@ -502,6 +502,8 @@</span> class Request
     */
    public function overrideGlobals()
    {
        <span style="color:green;">$this-&gt;server-&gt;set('QUERY_STRING', static::normalizeQueryString(http_build_query($this-&gt;query-&gt;all(), null, '&amp;')));</span>

        $_GET = $this-&gt;query-&gt;all();
        $_POST = $this-&gt;request-&gt;all();
        $_SERVER = $this-&gt;server-&gt;all();
<span style="color:teal;">@@ -1170,7 +1172,8 @@</span> class Request

        // as the host can come from the user (HTTP_HOST and depending on the configuration, SERVER_NAME too can come from the user)
        // check that it does not contain forbidden characters (see RFC 952 and RFC 2181)
        <span style="color:green;">// use preg_replace() instead of preg_match() to prevent DoS attacks with long host names</span>
        if ($host &amp;&amp; <span style="color:red;">!preg_match('/^\[?(?:[a-zA-Z0-9-:\]_]+\.?)+$/',</span><span style="color:green;">'' !== preg_replace('/(?:^\[)?[a-zA-Z0-9-:\]_]+\.?/', '',</span> $host)) {
            throw new \UnexpectedValueException(sprintf('Invalid Host &quot;%s&quot;', $host));
        }

<span style="color:teal;">@@ -1379,6 +1382,16 @@</span> class Request
        }
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * Get the default locale.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function getDefaultLocale()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return $this-&gt;defaultLocale;</span>
<span style="color:green;">    }</span>

    /**
     * Sets the locale.
     *
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/ServerBag.php b/src/Symfony/Component/HttpFoundation/ServerBag.php</span>
<span style="font-weight:bold;">index de6dbc9fb5..6a4f2c2b16 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/ServerBag.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/ServerBag.php</span>
<span style="color:teal;">@@ -65,13 +65,13 @@</span> class ServerBag extends ParameterBag
            }

            if (null !== $authorizationHeader) {
                if (0 === stripos($authorizationHeader, <span style="color:red;">'basic'))</span><span style="color:green;">'basic '))</span> {
                    // Decode AUTHORIZATION header into PHP_AUTH_USER and PHP_AUTH_PW when authorization header is basic
                    $exploded = explode(':', base64_decode(substr($authorizationHeader, <span style="color:red;">6)));</span><span style="color:green;">6)), 2);</span>
                    if (count($exploded) == 2) {
                        list($headers['PHP_AUTH_USER'], $headers['PHP_AUTH_PW']) = $exploded;
                    }
                } elseif (empty($this-&gt;parameters['PHP_AUTH_DIGEST']) &amp;&amp; (0 === stripos($authorizationHeader, <span style="color:red;">'digest')))</span><span style="color:green;">'digest ')))</span> {
                    // In some circumstances PHP_AUTH_DIGEST needs to be set
                    $headers['PHP_AUTH_DIGEST'] = $authorizationHeader;
                    $this-&gt;parameters['PHP_AUTH_DIGEST'] = $authorizationHeader;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/Tests/RequestTest.php b/src/Symfony/Component/HttpFoundation/Tests/RequestTest.php</span>
<span style="font-weight:bold;">index ea9e0ceb84..ed06e550c7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/Tests/RequestTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/Tests/RequestTest.php</span>
<span style="color:teal;">@@ -42,7 +42,7 @@</span> class RequestTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('bar', $request-&gt;attributes-&gt;get('foo'), '-&gt;initialize() takes an array of attributes as its third argument');

        $request-&gt;initialize(array(), array(), array(), array(), array(), array('HTTP_FOO' =&gt; 'bar'));
        $this-&gt;assertEquals('bar', $request-&gt;headers-&gt;get('FOO'), '-&gt;initialize() takes an array of HTTP headers as its <span style="color:red;">fourth</span><span style="color:green;">sixth</span> argument');
    }

    public function testGetLocale()
<span style="color:teal;">@@ -200,23 +200,23 @@</span> class RequestTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('test.com:90', $request-&gt;getHttpHost());
        $this-&gt;assertFalse($request-&gt;isSecure());

        $request = <span style="color:red;">Request::create('http://test:test@test.com');</span><span style="color:green;">Request::create('http://username:password@test.com');</span>
        $this-&gt;assertEquals('http://test.com/', $request-&gt;getUri());
        $this-&gt;assertEquals('/', $request-&gt;getPathInfo());
        $this-&gt;assertEquals('', $request-&gt;getQueryString());
        $this-&gt;assertEquals(80, $request-&gt;getPort());
        $this-&gt;assertEquals('test.com', $request-&gt;getHttpHost());
        <span style="color:red;">$this-&gt;assertEquals('test',</span><span style="color:green;">$this-&gt;assertEquals('username',</span> $request-&gt;getUser());
        <span style="color:red;">$this-&gt;assertEquals('test',</span><span style="color:green;">$this-&gt;assertEquals('password',</span> $request-&gt;getPassword());
        $this-&gt;assertFalse($request-&gt;isSecure());

        $request = <span style="color:red;">Request::create('http://testnopass@test.com');</span><span style="color:green;">Request::create('http://username@test.com');</span>
        $this-&gt;assertEquals('http://test.com/', $request-&gt;getUri());
        $this-&gt;assertEquals('/', $request-&gt;getPathInfo());
        $this-&gt;assertEquals('', $request-&gt;getQueryString());
        $this-&gt;assertEquals(80, $request-&gt;getPort());
        $this-&gt;assertEquals('test.com', $request-&gt;getHttpHost());
        <span style="color:red;">$this-&gt;assertEquals('testnopass',</span><span style="color:green;">$this-&gt;assertEquals('username',</span> $request-&gt;getUser());
        $this-&gt;assertSame('',$request-&gt;getPassword());
        $this-&gt;assertFalse($request-&gt;isSecure());

<span style="color:teal;">@@ -1012,10 +1012,21 @@</span> class RequestTest extends \PHPUnit_Framework_TestCase

        $request-&gt;headers-&gt;set('CONTENT_TYPE', 'multipart/form-data');
        $request-&gt;headers-&gt;set('CONTENT_LENGTH', 12345);

        $request-&gt;overrideGlobals();

        $this-&gt;assertArrayHasKey('CONTENT_TYPE', $_SERVER);
        $this-&gt;assertArrayHasKey('CONTENT_LENGTH', $_SERVER);

        <span style="color:green;">$request-&gt;initialize(array('foo' =&gt; 'bar', 'baz' =&gt; 'foo'));</span>
<span style="color:green;">        $request-&gt;query-&gt;remove('baz');</span>

<span style="color:green;">        $request-&gt;overrideGlobals();</span>

<span style="color:green;">        $this-&gt;assertEquals(array('foo' =&gt; 'bar'), $_GET);</span>
<span style="color:green;">        $this-&gt;assertEquals('foo=bar', $_SERVER['QUERY_STRING']);</span>
<span style="color:green;">        $this-&gt;assertEquals('foo=bar', $request-&gt;server-&gt;get('QUERY_STRING'));</span>

        // restore initial $_SERVER array
        $_SERVER = $server;
    }
<span style="color:teal;">@@ -1646,6 +1657,59 @@</span> class RequestTest extends \PHPUnit_Framework_TestCase

        Request::setFactory(null);
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @dataProvider getLongHostNames</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testVeryLongHosts($host)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $start = microtime(true);</span>

<span style="color:green;">        $request = Request::create('/');</span>
<span style="color:green;">        $request-&gt;headers-&gt;set('host', $host);</span>
<span style="color:green;">        $this-&gt;assertEquals($host, $request-&gt;getHost());</span>
<span style="color:green;">        $this-&gt;assertLessThan(1, microtime(true) - $start);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @dataProvider getHostValidities</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testHostValidity($host, $isValid, $expectedHost = null, $expectedPort = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $request = Request::create('/');</span>
<span style="color:green;">        $request-&gt;headers-&gt;set('host', $host);</span>

<span style="color:green;">        if ($isValid) {</span>
<span style="color:green;">            $this-&gt;assertSame($expectedHost ?: $host, $request-&gt;getHost());</span>
<span style="color:green;">            if ($expectedPort) {</span>
<span style="color:green;">                $this-&gt;assertSame($expectedPort, $request-&gt;getPort());</span>
<span style="color:green;">            }</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $this-&gt;setExpectedException('UnexpectedValueException', 'Invalid Host');</span>
<span style="color:green;">            $request-&gt;getHost();</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getHostValidities()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            array('.a', false),</span>
<span style="color:green;">            array('a..', false),</span>
<span style="color:green;">            array('a.', true),</span>
<span style="color:green;">            array(&quot;\xE9&quot;, false),</span>
<span style="color:green;">            array('[::1]', true),</span>
<span style="color:green;">            array('[::1]:80', true, '[::1]', 80),</span>
<span style="color:green;">            array(str_repeat('.', 101), false),</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getLongHostNames()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            array('a'.str_repeat('.a', 40000)),</span>
<span style="color:green;">            array(str_repeat(':', 101)),</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>
}

class RequestContentProxy extends Request
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/Tests/ResponseTest.php b/src/Symfony/Component/HttpFoundation/Tests/ResponseTest.php</span>
<span style="font-weight:bold;">index e513ffb351..1c97d4b762 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/Tests/ResponseTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/Tests/ResponseTest.php</span>
<span style="color:teal;">@@ -781,7 +781,7 @@</span> class ResponseTest extends ResponseTestCase
    public function invalidContentProvider()
    {
        return array(
            'obj'   =&gt; array(new <span style="color:red;">\stdClass),</span><span style="color:green;">\stdClass()),</span>
            'array' =&gt; array(array()),
            'bool'   =&gt; array(true, '1'),
        );
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpFoundation/Tests/ServerBagTest.php b/src/Symfony/Component/HttpFoundation/Tests/ServerBagTest.php</span>
<span style="font-weight:bold;">index 89920f1fbc..662c5880b1 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpFoundation/Tests/ServerBagTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpFoundation/Tests/ServerBagTest.php</span>
<span style="color:teal;">@@ -67,14 +67,24 @@</span> class ServerBagTest extends \PHPUnit_Framework_TestCase
        ), $bag-&gt;getHeaders());
    }

    <span style="color:green;">public function testHttpBasicAuthWithPhpCgiBogus()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $bag = new ServerBag(array('HTTP_AUTHORIZATION' =&gt; 'Basic_'.base64_encode('foo:bar')));</span>

<span style="color:green;">        // Username and passwords should not be set as the header is bogus</span>
<span style="color:green;">        $headers = $bag-&gt;getHeaders();</span>
<span style="color:green;">        $this-&gt;assertFalse(isset($headers['PHP_AUTH_USER']));</span>
<span style="color:green;">        $this-&gt;assertFalse(isset($headers['PHP_AUTH_PW']));</span>
<span style="color:green;">    }</span>

    public function testHttpBasicAuthWithPhpCgiRedirect()
    {
        $bag = new ServerBag(array('REDIRECT_HTTP_AUTHORIZATION' =&gt; 'Basic <span style="color:red;">'.base64_encode('foo:bar')));</span><span style="color:green;">'.base64_encode('username:pass:word')));</span>

        $this-&gt;assertEquals(array(
            'AUTHORIZATION' =&gt; 'Basic <span style="color:red;">'.base64_encode('foo:bar'),</span><span style="color:green;">'.base64_encode('username:pass:word'),</span>
            'PHP_AUTH_USER' =&gt; <span style="color:red;">'foo',</span><span style="color:green;">'username',</span>
            'PHP_AUTH_PW' =&gt; <span style="color:red;">'bar'</span><span style="color:green;">'pass:word'</span>
        ), $bag-&gt;getHeaders());
    }

<span style="color:teal;">@@ -100,6 +110,17 @@</span> class ServerBagTest extends \PHPUnit_Framework_TestCase
        ), $bag-&gt;getHeaders());
    }

    <span style="color:green;">public function testHttpDigestAuthWithPhpCgiBogus()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $digest = 'Digest_username=&quot;foo&quot;, realm=&quot;acme&quot;, nonce=&quot;'.md5('secret').'&quot;, uri=&quot;/protected, qop=&quot;auth&quot;';</span>
<span style="color:green;">        $bag = new ServerBag(array('HTTP_AUTHORIZATION' =&gt; $digest));</span>

<span style="color:green;">        // Username and passwords should not be set as the header is bogus</span>
<span style="color:green;">        $headers = $bag-&gt;getHeaders();</span>
<span style="color:green;">        $this-&gt;assertFalse(isset($headers['PHP_AUTH_USER']));</span>
<span style="color:green;">        $this-&gt;assertFalse(isset($headers['PHP_AUTH_PW']));</span>
<span style="color:green;">    }</span>

    public function testHttpDigestAuthWithPhpCgiRedirect()
    {
        $digest = 'Digest username=&quot;foo&quot;, realm=&quot;acme&quot;, nonce=&quot;'.md5('secret').'&quot;, uri=&quot;/protected, qop=&quot;auth&quot;';
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Debug/TraceableEventDispatcher.php b/src/Symfony/Component/HttpKernel/Debug/TraceableEventDispatcher.php</span>
<span style="font-weight:bold;">index 4e5a0c18d5..72fa8700e5 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Debug/TraceableEventDispatcher.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Debug/TraceableEventDispatcher.php</span>
<span style="color:teal;">@@ -252,8 +252,9 @@</span> class TraceableEventDispatcher implements EventDispatcherInterface, TraceableEve
    /**
     * Returns information about the listener
     *
     * @param object   $listener  The listener
     * @param <span style="color:green;">int|null $eventId   The event id</span>
<span style="color:green;">     * @param</span> string   $eventName The event name
     *
     * @return array Information about the listener
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php b/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php</span>
<span style="font-weight:bold;">index ef3fad3d4c..1a198a55f6 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/EventListener/FragmentListener.php</span>
<span style="color:teal;">@@ -12,11 +12,11 @@</span>
namespace Symfony\Component\HttpKernel\EventListener;

use Symfony\Component\HttpFoundation\Request;
<span style="color:red;">use Symfony\Component\HttpFoundation\IpUtils;</span>
use Symfony\Component\HttpKernel\Event\GetResponseEvent;
use Symfony\Component\HttpKernel\KernelEvents;
use Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException;
use Symfony\Component\HttpKernel\UriSigner;
<span style="color:green;">use Symfony\Component\HttpKernel\HttpKernelInterface;</span>
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

/**
<span style="color:teal;">@@ -25,8 +25,8 @@</span> use Symfony\Component\EventDispatcher\EventSubscriberInterface;
 * All URL paths starting with /_fragment are handled as
 * content fragments by this listener.
 *
 * If <span style="color:green;">throws an AccessDeniedHttpException exception if</span> the request
 <span style="color:red;">does</span><span style="color:green;">* is</span> not <span style="color:red;">come from a trusted IP,</span><span style="color:green;">signed or if</span> it <span style="color:red;">throws</span><span style="color:green;">is not</span> an <span style="color:red;">* AccessDeniedHttpException exception.</span><span style="color:green;">internal sub-request.</span>
 *
 * @author Fabien Potencier &lt;fabien@symfony.com&gt;
 */
<span style="color:teal;">@@ -62,7 +62,9 @@</span> class FragmentListener implements EventSubscriberInterface
            return;
        }

        <span style="color:green;">if ($event-&gt;isMasterRequest()) {</span>
            $this-&gt;validateRequest($request);
        <span style="color:green;">}</span>

        parse_str($request-&gt;query-&gt;get('_path', ''), $attributes);
        $request-&gt;attributes-&gt;add($attributes);
<span style="color:teal;">@@ -77,13 +79,6 @@</span> class FragmentListener implements EventSubscriberInterface
            throw new AccessDeniedHttpException();
        }

<span style="color:red;">        // does the Request come from a trusted IP?</span>
<span style="color:red;">        $trustedIps = array_merge($this-&gt;getLocalIpAddresses(), $request-&gt;getTrustedProxies());</span>
<span style="color:red;">        $remoteAddress = $request-&gt;server-&gt;get('REMOTE_ADDR');</span>
<span style="color:red;">        if (IpUtils::checkIp($remoteAddress, $trustedIps)) {</span>
<span style="color:red;">            return;</span>
<span style="color:red;">        }</span>

        // is the Request signed?
        // we cannot use $request-&gt;getUri() here as we want to work with the original URI (no query string reordering)
        if ($this-&gt;signer-&gt;check($request-&gt;getSchemeAndHttpHost().$request-&gt;getBaseUrl().$request-&gt;getPathInfo().(null !== ($qs = $request-&gt;server-&gt;get('QUERY_STRING')) ? '?'.$qs : ''))) {
<span style="color:teal;">@@ -93,6 +88,11 @@</span> class FragmentListener implements EventSubscriberInterface
        throw new AccessDeniedHttpException();
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @deprecated Deprecated since 2.3.19, to be removed in 3.0.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string[]</span>
<span style="color:green;">     */</span>
    protected function getLocalIpAddresses()
    {
        return array('127.0.0.1', 'fe80::1', '::1');
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/EventListener/SessionListener.php b/src/Symfony/Component/HttpKernel/EventListener/SessionListener.php</span>
<span style="font-weight:bold;">index d1023b297c..4c10418d6e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/EventListener/SessionListener.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/EventListener/SessionListener.php</span>
<span style="color:teal;">@@ -25,7 +25,7 @@</span> abstract class SessionListener implements EventSubscriberInterface
{
    public function onKernelRequest(GetResponseEvent $event)
    {
        if <span style="color:red;">(HttpKernelInterface::MASTER_REQUEST !== $event-&gt;getRequestType())</span><span style="color:green;">(!$event-&gt;isMasterRequest())</span> {
            return;
        }

<span style="color:teal;">@@ -48,7 +48,7 @@</span> abstract class SessionListener implements EventSubscriberInterface
    /**
     * Gets the session object.
     *
     * @return SessionInterface|null A SessionInterface instance <span style="color:red;">of</span><span style="color:green;">or</span> null if no session is available
     */
    abstract protected function getSession();
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/EventListener/TestSessionListener.php b/src/Symfony/Component/HttpKernel/EventListener/TestSessionListener.php</span>
<span style="font-weight:bold;">index ee047a6acc..794d45e720 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/EventListener/TestSessionListener.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/EventListener/TestSessionListener.php</span>
<span style="color:teal;">@@ -30,7 +30,7 @@</span> abstract class TestSessionListener implements EventSubscriberInterface
{
    public function onKernelRequest(GetResponseEvent $event)
    {
        if <span style="color:red;">(HttpKernelInterface::MASTER_REQUEST !== $event-&gt;getRequestType())</span><span style="color:green;">(!$event-&gt;isMasterRequest())</span> {
            return;
        }

<span style="color:teal;">@@ -55,7 +55,7 @@</span> abstract class TestSessionListener implements EventSubscriberInterface
     */
    public function onKernelResponse(FilterResponseEvent $event)
    {
        if <span style="color:red;">(HttpKernelInterface::MASTER_REQUEST !== $event-&gt;getRequestType())</span><span style="color:green;">(!$event-&gt;isMasterRequest())</span> {
            return;
        }

<span style="color:teal;">@@ -78,7 +78,7 @@</span> abstract class TestSessionListener implements EventSubscriberInterface
    /**
     * Gets the session object.
     *
     * @return SessionInterface|null A SessionInterface instance <span style="color:red;">of</span><span style="color:green;">or</span> null if no session is available
     */
    abstract protected function getSession();
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Fragment/EsiFragmentRenderer.php b/src/Symfony/Component/HttpKernel/Fragment/EsiFragmentRenderer.php</span>
<span style="font-weight:bold;">index 620c71a878..772884d634 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Fragment/EsiFragmentRenderer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Fragment/EsiFragmentRenderer.php</span>
<span style="color:teal;">@@ -15,6 +15,7 @@</span> use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Controller\ControllerReference;
use Symfony\Component\HttpKernel\HttpCache\Esi;
<span style="color:green;">use Symfony\Component\HttpKernel\UriSigner;</span>

/**
 * Implements the ESI rendering strategy.
<span style="color:teal;">@@ -25,6 +26,7 @@</span> class EsiFragmentRenderer extends RoutableFragmentRenderer
{
    private $esi;
    private $inlineStrategy;
    <span style="color:green;">private $signer;</span>

    /**
     * Constructor.
<span style="color:teal;">@@ -34,11 +36,13 @@</span> class EsiFragmentRenderer extends RoutableFragmentRenderer
     *
     * @param Esi                       $esi            An Esi instance
     * @param FragmentRendererInterface $inlineStrategy The inline strategy to use when ESI is not supported
     <span style="color:green;">* @param UriSigner                 $signer</span>
     */
    public function __construct(Esi $esi = null, InlineFragmentRenderer <span style="color:red;">$inlineStrategy)</span><span style="color:green;">$inlineStrategy, UriSigner $signer = null)</span>
    {
        $this-&gt;esi = $esi;
        $this-&gt;inlineStrategy = $inlineStrategy;
        <span style="color:green;">$this-&gt;signer = $signer;</span>
    }

    /**
<span style="color:teal;">@@ -61,12 +65,12 @@</span> class EsiFragmentRenderer extends RoutableFragmentRenderer
        }

        if ($uri instanceof ControllerReference) {
            $uri = <span style="color:red;">$this-&gt;generateFragmentUri($uri,</span><span style="color:green;">$this-&gt;generateSignedFragmentUri($uri,</span> $request);
        }

        $alt = isset($options['alt']) ? $options['alt'] : null;
        if ($alt instanceof ControllerReference) {
            $alt = <span style="color:red;">$this-&gt;generateFragmentUri($alt,</span><span style="color:green;">$this-&gt;generateSignedFragmentUri($alt,</span> $request);
        }

        $tag = $this-&gt;esi-&gt;renderIncludeTag($uri, $alt, isset($options['ignore_errors']) ? $options['ignore_errors'] : false, isset($options['comment']) ? $options['comment'] : '');
<span style="color:teal;">@@ -81,4 +85,16 @@</span> class EsiFragmentRenderer extends RoutableFragmentRenderer
    {
        return 'esi';
    }

    <span style="color:green;">private function generateSignedFragmentUri($uri, Request $request)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (null === $this-&gt;signer) {</span>
<span style="color:green;">            throw new \LogicException('You must use a URI when using the ESI rendering strategy or set a URL signer.');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        // we need to sign the absolute URI, but want to return the path only.</span>
<span style="color:green;">        $fragmentUri = $this-&gt;signer-&gt;sign($this-&gt;generateFragmentUri($uri, $request, true));</span>

<span style="color:green;">        return substr($fragmentUri, strlen($request-&gt;getSchemeAndHttpHost()));</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Fragment/FragmentHandler.php b/src/Symfony/Component/HttpKernel/Fragment/FragmentHandler.php</span>
<span style="font-weight:bold;">index 5ed7ec5dba..27fa7eabec 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Fragment/FragmentHandler.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Fragment/FragmentHandler.php</span>
<span style="color:teal;">@@ -97,7 +97,7 @@</span> class FragmentHandler
     * @return string|null The Response content or null when the Response is streamed
     *
     * @throws \InvalidArgumentException when the renderer does not exist
     * @throws \LogicException           when <span style="color:red;">the Request</span><span style="color:green;">no master request</span> is <span style="color:red;">not successful</span><span style="color:green;">being handled</span>
     */
    public function render($uri, $renderer = 'inline', array $options = array())
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Kernel.php b/src/Symfony/Component/HttpKernel/Kernel.php</span>
<span style="font-weight:bold;">index b0a21fc835..429135d3fe 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Kernel.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Kernel.php</span>
<span style="color:teal;">@@ -59,11 +59,11 @@</span> abstract class Kernel implements KernelInterface, TerminableInterface
    protected $startTime;
    protected $loadClassCache;

    const VERSION         = <span style="color:red;">'2.4.8';</span><span style="color:green;">'2.4.9';</span>
    const VERSION_ID      = <span style="color:red;">'20408';</span><span style="color:green;">'20409';</span>
    const MAJOR_VERSION   = '2';
    const MINOR_VERSION   = '4';
    const RELEASE_VERSION = <span style="color:red;">'8';</span><span style="color:green;">'9';</span>
    const EXTRA_VERSION   = '';

    /**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Tests/EventListener/FragmentListenerTest.php b/src/Symfony/Component/HttpKernel/Tests/EventListener/FragmentListenerTest.php</span>
<span style="font-weight:bold;">index ec9360a431..7ddb2fbbf2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Tests/EventListener/FragmentListenerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Tests/EventListener/FragmentListenerTest.php</span>
<span style="color:teal;">@@ -47,19 +47,6 @@</span> class FragmentListenerTest extends \PHPUnit_Framework_TestCase
        $listener-&gt;onKernelRequest($event);
    }

<span style="color:red;">    /**</span>
<span style="color:red;">     * @expectedException \Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException</span>
<span style="color:red;">     */</span>
<span style="color:red;">    public function testAccessDeniedWithNonLocalIps()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $request = Request::create('http://example.com/_fragment', 'GET', array(), array(), array(), array('REMOTE_ADDR' =&gt; '10.0.0.1'));</span>

<span style="color:red;">        $listener = new FragmentListener(new UriSigner('foo'));</span>
<span style="color:red;">        $event = $this-&gt;createGetResponseEvent($request);</span>

<span style="color:red;">        $listener-&gt;onKernelRequest($event);</span>
<span style="color:red;">    }</span>

    /**
     * @expectedException \Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Tests/Fragment/EsiFragmentRendererTest.php b/src/Symfony/Component/HttpKernel/Tests/Fragment/EsiFragmentRendererTest.php</span>
<span style="font-weight:bold;">index 8acf45d96f..90768f9dac 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Tests/Fragment/EsiFragmentRendererTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Tests/Fragment/EsiFragmentRendererTest.php</span>
<span style="color:teal;">@@ -15,6 +15,7 @@</span> use Symfony\Component\HttpKernel\Controller\ControllerReference;
use Symfony\Component\HttpKernel\Fragment\EsiFragmentRenderer;
use Symfony\Component\HttpKernel\HttpCache\Esi;
use Symfony\Component\HttpFoundation\Request;
<span style="color:green;">use Symfony\Component\HttpKernel\UriSigner;</span>

class EsiFragmentRendererTest extends \PHPUnit_Framework_TestCase
{
<span style="color:teal;">@@ -41,7 +42,52 @@</span> class EsiFragmentRendererTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('&lt;esi:include src=&quot;/&quot; /&gt;', $strategy-&gt;render('/', $request)-&gt;getContent());
        $this-&gt;assertEquals(&quot;&lt;esi:comment text=\&quot;This is a comment\&quot; /&gt;\n&lt;esi:include src=\&quot;/\&quot; /&gt;&quot;, $strategy-&gt;render('/', $request, array('comment' =&gt; 'This is a comment'))-&gt;getContent());
        $this-&gt;assertEquals('&lt;esi:include src=&quot;/&quot; alt=&quot;foo&quot; /&gt;', $strategy-&gt;render('/', $request, array('alt' =&gt; 'foo'))-&gt;getContent());
    <span style="color:red;">$this-&gt;assertEquals('&lt;esi:include src=&quot;/_fragment?_path=_format%3Dhtml%26_locale%3Dfr%26_controller%3Dmain_controller&quot; alt=&quot;/_fragment?_path=_format%3Dhtml%26_locale%3Dfr%26_controller%3Dalt_controller&quot; /&gt;', $strategy-&gt;render(new</span><span style="color:green;">}</span>

<span style="color:green;">    public function testRenderControllerReference()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $signer = new UriSigner('foo');</span>
<span style="color:green;">        $strategy = new EsiFragmentRenderer(new Esi(), $this-&gt;getInlineStrategy(), $signer);</span>

<span style="color:green;">        $request = Request::create('/');</span>
<span style="color:green;">        $request-&gt;setLocale('fr');</span>
<span style="color:green;">        $request-&gt;headers-&gt;set('Surrogate-Capability', 'ESI/1.0');</span>

<span style="color:green;">        $reference = new</span> ControllerReference('main_controller', array(), <span style="color:red;">array()),</span><span style="color:green;">array());</span>
<span style="color:green;">        $altReference = new ControllerReference('alt_controller', array(), array());</span>

<span style="color:green;">        $this-&gt;assertEquals(</span>
<span style="color:green;">            '&lt;esi:include src=&quot;/_fragment?_path=_format%3Dhtml%26_locale%3Dfr%26_controller%3Dmain_controller&amp;_hash=Jz1P8NErmhKTeI6onI1EdAXTB85359MY3RIk5mSJ60w%3D&quot; alt=&quot;/_fragment?_path=_format%3Dhtml%26_locale%3Dfr%26_controller%3Dalt_controller&amp;_hash=iPJEdRoUpGrM1ztqByiorpfMPtiW%2FOWwdH1DBUXHhEc%3D&quot; /&gt;',</span>
<span style="color:green;">            $strategy-&gt;render($reference,</span> $request, array('alt' =&gt; <span style="color:green;">$altReference))-&gt;getContent()</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \LogicException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testRenderControllerReferenceWithoutSignerThrowsException()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $strategy =</span> new <span style="color:red;">ControllerReference('alt_controller', array(), array())))-&gt;getContent());</span><span style="color:green;">EsiFragmentRenderer(new Esi(), $this-&gt;getInlineStrategy());</span>

<span style="color:green;">        $request = Request::create('/');</span>
<span style="color:green;">        $request-&gt;setLocale('fr');</span>
<span style="color:green;">        $request-&gt;headers-&gt;set('Surrogate-Capability', 'ESI/1.0');</span>

<span style="color:green;">        $strategy-&gt;render(new ControllerReference('main_controller'), $request);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @expectedException \LogicException</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testRenderAltControllerReferenceWithoutSignerThrowsException()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $strategy = new EsiFragmentRenderer(new Esi(), $this-&gt;getInlineStrategy());</span>

<span style="color:green;">        $request = Request::create('/');</span>
<span style="color:green;">        $request-&gt;setLocale('fr');</span>
<span style="color:green;">        $request-&gt;headers-&gt;set('Surrogate-Capability', 'ESI/1.0');</span>

<span style="color:green;">        $strategy-&gt;render('/', $request, array('alt' =&gt; new ControllerReference('alt_controller')));</span>
    }

    private function getInlineStrategy($called = false)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/HttpKernel/Tests/HttpCache/HttpCacheTest.php b/src/Symfony/Component/HttpKernel/Tests/HttpCache/HttpCacheTest.php</span>
<span style="font-weight:bold;">index f1c467d76b..89628cfd0f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/HttpKernel/Tests/HttpCache/HttpCacheTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/HttpKernel/Tests/HttpCache/HttpCacheTest.php</span>
<span style="color:teal;">@@ -1177,7 +1177,7 @@</span> class HttpCacheTest extends HttpCacheTestCase

    public function testEsiCacheRemoveValidationHeadersIfEmbeddedResponses()
    {
        $time = new <span style="color:red;">\DateTime;</span><span style="color:green;">\DateTime();</span>

        $responses = array(
            array(
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Intl/ResourceBundle/AbstractBundle.php b/src/Symfony/Component/Intl/ResourceBundle/AbstractBundle.php</span>
<span style="font-weight:bold;">index d1d523c40a..1aaadee20b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Intl/ResourceBundle/AbstractBundle.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Intl/ResourceBundle/AbstractBundle.php</span>
<span style="color:teal;">@@ -11,7 +11,6 @@</span>

namespace Symfony\Component\Intl\ResourceBundle;

<span style="color:red;">use Symfony\Component\Intl\Intl;</span>
use Symfony\Component\Intl\ResourceBundle\Reader\StructuredBundleReaderInterface;

/**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Intl/Resources/bin/copy-stubs-to-component.php b/src/Symfony/Component/Intl/Resources/bin/copy-stubs-to-component.php</span>
<span style="font-weight:bold;">index e85768327e..76eeecfc83 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Intl/Resources/bin/copy-stubs-to-component.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Intl/Resources/bin/copy-stubs-to-component.php</span>
<span style="color:teal;">@@ -11,7 +11,6 @@</span>

use Symfony\Component\Filesystem\Filesystem;
use Symfony\Component\Icu\IcuData;
<span style="color:red;">use Symfony\Component\Intl\Intl;</span>

require_once __DIR__ . '/common.php';
require_once __DIR__ . '/autoload.php';
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/ExecutableFinder.php b/src/Symfony/Component/Process/ExecutableFinder.php</span>
<span style="font-weight:bold;">index 44f1605fa9..6ae74dca17 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/ExecutableFinder.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/ExecutableFinder.php</span>
<span style="color:teal;">@@ -59,8 +59,7 @@</span> class ExecutableFinder
                if (is_dir($path)) {
                    $dirs[] = $path;
                } else {
<span style="color:red;">$file = str_replace(dirname($path), '', $path);</span>                    if <span style="color:red;">($file</span><span style="color:green;">(basename($path)</span> == $name &amp;&amp; is_executable($path)) {
                        return $path;
                    }
                }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Process.php b/src/Symfony/Component/Process/Process.php</span>
<span style="font-weight:bold;">index 2e7bb490b7..9caa279d1c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Process.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Process.php</span>
<span style="color:teal;">@@ -67,6 +67,8 @@</span> class Process
    /** @var ProcessPipes */
    private $processPipes;

    <span style="color:green;">private $latestSignal;</span>

    private static $sigchild;

    /**
<span style="color:teal;">@@ -326,7 +328,7 @@</span> class Process
            usleep(1000);
        }

        if <span style="color:red;">($this-&gt;processInformation['signaled'])</span><span style="color:green;">($this-&gt;processInformation['signaled'] &amp;&amp; $this-&gt;processInformation['termsig'] !== $this-&gt;latestSignal)</span> {
            throw new RuntimeException(sprintf('The process has been signaled with signal &quot;%s&quot;.', $this-&gt;processInformation['termsig']));
        }

<span style="color:teal;">@@ -692,7 +694,8 @@</span> class Process
                    throw new RuntimeException('Unable to kill the process');
                }
            }
            <span style="color:red;">proc_terminate($this-&gt;process);</span><span style="color:green;">// given `SIGTERM` may not be defined and that `proc_terminate` uses the constant value and not the constant itself, we use the same here</span>
<span style="color:green;">            $this-&gt;doSignal(15, false);</span>
            do {
                usleep(1000);
            } while ($this-&gt;isRunning() &amp;&amp; microtime(true) &lt; $timeoutMicro);
<span style="color:teal;">@@ -1237,6 +1240,7 @@</span> class Process
        $this-&gt;stdout = null;
        $this-&gt;stderr = null;
        $this-&gt;process = null;
        <span style="color:green;">$this-&gt;latestSignal = null;</span>
        $this-&gt;status = self::STATUS_READY;
        $this-&gt;incrementalOutputOffset = 0;
        $this-&gt;incrementalErrorOutputOffset = 0;
<span style="color:teal;">@@ -1280,6 +1284,8 @@</span> class Process
            return false;
        }

        <span style="color:green;">$this-&gt;latestSignal = $signal;</span>

        return true;
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/ProcessPipes.php b/src/Symfony/Component/Process/ProcessPipes.php</span>
<span style="font-weight:bold;">index f35d1c1287..37ab8ca83c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/ProcessPipes.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/ProcessPipes.php</span>
<span style="color:teal;">@@ -284,6 +284,8 @@</span> class ProcessPipes
    private function readStreams($blocking, $close = false)
    {
        if (empty($this-&gt;pipes)) {
            <span style="color:green;">usleep(Process::TIMEOUT_PRECISION * 1E4);</span>

            return array();
        }

<span style="color:teal;">@@ -313,11 +315,11 @@</span> class ProcessPipes
            $type = array_search($pipe, $this-&gt;pipes);

            $data = '';
            while <span style="color:red;">($dataread</span><span style="color:green;">('' !== $dataread</span> = <span style="color:green;">(string)</span> fread($pipe, self::CHUNK_SIZE)) {
                $data .= $dataread;
            }

            if <span style="color:red;">($data)</span><span style="color:green;">('' !== $data)</span> {
                $read[$type] = $data;
            }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Tests/AbstractProcessTest.php b/src/Symfony/Component/Process/Tests/AbstractProcessTest.php</span>
<span style="font-weight:bold;">index 57b6e16fe9..a87aa44b22 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Tests/AbstractProcessTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Tests/AbstractProcessTest.php</span>
<span style="color:teal;">@@ -260,13 +260,23 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase

    public function testGetIncrementalErrorOutput()
    {
        <span style="color:green;">// use a lock file to toggle between writing (&quot;W&quot;) and reading (&quot;R&quot;) the</span>
<span style="color:green;">        // error stream</span>
<span style="color:green;">        $lock = tempnam(sys_get_temp_dir(), get_class($this).'Lock');</span>
<span style="color:green;">        file_put_contents($lock, 'W');</span>

        $p = $this-&gt;getProcess(sprintf('php -r %s', escapeshellarg('$n = 0; while ($n &lt; 3) { <span style="color:red;">usleep(100000);</span><span style="color:green;">if (\'W\' === file_get_contents('.var_export($lock, true).')) {</span> file_put_contents(\'php://stderr\', \'ERROR\'); $n++; <span style="color:green;">file_put_contents('.var_export($lock, true).', \'R\'); } usleep(100);</span> }')));

        $p-&gt;start();
        while ($p-&gt;isRunning()) {
            <span style="color:green;">if ('R' === file_get_contents($lock)) {</span>
                $this-&gt;assertLessThanOrEqual(1, preg_match_all('/ERROR/', $p-&gt;getIncrementalErrorOutput(), $matches));
                <span style="color:red;">usleep(20000);</span><span style="color:green;">file_put_contents($lock, 'W');</span>
<span style="color:green;">            }</span>
<span style="color:green;">            usleep(100);</span>
        }

        <span style="color:green;">unlink($lock);</span>
    }

    public function testFlushErrorOutput()
<span style="color:teal;">@@ -280,7 +290,7 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase

    public function testGetOutput()
    {
        $p = $this-&gt;getProcess(sprintf('php -r %s', <span style="color:red;">escapeshellarg('$n=0;while ($n&lt;3) {echo</span><span style="color:green;">escapeshellarg('$n = 0; while ($n &lt; 3) { echo</span> \' foo <span style="color:red;">\';$n++; usleep(500);</span><span style="color:green;">\'; $n++;</span> }')));

        $p-&gt;run();
        $this-&gt;assertEquals(3, preg_match_all('/foo/', $p-&gt;getOutput(), $matches));
<span style="color:teal;">@@ -288,13 +298,23 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase

    public function testGetIncrementalOutput()
    {
        <span style="color:green;">// use a lock file to toggle between writing (&quot;W&quot;) and reading (&quot;R&quot;) the</span>
<span style="color:green;">        // output stream</span>
<span style="color:green;">        $lock = tempnam(sys_get_temp_dir(), get_class($this).'Lock');</span>
<span style="color:green;">        file_put_contents($lock, 'W');</span>

        $p = $this-&gt;getProcess(sprintf('php -r %s', <span style="color:red;">escapeshellarg('$n=0;while ($n&lt;3)</span><span style="color:green;">escapeshellarg('$n = 0; while ($n &lt; 3) { if (\'W\' === file_get_contents('.var_export($lock, true).'))</span> { echo \' foo \';<span style="color:red;">usleep(50000);</span> $n++; <span style="color:green;">file_put_contents('.var_export($lock, true).', \'R\'); } usleep(100);</span> }')));

        $p-&gt;start();
        while ($p-&gt;isRunning()) {
            <span style="color:green;">if ('R' === file_get_contents($lock)) {</span>
                $this-&gt;assertLessThanOrEqual(1, preg_match_all('/foo/', $p-&gt;getIncrementalOutput(), $matches));
                <span style="color:red;">usleep(20000);</span><span style="color:green;">file_put_contents($lock, 'W');</span>
<span style="color:green;">            }</span>
<span style="color:green;">            usleep(100);</span>
        }

        <span style="color:green;">unlink($lock);</span>
    }

    public function testFlushOutput()
<span style="color:teal;">@@ -306,6 +326,19 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEmpty($p-&gt;getOutput());
    }

    <span style="color:green;">public function testZeroAsOutput()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (defined('PHP_WINDOWS_VERSION_BUILD')) {</span>
<span style="color:green;">            // see http://stackoverflow.com/questions/7105433/windows-batch-echo-without-new-line</span>
<span style="color:green;">            $p = $this-&gt;getProcess('echo | set /p dummyName=0');</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $p = $this-&gt;getProcess('printf 0');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $p-&gt;run();</span>
<span style="color:green;">        $this-&gt;assertSame('0', $p-&gt;getOutput());</span>
<span style="color:green;">    }</span>

    public function testExitCodeCommandFailed()
    {
        if (defined('PHP_WINDOWS_VERSION_BUILD')) {
<span style="color:teal;">@@ -578,7 +611,7 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase

    public function testPhpDeadlock()
    {
        $this-&gt;markTestSkipped('Can <span style="color:red;">course</span><span style="color:green;">cause</span> PHP to hang');

        // Sleep doesn't work as it will allow the process to handle signals and close
        // file handles from the other end.
<span style="color:teal;">@@ -602,7 +635,14 @@</span> abstract class AbstractProcessTest extends \PHPUnit_Framework_TestCase
        }
        $duration = microtime(true) - $start;

        <span style="color:red;">$this-&gt;assertLessThan($timeout</span><span style="color:green;">if (defined('PHP_WINDOWS_VERSION_BUILD')) {</span>
<span style="color:green;">            // Windows is a bit slower as it read file handles, then allow twice the precision</span>
<span style="color:green;">            $maxDuration = $timeout</span> + <span style="color:red;">Process::TIMEOUT_PRECISION,</span><span style="color:green;">2 * Process::TIMEOUT_PRECISION;</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $maxDuration = $timeout + Process::TIMEOUT_PRECISION;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $this-&gt;assertLessThan($maxDuration,</span> $duration);
    }

    public function testCheckTimeoutOnNonStartedProcess()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Tests/ExecutableFinderTest.php b/src/Symfony/Component/Process/Tests/ExecutableFinderTest.php</span>
<span style="font-weight:bold;">index abaa47d8dd..5fbe1e0aa7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Tests/ExecutableFinderTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Tests/ExecutableFinderTest.php</span>
<span style="color:teal;">@@ -46,10 +46,10 @@</span> class ExecutableFinderTest extends \PHPUnit_Framework_TestCase

        $this-&gt;setPath(dirname(PHP_BINARY));

        $finder = new <span style="color:red;">ExecutableFinder;</span><span style="color:green;">ExecutableFinder();</span>
        $result = <span style="color:red;">$finder-&gt;find(basename(PHP_BINARY));</span><span style="color:green;">$finder-&gt;find($this-&gt;getPhpBinaryName());</span>

        <span style="color:red;">$this-&gt;assertEquals($result, PHP_BINARY);</span><span style="color:green;">$this-&gt;assertSamePath(PHP_BINARY, $result);</span>
    }

    public function testFindWithDefault()
<span style="color:teal;">@@ -62,7 +62,7 @@</span> class ExecutableFinderTest extends \PHPUnit_Framework_TestCase

        $this-&gt;setPath('');

        $finder = new <span style="color:red;">ExecutableFinder;</span><span style="color:green;">ExecutableFinder();</span>
        $result = $finder-&gt;find('foo', $expected);

        $this-&gt;assertEquals($expected, $result);
<span style="color:teal;">@@ -82,10 +82,10 @@</span> class ExecutableFinderTest extends \PHPUnit_Framework_TestCase

        $extraDirs = array(dirname(PHP_BINARY));

        $finder = new <span style="color:red;">ExecutableFinder;</span><span style="color:green;">ExecutableFinder();</span>
        $result = <span style="color:red;">$finder-&gt;find(basename(PHP_BINARY),</span><span style="color:green;">$finder-&gt;find($this-&gt;getPhpBinaryName(),</span> null, $extraDirs);

        <span style="color:red;">$this-&gt;assertEquals(PHP_BINARY,</span><span style="color:green;">$this-&gt;assertSamePath(PHP_BINARY,</span> $result);
    }

    public function testFindWithOpenBaseDir()
<span style="color:teal;">@@ -104,9 +104,44 @@</span> class ExecutableFinderTest extends \PHPUnit_Framework_TestCase

        ini_set('open_basedir', dirname(PHP_BINARY).PATH_SEPARATOR.'/');

        $finder = new <span style="color:red;">ExecutableFinder;</span><span style="color:green;">ExecutableFinder();</span>
        $result = <span style="color:red;">$finder-&gt;find(basename(PHP_BINARY));</span><span style="color:green;">$finder-&gt;find($this-&gt;getPhpBinaryName());</span>

        <span style="color:red;">$this-&gt;assertEquals(PHP_BINARY,</span><span style="color:green;">$this-&gt;assertSamePath(PHP_BINARY,</span> $result);
    <span style="color:green;">}</span>

<span style="color:green;">    public function testFindProcessInOpenBasedir()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (ini_get('open_basedir')) {</span>
<span style="color:green;">            $this-&gt;markTestSkipped('Cannot test when open_basedir is set');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (!defined('PHP_BINARY')) {</span>
<span style="color:green;">            $this-&gt;markTestSkipped('Requires the PHP_BINARY constant');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $execPath = __DIR__.'/SignalListener.php';</span>

<span style="color:green;">        $this-&gt;setPath('');</span>
<span style="color:green;">        ini_set('open_basedir', PHP_BINARY.PATH_SEPARATOR.'/');</span>

<span style="color:green;">        $finder = new ExecutableFinder();</span>
<span style="color:green;">        $result = $finder-&gt;find($this-&gt;getPhpBinaryName(), false);</span>

<span style="color:green;">        $this-&gt;assertSamePath(PHP_BINARY, $result);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function assertSamePath($expected, $tested)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (defined('PHP_WINDOWS_VERSION_BUILD')) {</span>
<span style="color:green;">            $this-&gt;assertEquals(strtolower($expected), strtolower($tested));</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $this-&gt;assertEquals($expected, $tested);</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function getPhpBinaryName()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return basename(PHP_BINARY, defined('PHP_WINDOWS_VERSION_BUILD') ? '.exe' : '');</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Tests/SigchildDisabledProcessTest.php b/src/Symfony/Component/Process/Tests/SigchildDisabledProcessTest.php</span>
<span style="font-weight:bold;">index 798e66a571..f0adb1faa4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Tests/SigchildDisabledProcessTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Tests/SigchildDisabledProcessTest.php</span>
<span style="color:teal;">@@ -51,7 +51,7 @@</span> class SigchildDisabledProcessTest extends AbstractProcessTest

    /**
     * @expectedException \Symfony\Component\Process\Exception\RuntimeException
     * @expectedExceptionMessage <span style="color:red;">his</span><span style="color:green;">This</span> PHP has been compiled with --enable-sigchild. Term signal can not be retrieved.
     */
    public function testProcessIsSignaledIfStopped()
    {
<span style="color:teal;">@@ -60,7 +60,7 @@</span> class SigchildDisabledProcessTest extends AbstractProcessTest

    /**
     * @expectedException \Symfony\Component\Process\Exception\RuntimeException
     * @expectedExceptionMessage <span style="color:red;">his</span><span style="color:green;">This</span> PHP has been compiled with --enable-sigchild. Term signal can not be retrieved.
     */
    public function testProcessWithTermSignal()
    {
<span style="color:teal;">@@ -69,7 +69,7 @@</span> class SigchildDisabledProcessTest extends AbstractProcessTest

    /**
     * @expectedException \Symfony\Component\Process\Exception\RuntimeException
     * @expectedExceptionMessage <span style="color:red;">his</span><span style="color:green;">This</span> PHP has been compiled with --enable-sigchild. Term signal can not be retrieved.
     */
    public function testProcessIsNotSignaled()
    {
<span style="color:teal;">@@ -78,7 +78,7 @@</span> class SigchildDisabledProcessTest extends AbstractProcessTest

    /**
     * @expectedException \Symfony\Component\Process\Exception\RuntimeException
     * @expectedExceptionMessage <span style="color:red;">his</span><span style="color:green;">This</span> PHP has been compiled with --enable-sigchild. Term signal can not be retrieved.
     */
    public function testProcessWithoutTermSignal()
    {
<span style="color:teal;">@@ -211,6 +211,11 @@</span> class SigchildDisabledProcessTest extends AbstractProcessTest
        $this-&gt;markTestSkipped('Signal is not supported in sigchild environment');
    }

    <span style="color:green;">public function testRunProcessWithTimeout()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;markTestSkipped('Signal (required for timeout) is not supported in sigchild environment');</span>
<span style="color:green;">    }</span>

    /**
     * {@inheritdoc}
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Tests/SigchildEnabledProcessTest.php b/src/Symfony/Component/Process/Tests/SigchildEnabledProcessTest.php</span>
<span style="font-weight:bold;">index 65dd4bb573..37a064188f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Tests/SigchildEnabledProcessTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Tests/SigchildEnabledProcessTest.php</span>
<span style="color:teal;">@@ -120,6 +120,21 @@</span> class SigchildEnabledProcessTest extends AbstractProcessTest
        parent::testStartAfterATimeout();
    }

    <span style="color:green;">public function testStopWithTimeoutIsActuallyWorking()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;markTestSkipped('Stopping with signal is not supported in sigchild environment');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testRunProcessWithTimeout()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;markTestSkipped('Signal (required for timeout) is not supported in sigchild environment');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testCheckTimeoutOnStartedProcess()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;markTestSkipped('Signal (required for timeout) is not supported in sigchild environment');</span>
<span style="color:green;">    }</span>

    /**
     * {@inheritdoc}
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Process/Tests/SimpleProcessTest.php b/src/Symfony/Component/Process/Tests/SimpleProcessTest.php</span>
<span style="font-weight:bold;">index 69ad3d5b09..ca4522acf1 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Process/Tests/SimpleProcessTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Process/Tests/SimpleProcessTest.php</span>
<span style="color:teal;">@@ -147,6 +147,57 @@</span> class SimpleProcessTest extends AbstractProcessTest
        parent::testSignalWithWrongNonIntSignal();
    }

    <span style="color:green;">public function testStopTerminatesProcessCleanly()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        try {</span>
<span style="color:green;">            $process = $this-&gt;getProcess('php -r &quot;echo \'foo\'; sleep(1); echo \'bar\';&quot;');</span>
<span style="color:green;">            $process-&gt;run(function () use ($process) {</span>
<span style="color:green;">                $process-&gt;stop();</span>
<span style="color:green;">            });</span>
<span style="color:green;">        } catch (RuntimeException $e) {</span>
<span style="color:green;">            $this-&gt;fail('A call to stop() is not expected to cause wait() to throw a RuntimeException');</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testKillSignalTerminatesProcessCleanly()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;expectExceptionIfPHPSigchild('Symfony\Component\Process\Exception\RuntimeException', 'This PHP has been compiled with --enable-sigchild. The process can not be signaled.');</span>

<span style="color:green;">        try {</span>
<span style="color:green;">            $process = $this-&gt;getProcess('php -r &quot;echo \'foo\'; sleep(1); echo \'bar\';&quot;');</span>
<span style="color:green;">            $process-&gt;run(function () use ($process) {</span>
<span style="color:green;">                if ($process-&gt;isRunning()) {</span>
<span style="color:green;">                    $process-&gt;signal(defined('SIGKILL') ? SIGKILL : 9);</span>
<span style="color:green;">                }</span>
<span style="color:green;">            });</span>
<span style="color:green;">        } catch (RuntimeException $e) {</span>
<span style="color:green;">            $this-&gt;fail('A call to signal() is not expected to cause wait() to throw a RuntimeException');</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testTermSignalTerminatesProcessCleanly()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;expectExceptionIfPHPSigchild('Symfony\Component\Process\Exception\RuntimeException', 'This PHP has been compiled with --enable-sigchild. The process can not be signaled.');</span>

<span style="color:green;">        try {</span>
<span style="color:green;">            $process = $this-&gt;getProcess('php -r &quot;echo \'foo\'; sleep(1); echo \'bar\';&quot;');</span>
<span style="color:green;">            $process-&gt;run(function () use ($process) {</span>
<span style="color:green;">                if ($process-&gt;isRunning()) {</span>
<span style="color:green;">                    $process-&gt;signal(defined('SIGTERM') ? SIGTERM : 15);</span>
<span style="color:green;">                }</span>
<span style="color:green;">            });</span>
<span style="color:green;">        } catch (RuntimeException $e) {</span>
<span style="color:green;">            $this-&gt;fail('A call to signal() is not expected to cause wait() to throw a RuntimeException');</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testStopWithTimeoutIsActuallyWorking()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;skipIfPHPSigchild();</span>

<span style="color:green;">        parent::testStopWithTimeoutIsActuallyWorking();</span>
<span style="color:green;">    }</span>

    /**
     * {@inheritdoc}
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/PropertyAccess/.gitattributes b/src/Symfony/Component/PropertyAccess/.gitattributes</span>
<span style="font-weight:bold;">deleted file mode 100644</span>
<span style="font-weight:bold;">index 80481513cf..0000000000</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/PropertyAccess/.gitattributes</span>
<span style="font-weight:bold;">+++ /dev/null</span>
<span style="color:teal;">@@ -1,2 +0,0 @@</span>
<span style="color:red;">/Tests export-ignore</span>
<span style="color:red;">phpunit.xml.dist export-ignore</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/PropertyAccess/StringUtil.php b/src/Symfony/Component/PropertyAccess/StringUtil.php</span>
<span style="font-weight:bold;">index 50a8eb4092..dd9ee3496c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/PropertyAccess/StringUtil.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/PropertyAccess/StringUtil.php</span>
<span style="color:teal;">@@ -75,6 +75,9 @@</span> class StringUtil
        // objectives (objective), alternative (alternatives)
        array('sevit', 5, true, true, 'tive'),

        <span style="color:green;">// drives (drive)</span>
<span style="color:green;">        array('sevird', 6, false, true, 'drive'),</span>

        // lives (life), wives (wife)
        array('sevi', 4, false, true, 'ife'),

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/PropertyAccess/Tests/PropertyAccessorCollectionTest.php b/src/Symfony/Component/PropertyAccess/Tests/PropertyAccessorCollectionTest.php</span>
<span style="font-weight:bold;">index a80d73f180..9033718acd 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/PropertyAccess/Tests/PropertyAccessorCollectionTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/PropertyAccess/Tests/PropertyAccessorCollectionTest.php</span>
<span style="color:teal;">@@ -12,7 +12,6 @@</span>
namespace Symfony\Component\PropertyAccess\Tests;

use Symfony\Component\PropertyAccess\PropertyAccessor;
<span style="color:red;">use Symfony\Component\PropertyAccess\StringUtil;</span>

class PropertyAccessorCollectionTest_Car
{
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/PropertyAccess/Tests/StringUtilTest.php b/src/Symfony/Component/PropertyAccess/Tests/StringUtilTest.php</span>
<span style="font-weight:bold;">index 92df8f1f73..1aff522981 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/PropertyAccess/Tests/StringUtilTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/PropertyAccess/Tests/StringUtilTest.php</span>
<span style="color:teal;">@@ -20,114 +20,127 @@</span> class StringUtilTest extends \PHPUnit_Framework_TestCase
        // see http://english-zone.com/spelling/plurals.html
        // see http://www.scribd.com/doc/3271143/List-of-100-Irregular-Plural-Nouns-in-English
        return array(
            <span style="color:red;">array('tags', 'tag'),</span><span style="color:green;">array('accesses', 'access'),</span>
<span style="color:green;">            array('addresses', 'address'),</span>
<span style="color:green;">            array('agendas', 'agenda'),</span>
<span style="color:green;">            array('alumnae', 'alumna'),</span>
            array('alumni', 'alumnus'),
<span style="color:red;">            array('funguses', array('fungus', 'funguse', 'fungusis')),</span>
<span style="color:red;">            array('fungi', 'fungus'),</span>
<span style="color:red;">            array('axes', array('ax', 'axe', 'axis')),</span>
<span style="color:red;">            array('appendices', array('appendex', 'appendix', 'appendice')),</span>
<span style="color:red;">            array('indices', array('index', 'indix', 'indice')),</span>
<span style="color:red;">            array('prices', array('prex', 'prix', 'price')),</span>
<span style="color:red;">            array('indexes', 'index'),</span>
<span style="color:red;">            array('children', 'child'),</span>
<span style="color:red;">            array('men', 'man'),</span>
<span style="color:red;">            array('women', 'woman'),</span>
<span style="color:red;">            array('oxen', 'ox'),</span>
<span style="color:red;">            array('bacteria', array('bacterion', 'bacterium')),</span>
<span style="color:red;">            array('criteria', array('criterion', 'criterium')),</span>
<span style="color:red;">            array('feet', 'foot'),</span>
<span style="color:red;">            array('nebulae', 'nebula'),</span>
<span style="color:red;">            array('babies', 'baby'),</span>
<span style="color:red;">            array('hooves', array('hoof', 'hoove', 'hooff')),</span>
<span style="color:red;">            array('chateaux', 'chateau'),</span>
<span style="color:red;">            array('echoes', array('echo', 'echoe')),</span>
            array('analyses', array('analys', 'analyse', 'analysis')),
<span style="color:red;">            array('theses', array('thes', 'these', 'thesis')),</span>
<span style="color:red;">            array('foci', 'focus'),</span>
<span style="color:red;">            array('focuses', array('focus', 'focuse', 'focusis')),</span>
<span style="color:red;">            array('oases', array('oas', 'oase', 'oasis')),</span>
<span style="color:red;">            array('matrices', array('matrex', 'matrix', 'matrice')),</span>
<span style="color:red;">            array('matrixes', 'matrix'),</span>
<span style="color:red;">            array('bureaus', 'bureau'),</span>
<span style="color:red;">            array('bureaux', 'bureau'),</span>
<span style="color:red;">            array('beaux', 'beau'),</span>
<span style="color:red;">            array('data', array('daton', 'datum')),</span>
<span style="color:red;">            array('phenomena', array('phenomenon', 'phenomenum')),</span>
<span style="color:red;">            array('strata', array('straton', 'stratum')),</span>
<span style="color:red;">            array('geese', 'goose'),</span>
<span style="color:red;">            array('teeth', 'tooth'),</span>
            array('antennae', 'antenna'),
            array('antennas', 'antenna'),
            <span style="color:red;">array('houses', array('hous', 'house', 'housis')),</span><span style="color:green;">array('appendices', array('appendex', 'appendix', 'appendice')),</span>
            array('arches', array('arch', 'arche')),
            array('atlases', array('atlas', 'atlase', 'atlasis')),
            <span style="color:green;">array('axes', array('ax', 'axe', 'axis')),</span>
<span style="color:green;">            array('babies', 'baby'),</span>
<span style="color:green;">            array('bacteria', array('bacterion', 'bacterium')),</span>
<span style="color:green;">            array('bases', array('bas', 'base', 'basis')),</span>
            array('batches', array('batch', 'batche')),
            <span style="color:red;">array('bushes', array('bush', 'bushe')),</span><span style="color:green;">array('beaux', 'beau'),</span>
<span style="color:green;">            array('bees', array('be', 'bee')),</span>
<span style="color:green;">            array('boxes', 'box'),</span>
<span style="color:green;">            array('boys', 'boy'),</span>
<span style="color:green;">            array('bureaus', 'bureau'),</span>
<span style="color:green;">            array('bureaux', 'bureau'),</span>
            array('buses', array('bus', 'buse', 'busis')),
            <span style="color:green;">array('bushes', array('bush', 'bushe')),</span>
            array('calves', array('calf', 'calve', 'calff')),
            <span style="color:green;">array('cars', 'car'),</span>
<span style="color:green;">            array('cassettes', array('cassett', 'cassette')),</span>
<span style="color:green;">            array('caves', array('caf', 'cave', 'caff')),</span>
<span style="color:green;">            array('chateaux', 'chateau'),</span>
<span style="color:green;">            array('cheeses', array('chees', 'cheese', 'cheesis')),</span>
<span style="color:green;">            array('children', 'child'),</span>
            array('circuses', array('circus', 'circuse', 'circusis')),
            <span style="color:green;">array('cliffs', 'cliff'),</span>
            array('crises', array('cris', 'crise', 'crisis')),
            <span style="color:green;">array('criteria', array('criterion', 'criterium')),</span>
<span style="color:green;">            array('cups', 'cup'),</span>
<span style="color:green;">            array('data', array('daton', 'datum')),</span>
<span style="color:green;">            array('days', 'day'),</span>
<span style="color:green;">            array('discos', 'disco'),</span>
<span style="color:green;">            array('drives', 'drive'),</span>
<span style="color:green;">            array('drivers', 'driver'),</span>
            array('dwarves', array('dwarf', 'dwarve', 'dwarff')),
            <span style="color:green;">array('echoes', array('echo', 'echoe')),</span>
            array('elves', array('elf', 'elve', 'elff')),
            array('emphases', array('emphas', 'emphase', 'emphasis')),
            array('faxes', 'fax'),
            <span style="color:green;">array('feet', 'foot'),</span>
<span style="color:green;">            array('foci', 'focus'),</span>
<span style="color:green;">            array('focuses', array('focus', 'focuse', 'focusis')),</span>
<span style="color:green;">            array('formulae', 'formula'),</span>
<span style="color:green;">            array('formulas', 'formula'),</span>
<span style="color:green;">            array('fungi', 'fungus'),</span>
<span style="color:green;">            array('funguses', array('fungus', 'funguse', 'fungusis')),</span>
<span style="color:green;">            array('garages', array('garag', 'garage')),</span>
<span style="color:green;">            array('geese', 'goose'),</span>
            array('halves', array('half', 'halve', 'halff')),
            <span style="color:green;">array('hats', 'hat'),</span>
            array('heroes', array('hero', 'heroe')),
            <span style="color:green;">array('hippopotamuses', array('hippopotamus', 'hippopotamuse', 'hippopotamusis')), //hippopotami</span>
            array('hoaxes', 'hoax'),
            <span style="color:green;">array('hooves', array('hoof', 'hoove', 'hooff')),</span>
<span style="color:green;">            array('houses', array('hous', 'house', 'housis')),</span>
<span style="color:green;">            array('indexes', 'index'),</span>
<span style="color:green;">            array('indices', array('index', 'indix', 'indice')),</span>
<span style="color:green;">            array('ions', 'ion'),</span>
            array('irises', array('iris', 'irise', 'irisis')),
            array('kisses', 'kiss'),
<span style="color:red;">            array('addresses', 'address'),</span>
<span style="color:red;">            array('accesses', 'access'),</span>
            array('knives', 'knife'),
            <span style="color:red;">array('lives', 'life'),</span><span style="color:green;">array('lamps', 'lamp'),</span>
<span style="color:green;">            array('leaves', array('leaf', 'leave', 'leaff')),</span>
            array('lice', 'louse'),
            <span style="color:green;">array('lives', 'life'),</span>
<span style="color:green;">            array('matrices', array('matrex', 'matrix', 'matrice')),</span>
<span style="color:green;">            array('matrixes', 'matrix'),</span>
<span style="color:green;">            array('men', 'man'),</span>
            array('mice', 'mouse'),
            <span style="color:green;">array('moves', 'move'),</span>
<span style="color:green;">            array('nebulae', 'nebula'),</span>
            array('neuroses', array('neuros', 'neurose', 'neurosis')),
            <span style="color:green;">array('oases', array('oas', 'oase', 'oasis')),</span>
<span style="color:green;">            array('objectives', 'objective'),</span>
<span style="color:green;">            array('oxen', 'ox'),</span>
<span style="color:green;">            array('parties', 'party'),</span>
<span style="color:green;">            array('phenomena', array('phenomenon', 'phenomenum')),</span>
<span style="color:green;">            array('photos', 'photo'),</span>
<span style="color:green;">            array('pianos', 'piano'),</span>
            array('plateaux', 'plateau'),
            array('poppies', 'poppy'),
            <span style="color:green;">array('prices', array('prex', 'prix', 'price')),</span>
            array('quizzes', 'quiz'),
            <span style="color:green;">array('radii', 'radius'),</span>
<span style="color:green;">            array('roofs', 'roof'),</span>
<span style="color:green;">            array('roses', array('ros', 'rose', 'rosis')),</span>
<span style="color:green;">            array('sandwiches', array('sandwich', 'sandwiche')),</span>
            array('scarves', array('scarf', 'scarve', 'scarff')),
            <span style="color:green;">array('schemas', 'schema'), //schemata</span>
<span style="color:green;">            array('sheriffs', 'sheriff'),</span>
<span style="color:green;">            array('shoes', array('sho', 'shoe')),</span>
            array('spies', 'spy'),
            <span style="color:green;">array('staves', array('staf', 'stave', 'staff')),</span>
            array('stories', 'story'),
            <span style="color:green;">array('strata', array('straton', 'stratum')),</span>
<span style="color:green;">            array('suitcases', array('suitcas', 'suitcase', 'suitcasis')),</span>
            array('syllabi', 'syllabus'),
            <span style="color:green;">array('tags', 'tag'),</span>
<span style="color:green;">            array('teeth', 'tooth'),</span>
<span style="color:green;">            array('theses', array('thes', 'these', 'thesis')),</span>
            array('thieves', array('thief', 'thieve', 'thieff')),
            <span style="color:green;">array('trees', array('tre', 'tree')),</span>
            array('waltzes', array('waltz', 'waltze')),
<span style="color:red;">            array('wharves', array('wharf', 'wharve', 'wharff')),</span>
<span style="color:red;">            array('caves', array('caf', 'cave', 'caff')),</span>
<span style="color:red;">            array('staves', array('staf', 'stave', 'staff')),</span>
            array('wives', 'wife'),
<span style="color:red;">            array('ions', 'ion'),</span>
<span style="color:red;">            array('bases', array('bas', 'base', 'basis')),</span>
<span style="color:red;">            array('cars', 'car'),</span>
<span style="color:red;">            array('cassettes', array('cassett', 'cassette')),</span>
<span style="color:red;">            array('lamps', 'lamp'),</span>
<span style="color:red;">            array('hats', 'hat'),</span>
<span style="color:red;">            array('cups', 'cup'),</span>
<span style="color:red;">            array('boxes', 'box'),</span>
<span style="color:red;">            array('sandwiches', array('sandwich', 'sandwiche')),</span>
<span style="color:red;">            array('suitcases', array('suitcas', 'suitcase', 'suitcasis')),</span>
<span style="color:red;">            array('roses', array('ros', 'rose', 'rosis')),</span>
<span style="color:red;">            array('garages', array('garag', 'garage')),</span>
<span style="color:red;">            array('shoes', array('sho', 'shoe')),</span>
<span style="color:red;">            array('days', 'day'),</span>
<span style="color:red;">            array('boys', 'boy'),</span>
<span style="color:red;">            array('roofs', 'roof'),</span>
<span style="color:red;">            array('cliffs', 'cliff'),</span>
<span style="color:red;">            array('sheriffs', 'sheriff'),</span>
<span style="color:red;">            array('discos', 'disco'),</span>
<span style="color:red;">            array('pianos', 'piano'),</span>
<span style="color:red;">            array('photos', 'photo'),</span>
<span style="color:red;">            array('trees', array('tre', 'tree')),</span>
<span style="color:red;">            array('bees', array('be', 'bee')),</span>
<span style="color:red;">            array('cheeses', array('chees', 'cheese', 'cheesis')),</span>
<span style="color:red;">            array('radii', 'radius'),</span>
<span style="color:red;">            array('objectives', 'objective'),</span>
<span style="color:red;">            array('moves', 'move'),</span>

            // test casing: if the first letter was uppercase, it should remain so
            array('Men', 'Man'),
            array('GrandChildren', 'GrandChild'),
            array('SubTrees', array('SubTre', 'SubTree')),

            <span style="color:green;">// Known issues</span>
<span style="color:green;">            //array('insignia', 'insigne'),</span>
<span style="color:green;">            //array('insignias', 'insigne'),</span>
<span style="color:green;">            //array('rattles', 'rattle'),</span>
        );
    }

<span style="color:teal;">@@ -136,6 +149,13 @@</span> class StringUtilTest extends \PHPUnit_Framework_TestCase
     */
    public function testSingularify($plural, $singular)
    {
        <span style="color:green;">$single = StringUtil::singularify($plural);</span>
<span style="color:green;">        if (is_string($singular) &amp;&amp; is_array($single)) {</span>
<span style="color:green;">            $this-&gt;fail(&quot;--- Expected\n`string`: &quot; . $singular . &quot;\n+++ Actual\n`array`: &quot; . implode(', ', $single));</span>
<span style="color:green;">        } elseif (is_array($singular) &amp;&amp; is_string($single)) {</span>
<span style="color:green;">            $this-&gt;fail(&quot;--- Expected\n`array`: &quot; . implode(', ', $singular) . &quot;\n+++ Actual\n`string`: &quot; . $single);</span>
<span style="color:green;">        }</span>

        $this-&gt;assertEquals($singular, <span style="color:red;">StringUtil::singularify($plural));</span><span style="color:green;">$single);</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Routing/Loader/XmlFileLoader.php b/src/Symfony/Component/Routing/Loader/XmlFileLoader.php</span>
<span style="font-weight:bold;">index 5838b8d341..8a95f51286 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Routing/Loader/XmlFileLoader.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Routing/Loader/XmlFileLoader.php</span>
<span style="color:teal;">@@ -219,7 +219,7 @@</span> class XmlFileLoader extends FileLoader
        foreach ($node-&gt;getElementsByTagNameNS(self::NAMESPACE_URI, '*') as $n) {
            switch ($n-&gt;localName) {
                case 'default':
                    if <span style="color:red;">($n-&gt;hasAttribute('xsi:nil') &amp;&amp; 'true' == $n-&gt;getAttribute('xsi:nil'))</span><span style="color:green;">($this-&gt;isElementValueNull($n))</span> {
                        $defaults[$n-&gt;getAttribute('key')] = null;
                    } else {
                        $defaults[$n-&gt;getAttribute('key')] = trim($n-&gt;textContent);
<span style="color:teal;">@@ -242,4 +242,15 @@</span> class XmlFileLoader extends FileLoader

        return array($defaults, $requirements, $options, $condition);
    }

    <span style="color:green;">private function isElementValueNull(\DOMElement $element)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $namespaceUri = 'http://www.w3.org/2001/XMLSchema-instance';</span>

<span style="color:green;">        if (!$element-&gt;hasAttributeNS($namespaceUri, 'nil')) {</span>
<span style="color:green;">            return false;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return 'true' === $element-&gt;getAttributeNS($namespaceUri, 'nil') || '1' === $element-&gt;getAttributeNS($namespaceUri, 'nil');</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Routing/Loader/schema/routing/routing-1.0.xsd b/src/Symfony/Component/Routing/Loader/schema/routing/routing-1.0.xsd</span>
<span style="font-weight:bold;">index 9ab969a41d..d40aa42212 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Routing/Loader/schema/routing/routing-1.0.xsd</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Routing/Loader/schema/routing/routing-1.0.xsd</span>
<span style="color:teal;">@@ -29,7 +29,7 @@</span>
      &lt;xsd:element name=&quot;default&quot; nillable=&quot;true&quot; type=&quot;element&quot; /&gt;
      &lt;xsd:element name=&quot;requirement&quot; type=&quot;element&quot; /&gt;
      &lt;xsd:element name=&quot;option&quot; type=&quot;element&quot; /&gt;
      &lt;xsd:element name=&quot;condition&quot; <span style="color:red;">type=&quot;condition&quot;</span><span style="color:green;">type=&quot;xsd:string&quot;</span> /&gt;
    &lt;/xsd:choice&gt;
  &lt;/xsd:group&gt;

<span style="color:teal;">@@ -62,9 +62,4 @@</span>
      &lt;/xsd:extension&gt;
    &lt;/xsd:simpleContent&gt;
  &lt;/xsd:complexType&gt;

<span style="color:red;">  &lt;xsd:simpleType name=&quot;condition&quot;&gt;</span>
<span style="color:red;">    &lt;xsd:restriction base=&quot;xsd:string&quot;&gt;</span>
<span style="color:red;">    &lt;/xsd:restriction&gt;</span>
<span style="color:red;">  &lt;/xsd:simpleType&gt;</span>
&lt;/xsd:schema&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Routing/Tests/Fixtures/null_values.xml b/src/Symfony/Component/Routing/Tests/Fixtures/null_values.xml</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..f9e2aa24df</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Routing/Tests/Fixtures/null_values.xml</span>
<span style="color:teal;">@@ -0,0 +1,12 @@</span>
<span style="color:green;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span style="color:green;">&lt;routes xmlns=&quot;http://symfony.com/schema/routing&quot;</span>
<span style="color:green;">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span style="color:green;">    xsi:schemaLocation=&quot;http://symfony.com/schema/routing http://symfony.com/schema/routing/routing-1.0.xsd&quot;&gt;</span>

<span style="color:green;">    &lt;route id=&quot;blog_show&quot; path=&quot;/blog/{slug}&quot;&gt;</span>
<span style="color:green;">        &lt;default key=&quot;foo&quot; xsi:nil=&quot;true&quot; /&gt;</span>
<span style="color:green;">        &lt;default key=&quot;bar&quot; xsi:nil=&quot;1&quot; /&gt;</span>
<span style="color:green;">        &lt;default key=&quot;foobar&quot; xsi:nil=&quot;false&quot;&gt;foo&lt;/default&gt;</span>
<span style="color:green;">        &lt;default key=&quot;baz&quot; xsi:nil=&quot;0&quot;&gt;bar&lt;/default&gt;</span>
<span style="color:green;">    &lt;/route&gt;</span>
<span style="color:green;">&lt;/routes&gt;</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Routing/Tests/Generator/Dumper/PhpGeneratorDumperTest.php b/src/Symfony/Component/Routing/Tests/Generator/Dumper/PhpGeneratorDumperTest.php</span>
<span style="font-weight:bold;">index ab5f4cdae0..376cc5b560 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Routing/Tests/Generator/Dumper/PhpGeneratorDumperTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Routing/Tests/Generator/Dumper/PhpGeneratorDumperTest.php</span>
<span style="color:teal;">@@ -60,7 +60,7 @@</span> class PhpGeneratorDumperTest extends \PHPUnit_Framework_TestCase
        $this-&gt;routeCollection-&gt;add('Test2', new Route('/testing2'));

        file_put_contents($this-&gt;testTmpFilepath, $this-&gt;generatorDumper-&gt;dump());
        include <span style="color:red;">($this-&gt;testTmpFilepath);</span><span style="color:green;">$this-&gt;testTmpFilepath;</span>

        $projectUrlGenerator = new \ProjectUrlGenerator(new RequestContext('/app.php'));

<span style="color:teal;">@@ -81,7 +81,7 @@</span> class PhpGeneratorDumperTest extends \PHPUnit_Framework_TestCase
    public function testDumpWithoutRoutes()
    {
        file_put_contents($this-&gt;testTmpFilepath, $this-&gt;generatorDumper-&gt;dump(array('class' =&gt; 'WithoutRoutesUrlGenerator')));
        include <span style="color:red;">($this-&gt;testTmpFilepath);</span><span style="color:green;">$this-&gt;testTmpFilepath;</span>

        $projectUrlGenerator = new \WithoutRoutesUrlGenerator(new RequestContext('/app.php'));

<span style="color:teal;">@@ -96,7 +96,7 @@</span> class PhpGeneratorDumperTest extends \PHPUnit_Framework_TestCase
        $this-&gt;routeCollection-&gt;add('Test', new Route('/test'));

        file_put_contents($this-&gt;testTmpFilepath, $this-&gt;generatorDumper-&gt;dump(array('class' =&gt; 'NonExistingRoutesUrlGenerator')));
        include <span style="color:red;">($this-&gt;testTmpFilepath);</span><span style="color:green;">$this-&gt;testTmpFilepath;</span>

        $projectUrlGenerator = new \NonExistingRoutesUrlGenerator(new RequestContext());
        $url = $projectUrlGenerator-&gt;generate('NonExisting', array());
<span style="color:teal;">@@ -107,7 +107,7 @@</span> class PhpGeneratorDumperTest extends \PHPUnit_Framework_TestCase
        $this-&gt;routeCollection-&gt;add('Test', new Route('/testing/{foo}', array('foo' =&gt; 'bar')));

        file_put_contents($this-&gt;testTmpFilepath, $this-&gt;generatorDumper-&gt;dump(array('class' =&gt; 'DefaultRoutesUrlGenerator')));
        include <span style="color:red;">($this-&gt;testTmpFilepath);</span><span style="color:green;">$this-&gt;testTmpFilepath;</span>

        $projectUrlGenerator = new \DefaultRoutesUrlGenerator(new RequestContext());
        $url = $projectUrlGenerator-&gt;generate('Test', array());
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Routing/Tests/Loader/XmlFileLoaderTest.php b/src/Symfony/Component/Routing/Tests/Loader/XmlFileLoaderTest.php</span>
<span style="font-weight:bold;">index f83b9ecba8..e6f0afd3ff 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Routing/Tests/Loader/XmlFileLoaderTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Routing/Tests/Loader/XmlFileLoaderTest.php</span>
<span style="color:teal;">@@ -121,4 +121,18 @@</span> class XmlFileLoaderTest extends \PHPUnit_Framework_TestCase
        $loader = new XmlFileLoader(new FileLocator(array(__DIR__.'/../Fixtures')));
        $loader-&gt;load('withdoctype.xml');
    }

    <span style="color:green;">public function testNullValues()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $loader = new XmlFileLoader(new FileLocator(array(__DIR__.'/../Fixtures')));</span>
<span style="color:green;">        $routeCollection = $loader-&gt;load('null_values.xml');</span>
<span style="color:green;">        $route = $routeCollection-&gt;get('blog_show');</span>

<span style="color:green;">        $this-&gt;assertTrue($route-&gt;hasDefault('foo'));</span>
<span style="color:green;">        $this-&gt;assertNull($route-&gt;getDefault('foo'));</span>
<span style="color:green;">        $this-&gt;assertTrue($route-&gt;hasDefault('bar'));</span>
<span style="color:green;">        $this-&gt;assertNull($route-&gt;getDefault('bar'));</span>
<span style="color:green;">        $this-&gt;assertEquals('foo', $route-&gt;getDefault('foobar'));</span>
<span style="color:green;">        $this-&gt;assertEquals('bar', $route-&gt;getDefault('baz'));</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Acl/Dbal/MutableAclProvider.php b/src/Symfony/Component/Security/Acl/Dbal/MutableAclProvider.php</span>
<span style="font-weight:bold;">index 42803acc07..b8f5fb8e20 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Acl/Dbal/MutableAclProvider.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Acl/Dbal/MutableAclProvider.php</span>
<span style="color:teal;">@@ -801,12 +801,12 @@</span> QUERY;
    }

    /**
     * This <span style="color:red;">process</span><span style="color:green;">processes</span> old entries changes on an ACE related property (classFieldAces, or objectFieldAces).
     *
     * @param string $name
     * @param array  $changes
     */
    private function <span style="color:red;">updateOldFieldAceProperty($ane,</span><span style="color:green;">updateOldFieldAceProperty($name,</span> array $changes)
    {
        $currentIds = array();
        foreach ($changes[1] as $field =&gt; $new) {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Core/Authorization/Voter/VoterInterface.php b/src/Symfony/Component/Security/Core/Authorization/Voter/VoterInterface.php</span>
<span style="font-weight:bold;">index abc18b438b..79fa69f8a9 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Core/Authorization/Voter/VoterInterface.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Core/Authorization/Voter/VoterInterface.php</span>
<span style="color:teal;">@@ -49,7 +49,7 @@</span> interface VoterInterface
     * ACCESS_GRANTED, ACCESS_DENIED, or ACCESS_ABSTAIN.
     *
     * @param TokenInterface $token      A TokenInterface instance
     * @param <span style="color:red;">object</span><span style="color:green;">object|null</span>    $object     The object to secure
     * @param array          $attributes An array of attributes associated with the method being invoked
     *
     * @return int     either ACCESS_GRANTED, ACCESS_ABSTAIN, or ACCESS_DENIED
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Core/Encoder/BCryptPasswordEncoder.php b/src/Symfony/Component/Security/Core/Encoder/BCryptPasswordEncoder.php</span>
<span style="font-weight:bold;">index 1dcf3a6969..27a7334569 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Core/Encoder/BCryptPasswordEncoder.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Core/Encoder/BCryptPasswordEncoder.php</span>
<span style="color:teal;">@@ -61,6 +61,8 @@</span> class BCryptPasswordEncoder extends BasePasswordEncoder
     *
     * @return string The encoded password
     *
     <span style="color:green;">* @throws BadCredentialsException when the given password is too long</span>
<span style="color:green;">     *</span>
     * @link http://lxr.php.net/xref/PHP_5_5/ext/standard/password.c#111
     */
    public function encodePassword($raw, $salt)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Core/Encoder/BasePasswordEncoder.php b/src/Symfony/Component/Security/Core/Encoder/BasePasswordEncoder.php</span>
<span style="font-weight:bold;">index b27c2b0b95..5bf223bdbd 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Core/Encoder/BasePasswordEncoder.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Core/Encoder/BasePasswordEncoder.php</span>
<span style="color:teal;">@@ -89,6 +89,8 @@</span> abstract class BasePasswordEncoder implements PasswordEncoderInterface
    /**
     * Checks if the password is too long.
     *
     <span style="color:green;">* @param string $password The password to check</span>
<span style="color:green;">     *</span>
     * @return bool    true if the password is too long, false otherwise
     */
    protected function isPasswordTooLong($password)
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Core/Tests/Validator/Constraints/UserPasswordValidatorTest.php b/src/Symfony/Component/Security/Core/Tests/Validator/Constraints/UserPasswordValidatorTest.php</span>
<span style="font-weight:bold;">index 53eeb5fed7..8b3eb53a2c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Core/Tests/Validator/Constraints/UserPasswordValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Core/Tests/Validator/Constraints/UserPasswordValidatorTest.php</span>
<span style="color:teal;">@@ -11,77 +11,96 @@</span>

namespace Symfony\Component\Security\Core\Tests\Validator\Constraints;

<span style="color:green;">use Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface;</span>
<span style="color:green;">use Symfony\Component\Security\Core\Encoder\PasswordEncoderInterface;</span>
<span style="color:green;">use Symfony\Component\Security\Core\SecurityContextInterface;</span>
use Symfony\Component\Security\Core\Validator\Constraints\UserPassword;
use Symfony\Component\Security\Core\Validator\Constraints\UserPasswordValidator;
<span style="color:green;">use Symfony\Component\Validator\Tests\Constraints\AbstractConstraintValidatorTest;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
<span style="color:green;"> */</span>
class UserPasswordValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    const <span style="color:red;">PASSWORD_VALID</span><span style="color:green;">PASSWORD</span> = <span style="color:red;">true;</span>
<span style="color:red;">    const PASSWORD_INVALID = false;</span><span style="color:green;">'s3Cr3t';</span>

    <span style="color:red;">protected $context;</span><span style="color:green;">const SALT = '^S4lt$';</span>

    <span style="color:green;">/**</span>
<span style="color:green;">     * @var SecurityContextInterface</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $securityContext;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var PasswordEncoderInterface</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $encoder;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var EncoderFactoryInterface</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $encoderFactory;</span>

    protected function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span><span style="color:green;">return new UserPasswordValidator($this-&gt;securityContext, $this-&gt;encoderFactory);</span>
    }

    protected function <span style="color:red;">tearDown()</span><span style="color:green;">setUp()</span>
    {
        <span style="color:red;">$this-&gt;context</span><span style="color:green;">$user</span> = <span style="color:red;">null;</span><span style="color:green;">$this-&gt;createUser();</span>
<span style="color:green;">        $this-&gt;securityContext = $this-&gt;createSecurityContext($user);</span>
<span style="color:green;">        $this-&gt;encoder = $this-&gt;createPasswordEncoder();</span>
<span style="color:green;">        $this-&gt;encoderFactory = $this-&gt;createEncoderFactory($this-&gt;encoder);</span>

<span style="color:green;">        parent::setUp();</span>
    }

    public function testPasswordIsValid()
    {
        <span style="color:red;">$user</span><span style="color:green;">$constraint</span> = <span style="color:red;">$this-&gt;createUser();</span>
<span style="color:red;">        $securityContext = $this-&gt;createSecurityContext($user);</span><span style="color:green;">new UserPassword(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        <span style="color:red;">$encoder = $this-&gt;createPasswordEncoder(static::PASSWORD_VALID);</span>
<span style="color:red;">        $encoderFactory = $this-&gt;createEncoderFactory($encoder);</span>

<span style="color:red;">        $validator = new UserPasswordValidator($securityContext, $encoderFactory);</span>
<span style="color:red;">        $validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">$this-&gt;encoder-&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('isPasswordValid')</span>
<span style="color:green;">            -&gt;with(static::PASSWORD, 'secret', static::SALT)</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(true));</span>

        <span style="color:red;">$this</span>
<span style="color:red;">            -&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">        ;</span><span style="color:green;">$this-&gt;validator-&gt;validate('secret', $constraint);</span>

        <span style="color:red;">$validator-&gt;validate('secret', new UserPassword());</span><span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testPasswordIsNotValid()
    {
        <span style="color:red;">$user = $this-&gt;createUser();</span>
<span style="color:red;">        $securityContext = $this-&gt;createSecurityContext($user);</span>

<span style="color:red;">        $encoder = $this-&gt;createPasswordEncoder(static::PASSWORD_INVALID);</span>
<span style="color:red;">        $encoderFactory = $this-&gt;createEncoderFactory($encoder);</span><span style="color:green;">$constraint = new UserPassword(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        <span style="color:red;">$validator = new UserPasswordValidator($securityContext, $encoderFactory);</span>
<span style="color:red;">        $validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">$this-&gt;encoder-&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('isPasswordValid')</span>
<span style="color:green;">            -&gt;with(static::PASSWORD, 'secret', static::SALT)</span>
<span style="color:green;">            -&gt;will($this-&gt;returnValue(false));</span>

        <span style="color:red;">$this</span>
<span style="color:red;">            -&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">        ;</span><span style="color:green;">$this-&gt;validator-&gt;validate('secret', $constraint);</span>

        <span style="color:red;">$validator-&gt;validate('secret', new UserPassword());</span><span style="color:green;">$this-&gt;assertViolation('myMessage');</span>
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @expectedException \Symfony\Component\Validator\Exception\ConstraintDefinitionException</span>
<span style="color:green;">     */</span>
    public function testUserIsNotValid()
    {
<span style="color:red;">        $this-&gt;setExpectedException('Symfony\Component\Validator\Exception\ConstraintDefinitionException');</span>

        $user = $this-&gt;getMock('Foo\Bar\User');
<span style="color:red;">        $encoderFactory = $this-&gt;getMock('Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface');</span>
<span style="color:red;">        $securityContext = $this-&gt;createSecurityContext($user);</span>

        <span style="color:red;">$validator</span><span style="color:green;">$this-&gt;securityContext</span> = <span style="color:red;">new UserPasswordValidator($securityContext, $encoderFactory);</span>
<span style="color:red;">        $validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">        $validator-&gt;validate('secret',</span><span style="color:green;">$this-&gt;createSecurityContext($user);</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate('secret',</span> new UserPassword());
    }

    protected function createUser()
<span style="color:teal;">@@ -89,15 +108,15 @@</span> class UserPasswordValidatorTest extends \PHPUnit_Framework_TestCase
        $mock = $this-&gt;getMock('Symfony\Component\Security\Core\User\UserInterface');

        $mock
            <span style="color:red;">-&gt;expects($this-&gt;once())</span><span style="color:green;">-&gt;expects($this-&gt;any())</span>
            -&gt;method('getPassword')
            <span style="color:red;">-&gt;will($this-&gt;returnValue('s3Cr3t'))</span><span style="color:green;">-&gt;will($this-&gt;returnValue(static::PASSWORD))</span>
        ;

        $mock
            <span style="color:red;">-&gt;expects($this-&gt;once())</span><span style="color:green;">-&gt;expects($this-&gt;any())</span>
            -&gt;method('getSalt')
            <span style="color:red;">-&gt;will($this-&gt;returnValue('^S4lt$'))</span><span style="color:green;">-&gt;will($this-&gt;returnValue(static::SALT))</span>
        ;

        return $mock;
<span style="color:teal;">@@ -105,15 +124,7 @@</span> class UserPasswordValidatorTest extends \PHPUnit_Framework_TestCase

    protected function createPasswordEncoder($isPasswordValid = true)
    {
<span style="color:red;">$mock = $this-&gt;getMock('Symfony\Component\Security\Core\Encoder\PasswordEncoderInterface');</span>

<span style="color:red;">        $mock</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('isPasswordValid')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue($isPasswordValid))</span>
<span style="color:red;">        ;</span>        return <span style="color:red;">$mock;</span><span style="color:green;">$this-&gt;getMock('Symfony\Component\Security\Core\Encoder\PasswordEncoderInterface');</span>
    }

    protected function createEncoderFactory($encoder = null)
<span style="color:teal;">@@ -121,7 +132,7 @@</span> class UserPasswordValidatorTest extends \PHPUnit_Framework_TestCase
        $mock = $this-&gt;getMock('Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface');

        $mock
            <span style="color:red;">-&gt;expects($this-&gt;once())</span><span style="color:green;">-&gt;expects($this-&gt;any())</span>
            -&gt;method('getEncoder')
            -&gt;will($this-&gt;returnValue($encoder))
        ;
<span style="color:teal;">@@ -135,7 +146,7 @@</span> class UserPasswordValidatorTest extends \PHPUnit_Framework_TestCase

        $mock = $this-&gt;getMock('Symfony\Component\Security\Core\SecurityContextInterface');
        $mock
            <span style="color:red;">-&gt;expects($this-&gt;once())</span><span style="color:green;">-&gt;expects($this-&gt;any())</span>
            -&gt;method('getToken')
            -&gt;will($this-&gt;returnValue($token))
        ;
<span style="color:teal;">@@ -147,7 +158,7 @@</span> class UserPasswordValidatorTest extends \PHPUnit_Framework_TestCase
    {
        $mock = $this-&gt;getMock('Symfony\Component\Security\Core\Authentication\Token\TokenInterface');
        $mock
            <span style="color:red;">-&gt;expects($this-&gt;once())</span><span style="color:green;">-&gt;expects($this-&gt;any())</span>
            -&gt;method('getUser')
            -&gt;will($this-&gt;returnValue($user))
        ;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Core/Util/StringUtils.php b/src/Symfony/Component/Security/Core/Util/StringUtils.php</span>
<span style="font-weight:bold;">index d47bd4bb37..5e130375b7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Core/Util/StringUtils.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Core/Util/StringUtils.php</span>
<span style="color:teal;">@@ -35,23 +35,19 @@</span> class StringUtils
     */
    public static function equals($knownString, $userInput)
    {
<span style="color:red;">        // Prevent issues if string length is 0</span>
<span style="color:red;">        $knownString .= chr(0);</span>
<span style="color:red;">        $userInput .= chr(0);</span>

        $knownLen = strlen($knownString);
        $userLen = strlen($userInput);

        <span style="color:green;">// Extend the known string to avoid uninitialized string offsets</span>
<span style="color:green;">        $knownString .= $userInput;</span>

        // Set the result to the difference between the lengths
        $result = $knownLen - $userLen;

        // Note that we ALWAYS iterate over the user-supplied length
        // This is to prevent leaking length information
        for ($i = 0; $i &lt; $userLen; $i++) {
<span style="color:red;">// Using % here is a trick to prevent notices</span>
<span style="color:red;">            // It's safe, since if the lengths are different</span>
<span style="color:red;">            // $result is already non-0</span>            $result |= <span style="color:red;">(ord($knownString[$i % $knownLen])</span><span style="color:green;">(ord($knownString[$i])</span> ^ ord($userInput[$i]));
        }

        // They are only identical strings if $result is exactly 0...
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Security/Http/RememberMe/AbstractRememberMeServices.php b/src/Symfony/Component/Security/Http/RememberMe/AbstractRememberMeServices.php</span>
<span style="font-weight:bold;">index be842088e9..b868dae9b7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Security/Http/RememberMe/AbstractRememberMeServices.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Security/Http/RememberMe/AbstractRememberMeServices.php</span>
<span style="color:teal;">@@ -303,7 +303,7 @@</span> abstract class AbstractRememberMeServices implements RememberMeServicesInterface

        $parameter = $request-&gt;get($this-&gt;options['remember_me_parameter'], null, true);

        if <span style="color:red;">($parameter</span><span style="color:green;">(null</span> === <span style="color:red;">null</span><span style="color:green;">$parameter</span> &amp;&amp; null !== $this-&gt;logger) {
            $this-&gt;logger-&gt;debug(sprintf('Did not send remember-me cookie (remember-me parameter &quot;%s&quot; was not sent).', $this-&gt;options['remember_me_parameter']));
        }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Serializer/Normalizer/GetSetMethodNormalizer.php b/src/Symfony/Component/Serializer/Normalizer/GetSetMethodNormalizer.php</span>
<span style="font-weight:bold;">index b6740ed0a4..9d24278b74 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Serializer/Normalizer/GetSetMethodNormalizer.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Serializer/Normalizer/GetSetMethodNormalizer.php</span>
<span style="color:teal;">@@ -117,6 +117,18 @@</span> class GetSetMethodNormalizer extends SerializerAwareNormalizer implements Normal
     */
    public function denormalize($data, $class, $format = null, array $context = array())
    {
        <span style="color:green;">if (is_array($data) || is_object($data) &amp;&amp; $data instanceof \ArrayAccess) {</span>
<span style="color:green;">            $normalizedData = $data;</span>
<span style="color:green;">        } elseif (is_object($data)) {</span>
<span style="color:green;">            $normalizedData = array();</span>

<span style="color:green;">            foreach ($data as $attribute =&gt; $value) {</span>
<span style="color:green;">                $normalizedData[$attribute] = $value;</span>
<span style="color:green;">            }</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $normalizedData = array();</span>
<span style="color:green;">        }</span>

        $reflectionClass = new \ReflectionClass($class);
        $constructor = $reflectionClass-&gt;getConstructor();

<span style="color:teal;">@@ -127,10 +139,10 @@</span> class GetSetMethodNormalizer extends SerializerAwareNormalizer implements Normal
            foreach ($constructorParameters as $constructorParameter) {
                $paramName = lcfirst($this-&gt;formatAttribute($constructorParameter-&gt;name));

                if <span style="color:red;">(isset($data[$paramName]))</span><span style="color:green;">(isset($normalizedData[$paramName]))</span> {
                    $params[] = <span style="color:red;">$data[$paramName];</span><span style="color:green;">$normalizedData[$paramName];</span>
                    // don't run set for a parameter passed to the constructor
                    <span style="color:red;">unset($data[$paramName]);</span><span style="color:green;">unset($normalizedData[$paramName]);</span>
                } elseif ($constructorParameter-&gt;isOptional()) {
                    $params[] = $constructorParameter-&gt;getDefaultValue();
                } else {
<span style="color:teal;">@@ -144,10 +156,10 @@</span> class GetSetMethodNormalizer extends SerializerAwareNormalizer implements Normal

            $object = $reflectionClass-&gt;newInstanceArgs($params);
        } else {
            $object = new <span style="color:red;">$class;</span><span style="color:green;">$class();</span>
        }

        foreach <span style="color:red;">($data</span><span style="color:green;">($normalizedData</span> as $attribute =&gt; $value) {
            $setter = 'set'.$this-&gt;formatAttribute($attribute);

            if (method_exists($object, $setter)) {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Serializer/Tests/Normalizer/GetSetMethodNormalizerTest.php b/src/Symfony/Component/Serializer/Tests/Normalizer/GetSetMethodNormalizerTest.php</span>
<span style="font-weight:bold;">index 2d2f9cfb01..1a8dfccac6 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Serializer/Tests/Normalizer/GetSetMethodNormalizerTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Serializer/Tests/Normalizer/GetSetMethodNormalizerTest.php</span>
<span style="color:teal;">@@ -17,6 +17,11 @@</span> use Symfony\Component\Serializer\Normalizer\NormalizerInterface;

class GetSetMethodNormalizerTest extends \PHPUnit_Framework_TestCase
{
    <span style="color:green;">/**</span>
<span style="color:green;">     * @var GetSetMethodNormalizer</span>
<span style="color:green;">     */</span>
<span style="color:green;">    private $normalizer;</span>

    protected function setUp()
    {
        $this-&gt;serializer = $this-&gt;getMock(__NAMESPACE__.'\SerializerNormalizer');
<span style="color:teal;">@@ -63,6 +68,17 @@</span> class GetSetMethodNormalizerTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('bar', $obj-&gt;getBar());
    }

    <span style="color:green;">public function testDenormalizeWithObject()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $data = new \stdClass();</span>
<span style="color:green;">        $data-&gt;foo = 'foo';</span>
<span style="color:green;">        $data-&gt;bar = 'bar';</span>
<span style="color:green;">        $data-&gt;fooBar = 'foobar';</span>
<span style="color:green;">        $obj = $this-&gt;normalizer-&gt;denormalize($data, __NAMESPACE__.'\GetSetDummy', 'any');</span>
<span style="color:green;">        $this-&gt;assertEquals('foo', $obj-&gt;getFoo());</span>
<span style="color:green;">        $this-&gt;assertEquals('bar', $obj-&gt;getBar());</span>
<span style="color:green;">    }</span>

    public function testDenormalizeOnCamelCaseFormat()
    {
        $this-&gt;normalizer-&gt;setCamelizedAttributes(array('camel_case'));
<span style="color:teal;">@@ -73,6 +89,11 @@</span> class GetSetMethodNormalizerTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('camelCase', $obj-&gt;getCamelCase());
    }

    <span style="color:green;">public function testDenormalizeNull()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertEquals(new GetSetDummy(), $this-&gt;normalizer-&gt;denormalize(null, __NAMESPACE__.'\GetSetDummy'));</span>
<span style="color:green;">    }</span>

    /**
     * @dataProvider attributeProvider
     */
<span style="color:teal;">@@ -115,6 +136,17 @@</span> class GetSetMethodNormalizerTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals(array(1, 2, 3), $obj-&gt;getBaz());
    }

    <span style="color:green;">public function testConstructorWithObjectDenormalize()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $data = new \stdClass();</span>
<span style="color:green;">        $data-&gt;foo = 'foo';</span>
<span style="color:green;">        $data-&gt;bar = 'bar';</span>
<span style="color:green;">        $data-&gt;fooBar = 'foobar';</span>
<span style="color:green;">        $obj = $this-&gt;normalizer-&gt;denormalize($data, __NAMESPACE__.'\GetConstructorDummy', 'any');</span>
<span style="color:green;">        $this-&gt;assertEquals('foo', $obj-&gt;getFoo());</span>
<span style="color:green;">        $this-&gt;assertEquals('bar', $obj-&gt;getBar());</span>
<span style="color:green;">    }</span>

    /**
     * @dataProvider provideCallbacks
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Stopwatch/.gitattributes b/src/Symfony/Component/Stopwatch/.gitattributes</span>
<span style="font-weight:bold;">deleted file mode 100644</span>
<span style="font-weight:bold;">index e742c9b351..0000000000</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Stopwatch/.gitattributes</span>
<span style="font-weight:bold;">+++ /dev/null</span>
<span style="color:teal;">@@ -1,2 +0,0 @@</span>
<span style="color:red;">Tests/ export-ignore</span>
<span style="color:red;">phpunit.xml.dist export-ignore</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Stopwatch/Tests/StopwatchEventTest.php b/src/Symfony/Component/Stopwatch/Tests/StopwatchEventTest.php</span>
<span style="font-weight:bold;">index af63153382..825520850a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Stopwatch/Tests/StopwatchEventTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Stopwatch/Tests/StopwatchEventTest.php</span>
<span style="color:teal;">@@ -133,25 +133,6 @@</span> class StopwatchEventTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals(0, $event-&gt;getStartTime(), null, self::DELTA);
    }

<span style="color:red;">    public function testEndTime()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $event = new StopwatchEvent(microtime(true) * 1000);</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $event-&gt;getEndTime());</span>

<span style="color:red;">        $event = new StopwatchEvent(microtime(true) * 1000);</span>
<span style="color:red;">        $event-&gt;start();</span>
<span style="color:red;">        $this-&gt;assertEquals(0, $event-&gt;getEndTime());</span>

<span style="color:red;">        $event = new StopwatchEvent(microtime(true) * 1000);</span>
<span style="color:red;">        $event-&gt;start();</span>
<span style="color:red;">        usleep(100000);</span>
<span style="color:red;">        $event-&gt;stop();</span>
<span style="color:red;">        $event-&gt;start();</span>
<span style="color:red;">        usleep(100000);</span>
<span style="color:red;">        $event-&gt;stop();</span>
<span style="color:red;">        $this-&gt;assertEquals(200, $event-&gt;getEndTime(), null, self::DELTA);</span>
<span style="color:red;">    }</span>

    /**
     * @expectedException \InvalidArgumentException
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Stopwatch/Tests/StopwatchTest.php b/src/Symfony/Component/Stopwatch/Tests/StopwatchTest.php</span>
<span style="font-weight:bold;">index a8c11424fa..6805effb48 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Stopwatch/Tests/StopwatchTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Stopwatch/Tests/StopwatchTest.php</span>
<span style="color:teal;">@@ -79,19 +79,6 @@</span> class StopwatchTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals(200, $event-&gt;getDuration(), null, self::DELTA);
    }

<span style="color:red;">    public function testLap()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $stopwatch = new Stopwatch();</span>
<span style="color:red;">        $stopwatch-&gt;start('foo', 'cat');</span>
<span style="color:red;">        usleep(100000);</span>
<span style="color:red;">        $event = $stopwatch-&gt;lap('foo');</span>
<span style="color:red;">        usleep(100000);</span>
<span style="color:red;">        $stopwatch-&gt;stop('foo');</span>

<span style="color:red;">        $this-&gt;assertInstanceof('Symfony\Component\Stopwatch\StopwatchEvent', $event);</span>
<span style="color:red;">        $this-&gt;assertEquals(200, $event-&gt;getDuration(), null, self::DELTA);</span>
<span style="color:red;">    }</span>

    /**
     * @expectedException \LogicException
     */
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Translation/Loader/PhpFileLoader.php b/src/Symfony/Component/Translation/Loader/PhpFileLoader.php</span>
<span style="font-weight:bold;">index 4737d1bf96..55913d6c75 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Translation/Loader/PhpFileLoader.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Translation/Loader/PhpFileLoader.php</span>
<span style="color:teal;">@@ -39,7 +39,7 @@</span> class PhpFileLoader extends ArrayLoader implements LoaderInterface
            throw new NotFoundResourceException(sprintf('File &quot;%s&quot; not found.', $resource));
        }

        $messages = <span style="color:red;">require($resource);</span><span style="color:green;">require $resource;</span>

        $catalogue = parent::load($messages, $locale, $domain);
        $catalogue-&gt;addResource(new FileResource($resource));
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Translation/Tests/TranslatorTest.php b/src/Symfony/Component/Translation/Tests/TranslatorTest.php</span>
<span style="font-weight:bold;">index 313199fa02..1efcff6de2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Translation/Tests/TranslatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Translation/Tests/TranslatorTest.php</span>
<span style="color:teal;">@@ -103,7 +103,6 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertEquals('bar (fr)', $translator-&gt;trans('bar'));
    }


    /**
     * @dataProvider      getInvalidLocalesTests
     * @expectedException \InvalidArgumentException
<span style="color:teal;">@@ -329,7 +328,6 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
        // no assertion. this method just asserts that no exception is thrown
    }


    public function getTransFileTests()
    {
        return array(
<span style="color:teal;">@@ -430,6 +428,7 @@</span> class TranslatorTest extends \PHPUnit_Framework_TestCase
            array('fr_FR'),
            array('fr.FR'),
            array('fr-FR.UTF8'),
            <span style="color:green;">array('sr@latin'),</span>
        );
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Translation/Translator.php b/src/Symfony/Component/Translation/Translator.php</span>
<span style="font-weight:bold;">index bcd73316ff..32ae7650ff 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Translation/Translator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Translation/Translator.php</span>
<span style="color:teal;">@@ -316,10 +316,10 @@</span> class Translator implements TranslatorInterface
     *
     * @throws \InvalidArgumentException If the locale contains invalid characters
     */
    <span style="color:red;">private</span><span style="color:green;">protected</span> function assertValidLocale($locale)
    {
        if <span style="color:red;">(0</span><span style="color:green;">(1</span> !== <span style="color:red;">preg_match('/[^a-z0-9_\\.\\-]+/i', $locale, $match))</span><span style="color:green;">preg_match('/^[a-z0-9@_\\.\\-]*$/i', $locale))</span> {
            throw new \InvalidArgumentException(sprintf('Invalid <span style="color:red;">locale: %s.',</span><span style="color:green;">&quot;%s&quot; locale.',</span> $locale));
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/ConstraintValidator.php b/src/Symfony/Component/Validator/ConstraintValidator.php</span>
<span style="font-weight:bold;">index 201db0f230..58c0902e13 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/ConstraintValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/ConstraintValidator.php</span>
<span style="color:teal;">@@ -20,6 +20,21 @@</span> namespace Symfony\Component\Validator;
 */
abstract class ConstraintValidator implements ConstraintValidatorInterface
{
    <span style="color:green;">/**</span>
<span style="color:green;">     * Whether to format {@link \DateTime} objects as RFC-3339 dates</span>
<span style="color:green;">     * (&quot;Y-m-d H:i:s&quot;).</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @var integer</span>
<span style="color:green;">     */</span>
<span style="color:green;">    const PRETTY_DATE = 1;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Whether to cast objects with a &quot;__toString()&quot; method to strings.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @var integer</span>
<span style="color:green;">     */</span>
<span style="color:green;">    const OBJECT_TO_STRING = 2;</span>

    /**
     * @var ExecutionContextInterface
     */
<span style="color:teal;">@@ -32,4 +47,114 @@</span> abstract class ConstraintValidator implements ConstraintValidatorInterface
    {
        $this-&gt;context = $context;
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * Returns a string representation of the type of the value.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * This method should be used if you pass the type of a value as</span>
<span style="color:green;">     * message parameter to a constraint violation. Note that such</span>
<span style="color:green;">     * parameters should usually not be included in messages aimed at</span>
<span style="color:green;">     * non-technical people.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param mixed $value The value to return the type of</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string The type of the value</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected function formatTypeOf($value)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return is_object($value) ? get_class($value) : gettype($value);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Returns a string representation of the value.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * This method returns the equivalent PHP tokens for most scalar types</span>
<span style="color:green;">     * (i.e. &quot;false&quot; for false, &quot;1&quot; for 1 etc.). Strings are always wrapped</span>
<span style="color:green;">     * in double quotes (&quot;). Objects, arrays and resources are formatted as</span>
<span style="color:green;">     * &quot;object&quot;, &quot;array&quot; and &quot;resource&quot;. If the parameter $prettyDateTime</span>
<span style="color:green;">     * is set to true, {@link \DateTime} objects will be formatted as</span>
<span style="color:green;">     * RFC-3339 dates (&quot;Y-m-d H:i:s&quot;).</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * Be careful when passing message parameters to a constraint violation</span>
<span style="color:green;">     * that (may) contain objects, arrays or resources. These parameters</span>
<span style="color:green;">     * should only be displayed for technical users. Non-technical users</span>
<span style="color:green;">     * won't know what an &quot;object&quot;, &quot;array&quot; or &quot;resource&quot; is and will be</span>
<span style="color:green;">     * confused by the violation message.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param mixed   $value  The value to format as string</span>
<span style="color:green;">     * @param integer $format A bitwise combination of the format</span>
<span style="color:green;">     *                        constants in this class</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string The string representation of the passed value</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected function formatValue($value, $format = 0)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (($format &amp; self::PRETTY_DATE) &amp;&amp; $value instanceof \DateTime) {</span>
<span style="color:green;">            if (class_exists('IntlDateFormatter')) {</span>
<span style="color:green;">                $locale = \Locale::getDefault();</span>
<span style="color:green;">                $formatter = new \IntlDateFormatter($locale, \IntlDateFormatter::MEDIUM, \IntlDateFormatter::SHORT);</span>

<span style="color:green;">                return $formatter-&gt;format($value);</span>
<span style="color:green;">            }</span>

<span style="color:green;">            return $value-&gt;format('Y-m-d H:i:s');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (is_object($value)) {</span>
<span style="color:green;">            if ($format &amp; self::OBJECT_TO_STRING &amp;&amp; method_exists($value, '__toString')) {</span>
<span style="color:green;">                return $value-&gt;__toString();</span>
<span style="color:green;">            }</span>

<span style="color:green;">            return 'object';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (is_array($value)) {</span>
<span style="color:green;">            return 'array';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (is_string($value)) {</span>
<span style="color:green;">            return '&quot;'.$value.'&quot;';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (is_resource($value)) {</span>
<span style="color:green;">            return 'resource';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (null === $value) {</span>
<span style="color:green;">            return 'null';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (false === $value) {</span>
<span style="color:green;">            return 'false';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        if (true === $value) {</span>
<span style="color:green;">            return 'true';</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return (string) $value;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * Returns a string representation of a list of values.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * Each of the values is converted to a string using</span>
<span style="color:green;">     * {@link formatValue()}. The values are then concatenated with commas.</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @param array   $values A list of values</span>
<span style="color:green;">     * @param integer $format A bitwise combination of the format</span>
<span style="color:green;">     *                        constants in this class</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @return string The string representation of the value list</span>
<span style="color:green;">     *</span>
<span style="color:green;">     * @see formatValue()</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected function formatValues(array $values, $format = 0)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        foreach ($values as $key =&gt; $value) {</span>
<span style="color:green;">            $values[$key] = $this-&gt;formatValue($value, $format);</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return implode(', ', $values);</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/ConstraintViolation.php b/src/Symfony/Component/Validator/ConstraintViolation.php</span>
<span style="font-weight:bold;">index ddd14dbdc0..02b77be0bf 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/ConstraintViolation.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/ConstraintViolation.php</span>
<span style="color:teal;">@@ -96,9 +96,9 @@</span> class ConstraintViolation implements ConstraintViolationInterface
    public function __toString()
    {
        if (is_object($this-&gt;root)) {
            $class = <span style="color:red;">get_class($this-&gt;root);</span><span style="color:green;">'Object('.get_class($this-&gt;root).')';</span>
        } elseif (is_array($this-&gt;root)) {
            $class = <span style="color:red;">&quot;Array&quot;;</span><span style="color:green;">'Array';</span>
        } else {
            $class = (string) $this-&gt;root;
        }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/AbstractComparisonValidator.php b/src/Symfony/Component/Validator/Constraints/AbstractComparisonValidator.php</span>
<span style="font-weight:bold;">index 010039ac61..2e8230bb83 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/AbstractComparisonValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/AbstractComparisonValidator.php</span>
<span style="color:teal;">@@ -32,45 +32,13 @@</span> abstract class AbstractComparisonValidator extends ConstraintValidator

        if (!$this-&gt;compareValues($value, $constraint-&gt;value)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, array(
                '{{ value }}' =&gt; <span style="color:red;">$this-&gt;valueToString($constraint-&gt;value),</span><span style="color:green;">$this-&gt;formatValue($value, self::OBJECT_TO_STRING | self::PRETTY_DATE),</span>
                '{{ compared_value }}' =&gt; <span style="color:red;">$this-&gt;valueToString($constraint-&gt;value),</span><span style="color:green;">$this-&gt;formatValue($constraint-&gt;value, self::OBJECT_TO_STRING | self::PRETTY_DATE),</span>
                '{{ compared_value_type }}' =&gt; <span style="color:red;">$this-&gt;valueToType($constraint-&gt;value)</span><span style="color:green;">$this-&gt;formatTypeOf($constraint-&gt;value)</span>
            ));
        }
    }

<span style="color:red;">    /**</span>
<span style="color:red;">     * Returns a string representation of the type of the value.</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @param  mixed $value</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @return string</span>
<span style="color:red;">     */</span>
<span style="color:red;">    private function valueToType($value)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return is_object($value) ? get_class($value) : gettype($value);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    /**</span>
<span style="color:red;">     * Returns a string representation of the value.</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @param  mixed  $value</span>
<span style="color:red;">     *</span>
<span style="color:red;">     * @return string</span>
<span style="color:red;">     */</span>
<span style="color:red;">    private function valueToString($value)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (is_object($value) &amp;&amp; method_exists($value, '__toString')) {</span>
<span style="color:red;">            return (string) $value;</span>
<span style="color:red;">        }</span>

<span style="color:red;">        if ($value instanceof \DateTime) {</span>
<span style="color:red;">            return $value-&gt;format('Y-m-d H:i:s');</span>
<span style="color:red;">        }</span>

<span style="color:red;">        return var_export($value, true);</span>
<span style="color:red;">    }</span>

    /**
     * Compares the two given values to find if their relationship is valid
     *
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/AllValidator.php b/src/Symfony/Component/Validator/Constraints/AllValidator.php</span>
<span style="font-weight:bold;">index 868863a552..11f9418592 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/AllValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/AllValidator.php</span>
<span style="color:teal;">@@ -39,9 +39,7 @@</span> class AllValidator extends ConstraintValidator
        $group = $context-&gt;getGroup();

        foreach ($value as $key =&gt; $element) {
<span style="color:red;">foreach ($constraint-&gt;constraints as $constr) {</span>            $context-&gt;validateValue($element, <span style="color:red;">$constr,</span><span style="color:green;">$constraint-&gt;constraints,</span> '['.$key.']', $group);<span style="color:red;">}</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/BlankValidator.php b/src/Symfony/Component/Validator/Constraints/BlankValidator.php</span>
<span style="font-weight:bold;">index 06064620f1..e8406a238e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/BlankValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/BlankValidator.php</span>
<span style="color:teal;">@@ -27,7 +27,9 @@</span> class BlankValidator extends ConstraintValidator
    public function validate($value, Constraint $constraint)
    {
        if ('' !== $value &amp;&amp; null !== $value) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value)</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/CardSchemeValidator.php b/src/Symfony/Component/Validator/Constraints/CardSchemeValidator.php</span>
<span style="font-weight:bold;">index 1ece3fdd65..73f602adce 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/CardSchemeValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/CardSchemeValidator.php</span>
<span style="color:teal;">@@ -108,7 +108,9 @@</span> class CardSchemeValidator extends ConstraintValidator
        }

        if (!is_numeric($value)) {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

            return;
        }
<span style="color:teal;">@@ -124,6 +126,8 @@</span> class CardSchemeValidator extends ConstraintValidator
            }
        }

        <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/ChoiceValidator.php b/src/Symfony/Component/Validator/Constraints/ChoiceValidator.php</span>
<span style="font-weight:bold;">index ef9ae6e3ad..79081fee49 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/ChoiceValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/ChoiceValidator.php</span>
<span style="color:teal;">@@ -59,25 +59,33 @@</span> class ChoiceValidator extends ConstraintValidator
        if ($constraint-&gt;multiple) {
            foreach ($value as $_value) {
                if (!in_array($_value, $choices, $constraint-&gt;strict)) {
                    $this-&gt;context-&gt;addViolation($constraint-&gt;multipleMessage, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                        '{{</span> value }}' =&gt; <span style="color:red;">$_value));</span><span style="color:green;">$this-&gt;formatValue($_value),</span>
<span style="color:green;">                    ));</span>
                }
            }

            $count = count($value);

            if ($constraint-&gt;min !== null &amp;&amp; $count &lt; $constraint-&gt;min) {
                $this-&gt;context-&gt;addViolation($constraint-&gt;minMessage, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                    '{{</span> limit }}' =&gt; <span style="color:red;">$constraint-&gt;min), null,</span><span style="color:green;">$constraint-&gt;min</span>
<span style="color:green;">                ), $value,</span> (int) $constraint-&gt;min);

                return;
            }

            if ($constraint-&gt;max !== null &amp;&amp; $count &gt; $constraint-&gt;max) {
                $this-&gt;context-&gt;addViolation($constraint-&gt;maxMessage, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                    '{{</span> limit }}' =&gt; <span style="color:red;">$constraint-&gt;max), null,</span><span style="color:green;">$constraint-&gt;max</span>
<span style="color:green;">                ), $value,</span> (int) $constraint-&gt;max);

                return;
            }
        } elseif (!in_array($value, $choices, $constraint-&gt;strict)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value)</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/CollectionValidator.php b/src/Symfony/Component/Validator/Constraints/CollectionValidator.php</span>
<span style="font-weight:bold;">index e3ecc661e2..e93c94b6ed 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/CollectionValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/CollectionValidator.php</span>
<span style="color:teal;">@@ -53,12 +53,10 @@</span> class CollectionValidator extends ConstraintValidator
                (is_array($value) &amp;&amp; array_key_exists($field, $value)) ||
                ($value instanceof \ArrayAccess &amp;&amp; $value-&gt;offsetExists($field))
            ) {
<span style="color:red;">foreach ($fieldConstraint-&gt;constraints as $constr) {</span>                $context-&gt;validateValue($value[$field], <span style="color:red;">$constr,</span><span style="color:green;">$fieldConstraint-&gt;constraints,</span> '['.$field.']', $group);<span style="color:red;">}</span>
            } elseif (!$fieldConstraint instanceof Optional &amp;&amp; !$constraint-&gt;allowMissingFields) {
                $context-&gt;addViolationAt('['.$field.']', $constraint-&gt;missingFieldsMessage, array(
                    '{{ field }}' =&gt; <span style="color:red;">$field</span><span style="color:green;">$this-&gt;formatValue($field)</span>
                ), null);
            }
        }
<span style="color:teal;">@@ -67,7 +65,7 @@</span> class CollectionValidator extends ConstraintValidator
            foreach ($value as $field =&gt; $fieldValue) {
                if (!isset($constraint-&gt;fields[$field])) {
                    $context-&gt;addViolationAt('['.$field.']', $constraint-&gt;extraFieldsMessage, array(
                        '{{ field }}' =&gt; <span style="color:red;">$field</span><span style="color:green;">$this-&gt;formatValue($field)</span>
                    ), $fieldValue);
                }
            }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/CountryValidator.php b/src/Symfony/Component/Validator/Constraints/CountryValidator.php</span>
<span style="font-weight:bold;">index 6a8d1d6446..a094c10481 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/CountryValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/CountryValidator.php</span>
<span style="color:teal;">@@ -42,7 +42,9 @@</span> class CountryValidator extends ConstraintValidator
        $countries = Intl::getRegionBundle()-&gt;getCountryNames();

        if (!isset($countries[$value])) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/CurrencyValidator.php b/src/Symfony/Component/Validator/Constraints/CurrencyValidator.php</span>
<span style="font-weight:bold;">index 4451047cdd..d8c999af4d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/CurrencyValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/CurrencyValidator.php</span>
<span style="color:teal;">@@ -42,7 +42,9 @@</span> class CurrencyValidator extends ConstraintValidator
        $currencies = Intl::getCurrencyBundle()-&gt;getCurrencyNames();

        if (!isset($currencies[$value])) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/DateValidator.php b/src/Symfony/Component/Validator/Constraints/DateValidator.php</span>
<span style="font-weight:bold;">index 733a3b7f5e..5e5250852f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/DateValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/DateValidator.php</span>
<span style="color:teal;">@@ -40,7 +40,9 @@</span> class DateValidator extends ConstraintValidator
        $value = (string) $value;

        if (!preg_match(static::PATTERN, $value, $matches) || !checkdate($matches[2], $matches[3], $matches[1])) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/EmailValidator.php b/src/Symfony/Component/Validator/Constraints/EmailValidator.php</span>
<span style="font-weight:bold;">index e14546ce82..b3789a130d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/EmailValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/EmailValidator.php</span>
<span style="color:teal;">@@ -50,7 +50,9 @@</span> class EmailValidator extends ConstraintValidator
        }

        if (!$valid) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/ExpressionValidator.php b/src/Symfony/Component/Validator/Constraints/ExpressionValidator.php</span>
<span style="font-weight:bold;">index 8411d0d6a3..0afa0fc4da 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/ExpressionValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/ExpressionValidator.php</span>
<span style="color:teal;">@@ -51,6 +51,7 @@</span> class ExpressionValidator extends ConstraintValidator
        $variables = array();

        if (null === $this-&gt;context-&gt;getPropertyName()) {
            <span style="color:green;">$variables['value'] = $value;</span>
            $variables['this'] = $value;
        } else {
            // Extract the object that the property belongs to from the object
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/FalseValidator.php b/src/Symfony/Component/Validator/Constraints/FalseValidator.php</span>
<span style="font-weight:bold;">index 4e8c4df269..280deba3c9 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/FalseValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/FalseValidator.php</span>
<span style="color:teal;">@@ -30,6 +30,8 @@</span> class FalseValidator extends ConstraintValidator
            return;
        }

        <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/FileValidator.php b/src/Symfony/Component/Validator/Constraints/FileValidator.php</span>
<span style="font-weight:bold;">index 5f499810e6..006064594b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/FileValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/FileValidator.php</span>
<span style="color:teal;">@@ -96,13 +96,17 @@</span> class FileValidator extends ConstraintValidator
        $path = $value instanceof FileObject ? $value-&gt;getPathname() : (string) $value;

        if (!is_file($path)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;notFoundMessage, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> file }}' =&gt; <span style="color:red;">$path));</span><span style="color:green;">$this-&gt;formatValue($path)</span>
<span style="color:green;">            ));</span>

            return;
        }

        if (!is_readable($path)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;notReadableMessage, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> file }}' =&gt; <span style="color:red;">$path));</span><span style="color:green;">$this-&gt;formatValue($path)</span>
<span style="color:green;">            ));</span>

            return;
        }
<span style="color:teal;">@@ -126,10 +130,10 @@</span> class FileValidator extends ConstraintValidator

            if ($size &gt; $limit) {
                $this-&gt;context-&gt;addViolation($constraint-&gt;maxSizeMessage, array(
                    '{{ size }}' =&gt; $size,
                    '{{ limit }}' =&gt; $limit,
                    '{{ suffix }}' =&gt; $suffix,
                    '{{ file }}' =&gt; <span style="color:red;">$path,</span><span style="color:green;">$this-&gt;formatValue($path),</span>
                ));

                return;
<span style="color:teal;">@@ -161,9 +165,9 @@</span> class FileValidator extends ConstraintValidator

            if (false === $valid) {
                $this-&gt;context-&gt;addViolation($constraint-&gt;mimeTypesMessage, array(
                    '{{ type }}' =&gt; <span style="color:red;">'&quot;'.$mime.'&quot;',</span><span style="color:green;">$this-&gt;formatValue($mime),</span>
                    '{{ types }}' =&gt; <span style="color:red;">'&quot;'.implode('&quot;, &quot;', $mimeTypes) .'&quot;',</span><span style="color:green;">$this-&gt;formatValues($mimeTypes),</span>
                    '{{ file }}' =&gt; <span style="color:red;">$path,</span><span style="color:green;">$this-&gt;formatValue($path),</span>
                ));
            }
        }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/IbanValidator.php b/src/Symfony/Component/Validator/Constraints/IbanValidator.php</span>
<span style="font-weight:bold;">index 640da3c702..699db7ea7a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/IbanValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/IbanValidator.php</span>
<span style="color:teal;">@@ -13,10 +13,12 @@</span> namespace Symfony\Component\Validator\Constraints;

use Symfony\Component\Validator\Constraint;
use Symfony\Component\Validator\ConstraintValidator;
<span style="color:green;">use Symfony\Component\Validator\Exception\UnexpectedTypeException;</span>

/**
 * @author Manuel Reinhard &lt;manu@sprain.ch&gt;
 * @author Michael Schummel
 <span style="color:green;">* @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
 * @link http://www.michael-schummel.de/2007/10/05/iban-prufung-mit-php/
 */
class IbanValidator extends ConstraintValidator
<span style="color:teal;">@@ -30,41 +32,100 @@</span> class IbanValidator extends ConstraintValidator
            return;
        }

        <span style="color:green;">if (!is_scalar($value) &amp;&amp; !(is_object($value) &amp;&amp; method_exists($value, '__toString'))) {</span>
<span style="color:green;">            throw new UnexpectedTypeException($value, 'string');</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $value = (string) $value;</span>

        // <span style="color:red;">An IBAN without a country code is not an IBAN.</span><span style="color:green;">Remove spaces</span>
<span style="color:green;">        $canonicalized = str_replace(' ', '', $value);</span>

        if <span style="color:red;">(0 === preg_match('/[A-Z]/', $value))</span><span style="color:green;">(strlen($canonicalized) &lt; 4)</span> {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

            return;
        }

        <span style="color:red;">$teststring = preg_replace('/\s+/', '', $value);</span><span style="color:green;">// The IBAN must have at least 4 characters, start with a country</span>
<span style="color:green;">        // code and contain only digits and (uppercase) characters</span>
        if <span style="color:red;">(strlen($teststring)</span><span style="color:green;">(strlen($canonicalized)</span> &lt; <span style="color:red;">4)</span><span style="color:green;">4 || !ctype_upper($canonicalized{0})</span>
<span style="color:green;">            || !ctype_upper($canonicalized{1}) || !ctype_alnum($canonicalized))</span> {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

            return;
        }

        <span style="color:red;">$teststring</span><span style="color:green;">// Move the first four characters to the end</span>
<span style="color:green;">        // e.g. CH93 0076 2011 6238 5295 7</span>
<span style="color:green;">        //   -&gt; 0076 2011 6238 5295 7 CH93</span>
<span style="color:green;">        $canonicalized</span> = <span style="color:red;">substr($teststring, 4)</span>
<span style="color:red;">            .strval(ord($teststring{0}) - 55)</span>
<span style="color:red;">            .strval(ord($teststring{1}) - 55)</span>
<span style="color:red;">            .substr($teststring, 2, 2);</span><span style="color:green;">substr($canonicalized, 4).substr($canonicalized, 0, 4);</span>

        <span style="color:red;">$teststring</span><span style="color:green;">// Convert all remaining letters to their ordinals</span>
<span style="color:green;">        // The result is an integer, which is too large for PHP's int</span>
<span style="color:green;">        // data type, so we store it in a string instead.</span>
<span style="color:green;">        // e.g. 0076 2011 6238 5295 7 CH93</span>
<span style="color:green;">        //   -&gt; 0076 2011 6238 5295 7 121893</span>
<span style="color:green;">        $checkSum</span> = <span style="color:red;">preg_replace_callback('/[A-Z]/', function ($letter) {</span>
<span style="color:red;">            return intval(ord(strtolower($letter[0])) - 87);</span>
<span style="color:red;">        }, $teststring);</span><span style="color:green;">$this-&gt;toBigInt($canonicalized);</span>

        <span style="color:red;">$rest = 0;</span>
<span style="color:red;">        $strlen = strlen($teststring);</span>
<span style="color:red;">        for ($pos = 0; $pos &lt; $strlen; $pos += 7)</span><span style="color:green;">if (false === $checkSum)</span> {
            <span style="color:red;">$part = strval($rest).substr($teststring, $pos, 7);</span>
<span style="color:red;">            $rest = intval($part) % 97;</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

<span style="color:green;">            return;</span>
        }

        <span style="color:green;">// Do a modulo-97 operation on the large integer</span>
<span style="color:green;">        // We cannot use PHP's modulo operator, so we calculate the</span>
<span style="color:green;">        // modulo step-wisely instead</span>
        if <span style="color:red;">($rest != 1)</span><span style="color:green;">(1 !== $this-&gt;bigModulo97($checkSum))</span> {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

            return;
        }
    }

    <span style="color:green;">private function toBigInt($string)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $chars = str_split($string);</span>
<span style="color:green;">        $bigInt = '';</span>

<span style="color:green;">        foreach ($chars as $char) {</span>
<span style="color:green;">            // Convert uppercase characters to ordinals, starting with 10 for &quot;A&quot;</span>
<span style="color:green;">            if (ctype_upper($char)) {</span>
<span style="color:green;">                $bigInt .= (ord($char) - 55);</span>

<span style="color:green;">                continue;</span>
<span style="color:green;">            }</span>

<span style="color:green;">            // Disallow lowercase characters</span>
<span style="color:green;">            if (ctype_lower($char)) {</span>
<span style="color:green;">                return false;</span>
<span style="color:green;">            }</span>

<span style="color:green;">            // Simply append digits</span>
<span style="color:green;">            $bigInt .= $char;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return $bigInt;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function bigModulo97($bigInt)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $parts = str_split($bigInt, 7);</span>
<span style="color:green;">        $rest = 0;</span>

<span style="color:green;">        foreach ($parts as $part) {</span>
<span style="color:green;">            $rest = ($rest.$part) % 97;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return $rest;</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/IpValidator.php b/src/Symfony/Component/Validator/Constraints/IpValidator.php</span>
<span style="font-weight:bold;">index 69afe61b71..5ebda4e9e2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/IpValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/IpValidator.php</span>
<span style="color:teal;">@@ -91,7 +91,9 @@</span> class IpValidator extends ConstraintValidator
        }

        if (!filter_var($value, FILTER_VALIDATE_IP, $flag)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/Isbn.php b/src/Symfony/Component/Validator/Constraints/Isbn.php</span>
<span style="font-weight:bold;">index 6c978cf3b8..bd61f4b539 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/Isbn.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/Isbn.php</span>
<span style="color:teal;">@@ -42,5 +42,8 @@</span> class Isbn extends Constraint
        if (null === $this-&gt;isbn10 &amp;&amp; null === $this-&gt;isbn13) {
            throw new MissingOptionsException(sprintf('Either option &quot;isbn10&quot; or &quot;isbn13&quot; must be given for constraint &quot;%s&quot;.', __CLASS__), array('isbn10', 'isbn13'));
        }

        <span style="color:green;">$this-&gt;isbn10 = (bool) $this-&gt;isbn10;</span>
<span style="color:green;">        $this-&gt;isbn13 = (bool) $this-&gt;isbn13;</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/IsbnValidator.php b/src/Symfony/Component/Validator/Constraints/IsbnValidator.php</span>
<span style="font-weight:bold;">index a000e382ed..5fee10e718 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/IsbnValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/IsbnValidator.php</span>
<span style="color:teal;">@@ -19,6 +19,7 @@</span> use Symfony\Component\Validator\Exception\UnexpectedTypeException;
 * Validates whether the value is a valid ISBN-10 or ISBN-13.
 *
 * @author The Whole Life To Learn &lt;thewholelifetolearn@gmail.com&gt;
 <span style="color:green;">* @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
 *
 * @see https://en.wikipedia.org/wiki/Isbn
 */
<span style="color:teal;">@@ -37,53 +38,71 @@</span> class IsbnValidator extends ConstraintValidator
            throw new UnexpectedTypeException($value, 'string');
        }

<span style="color:red;">if (!is_numeric($value)) {</span>        $value = <span style="color:red;">str_replace('-',</span><span style="color:green;">(string) $value;</span>
<span style="color:green;">        $canonical = strtoupper(str_replace('-',</span> '', <span style="color:red;">$value);</span>
<span style="color:red;">        }</span><span style="color:green;">$value));</span>

<span style="color:red;">$validation = 0;</span>
<span style="color:red;">        $value = strtoupper($value);</span>
<span style="color:red;">        $valueLength = strlen($value);</span>        if <span style="color:red;">(10 === $valueLength</span><span style="color:green;">($constraint-&gt;isbn10</span> &amp;&amp; <span style="color:red;">null !== $constraint-&gt;isbn10)</span><span style="color:green;">$this-&gt;isValidIsbn10($canonical))</span> {
            <span style="color:red;">for ($i = 0; $i &lt; 10; $i++) {</span>
<span style="color:red;">                if ($value[$i] == 'X') {</span>
<span style="color:red;">                    $validation += 10 * intval(10 - $i);</span>
<span style="color:red;">                } else {</span>
<span style="color:red;">                    $validation += intval($value[$i]) * intval(10 - $i);</span>
<span style="color:red;">                }</span><span style="color:green;">return;</span>
        }

        if <span style="color:red;">($validation % 11 != 0) {</span>
<span style="color:red;">                if (null !== $constraint-&gt;isbn13) {</span>
<span style="color:red;">                    $this-&gt;context-&gt;addViolation($constraint-&gt;bothIsbnMessage);</span>
<span style="color:red;">                } else {</span>
<span style="color:red;">                    $this-&gt;context-&gt;addViolation($constraint-&gt;isbn10Message);</span>
<span style="color:red;">                }</span>
<span style="color:red;">            }</span>
<span style="color:red;">        } elseif (13 === $valueLength</span><span style="color:green;">($constraint-&gt;isbn13</span> &amp;&amp; <span style="color:red;">null !== $constraint-&gt;isbn13) {</span>
<span style="color:red;">            for ($i = 0; $i &lt; 13; $i += 2) {</span>
<span style="color:red;">                $validation += intval($value[$i]);</span>
<span style="color:red;">            }</span>
<span style="color:red;">            for ($i = 1; $i &lt; 12; $i += 2)</span><span style="color:green;">$this-&gt;isValidIsbn13($canonical))</span> {
            <span style="color:red;">$validation += intval($value[$i]) * 3;</span><span style="color:green;">return;</span>
        }

        if <span style="color:red;">($validation % 10 != 0)</span><span style="color:green;">($constraint-&gt;isbn10 &amp;&amp; $constraint-&gt;isbn13)</span> {
            <span style="color:red;">if (null !== $constraint-&gt;isbn10) {</span>
<span style="color:red;">                    $this-&gt;context-&gt;addViolation($constraint-&gt;bothIsbnMessage);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;bothIsbnMessage, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        } <span style="color:red;">else</span><span style="color:green;">elseif ($constraint-&gt;isbn10)</span> {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;isbn13Message);</span>
<span style="color:red;">                }</span>
<span style="color:red;">            }</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;isbn10Message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        } else {
            <span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;isbn13Message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function isValidIsbn10($isbn)</span>
<span style="color:green;">    {</span>
        if <span style="color:red;">(null</span><span style="color:green;">(10</span> !== <span style="color:red;">$constraint-&gt;isbn10 &amp;&amp; null !== $constraint-&gt;isbn13)</span><span style="color:green;">strlen($isbn))</span> {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;bothIsbnMessage);</span><span style="color:green;">return false;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $checkSum = 0;</span>

<span style="color:green;">        for ($i = 0; $i &lt; 10; ++$i) {</span>
<span style="color:green;">            if ('X' === $isbn{$i}) {</span>
<span style="color:green;">                $digit = 10;</span>
            } elseif <span style="color:red;">(null !== $constraint-&gt;isbn10)</span><span style="color:green;">(ctype_digit($isbn{$i}))</span> {
                <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;isbn10Message);</span><span style="color:green;">$digit = $isbn{$i};</span>
            } else {
                <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;isbn13Message);</span><span style="color:green;">return false;</span>
            }

            <span style="color:green;">$checkSum += $digit * intval(10 - $i);</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return 0 === $checkSum % 11;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    private function isValidIsbn13($isbn)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (13 !== strlen($isbn) || !ctype_digit($isbn)) {</span>
<span style="color:green;">            return false;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        $checkSum = 0;</span>

<span style="color:green;">        for ($i = 0; $i &lt; 13; $i += 2) {</span>
<span style="color:green;">            $checkSum += $isbn{$i};</span>
        }

        <span style="color:green;">for ($i = 1; $i &lt; 12; $i += 2) {</span>
<span style="color:green;">            $checkSum += $isbn{$i} * 3;</span>
<span style="color:green;">        }</span>

<span style="color:green;">        return 0 === $checkSum % 10;</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/IssnValidator.php b/src/Symfony/Component/Validator/Constraints/IssnValidator.php</span>
<span style="font-weight:bold;">index 0e580ea96c..301b40d2d9 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/IssnValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/IssnValidator.php</span>
<span style="color:teal;">@@ -37,26 +37,35 @@</span> class IssnValidator extends ConstraintValidator
            throw new UnexpectedTypeException($value, 'string');
        }

        <span style="color:green;">$value = (string) $value;</span>

        // Compose regex pattern
        $digitsPattern = $constraint-&gt;requireHyphen ? '\d{4}-\d{3}' : '\d{4}-?\d{3}';
        <span style="color:red;">$checksumPattern</span><span style="color:green;">$checkSumPattern</span> = $constraint-&gt;caseSensitive ? '[\d|X]' : '[\d|X|x]';
        $pattern = <span style="color:red;">&quot;/^&quot;.$digitsPattern.$checksumPattern.&quot;$/&quot;;</span><span style="color:green;">&quot;/^&quot;.$digitsPattern.$checkSumPattern.&quot;$/&quot;;</span>

        if (!preg_match($pattern, $value)) {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

<span style="color:green;">            return;</span>
        }

        <span style="color:red;">else {</span>
<span style="color:red;">            $digits</span><span style="color:green;">$canonical</span> = <span style="color:red;">str_split(strtoupper(str_replace('-',</span><span style="color:green;">strtoupper(str_replace('-',</span> '', <span style="color:red;">$value)));</span><span style="color:green;">$value));</span>

        <span style="color:red;">$sum</span><span style="color:green;">// Calculate a checksum. &quot;X&quot; equals 10.</span>
<span style="color:green;">        $checkSum</span> = <span style="color:red;">0;</span>
<span style="color:red;">            for ($i = 8; $i &gt; 1; $i--) {</span>
<span style="color:red;">                $sum += $i * (int) array_shift($digits);</span>
<span style="color:red;">            }</span><span style="color:green;">'X' === $canonical{7} ? 10 : $canonical{7};</span>

        <span style="color:red;">$checksum</span><span style="color:green;">for ($i</span> = <span style="color:red;">'X' == reset($digits) ? 10 : (int) reset($digits);</span><span style="color:green;">0; $i &lt; 7; ++$i) {</span>
<span style="color:green;">            // Multiply the first digit by 8, the second by 7, etc.</span>
<span style="color:green;">            $checkSum += (8-$i) * $canonical{$i};</span>
<span style="color:green;">        }</span>

        if (0 <span style="color:red;">!= ($sum + $checksum)</span><span style="color:green;">!== $checkSum</span> % 11) {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span>
<span style="color:red;">            }</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/LanguageValidator.php b/src/Symfony/Component/Validator/Constraints/LanguageValidator.php</span>
<span style="font-weight:bold;">index 87019705db..8b048b8a48 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/LanguageValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/LanguageValidator.php</span>
<span style="color:teal;">@@ -42,7 +42,9 @@</span> class LanguageValidator extends ConstraintValidator
        $languages = Intl::getLanguageBundle()-&gt;getLanguageNames();

        if (!isset($languages[$value])) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/LengthValidator.php b/src/Symfony/Component/Validator/Constraints/LengthValidator.php</span>
<span style="font-weight:bold;">index 8dc68483c8..ceccde5a61 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/LengthValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/LengthValidator.php</span>
<span style="color:teal;">@@ -45,7 +45,7 @@</span> class LengthValidator extends ConstraintValidator

        if ($constraint-&gt;min == $constraint-&gt;max &amp;&amp; $length != $constraint-&gt;min) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;exactMessage, array(
                '{{ value }}' =&gt; <span style="color:red;">$stringValue,</span><span style="color:green;">$this-&gt;formatValue($stringValue),</span>
                '{{ limit }}' =&gt; $constraint-&gt;min,
            ), $value, (int) $constraint-&gt;min);

<span style="color:teal;">@@ -54,7 +54,7 @@</span> class LengthValidator extends ConstraintValidator

        if (null !== $constraint-&gt;max &amp;&amp; $length &gt; $constraint-&gt;max) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;maxMessage, array(
                '{{ value }}' =&gt; <span style="color:red;">$stringValue,</span><span style="color:green;">$this-&gt;formatValue($stringValue),</span>
                '{{ limit }}' =&gt; $constraint-&gt;max,
            ), $value, (int) $constraint-&gt;max);

<span style="color:teal;">@@ -63,7 +63,7 @@</span> class LengthValidator extends ConstraintValidator

        if (null !== $constraint-&gt;min &amp;&amp; $length &lt; $constraint-&gt;min) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;minMessage, array(
                '{{ value }}' =&gt; <span style="color:red;">$stringValue,</span><span style="color:green;">$this-&gt;formatValue($stringValue),</span>
                '{{ limit }}' =&gt; $constraint-&gt;min,
            ), $value, (int) $constraint-&gt;min);
        }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/LocaleValidator.php b/src/Symfony/Component/Validator/Constraints/LocaleValidator.php</span>
<span style="font-weight:bold;">index daf594800b..1d887d58f0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/LocaleValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/LocaleValidator.php</span>
<span style="color:teal;">@@ -42,7 +42,9 @@</span> class LocaleValidator extends ConstraintValidator
        $locales = Intl::getLocaleBundle()-&gt;getLocaleNames();

        if (!isset($locales[$value])) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/LuhnValidator.php b/src/Symfony/Component/Validator/Constraints/LuhnValidator.php</span>
<span style="font-weight:bold;">index d3802fe99a..29d2a5dfe0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/LuhnValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/LuhnValidator.php</span>
<span style="color:teal;">@@ -24,14 +24,17 @@</span> use Symfony\Component\Validator\Exception\UnexpectedTypeException;
 * @see    http://en.wikipedia.org/wiki/Luhn_algorithm
 * @author Tim Nagel &lt;t.nagel@infinite.net.au&gt;
 * @author Greg Knapp http://gregk.me/2011/php-implementation-of-bank-card-luhn-algorithm/
 <span style="color:green;">* @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
 */
class LuhnValidator extends ConstraintValidator
{
    /**
     * Validates a <span style="color:red;">creditcard</span><span style="color:green;">credit card</span> number with the Luhn algorithm.
     *
     * @param mixed      $value
     * @param Constraint $constraint
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws UnexpectedTypeException when the given credit card number is no string</span>
     */
    public function validate($value, Constraint $constraint)
    {
<span style="color:teal;">@@ -39,28 +42,48 @@</span> class LuhnValidator extends ConstraintValidator
            return;
        }

        <span style="color:red;">/**</span>
<span style="color:red;">         * need to work</span><span style="color:green;">// Work</span> with strings <span style="color:red;">only</span><span style="color:green;">only,</span> because long numbers are <span style="color:red;">treated</span><span style="color:green;">represented</span> as floats
        <span style="color:green;">// internally</span> and don't work with <span style="color:red;">strlen</span>
<span style="color:red;">         */</span><span style="color:green;">strlen()</span>
        if <span style="color:red;">(!is_string($value))</span><span style="color:green;">(!is_string($value) &amp;&amp; !(is_object($value) &amp;&amp; method_exists($value, '__toString')))</span> {
            throw new UnexpectedTypeException($value, 'string');
        }

        <span style="color:green;">$value = (string) $value;</span>

        if <span style="color:red;">(!is_numeric($value))</span><span style="color:green;">(!ctype_digit($value))</span> {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>

            return;
        }

        <span style="color:green;">$checkSum = 0;</span>
        $length = strlen($value);

        <span style="color:red;">$oddLength</span><span style="color:green;">// Starting with the last digit and walking left, add every second</span>
<span style="color:green;">        // digit to the check sum</span>
<span style="color:green;">        // e.g. 7  9  9  2  7  3  9  8  7  1  3</span>
<span style="color:green;">        //      ^     ^     ^     ^     ^     ^</span>
<span style="color:green;">        //</span>    = <span style="color:red;">$length % 2;</span><span style="color:green;">7  +  9  +  7  +  9  +  7  +  3</span>
        for <span style="color:red;">($sum = 0, $i</span><span style="color:green;">($i</span> = $length - 1; $i &gt;= 0; <span style="color:red;">$i--)</span><span style="color:green;">$i -= 2)</span> {
            <span style="color:red;">$digit = (int) $value[$i];</span>
<span style="color:red;">            $sum</span><span style="color:green;">$checkSum</span> += <span style="color:red;">(($i %</span><span style="color:green;">$value{$i};</span>
<span style="color:green;">        }</span>

<span style="color:green;">        // Starting with the second last digit and walking left, double every</span>
<span style="color:green;">        // second digit and add it to the check sum</span>
<span style="color:green;">        // For doubles greater than 9, sum the individual digits</span>
<span style="color:green;">        // e.g. 7  9  9  2  7  3  9  8  7  1  3</span>
<span style="color:green;">        //         ^     ^     ^     ^     ^</span>
<span style="color:green;">        //    =    1+8 + 4  +  6  +  1+6 + 2</span>
<span style="color:green;">        for ($i = $length - 2; $i &gt;= 0; $i -=</span> 2) <span style="color:red;">=== $oddLength) ? array_sum(str_split($digit</span><span style="color:green;">{</span>
<span style="color:green;">            $checkSum += array_sum(str_split($value{$i}</span> * <span style="color:red;">2)) : $digit;</span><span style="color:green;">2));</span>
        }

        if <span style="color:red;">($sum</span><span style="color:green;">(0</span> === <span style="color:red;">0</span><span style="color:green;">$checkSum</span> || <span style="color:red;">($sum</span><span style="color:green;">0 !== $checkSum</span> % 10)<span style="color:red;">!== 0)</span> {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/NotBlankValidator.php b/src/Symfony/Component/Validator/Constraints/NotBlankValidator.php</span>
<span style="font-weight:bold;">index 98c2730fe8..945803348b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/NotBlankValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/NotBlankValidator.php</span>
<span style="color:teal;">@@ -27,7 +27,9 @@</span> class NotBlankValidator extends ConstraintValidator
    public function validate($value, Constraint $constraint)
    {
        if (false === $value || (empty($value) &amp;&amp; '0' != $value)) {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/NullValidator.php b/src/Symfony/Component/Validator/Constraints/NullValidator.php</span>
<span style="font-weight:bold;">index f0f09c492f..9c5deb36e7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/NullValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/NullValidator.php</span>
<span style="color:teal;">@@ -27,13 +27,9 @@</span> class NullValidator extends ConstraintValidator
    public function validate($value, Constraint $constraint)
    {
        if (null !== $value) {
<span style="color:red;">if (is_object($value)) {</span>
<span style="color:red;">                $value = get_class($value);</span>
<span style="color:red;">            } elseif (is_array($value)) {</span>
<span style="color:red;">                $value = 'Array';</span>
<span style="color:red;">            }</span>            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/RangeValidator.php b/src/Symfony/Component/Validator/Constraints/RangeValidator.php</span>
<span style="font-weight:bold;">index 6f0ad51dba..c2df195b81 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/RangeValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/RangeValidator.php</span>
<span style="color:teal;">@@ -30,7 +30,7 @@</span> class RangeValidator extends ConstraintValidator

        if (!is_numeric($value)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;invalidMessage, array(
                '{{ value }}' =&gt; <span style="color:red;">$value,</span><span style="color:green;">$this-&gt;formatValue($value),</span>
            ));

            return;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/RegexValidator.php b/src/Symfony/Component/Validator/Constraints/RegexValidator.php</span>
<span style="font-weight:bold;">index 1f2febbbca..88ea8ae05b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/RegexValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/RegexValidator.php</span>
<span style="color:teal;">@@ -41,7 +41,9 @@</span> class RegexValidator extends ConstraintValidator
        $value = (string) $value;

        if ($constraint-&gt;match xor preg_match($constraint-&gt;pattern, $value)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/TimeValidator.php b/src/Symfony/Component/Validator/Constraints/TimeValidator.php</span>
<span style="font-weight:bold;">index cbaa816d1a..a7c2b27ad0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/TimeValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/TimeValidator.php</span>
<span style="color:teal;">@@ -40,7 +40,9 @@</span> class TimeValidator extends ConstraintValidator
        $value = (string) $value;

        if (!preg_match(static::PATTERN, $value)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/TrueValidator.php b/src/Symfony/Component/Validator/Constraints/TrueValidator.php</span>
<span style="font-weight:bold;">index 5ef74fd274..480230a909 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/TrueValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/TrueValidator.php</span>
<span style="color:teal;">@@ -31,7 +31,9 @@</span> class TrueValidator extends ConstraintValidator
        }

        if (true !== $value &amp;&amp; 1 !== $value &amp;&amp; '1' !== $value) {
            <span style="color:red;">$this-&gt;context-&gt;addViolation($constraint-&gt;message);</span><span style="color:green;">$this-&gt;context-&gt;addViolation($constraint-&gt;message, array(</span>
<span style="color:green;">                '{{ value }}' =&gt; $this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/TypeValidator.php b/src/Symfony/Component/Validator/Constraints/TypeValidator.php</span>
<span style="font-weight:bold;">index f75bb0fd8b..237546a5b9 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/TypeValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/TypeValidator.php</span>
<span style="color:teal;">@@ -44,7 +44,7 @@</span> class TypeValidator extends ConstraintValidator
        }

        $this-&gt;context-&gt;addViolation($constraint-&gt;message, array(
            '{{ value }}' =&gt; <span style="color:red;">is_object($value) ? get_class($value) : (is_array($value) ? 'Array' : (string) $value),</span><span style="color:green;">$this-&gt;formatValue($value),</span>
            '{{ type }}'  =&gt; $constraint-&gt;type,
        ));
    }
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Constraints/UrlValidator.php b/src/Symfony/Component/Validator/Constraints/UrlValidator.php</span>
<span style="font-weight:bold;">index 8ea05120bc..1e7750c2ff 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Constraints/UrlValidator.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Constraints/UrlValidator.php</span>
<span style="color:teal;">@@ -24,6 +24,7 @@</span> class UrlValidator extends ConstraintValidator
{
    const PATTERN = '~^
            (%s)://                                 # protocol
            <span style="color:green;">(([\pL\pN-]+:)?([\pL\pN-]+)@)?          # basic auth</span>
            (
                ([\pL\pN\pS-]+\.)+([\pL]|xn\-\-[\pL\pN-]+)+                   # a domain name
                    |                                     #  or
<span style="color:teal;">@@ -51,11 +52,12 @@</span> class UrlValidator extends ConstraintValidator
        }

        $value = (string) $value;

        $pattern = sprintf(static::PATTERN, implode('|', $constraint-&gt;protocols));

        if (!preg_match($pattern, $value)) {
            $this-&gt;context-&gt;addViolation($constraint-&gt;message, <span style="color:red;">array('{{</span><span style="color:green;">array(</span>
<span style="color:green;">                '{{</span> value }}' =&gt; <span style="color:red;">$value));</span><span style="color:green;">$this-&gt;formatValue($value),</span>
<span style="color:green;">            ));</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Mapping/ClassMetadata.php b/src/Symfony/Component/Validator/Mapping/ClassMetadata.php</span>
<span style="font-weight:bold;">index 553d7806ad..792d8e5140 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Mapping/ClassMetadata.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Mapping/ClassMetadata.php</span>
<span style="color:teal;">@@ -298,6 +298,10 @@</span> class ClassMetadata extends ElementMetadata implements MetadataInterface, ClassB
     */
    public function getMemberMetadatas($property)
    {
        <span style="color:green;">if (!isset($this-&gt;members[$property])) {</span>
<span style="color:green;">            return array();</span>
<span style="color:green;">        }</span>

        return $this-&gt;members[$property];
    }

<span style="color:teal;">@@ -314,6 +318,10 @@</span> class ClassMetadata extends ElementMetadata implements MetadataInterface, ClassB
     */
    public function getPropertyMetadata($property)
    {
        <span style="color:green;">if (!isset($this-&gt;members[$property])) {</span>
<span style="color:green;">            return array();</span>
<span style="color:green;">        }</span>

        return $this-&gt;members[$property];
    }

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.af.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.af.xlf</span>
<span style="font-weight:bold;">index 6100400159..8cb8bf4ddb 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.af.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.af.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Een of meer van die gegewe waardes is ongeldig.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                &lt;target&gt;Die <span style="color:red;">velde {{ fields }}</span><span style="color:green;">veld</span> is nie verwag nie.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Die velde {{ fields }}</span><span style="color:green;">&lt;target&gt;Hierdie veld</span> ontbreek.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.ar.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.ar.xlf</span>
<span style="font-weight:bold;">index 2fbc304106..2c83daf09e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.ar.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.ar.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;واحد أو أكثر من القيم المعطاه خاطئ.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;القيم {{ fields }} لم تكن متوقعة.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;لم يكن من المتوقع هذا المجال.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;القيم {{ fields }} مفقودة.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;هذا المجال مفقود.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.bg.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.bg.xlf</span>
<span style="font-weight:bold;">index 4f96dbb5b8..d1c2b1f785 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.bg.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.bg.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Една или повече от зададените стойности е невалидна.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Полетата {{ fields }}</span><span style="color:green;">&lt;target&gt;Това поле</span> не <span style="color:red;">бяха очаквани.&lt;/target&gt;</span><span style="color:green;">се е очаквало.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Полетата {{ fields }} липсват.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Това поле липсва.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.ca.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.ca.xlf</span>
<span style="font-weight:bold;">index 4b42b819b9..569a7c7030 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.ca.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.ca.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Un o més dels valors facilitats són incorrectes.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;No s'esperaven els camps {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Aquest camp no s'esperava.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Falten els camps {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Aquest camp està desaparegut.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -278,6 +278,26 @@</span>
                &lt;source&gt;This value should not be identical to {{ compared_value_type }} {{ compared_value }}.&lt;/source&gt;
                &lt;target&gt;Aquest valor no hauria de idèntic a {{ compared_value_type }} {{ compared_value }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            <span style="color:green;">&lt;trans-unit id=&quot;73&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image ratio is too big ({{ ratio }}). Allowed maximum ratio is {{ max_ratio }}.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;La proporció de l'imatge és massa gran ({{ ratio }}). La màxima proporció permesa és {{ max_ratio }}.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;74&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image ratio is too small ({{ ratio }}). Minimum ratio expected is {{ min_ratio }}.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;La proporció de l'imatge és massa petita ({{ ratio }}). La mínima proporció permesa és {{ max_ratio }}.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;75&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is square ({{ width }}x{{ height }}px). Square images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;L'imatge és quadrada({{ width }}x{{ height }}px). Les imatges quadrades no estan permeses.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;76&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is landscape oriented ({{ width }}x{{ height }}px). Landscape oriented images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;L'imatge està orientada horitzontalment ({{ width }}x{{ height }}px). Les imatges orientades horitzontalment no estan permeses.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;77&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is portrait oriented ({{ width }}x{{ height }}px). Portrait oriented images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;L'imatge està orientada verticalment ({{ width }}x{{ height }}px). Les imatges orientades verticalment no estan permeses.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
        &lt;/body&gt;
    &lt;/file&gt;
&lt;/xliff&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.cs.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.cs.xlf</span>
<span style="font-weight:bold;">index 51de1275de..2cc09c974f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.cs.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.cs.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Některé z uvedených hodnot jsou neplatné.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Neočekávaná</span><span style="color:green;">&lt;target&gt;Toto</span> pole <span style="color:red;">{{ fields }}.&lt;/target&gt;</span><span style="color:green;">nebyla očekávána.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Chybí následující</span><span style="color:green;">&lt;target&gt;Toto</span> pole <span style="color:red;">{{ fields }}.&lt;/target&gt;</span><span style="color:green;">chybí.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.cy.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.cy.xlf</span>
<span style="font-weight:bold;">index b9f5f82d0c..fd62ba2f27 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.cy.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.cy.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Mae un neu fwy o'r gwerthoedd a roddwyd yn annilys.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Roedd</span><span style="color:green;">&lt;target&gt;Nid oedd disgwyl</span> y <span style="color:red;">maesydd {{ fields }} yn anisgwyl.&lt;/target&gt;</span><span style="color:green;">maes hwn.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Roedd y maesydd {{ fields }}</span><span style="color:green;">&lt;target&gt;Mae'r maes hwn</span> ar goll.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.da.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.da.xlf</span>
<span style="font-weight:bold;">index 8b355145cf..ccc6bfb016 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.da.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.da.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;En eller flere af de oplyste værdier er ugyldige.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Felterne {{ fields }} var</span><span style="color:green;">&lt;target&gt;Feltet blev</span> ikke forventet.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Felterne {{ fields }}</span><span style="color:green;">&lt;target&gt;Dette felt er</span> mangler.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.de.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.de.xlf</span>
<span style="font-weight:bold;">index 8f6144eead..b29172dd4f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.de.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.de.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Einer oder mehrere der angegebenen Werte sind ungültig.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Die Felder {{ fields }} wurden</span><span style="color:green;">&lt;target&gt;Dieses Feld wurde</span> nicht erwartet.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Die erwarteten Felder {{ fields }} fehlen.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Dieses Feld fehlt.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.el.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.el.xlf</span>
<span style="font-weight:bold;">index 6bf3c146e9..3e90c3cd2c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.el.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.el.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Μια ή περισσότερες τιμές δεν είναι έγκυρες.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Τα πεδία {{ fields }}</span><span style="color:green;">&lt;target&gt;Αυτό το πεδίο</span> δεν ήταν <span style="color:red;">αναμενόμενα.&lt;/target&gt;</span><span style="color:green;">αναμενόμενο.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Τα πεδία {{ fields }} απουσιάζουν.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Λείπει αυτό το πεδίο.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.en.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.en.xlf</span>
<span style="font-weight:bold;">index 06cc77e399..d9c25c3c18 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.en.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.en.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;One or more of the given values is invalid.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;target&gt;This field was</span> not expected.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;target&gt;This field is</span> missing.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.es.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.es.xlf</span>
<span style="font-weight:bold;">index 2765fa2ae4..fafec155c0 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.es.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.es.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Uno o más de los valores indicados no son válidos.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;No</span><span style="color:green;">&lt;target&gt;Este campo no</span> se <span style="color:red;">esperaban los campos {{ fields }}.&lt;/target&gt;</span><span style="color:green;">esperaba.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Faltan los campos {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Este campo está desaparecido.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -160,19 +160,19 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;43&quot;&gt;
                &lt;source&gt;The image width is too big ({{ width }}px). Allowed maximum width is {{ max_width }}px.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;La anchura</span><span style="color:green;">&lt;target&gt;El ancho</span> de la imagen es demasiado grande ({{ width }}px). <span style="color:red;">La anchura máxima permitida son</span><span style="color:green;">El ancho máximo permitido es de</span> {{ max_width }}px.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;44&quot;&gt;
                &lt;source&gt;The image width is too small ({{ width }}px). Minimum width expected is {{ min_width }}px.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;La anchura</span><span style="color:green;">&lt;target&gt;El ancho</span> de la imagen es demasiado <span style="color:red;">pequeña</span><span style="color:green;">pequeño</span> ({{ width }}px). <span style="color:red;">La anchura mínima requerida son</span><span style="color:green;">El ancho mínimo requerido es</span> {{ min_width }}px.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;45&quot;&gt;
                &lt;source&gt;The image height is too big ({{ height }}px). Allowed maximum height is {{ max_height }}px.&lt;/source&gt;
                &lt;target&gt;La altura de la imagen es demasiado grande ({{ height }}px). La altura máxima permitida <span style="color:red;">son</span><span style="color:green;">es de</span> {{ max_height }}px.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;46&quot;&gt;
                &lt;source&gt;The image height is too small ({{ height }}px). Minimum height expected is {{ min_height }}px.&lt;/source&gt;
                &lt;target&gt;La altura de la imagen es demasiado pequeña ({{ height }}px). La altura mínima requerida <span style="color:red;">son</span><span style="color:green;">es de</span> {{ min_height }}px.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;47&quot;&gt;
                &lt;source&gt;This value should be the user current password.&lt;/source&gt;
<span style="color:teal;">@@ -280,23 +280,23 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;73&quot;&gt;
                &lt;source&gt;The image ratio is too big ({{ ratio }}). Allowed maximum ratio is {{ max_ratio }}.&lt;/source&gt;
                &lt;target&gt;La proporción de la imagen es demasiado grande ({{ ratio }}). <span style="color:red;">Maxima</span><span style="color:green;">La máxima</span> proporción permitida es {{ max_ratio }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;74&quot;&gt;
                &lt;source&gt;The image ratio is too small ({{ ratio }}). Minimum ratio expected is {{ min_ratio }}.&lt;/source&gt;
                &lt;target&gt;La proporción de la imagen es demasiado pequeña ({{ ratio }}). <span style="color:red;">Mínima</span><span style="color:green;">La mínima</span> proporción permitida es {{ min_ratio }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;75&quot;&gt;
                &lt;source&gt;The image is square ({{ width }}x{{ height }}px). Square images are not allowed.&lt;/source&gt;
                &lt;target&gt;La imagen es cuadrada ({{ width }}x{{ height }}px). <span style="color:red;">Imágenes</span><span style="color:green;">Las imágenes</span> cuadradas no <span style="color:red;">son</span><span style="color:green;">están</span> permitidas.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;76&quot;&gt;
                &lt;source&gt;The image is landscape oriented ({{ width }}x{{ height }}px). Landscape oriented images are not allowed.&lt;/source&gt;
                &lt;target&gt;La imagen está orientada <span style="color:red;">horizontal</span><span style="color:green;">horizontalmente</span> ({{ width }}x{{ height }}px). <span style="color:red;">Imágenes orientada horizontal</span><span style="color:green;">Las imágenes orientadas horizontalmente</span> no <span style="color:red;">está permitido.&lt;/target&gt;</span><span style="color:green;">están permitidas.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;77&quot;&gt;
                &lt;source&gt;The image is portrait oriented ({{ width }}x{{ height }}px). Portrait oriented images are not allowed.&lt;/source&gt;
                &lt;target&gt;La imagen está orientada <span style="color:red;">vertical</span><span style="color:green;">verticalmente</span> ({{ width }}x{{ height }}px). <span style="color:red;">Imágenes orientada vertical</span><span style="color:green;">Las imágenes orientadas verticalmente</span> no <span style="color:red;">está permitido.&lt;/target&gt;</span><span style="color:green;">están permitidas.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
        &lt;/body&gt;
    &lt;/file&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.et.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.et.xlf</span>
<span style="font-weight:bold;">index b296b6b82b..7208670e43 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.et.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.et.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;One or more of the given values is invalid.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Väljad {{ fields }} olid ootamatud.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;See väli ei oodatud.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Väljad {{ fields }}</span><span style="color:green;">&lt;target&gt;See väli</span> on puudu.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.eu.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.eu.xlf</span>
<span style="font-weight:bold;">index 62801cce83..298dd46254 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.eu.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.eu.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Emandako balioetatik gutxienez bat ez da egokia.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} eremuak</span><span style="color:green;">&lt;target&gt;Eremu hau</span> ez <span style="color:red;">ziren</span><span style="color:green;">zen</span> espero.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} eremuak</span><span style="color:green;">&lt;target&gt;Eremu hau</span> falta <span style="color:red;">dira.&lt;/target&gt;</span><span style="color:green;">da.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.fi.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.fi.xlf</span>
<span style="font-weight:bold;">index 99f90b09f1..26f0177148 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.fi.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.fi.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Yksi tai useampi annetuista arvoista on virheellinen.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Odottamattomia kenttiä {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Tässä kentässä ei odotettu.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Kentät {{ fields }} puuttuvat.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Tämä kenttä puuttuu.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.fr.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.fr.xlf</span>
<span style="font-weight:bold;">index 2a4f92342c..102d86b3c8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.fr.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.fr.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Une ou plusieurs des valeurs soumises sont invalides.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Les champs {{ fields }} n'ont</span><span style="color:green;">&lt;target&gt;Ce champ n'a</span> pas été <span style="color:red;">prévus.&lt;/target&gt;</span><span style="color:green;">prévu.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Les champs {{ fields }} sont manquants.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ce champ est manquant.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.gl.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.gl.xlf</span>
<span style="font-weight:bold;">index 7d9f34ccee..13c7ffe0d2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.gl.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.gl.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Un ou máis dos valores indicados non son válidos.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Non se esperaban os campos {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Este campo non era esperado.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Faltan os campos {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Este campo falta.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.he.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.he.xlf</span>
<span style="font-weight:bold;">index 520e5bae72..fb8c7c6cc5 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.he.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.he.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;אחד או יותר מהערכים אינו חוקי.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;השדות {{ fields }}</span><span style="color:green;">&lt;target&gt;שדה זה</span> לא <span style="color:red;">היו צפויים.&lt;/target&gt;</span><span style="color:green;">היה צפוי&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;השדות {{ fields }} חסרים.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;שדה זה חסר.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.hr.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.hr.xlf</span>
<span style="font-weight:bold;">index bfe76e6e8c..53f914b25f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.hr.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.hr.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Jedna ili više danih vrijednosti nije ispravna.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} nisu bila očekivana.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ovo polje nije očekivalo.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} nedostaju.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ovo polje nedostaje.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.hu.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.hu.xlf</span>
<span style="font-weight:bold;">index 94c71d540c..2e15f3a915 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.hu.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.hu.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;A megadott értékek közül legalább egy érvénytelen.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Váratlan mezők: {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ez a mező nem számítottak.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;A következő mezők hiányoznak: {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ez a mező hiányzik.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.hy.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.hy.xlf</span>
<span style="font-weight:bold;">index 262b93b8bc..3c1404975f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.hy.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.hy.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Մեկ կամ ավելի տրված արժեքները անթույլատրելի են.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} տողերը չէին</span><span style="color:green;">&lt;target&gt;Այս դաշտը չի</span> սպասվում.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} տողերը</span><span style="color:green;">&lt;target&gt;Այս դաշտը</span> բացակայում <span style="color:red;">են.&lt;/target&gt;</span><span style="color:green;">է.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.id.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.id.xlf</span>
<span style="font-weight:bold;">index 92d9c93788..f4e24d21ca 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.id.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.id.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Satu atau lebih nilai yang diberikan tidak sah.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Kolom {{ fields }}</span><span style="color:green;">&lt;target&gt;Bidang ini</span> tidak<span style="color:red;">seperti yang</span> diharapkan.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Kolom {{ fields }}</span><span style="color:green;">&lt;target&gt;Bidang ini</span> hilang.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.it.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.it.xlf</span>
<span style="font-weight:bold;">index 11db4d8743..8b765bf642 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.it.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.it.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Uno o più valori inseriti non sono validi.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;I campi {{ fields }}</span><span style="color:green;">&lt;target&gt;Questo campo</span> non <span style="color:red;">sono validi.&lt;/target&gt;</span><span style="color:green;">è stato previsto.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;I campi {{ fields }} sono mancanti.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Questo campo è manca.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.ja.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.ja.xlf</span>
<span style="font-weight:bold;">index 1366192f33..f90cc66381 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.ja.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.ja.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;無効な選択肢が含まれています。&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;フィールド{{ fields }}は無効です。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;このフィールドは予期されていませんでした。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;フィールド{{ fields }}は必須です。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;このフィールドは、欠落しています。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.lt.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.lt.xlf</span>
<span style="font-weight:bold;">index 58737da20f..5ee418170b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.lt.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.lt.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Viena ar daugiau įvestų reikšmių yra netinkamos.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Laukai {{ fields }} yra nenumatyti.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Nebuvo tikimasi Šis laukas.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Trūkstami laukai {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Šiame lauke yra dingęs.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.mn.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.mn.xlf</span>
<span style="font-weight:bold;">index e238061338..dfe7eebf6d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.mn.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.mn.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Өгөгдсөн нэг эсвэл нэгээс олон утга буруу байна.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;Талбарууд {{ fields }} зөвшөөрөгдөөгүй байна.&lt;/source&gt;</span>
<span style="color:red;">                &lt;target&gt;{{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;source&gt;This field was not expected.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Энэ талбар нь хүлээгдэж байсан юм.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} талбарууд дутуу</span><span style="color:green;">&lt;target&gt;Энэ талбар нь алга болсон</span> байна.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.nb.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.nb.xlf</span>
<span style="font-weight:bold;">index 086b8b0b08..a8b790c7d8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.nb.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.nb.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;En eller flere av de oppgitte verdier er ugyldige.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Feltene {{ fields }} var</span><span style="color:green;">&lt;target&gt;Dette feltet</span> ikke <span style="color:green;">var</span> forventet.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Feltene {{ fields }}</span><span style="color:green;">&lt;target&gt;Dette feltet</span> mangler.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.nl.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.nl.xlf</span>
<span style="font-weight:bold;">index 65aef859ad..a03061e75d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.nl.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.nl.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Eén of meer van de ingegeven waarden zijn ongeldig.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;De velden {{ fields }} werden</span><span style="color:green;">&lt;target&gt;Dit veld was</span> niet verwacht.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;De velden {{ fields }} ontbreken.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Dit veld ontbreekt.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -180,7 +180,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;48&quot;&gt;
                &lt;source&gt;This value should have exactly {{ limit }} character.|This value should have exactly {{ limit }} characters.&lt;/source&gt;
                &lt;target&gt;Deze waarde moet exact {{ limit }} <span style="color:green;">teken lang zijn.|Deze waarde moet exact {{ limit }}</span> tekens lang zijn.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;49&quot;&gt;
                &lt;source&gt;The file was only partially uploaded.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.no.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.no.xlf</span>
<span style="font-weight:bold;">index eeebabab24..566b82e947 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.no.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.no.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Ein eller fleire av dei opplyste verdiane er ugyldige.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Felta {{ fields }}</span><span style="color:green;">&lt;target&gt;Dette feltet</span> var <span style="color:red;">ikkje forventa.&lt;/target&gt;</span><span style="color:green;">ikke forventet.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Felta {{ fields }} manglar.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Dette feltet mangler.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.pl.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.pl.xlf</span>
<span style="font-weight:bold;">index 85c2e88c8a..93595f8a76 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.pl.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.pl.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Jedna lub więcej z podanych wartości jest nieprawidłowa.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Pola {{ fields }}</span><span style="color:green;">&lt;target&gt;To pole</span> nie <span style="color:red;">były oczekiwane.&lt;/target&gt;</span><span style="color:green;">spodziewano.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Brakuje pól {{ fields }}.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;To pole jest chybianie.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.pt.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.pt.xlf</span>
<span style="font-weight:bold;">index 6332c4886f..f685b16b27 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.pt.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.pt.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Um ou mais dos valores introduzidos não são válidos.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Os campos {{ fields }}</span><span style="color:green;">&lt;target&gt;Este campo</span> não <span style="color:red;">eram esperados.&lt;/target&gt;</span><span style="color:green;">era esperado.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Os campos {{ fields }} estão ausentes.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Este campo está faltando.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.pt_BR.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.pt_BR.xlf</span>
<span style="font-weight:bold;">index f74fe90615..8f3a556114 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.pt_BR.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.pt_BR.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Um ou mais valores informados são inválidos.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Os campos {{ fields }}</span><span style="color:green;">&lt;target&gt;Este campo</span> não <span style="color:red;">são esperados.&lt;/target&gt;</span><span style="color:green;">era esperado.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Os campos {{ fields }} estão ausentes.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Este campo está ausente.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -280,11 +280,11 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;73&quot;&gt;
                &lt;source&gt;The image ratio is too big ({{ ratio }}). Allowed maximum ratio is {{ max_ratio }}.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;O formato</span><span style="color:green;">&lt;target&gt;A proporção</span> da imagem é muito grande ({{ ratio }}). <span style="color:red;">O formato máximo</span><span style="color:green;">A proporção máxima permitida</span> é {{ max_ratio }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;74&quot;&gt;
                &lt;source&gt;The image ratio is too small ({{ ratio }}). Minimum ratio expected is {{ min_ratio }}.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;O formato</span><span style="color:green;">&lt;target&gt;A proporção</span> da imagem é muito <span style="color:red;">pequeno</span><span style="color:green;">pequena</span> ({{ ratio }}). <span style="color:red;">O formato mínimo esperado</span><span style="color:green;">A proporção mínima esperada</span> é {{ min_ratio }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;75&quot;&gt;
                &lt;source&gt;The image is square ({{ width }}x{{ height }}px). Square images are not allowed.&lt;/source&gt;
<span style="color:teal;">@@ -300,7 +300,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;78&quot;&gt;
                &lt;source&gt;An empty file is not allowed.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Ficheiro</span><span style="color:green;">&lt;target&gt;Arquivo</span> vazio não é permitido.&lt;/target&gt;
            &lt;/trans-unit&gt;
        &lt;/body&gt;
    &lt;/file&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.ro.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.ro.xlf</span>
<span style="font-weight:bold;">index e109eb3c4b..fa6e38e85a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.ro.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.ro.xlf</span>
<span style="color:teal;">@@ -24,23 +24,23 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;6&quot;&gt;
                &lt;source&gt;You must select at least {{ limit }} choice.|You must select at least {{ limit }} choices.&lt;/source&gt;
                &lt;target&gt;Trebuie să selectați cel puțin {{ limit }} <span style="color:red;">opțiuni.&lt;/target&gt;</span><span style="color:green;">opțiune.|Trebuie să selectați cel puțin {{ limit }} opțiuni.|Trebuie să selectați cel puțin {{ limit }} de opțiuni&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;7&quot;&gt;
                &lt;source&gt;You must select at most {{ limit }} choice.|You must select at most {{ limit }} choices.&lt;/source&gt;
                &lt;target&gt;Trebuie să selectați cel mult {{ limit }} <span style="color:green;">opțiune.|Trebuie să selectați cel mult {{ limit }} opțiuni.|Trebuie să selectați cel mult {{ limit }} de</span> opțiuni.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;8&quot;&gt;
                &lt;source&gt;One or more of the given values is invalid.&lt;/source&gt;
                &lt;target&gt;Una sau mai multe dintre valorile furnizate sunt invalide.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Câmpurile {{ fields }}</span><span style="color:green;">&lt;target&gt;Acest câmp</span> nu <span style="color:red;">erau așteptate.&lt;/target&gt;</span><span style="color:green;">era de aşteptat.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Câmpurile {{ fields }} lipsesc.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Acest câmp este lipsă.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -76,7 +76,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;19&quot;&gt;
                &lt;source&gt;This value is too long. It should have {{ limit }} character or less.|This value is too long. It should have {{ limit }} characters or less.&lt;/source&gt;
                &lt;target&gt;Această valoare este prea lungă. Ar trebui să aibă maxim {{ limit }} caracter.|Această valoare este prea lungă. Ar trebui să aibă maxim {{ limit }} <span style="color:green;">caractere.|Această valoare este prea lungă. Ar trebui să aibă maxim {{ limit }} de</span> caractere.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;20&quot;&gt;
                &lt;source&gt;This value should be {{ limit }} or more.&lt;/source&gt;
<span style="color:teal;">@@ -84,7 +84,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;21&quot;&gt;
                &lt;source&gt;This value is too short. It should have {{ limit }} character or more.|This value is too short. It should have {{ limit }} characters or more.&lt;/source&gt;
                &lt;target&gt;Această valoare este prea scurtă. Ar trebui să aibă minim {{ limit }} caracter.|Această valoare este prea scurtă. Ar trebui să aibă minim {{ limit }} <span style="color:green;">caractere.|Această valoare este prea scurtă. Ar trebui să aibă minim {{ limit }} de</span> caractere.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;22&quot;&gt;
                &lt;source&gt;This value should not be blank.&lt;/source&gt;
<span style="color:teal;">@@ -180,7 +180,7 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;48&quot;&gt;
                &lt;source&gt;This value should have exactly {{ limit }} character.|This value should have exactly {{ limit }} characters.&lt;/source&gt;
                &lt;target&gt;Această valoare trebuie să conțină exact {{ limit }} caracter.|Această valoare trebuie să conțină exact {{ limit }} <span style="color:green;">caractere.|Această valoare trebuie să conțină exact {{ limit }} de</span> caractere.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;49&quot;&gt;
                &lt;source&gt;The file was only partially uploaded.&lt;/source&gt;
<span style="color:teal;">@@ -204,15 +204,15 @@</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;54&quot;&gt;
                &lt;source&gt;This collection should contain {{ limit }} element or more.|This collection should contain {{ limit }} elements or more.&lt;/source&gt;
                &lt;target&gt;Această colecție trebuie să conțină cel puțin {{ limit }} <span style="color:green;">element.|Această colecție trebuie să conțină cel puțin {{ limit }} elemente.|Această colecție trebuie să conțină cel puțin {{ limit }} de</span> elemente.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;55&quot;&gt;
                &lt;source&gt;This collection should contain {{ limit }} element or less.|This collection should contain {{ limit }} elements or less.&lt;/source&gt;
                &lt;target&gt;Această colecție trebuie să conțină cel mult {{ limit }} <span style="color:green;">element.|Această colecție trebuie să conțină cel mult {{ limit }} elemente.|Această colecție trebuie să conțină cel mult {{ limit }} de</span> elemente.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;56&quot;&gt;
                &lt;source&gt;This collection should contain exactly {{ limit }} element.|This collection should contain exactly {{ limit }} elements.&lt;/source&gt;
                &lt;target&gt;Această colecție trebuie să conțină {{ limit }} <span style="color:green;">element.|Această colecție trebuie să conțină {{ limit }} elemente.|Această colecție trebuie să conțină {{ limit }} de</span> elemente.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;57&quot;&gt;
                &lt;source&gt;Invalid card number.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.ru.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.ru.xlf</span>
<span style="font-weight:bold;">index 0dd06e7897..aaca609974 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.ru.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.ru.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Одно или несколько заданных значений недопустимо.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поля {{ fields }}</span><span style="color:green;">&lt;target&gt;Это поле</span> не <span style="color:red;">ожидались.&lt;/target&gt;</span><span style="color:green;">ожидалось.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поля {{ fields }} отсутствуют.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Это поле отсутствует.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sk.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sk.xlf</span>
<span style="font-weight:bold;">index 5286002d5d..c3a699ee80 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sk.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sk.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Niektoré z uvedených hodnôt sú neplatné.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polia {{ fields }} neboli očakávané.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Toto pole sa neočakáva.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Chýbajú polia {{ fields }} .&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Toto pole chýba.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sl.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sl.xlf</span>
<span style="font-weight:bold;">index f23c20fdd3..41e8932857 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sl.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sl.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Ena ali več podanih vrednosti ni veljavnih.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} niso bila pričakovana.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;To polje ni bilo pričakovati.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} manjkajo.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;To polje manjka.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sq.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sq.xlf</span>
<span style="font-weight:bold;">index e6190fca11..f54ad56a22 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sq.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sq.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Një apo më shumë nga vlerat e dhëna nuk janë të sakta.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Fushat {{ fields }}</span><span style="color:green;">&lt;target&gt;Kjo fushë</span> nuk <span style="color:red;">ishin të pritura.&lt;/target&gt;</span><span style="color:green;">pritej.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Fushat {{ fields }} mungojnë.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Kjo fushë është zhdukur.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sr_Cyrl.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sr_Cyrl.xlf</span>
<span style="font-weight:bold;">index 83fd9732f0..781cf89c85 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sr_Cyrl.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sr_Cyrl.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Једна или више вредности је невалидна.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поља {{ fields }} нису била очекивана.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ово поље не очекује.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поља {{ fields }} недостају.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ово поље недостаје.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sr_Latn.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sr_Latn.xlf</span>
<span style="font-weight:bold;">index f7b6baf028..b322b92e1c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sr_Latn.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sr_Latn.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Jedna ili više vrednosti je nevalidna.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} nisu bila očekivana.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ovo polje ne očekuje.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Polja {{ fields }} nedostaju.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Ovo polje nedostaje.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.sv.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.sv.xlf</span>
<span style="font-weight:bold;">index c9d7b37b9a..ecdf132bf2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.sv.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.sv.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Ett eller fler av de angivna värdena är ogiltigt.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Fälten {{ fields }} var oväntade.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Det här fältet förväntades inte.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Fälten {{ fields }}</span><span style="color:green;">&lt;target&gt;Det här fältet</span> saknas.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="color:teal;">@@ -278,6 +278,26 @@</span>
                &lt;source&gt;This value should not be identical to {{ compared_value_type }} {{ compared_value }}.&lt;/source&gt;
                &lt;target&gt;Värdet ska inte vara identiskt med {{ compared_value_type }} {{ compared_value }}.&lt;/target&gt;
            &lt;/trans-unit&gt;
            <span style="color:green;">&lt;trans-unit id=&quot;73&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image ratio is too big ({{ ratio }}). Allowed maximum ratio is {{ max_ratio }}.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Förhållandet mellan bildens bredd och höjd är för stort ({{ ratio }}). Högsta tillåtna förhållande är {{ max_ratio }}.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;74&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image ratio is too small ({{ ratio }}). Minimum ratio expected is {{ min_ratio }}.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Förhållandet mellan bildens bredd och höjd är för litet ({{ ratio }}). Minsta tillåtna förhållande är {{ min_ratio }}.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;75&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is square ({{ width }}x{{ height }}px). Square images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Bilden är kvadratisk ({{ width }}x{{ height }}px). Kvadratiska bilder tillåts inte.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;76&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is landscape oriented ({{ width }}x{{ height }}px). Landscape oriented images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Bilden är landskapsorienterad ({{ width }}x{{ height }}px). Landskapsorienterade bilder tillåts inte.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
<span style="color:green;">            &lt;trans-unit id=&quot;77&quot;&gt;</span>
<span style="color:green;">                &lt;source&gt;The image is portrait oriented ({{ width }}x{{ height }}px). Portrait oriented images are not allowed.&lt;/source&gt;</span>
<span style="color:green;">                &lt;target&gt;Bilden är porträttsorienterad ({{ width }}x{{ height }}px). Porträttsorienterade bilder tillåts inte.&lt;/target&gt;</span>
<span style="color:green;">            &lt;/trans-unit&gt;</span>
        &lt;/body&gt;
    &lt;/file&gt;
&lt;/xliff&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.th.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.th.xlf</span>
<span style="font-weight:bold;">index 467b39dfc0..0237a308ac 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.th.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.th.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;มีบางค่าที่ส่งมาไม่ถูกต้อง&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} ฟิลด์เหล่านี้ไม่ใช่ฟิลด์ที่ถูกต้อง&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;ฟิลด์นี้ที่ไม่ได้คาดหวัง&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} ฟิลด์เหล่านี้หายไป&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;ฟิลด์นี้จะหายไป&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.tr.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.tr.xlf</span>
<span style="font-weight:bold;">index 331abd40b0..02b5db2c98 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.tr.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.tr.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Verilen değerlerden bir veya daha fazlası geçersiz.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} alanları kabul edilmedi.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Bu alan beklenen olmadı.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;{{ fields }} alanları eksik.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Bu alan, eksik&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.uk.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.uk.xlf</span>
<span style="font-weight:bold;">index 1832b34a01..54118b6001 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.uk.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.uk.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Одне або кілька заданих значень є недопустимі.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поля {{ fields }}</span><span style="color:green;">&lt;target&gt;Це поле</span> не <span style="color:red;">очікувалися.&lt;/target&gt;</span><span style="color:green;">очікується.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Поля {{ fields }} відсутні.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Це поле не вистачає.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.vi.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.vi.xlf</span>
<span style="font-weight:bold;">index 9c952e85aa..71a44e908b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.vi.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.vi.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;Một hoặc nhiều giá trị được chọn không hợp lệ.&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Trường có tên {{ fields }}</span><span style="color:green;">&lt;target&gt;Lĩnh vực này</span> không được <span style="color:red;">chấp nhận.&lt;/target&gt;</span><span style="color:green;">dự kiến.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;Trường có tên {{ fields }} không tìm thấy.&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;Lĩnh vực này là mất tích.&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.zh_CN.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.zh_CN.xlf</span>
<span style="font-weight:bold;">index ff6efdd135..3d529116e6 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.zh_CN.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.zh_CN.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;一个或者多个给定的值无效。&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;非预期字段 {{ fields }} 。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;此字段是没有预料到。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;遗漏字段 {{ fields }} 。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;此字段是失踪。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Resources/translations/validators.zh_TW.xlf b/src/Symfony/Component/Validator/Resources/translations/validators.zh_TW.xlf</span>
<span style="font-weight:bold;">index e39d32876f..ae6931c884 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Resources/translations/validators.zh_TW.xlf</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Resources/translations/validators.zh_TW.xlf</span>
<span style="color:teal;">@@ -35,12 +35,12 @@</span>
                &lt;target&gt;一個或者多個給定的值無效。&lt;/target&gt;
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;9&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} were</span><span style="color:green;">&lt;source&gt;This field was</span> not expected.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;非預期的欄位 {{ fields }} 。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;此字段是沒有預料到。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;10&quot;&gt;
                <span style="color:red;">&lt;source&gt;The fields {{ fields }} are</span><span style="color:green;">&lt;source&gt;This field is</span> missing.&lt;/source&gt;
                <span style="color:red;">&lt;target&gt;缺少的欄位 {{ fields }} 。&lt;/target&gt;</span><span style="color:green;">&lt;target&gt;此字段缺失。&lt;/target&gt;</span>
            &lt;/trans-unit&gt;
            &lt;trans-unit id=&quot;11&quot;&gt;
                &lt;source&gt;This value is not a valid date.&lt;/source&gt;
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/AbstractComparisonValidatorTestCase.php b/src/Symfony/Component/Validator/Tests/Constraints/AbstractComparisonValidatorTestCase.php</span>
<span style="font-weight:bold;">index 36405e3de8..a56f734554 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/AbstractComparisonValidatorTestCase.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/AbstractComparisonValidatorTestCase.php</span>
<span style="color:teal;">@@ -11,8 +11,8 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:green;">use Symfony\Component\Intl\Util\IntlTestHelper;</span>
use Symfony\Component\Validator\Constraint;
<span style="color:red;">use Symfony\Component\Validator\Constraints\AbstractComparisonValidator;</span>

class ComparisonTest_Class
{
<span style="color:teal;">@@ -32,30 +32,15 @@</span> class ComparisonTest_Class
/**
 * @author Daniel Holmes &lt;daniel@danielholmes.org&gt;
 */
abstract class AbstractComparisonValidatorTestCase extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
<span style="color:red;">    private $validator;</span>
<span style="color:red;">    private $context;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMockBuilder('Symfony\Component\Validator\ExecutionContext')</span>
<span style="color:red;">            -&gt;disableOriginalConstructor()</span>
<span style="color:red;">            -&gt;getMock();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

    /**
     * <span style="color:red;">@return AbstractComparisonValidator</span><span style="color:green;">@expectedException \Symfony\Component\Validator\Exception\ConstraintDefinitionException</span>
     */
<span style="color:red;">    abstract protected function createValidator();</span>

    public function testThrowsConstraintExceptionIfNoValueOrProperty()
    {
<span style="color:red;">        $this-&gt;setExpectedException('Symfony\Component\Validator\Exception\ConstraintDefinitionException');</span>

        $comparison = $this-&gt;createConstraint(array());

        $this-&gt;validator-&gt;validate('some value', $comparison);
    }

<span style="color:teal;">@@ -66,16 +51,11 @@</span> abstract class AbstractComparisonValidatorTestCase extends \PHPUnit_Framework_Te
     */
    public function testValidComparisonToValue($dirtyValue, $comparisonValue)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = $this-&gt;createConstraint(array('value' =&gt; $comparisonValue));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property1'));</span>

        $this-&gt;validator-&gt;validate($dirtyValue, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -86,28 +66,29 @@</span> abstract class AbstractComparisonValidatorTestCase extends \PHPUnit_Framework_Te
    /**
     * @dataProvider provideInvalidComparisons
     * @param mixed  $dirtyValue
     <span style="color:green;">* @param mixed  $dirtyValueAsString</span>
     * @param mixed  $comparedValue
     * @param mixed  $comparedValueString
     * @param string $comparedValueType
     */
    public function testInvalidComparisonToValue($dirtyValue, <span style="color:green;">$dirtyValueAsString,</span> $comparedValue, $comparedValueString, $comparedValueType)
    {
        <span style="color:green;">// Conversion of dates to string differs between ICU versions</span>
<span style="color:green;">        // Make sure we have the correct version loaded</span>
<span style="color:green;">        if ($dirtyValue instanceof \DateTime) {</span>
<span style="color:green;">            IntlTestHelper::requireIntl($this);</span>
<span style="color:green;">        }</span>

        $constraint = $this-&gt;createConstraint(array('value' =&gt; $comparedValue));
        $constraint-&gt;message = 'Constraint Message';

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property1'));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Constraint Message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $comparedValueString,</span>
<span style="color:red;">                '{{ compared_value }}' =&gt; $comparedValueString,</span>
<span style="color:red;">                '{{ compared_value_type }}' =&gt; $comparedValueType</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($dirtyValue, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Constraint Message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $dirtyValueAsString,</span>
<span style="color:green;">            '{{ compared_value }}' =&gt; $comparedValueString,</span>
<span style="color:green;">            '{{ compared_value_type }}' =&gt; $comparedValueType</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/AbstractConstraintValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/AbstractConstraintValidatorTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..bc4e1c214a</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/AbstractConstraintValidatorTest.php</span>
<span style="color:teal;">@@ -0,0 +1,194 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Component\Validator\Tests\Constraints;</span>

<span style="color:green;">use Symfony\Component\Validator\ConstraintValidatorInterface;</span>
<span style="color:green;">use Symfony\Component\Validator\ConstraintViolation;</span>
<span style="color:green;">use Symfony\Component\Validator\Context\ExecutionContext;</span>
<span style="color:green;">use Symfony\Component\Validator\Context\ExecutionContextInterface;</span>
<span style="color:green;">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span style="color:green;">use Symfony\Component\Validator\Mapping\PropertyMetadata;</span>
<span style="color:green;">use Symfony\Component\Validator\Tests\Fixtures\StubGlobalExecutionContext;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * @since  2.5.3</span>
<span style="color:green;"> * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">abstract class AbstractConstraintValidatorTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:green;">{</span>
<span style="color:green;">    /**</span>
<span style="color:green;">     * @var ExecutionContextInterface</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $context;</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * @var ConstraintValidatorInterface</span>
<span style="color:green;">     */</span>
<span style="color:green;">    protected $validator;</span>

<span style="color:green;">    protected $group;</span>

<span style="color:green;">    protected $metadata;</span>

<span style="color:green;">    protected $object;</span>

<span style="color:green;">    protected $value;</span>

<span style="color:green;">    protected $root;</span>

<span style="color:green;">    protected $propertyPath;</span>

<span style="color:green;">    protected function setUp()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;group = 'MyGroup';</span>
<span style="color:green;">        $this-&gt;metadata = null;</span>
<span style="color:green;">        $this-&gt;object = null;</span>
<span style="color:green;">        $this-&gt;value = 'InvalidValue';</span>
<span style="color:green;">        $this-&gt;root = 'root';</span>
<span style="color:green;">        $this-&gt;propertyPath = 'property.path';</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator = $this-&gt;createValidator();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:green;">        \Locale::setDefault('en');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createContext()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $translator = $this-&gt;getMock('Symfony\Component\Translation\TranslatorInterface');</span>

<span style="color:green;">        return $this-&gt;getMockBuilder('Symfony\Component\Validator\ExecutionContext')</span>
<span style="color:green;">            -&gt;setConstructorArgs(array(</span>
<span style="color:green;">                new StubGlobalExecutionContext($this-&gt;root),</span>
<span style="color:green;">                $translator,</span>
<span style="color:green;">                null,</span>
<span style="color:green;">                $this-&gt;metadata,</span>
<span style="color:green;">                $this-&gt;value,</span>
<span style="color:green;">                $this-&gt;group,</span>
<span style="color:green;">                $this-&gt;propertyPath</span>
<span style="color:green;">            ))</span>
<span style="color:green;">            -&gt;setMethods(array('validate', 'validateValue'))</span>
<span style="color:green;">            -&gt;getMock();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createViolation($message, array $parameters = array(), $propertyPath = 'property.path', $invalidValue = 'InvalidValue', $plural = null, $code = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new ConstraintViolation(</span>
<span style="color:green;">            null,</span>
<span style="color:green;">            $message,</span>
<span style="color:green;">            $parameters,</span>
<span style="color:green;">            $this-&gt;root,</span>
<span style="color:green;">            $propertyPath,</span>
<span style="color:green;">            $invalidValue,</span>
<span style="color:green;">            $plural,</span>
<span style="color:green;">            $code</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setGroup($group)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;group = $group;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setObject($object)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;object = $object;</span>
<span style="color:green;">        $this-&gt;metadata = is_object($object)</span>
<span style="color:green;">            ? new ClassMetadata(get_class($object))</span>
<span style="color:green;">            : null;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setProperty($object, $property)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;object = $object;</span>
<span style="color:green;">        $this-&gt;metadata = is_object($object)</span>
<span style="color:green;">            ? new PropertyMetadata(get_class($object), $property)</span>
<span style="color:green;">            : null;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setValue($value)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;value = $value;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setRoot($root)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;root = $root;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function setPropertyPath($propertyPath)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;propertyPath = $propertyPath;</span>
<span style="color:green;">        $this-&gt;context = $this-&gt;createContext();</span>
<span style="color:green;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function expectNoValidate()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:green;">            -&gt;method('validate');</span>
<span style="color:green;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:green;">            -&gt;method('validateValue');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function expectValidateAt($i, $propertyPath, $value, $group)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;context-&gt;expects($this-&gt;at($i))</span>
<span style="color:green;">            -&gt;method('validate')</span>
<span style="color:green;">            -&gt;with($value, $propertyPath, $group);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function expectValidateValueAt($i, $propertyPath, $value, $constraints, $group)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;context-&gt;expects($this-&gt;at($i))</span>
<span style="color:green;">            -&gt;method('validateValue')</span>
<span style="color:green;">            -&gt;with($value, $constraints, $propertyPath, $group);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function assertNoViolation()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertCount(0, $this-&gt;context-&gt;getViolations());</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function assertViolation($message, array $parameters = array(), $propertyPath = 'property.path', $invalidValue = 'InvalidValue', $plural = null, $code = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $violations = $this-&gt;context-&gt;getViolations();</span>

<span style="color:green;">        $this-&gt;assertCount(1, $violations);</span>
<span style="color:green;">        $this-&gt;assertEquals($this-&gt;createViolation($message, $parameters, $propertyPath, $invalidValue, $plural, $code), $violations[0]);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function assertViolations(array $expected)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $violations = $this-&gt;context-&gt;getViolations();</span>

<span style="color:green;">        $this-&gt;assertCount(count($expected), $violations);</span>

<span style="color:green;">        $i = 0;</span>

<span style="color:green;">        foreach ($expected as $violation) {</span>
<span style="color:green;">            $this-&gt;assertEquals($violation, $violations[$i++]);</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    abstract protected function createValidator();</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/AllValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/AllValidatorTest.php</span>
<span style="font-weight:bold;">index eaa9044e9e..d9ffd9814c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/AllValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/AllValidatorTest.php</span>
<span style="color:teal;">@@ -11,40 +11,23 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:red;">use Symfony\Component\Validator\ExecutionContext;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\Range;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\NotNull;</span>
use Symfony\Component\Validator\Constraints\All;
use Symfony\Component\Validator\Constraints\AllValidator;
<span style="color:green;">use Symfony\Component\Validator\Constraints\NotNull;</span>
<span style="color:green;">use Symfony\Component\Validator\Constraints\Range;</span>

class AllValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new AllValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getGroup')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('MyGroup'));</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;validator = null;</span>
<span style="color:red;">        $this-&gt;context = null;</span><span style="color:green;">return new AllValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new All(new Range(array('min' =&gt; 4))));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -62,18 +45,15 @@</span> class AllValidatorTest extends \PHPUnit_Framework_TestCase
    {
        $constraint = new Range(array('min' =&gt; 4));

        $i = <span style="color:red;">1;</span><span style="color:green;">0;</span>

        foreach ($array as $key =&gt; $value) {
            <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($value, $constraint,</span><span style="color:green;">$this-&gt;expectValidateValueAt($i++,</span> '['.$key.']', <span style="color:green;">$value, array($constraint),</span> 'MyGroup');
        }

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($array, new All($constraint));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -85,21 +65,16 @@</span> class AllValidatorTest extends \PHPUnit_Framework_TestCase
        $constraint2 = new NotNull();

        $constraints = array($constraint1, $constraint2);

        $i = <span style="color:red;">1;</span><span style="color:green;">0;</span>

        foreach ($array as $key =&gt; $value) {
            <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($value, $constraint1, '['.$key.']', 'MyGroup');</span>
<span style="color:red;">            $this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($value, $constraint2,</span><span style="color:green;">$this-&gt;expectValidateValueAt($i++,</span> '['.$key.']', <span style="color:green;">$value, array($constraint1, $constraint2),</span> 'MyGroup');
        }

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($array, new All($constraints));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidArguments()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/BlankValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/BlankValidatorTest.php</span>
<span style="font-weight:bold;">index 0fbe5e6fbb..1d83d10b0f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/BlankValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/BlankValidatorTest.php</span>
<span style="color:teal;">@@ -14,65 +14,51 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\Blank;
use Symfony\Component\Validator\Constraints\BlankValidator;

class BlankValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new BlankValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new BlankValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Blank());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testBlankIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Blank());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
     * @dataProvider getInvalidValues
     */
    public function <span style="color:red;">testInvalidValues($value)</span><span style="color:green;">testInvalidValues($value, $valueAsString)</span>
    {
        $constraint = new Blank(array(
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $value,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation(</span>
<span style="color:green;">            'myMessage',</span>
<span style="color:green;">            array('{{ value }}' =&gt; $valueAsString)</span>
<span style="color:green;">        );</span>
    }

    public function getInvalidValues()
    {
        return array(
            <span style="color:red;">array('foobar'),</span>
<span style="color:red;">            array(0),</span>
<span style="color:red;">            array(false),</span>
<span style="color:red;">            array(1234),</span><span style="color:green;">array('foobar', '&quot;foobar&quot;'),</span>
<span style="color:green;">            array(0, '0'),</span>
<span style="color:green;">            array(false, 'false'),</span>
<span style="color:green;">            array(1234, '1234'),</span>
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CallbackValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CallbackValidatorTest.php</span>
<span style="font-weight:bold;">index cdcd49bb58..3e92c83742 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CallbackValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CallbackValidatorTest.php</span>
<span style="color:teal;">@@ -11,15 +11,16 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

use <span style="color:red;">Symfony\Component\Validator\ExecutionContext;</span><span style="color:green;">Symfony\Component\Validator\Constraint;</span>
use Symfony\Component\Validator\Constraints\Callback;
use Symfony\Component\Validator\Constraints\CallbackValidator;
<span style="color:green;">use Symfony\Component\Validator\ExecutionContextInterface;</span>

class CallbackValidatorTest_Class
{
    public static function validateCallback($object, <span style="color:red;">ExecutionContext</span><span style="color:green;">ExecutionContextInterface</span> $context)
    {
        $context-&gt;addViolation('Callback message', array('{{ value }}' =&gt; <span style="color:red;">'foobar'), 'invalidValue');</span><span style="color:green;">'foobar'));</span>

        return false;
    }
<span style="color:teal;">@@ -27,45 +28,33 @@</span> class CallbackValidatorTest_Class

class CallbackValidatorTest_Object
{
    public function <span style="color:red;">validate(ExecutionContext</span><span style="color:green;">validate(ExecutionContextInterface</span> $context)
    {
        $context-&gt;addViolation('My message', array('{{ value }}' =&gt; <span style="color:red;">'foobar'), 'invalidValue');</span><span style="color:green;">'foobar'));</span>

        return false;
    }

    public static function validateStatic($object, <span style="color:red;">ExecutionContext</span><span style="color:green;">ExecutionContextInterface</span> $context)
    {
        $context-&gt;addViolation('Static message', array('{{ value }}' =&gt; <span style="color:red;">'baz'), 'otherInvalidValue');</span><span style="color:green;">'baz'));</span>

        return false;
    }
}

class CallbackValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new CallbackValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new CallbackValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Callback(array('foo')));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testSingleMethod()
<span style="color:teal;">@@ -73,13 +62,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback('validate');

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    public function testSingleMethodExplicitName()
<span style="color:teal;">@@ -87,13 +74,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array('callback' =&gt; 'validate'));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    public function testSingleStaticMethod()
<span style="color:teal;">@@ -101,51 +86,45 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback('validateStatic');

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Static message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'baz',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Static message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'baz',</span>
<span style="color:green;">        ));</span>
    }

    public function testClosure()
    {
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(function ($object, <span style="color:red;">ExecutionContext</span><span style="color:green;">ExecutionContextInterface</span> $context) {
            $context-&gt;addViolation('My message', array('{{ value }}' =&gt; <span style="color:red;">'foobar'), 'invalidValue');</span><span style="color:green;">'foobar'));</span>

            return false;
        });

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    public function testClosureExplicitName()
    {
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array(
            'callback' =&gt; function ($object, <span style="color:red;">ExecutionContext</span><span style="color:green;">ExecutionContextInterface</span> $context) {
                $context-&gt;addViolation('My message', array('{{ value }}' =&gt; <span style="color:red;">'foobar'), 'invalidValue');</span><span style="color:green;">'foobar'));</span>

                return false;
            },
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    public function testArrayCallable()
<span style="color:teal;">@@ -153,13 +132,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array(__CLASS__.'_Class', 'validateCallback'));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Callback message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Callback message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    public function testArrayCallableExplicitName()
<span style="color:teal;">@@ -169,13 +146,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
            'callback' =&gt; array(__CLASS__.'_Class', 'validateCallback'),
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Callback message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Callback message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -184,13 +159,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array('validate'));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -199,13 +172,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array('methods' =&gt; array('validate')));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('My message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -214,18 +185,16 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
        $object = new CallbackValidatorTest_Object();
        $constraint = new Callback(array('validate', 'validateStatic'));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Static message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'baz',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolations(array(</span>
<span style="color:green;">            $this-&gt;createViolation('My message', array(</span>
<span style="color:green;">               '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">            )),</span>
<span style="color:green;">            $this-&gt;createViolation('Static message', array(</span>
<span style="color:green;">               '{{ value }}' =&gt; 'baz',</span>
<span style="color:green;">            )),</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -236,18 +205,16 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
            'methods' =&gt; array('validate', 'validateStatic'),
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;at(0))</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('My message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;at(1))</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Static message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'baz',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolations(array(</span>
<span style="color:green;">            $this-&gt;createViolation('My message', array(</span>
<span style="color:green;">               '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">            )),</span>
<span style="color:green;">            $this-&gt;createViolation('Static message', array(</span>
<span style="color:green;">               '{{ value }}' =&gt; 'baz',</span>
<span style="color:green;">            )),</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -258,13 +225,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
            array(__CLASS__.'_Class', 'validateCallback')
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Callback message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Callback message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    // BC with Symfony &lt; 2.4
<span style="color:teal;">@@ -275,13 +240,11 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
            'methods' =&gt; array(array(__CLASS__.'_Class', 'validateCallback')),
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('Callback message', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('Callback message', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'foobar',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -321,7 +284,7 @@</span> class CallbackValidatorTest extends \PHPUnit_Framework_TestCase
    {
        $constraint = new Callback(array('foo'));

        <span style="color:red;">$this-&gt;assertEquals('class',</span><span style="color:green;">$this-&gt;assertEquals(Constraint::CLASS_CONSTRAINT,</span> $constraint-&gt;getTargets());
    }

    // Should succeed. Needed when defining constraints as annotations.
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CardSchemeValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CardSchemeValidatorTest.php</span>
<span style="font-weight:bold;">index ee7cc7a60a..0b3b04e067 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CardSchemeValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CardSchemeValidatorTest.php</span>
<span style="color:teal;">@@ -14,38 +14,25 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\CardScheme;
use Symfony\Component\Validator\Constraints\CardSchemeValidator;

class CardSchemeValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new CardSchemeValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new CardSchemeValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new CardScheme(array('schemes' =&gt; array())));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new CardScheme(array('schemes' =&gt; array())));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -53,10 +40,9 @@</span> class CardSchemeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidNumbers($scheme, $number)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($number, new CardScheme(array('schemes' =&gt; $scheme)));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -64,10 +50,16 @@</span> class CardSchemeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidNumbers($scheme, $number)
    {
        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$constraint = new CardScheme(array(</span>
<span style="color:green;">            'schemes' =&gt; $scheme,</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($number, <span style="color:red;">new CardScheme(array('schemes'</span><span style="color:green;">$constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}'</span> =&gt; <span style="color:red;">$scheme)));</span><span style="color:green;">is_string($number) ? '&quot;'.$number.'&quot;' : $number,</span>
<span style="color:green;">        ));</span>
    }

    public function getValidNumbers()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/ChoiceValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/ChoiceValidatorTest.php</span>
<span style="font-weight:bold;">index 9267fdb872..113a31e3cf 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/ChoiceValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/ChoiceValidatorTest.php</span>
<span style="color:teal;">@@ -19,31 +19,16 @@</span> function choice_callback()
    return array('foo', 'bar');
}

class ChoiceValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    public static function staticCallback()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return array('foo', 'bar');</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new ChoiceValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getClassName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(__CLASS__));</span>
    }

    <span style="color:red;">protected</span><span style="color:green;">public static</span> function <span style="color:red;">tearDown()</span><span style="color:green;">staticCallback()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return array('foo', 'bar');</span>
    }

    /**
<span style="color:teal;">@@ -61,10 +46,9 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Choice(array('choices' =&gt; array('foo', 'bar'))));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -87,20 +71,18 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
    {
        $constraint = new Choice(array('choices' =&gt; array('foo', 'bar')));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('bar', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidChoiceCallbackFunction()
    {
        $constraint = new Choice(array('callback' =&gt; __NAMESPACE__.'\choice_callback'));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('bar', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidChoiceCallbackClosure()
<span style="color:teal;">@@ -109,30 +91,30 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            return array('foo', 'bar');
        }));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('bar', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidChoiceCallbackStaticMethod()
    {
        $constraint = new Choice(array('callback' =&gt; array(__CLASS__, 'staticCallback')));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('bar', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidChoiceCallbackContextMethod()
    {
        <span style="color:red;">$constraint = new Choice(array('callback' =&gt; 'staticCallback'));</span><span style="color:green;">// search $this for &quot;staticCallback&quot;</span>
<span style="color:green;">        $this-&gt;setObject($this);</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$constraint = new Choice(array('callback' =&gt; 'staticCallback'));</span>

        $this-&gt;validator-&gt;validate('bar', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testMultipleChoices()
<span style="color:teal;">@@ -142,10 +124,9 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'multiple' =&gt; true,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(array('baz', 'bar'), $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testInvalidChoice()
<span style="color:teal;">@@ -155,13 +136,11 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'baz',</span>
<span style="color:red;">            ), null, null);</span>

        $this-&gt;validator-&gt;validate('baz', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;baz&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function testInvalidChoiceMultiple()
<span style="color:teal;">@@ -172,13 +151,11 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'multiple' =&gt; true,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 'baz',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(array('foo', 'baz'), $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;baz&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function testTooFewChoices()
<span style="color:teal;">@@ -190,13 +167,15 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'minMessage' =&gt; 'myMessage',
        ));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ limit }}' =&gt; 2,</span>
<span style="color:red;">            ), null, 2);</span><span style="color:green;">$value = array('foo');</span>

<span style="color:green;">        $this-&gt;setValue($value);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($value, $constraint);</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate(array('foo'), $constraint);</span><span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ limit }}' =&gt; 2,</span>
<span style="color:green;">        ), 'property.path', $value, 2);</span>
    }

    public function testTooManyChoices()
<span style="color:teal;">@@ -208,13 +187,15 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMessage',
        ));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ limit }}' =&gt; 2,</span>
<span style="color:red;">            ), null, 2);</span><span style="color:green;">$value = array('foo', 'bar', 'moo');</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate(array('foo', 'bar', 'moo'),</span><span style="color:green;">$this-&gt;setValue($value);</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($value,</span> $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ limit }}' =&gt; 2,</span>
<span style="color:green;">        ), 'property.path', $value, 2);</span>
    }

    public function testNonStrict()
<span style="color:teal;">@@ -224,11 +205,10 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'strict' =&gt; false,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('2', $constraint);
        $this-&gt;validator-&gt;validate(2, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testStrictAllowsExactValue()
<span style="color:teal;">@@ -238,10 +218,9 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'strict' =&gt; true,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(2, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testStrictDisallowsDifferentType()
<span style="color:teal;">@@ -252,13 +231,11 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; '2',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate('2', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;2&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function testNonStrictWithMultipleChoices()
<span style="color:teal;">@@ -269,10 +246,9 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'strict' =&gt; false
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(array('2', 3), $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testStrictWithMultipleChoices()
<span style="color:teal;">@@ -284,12 +260,10 @@</span> class ChoiceValidatorTest extends \PHPUnit_Framework_TestCase
            'multipleMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; '3',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(array(2, '3'), $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;3&quot;',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CollectionTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CollectionTest.php</span>
<span style="font-weight:bold;">index da868d3cfd..4b485a9b10 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CollectionTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CollectionTest.php</span>
<span style="color:teal;">@@ -12,9 +12,9 @@</span>
namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Collection;
<span style="color:red;">use Symfony\Component\Validator\Constraints\Required;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\Optional;</span>
use Symfony\Component\Validator\Constraints\Email;
<span style="color:green;">use Symfony\Component\Validator\Constraints\Optional;</span>
<span style="color:green;">use Symfony\Component\Validator\Constraints\Required;</span>
use Symfony\Component\Validator\Constraints\Valid;

/**
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorCustomArrayObjectTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorCustomArrayObjectTest.php</span>
<span style="font-weight:bold;">index ebad849b8b..3d4c29681b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorCustomArrayObjectTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorCustomArrayObjectTest.php</span>
<span style="color:teal;">@@ -11,63 +11,7 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:red;">/**</span>
<span style="color:red;"> * This class is a hand written simplified version of PHP native `ArrayObject`</span>
<span style="color:red;"> * class, to show that it behaves differently than the PHP native implementation.</span>
<span style="color:red;"> */</span>
<span style="color:red;">class CustomArrayObject implements \ArrayAccess, \IteratorAggregate, \Countable, \Serializable</span>
<span style="color:red;">{</span>
<span style="color:red;">    private $array;</span>

<span style="color:red;">    public function __construct(array $array = null)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;array = $array ?: array();</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function offsetExists($offset)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return array_key_exists($offset, $this-&gt;array);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function offsetGet($offset)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return $this-&gt;array[$offset];</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function offsetSet($offset, $value)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        if (null === $offset) {</span>
<span style="color:red;">            $this-&gt;array[] = $value;</span>
<span style="color:red;">        } else {</span>
<span style="color:red;">            $this-&gt;array[$offset] = $value;</span>
<span style="color:red;">        }</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function offsetUnset($offset)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        unset($this-&gt;array[$offset]);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function getIterator()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return new \ArrayIterator($this-&gt;array);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function count()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return count($this-&gt;array);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function serialize()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return serialize($this-&gt;array);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function unserialize($serialized)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;array = (array) unserialize((string) $serialized);</span>
<span style="color:red;">    }</span>
<span style="color:red;">}</span><span style="color:green;">use Symfony\Component\Validator\Tests\Fixtures\CustomArrayObject;</span>

class CollectionValidatorCustomArrayObjectTest extends CollectionValidatorTest
{
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorTest.php</span>
<span style="font-weight:bold;">index 4a13234b69..8c26957e6f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CollectionValidatorTest.php</span>
<span style="color:teal;">@@ -11,57 +11,44 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:red;">use Symfony\Component\Validator\Constraints\Range;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\NotNull;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\Required;</span>
<span style="color:red;">use Symfony\Component\Validator\Constraints\Optional;</span>
use Symfony\Component\Validator\Constraints\Collection;
use Symfony\Component\Validator\Constraints\CollectionValidator;
<span style="color:green;">use Symfony\Component\Validator\Constraints\NotNull;</span>
<span style="color:green;">use Symfony\Component\Validator\Constraints\Optional;</span>
<span style="color:green;">use Symfony\Component\Validator\Constraints\Range;</span>
<span style="color:green;">use Symfony\Component\Validator\Constraints\Required;</span>

abstract class CollectionValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new CollectionValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getGroup')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('MyGroup'));</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function tearDown()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span>
    }

    abstract protected function prepareTestData(array $contents);

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate(null, new Collection(array('fields' =&gt; array(
            'foo' =&gt; new Range(array('min' =&gt; 4)),
        ))));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFieldsAsDefaultOption()
    {
        <span style="color:green;">$constraint = new Range(array('min' =&gt; 4));</span>

        $data = $this-&gt;prepareTestData(array('foo' =&gt; 'foobar'));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">$this-&gt;expectValidateValueAt(0, '[foo]', $data['foo'], array($constraint), 'MyGroup');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -82,25 +69,23 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; 3,
            'bar' =&gt; 5,
        );

        $i = <span style="color:red;">1;</span><span style="color:green;">0;</span>

        foreach ($array as $key =&gt; $value) {
            <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($value, $constraint,</span><span style="color:green;">$this-&gt;expectValidateValueAt($i++,</span> '['.$key.']', <span style="color:green;">$value, array($constraint),</span> 'MyGroup');
        }

        $data = $this-&gt;prepareTestData($array);

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; $constraint,
                'bar' =&gt; $constraint,
            ),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testWalkMultipleConstraints()
<span style="color:teal;">@@ -114,48 +99,46 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; 3,
            'bar' =&gt; 5,
        );

        $i = <span style="color:red;">1;</span><span style="color:green;">0;</span>

        foreach ($array as $key =&gt; $value) {
            <span style="color:red;">foreach ($constraints as $constraint) {</span>
<span style="color:red;">                $this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                    -&gt;method('validateValue')</span>
<span style="color:red;">                    -&gt;with($value, $constraint,</span><span style="color:green;">$this-&gt;expectValidateValueAt($i++,</span> '['.$key.']', <span style="color:green;">$value, $constraints,</span> 'MyGroup');<span style="color:red;">}</span>
        }

        $data = $this-&gt;prepareTestData($array);

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; $constraints,
                'bar' =&gt; $constraints,
            )
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testExtraFieldsDisallowed()
    {
        <span style="color:green;">$constraint = new Range(array('min' =&gt; 4));</span>

        $data = $this-&gt;prepareTestData(array(
            'foo' =&gt; 5,
            'baz' =&gt; 6,
        ));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolationAt')</span>
<span style="color:red;">            -&gt;with('[baz]', 'myMessage', array(</span>
<span style="color:red;">                '{{ field }}' =&gt; 'baz'</span>
<span style="color:red;">            ));</span><span style="color:green;">$this-&gt;expectValidateValueAt(0, '[foo]', $data['foo'], array($constraint), 'MyGroup');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
            ),
            'extraFieldsMessage' =&gt; 'myMessage',
        )));

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ field }}' =&gt; '&quot;baz&quot;'</span>
<span style="color:green;">        ), 'property.path[baz]', 6);</span>
    }

    // bug fix
<span style="color:teal;">@@ -165,16 +148,17 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; null,
        ));

        $constraint = new <span style="color:green;">Range(array('min' =&gt; 4));</span>

<span style="color:green;">        $this-&gt;expectValidateValueAt(0, '[foo]', $data['foo'], array($constraint), 'MyGroup');</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($data, new</span> Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
            ),
        <span style="color:red;">));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">)));</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate($data, $constraint);</span><span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testExtraFieldsAllowed()
<span style="color:teal;">@@ -184,54 +168,52 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'bar' =&gt; 6,
        ));

        $constraint = new <span style="color:green;">Range(array('min' =&gt; 4));</span>

<span style="color:green;">        $this-&gt;expectValidateValueAt(0, '[foo]', $data['foo'], array($constraint), 'MyGroup');</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($data, new</span> Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
            ),
            'allowExtraFields' =&gt; true,
        <span style="color:red;">));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">)));</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate($data, $constraint);</span><span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testMissingFieldsDisallowed()
    {
        $data = $this-&gt;prepareTestData(array());

        $constraint = new <span style="color:green;">Range(array('min' =&gt; 4));</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($data, new</span> Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
            ),
            'missingFieldsMessage' =&gt; 'myMessage',
        <span style="color:red;">));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolationAt')</span>
<span style="color:red;">            -&gt;with('[foo]', 'myMessage', array(</span>
<span style="color:red;">                '{{ field }}' =&gt; 'foo',</span>
<span style="color:red;">            ));</span><span style="color:green;">)));</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate($data, $constraint);</span><span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ field }}' =&gt; '&quot;foo&quot;'</span>
<span style="color:green;">        ), 'property.path[foo]', null);</span>
    }

    public function testMissingFieldsAllowed()
    {
        $data = $this-&gt;prepareTestData(array());

        $constraint = new <span style="color:green;">Range(array('min' =&gt; 4));</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate($data, new</span> Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 4)),</span><span style="color:green;">$constraint,</span>
            ),
            'allowMissingFields' =&gt; true,
        <span style="color:red;">));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">)));</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate($data, $constraint);</span><span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testOptionalFieldPresent()
<span style="color:teal;">@@ -240,24 +222,22 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; null,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Optional(),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testOptionalFieldNotPresent()
    {
        $data = $this-&gt;prepareTestData(array());

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Optional(),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testOptionalFieldSingleConstraint()
<span style="color:teal;">@@ -268,18 +248,15 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase

        $constraint = new Range(array('min' =&gt; 4));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($array['foo'], $constraint,</span><span style="color:green;">$this-&gt;expectValidateValueAt(0,</span> '[foo]', <span style="color:green;">$array['foo'], array($constraint),</span> 'MyGroup');<span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $data = $this-&gt;prepareTestData($array);

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Optional($constraint),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testOptionalFieldMultipleConstraints()
<span style="color:teal;">@@ -292,22 +269,16 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            new NotNull(),
            new Range(array('min' =&gt; 4)),
        );
<span style="color:red;">        $i = 1;</span>

<span style="color:red;">        foreach ($constraints as $constraint) {</span>
<span style="color:red;">            $this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($array['foo'], $constraint, '[foo]', 'MyGroup');</span>
<span style="color:red;">        }</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">$this-&gt;expectValidateValueAt(0, '[foo]', $array['foo'], $constraints, 'MyGroup');</span>

        $data = $this-&gt;prepareTestData($array);

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Optional($constraints),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testRequiredFieldPresent()
<span style="color:teal;">@@ -316,30 +287,27 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; null,
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Required(),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testRequiredFieldNotPresent()
    {
        $data = $this-&gt;prepareTestData(array());

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolationAt')</span>
<span style="color:red;">            -&gt;with('[foo]', 'myMessage', array(</span>
<span style="color:red;">                '{{ field }}' =&gt; 'foo',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; new Required(),
            ),
            'missingFieldsMessage' =&gt; 'myMessage',
        )));

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ field }}' =&gt; '&quot;foo&quot;'</span>
<span style="color:green;">        ), 'property.path[foo]', null);</span>
    }

    public function testRequiredFieldSingleConstraint()
<span style="color:teal;">@@ -350,18 +318,15 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase

        $constraint = new Range(array('min' =&gt; 4));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('validateValue')</span>
<span style="color:red;">            -&gt;with($array['foo'], $constraint,</span><span style="color:green;">$this-&gt;expectValidateValueAt(0,</span> '[foo]', <span style="color:green;">$array['foo'], array($constraint),</span> 'MyGroup');<span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span>

        $data = $this-&gt;prepareTestData($array);

        $this-&gt;validator-&gt;validate($data, new Collection(array(
            'foo' =&gt; new Required($constraint),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testRequiredFieldMultipleConstraints()
<span style="color:teal;">@@ -374,22 +339,16 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            new NotNull(),
            new Range(array('min' =&gt; 4)),
        );
<span style="color:red;">        $i = 1;</span>

<span style="color:red;">        foreach ($constraints as $constraint) {</span>
<span style="color:red;">            $this-&gt;context-&gt;expects($this-&gt;at($i++))</span>
<span style="color:red;">                -&gt;method('validateValue')</span>
<span style="color:red;">                -&gt;with($array['foo'], $constraint, '[foo]', 'MyGroup');</span>
<span style="color:red;">        }</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolationAt');</span><span style="color:green;">$this-&gt;expectValidateValueAt(0, '[foo]', $array['foo'], $constraints, 'MyGroup');</span>

        $data = $this-&gt;prepareTestData($array);

        <span style="color:red;">$this-&gt;validator-&gt;validate($array,</span><span style="color:green;">$this-&gt;validator-&gt;validate($data,</span> new Collection(array(
            'foo' =&gt; new Required($constraints),
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testObjectShouldBeLeftUnchanged()
<span style="color:teal;">@@ -398,9 +357,13 @@</span> abstract class CollectionValidatorTest extends \PHPUnit_Framework_TestCase
            'foo' =&gt; 3
        ));

        <span style="color:green;">$constraint = new Range(array('min' =&gt; 2));</span>

<span style="color:green;">        $this-&gt;expectValidateValueAt(0, '[foo]', $value['foo'], array($constraint), 'MyGroup');</span>

        $this-&gt;validator-&gt;validate($value, new Collection(array(
            'fields' =&gt; array(
                'foo' =&gt; <span style="color:red;">new Range(array('min' =&gt; 2)),</span><span style="color:green;">$constraint,</span>
            )
        )));

<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorCountableTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorCountableTest.php</span>
<span style="font-weight:bold;">index ec4d8dec71..7d46967bde 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorCountableTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorCountableTest.php</span>
<span style="color:teal;">@@ -11,20 +11,7 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:red;">class CountValidatorCountableTest_Countable implements \Countable</span>
<span style="color:red;">{</span>
<span style="color:red;">    private $content;</span>

<span style="color:red;">    public function __construct(array $content)</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;content = $content;</span>
<span style="color:red;">    }</span>

<span style="color:red;">    public function count()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        return count($this-&gt;content);</span>
<span style="color:red;">    }</span>
<span style="color:red;">}</span><span style="color:green;">use Symfony\Component\Validator\Tests\Fixtures\Countable;</span>

/**
 * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;
<span style="color:teal;">@@ -33,6 +20,6 @@</span> class CountValidatorCountableTest extends CountValidatorTest
{
    protected function createCollection(array $content)
    {
        return new <span style="color:red;">CountValidatorCountableTest_Countable($content);</span><span style="color:green;">Countable($content);</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorTest.php</span>
<span style="font-weight:bold;">index 9c4a38d56c..c910c1156c 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CountValidatorTest.php</span>
<span style="color:teal;">@@ -17,32 +17,20 @@</span> use Symfony\Component\Validator\Constraints\CountValidator;
/**
 * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;
 */
abstract class CountValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new CountValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new CountValidator();</span>
    }

    abstract protected function createCollection(array $content);

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Count(6));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -93,11 +81,10 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesMax($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Count(array('max' =&gt; 3));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -105,11 +92,10 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesMin($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Count(array('min' =&gt; 5));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -117,11 +103,10 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesExact($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Count(4);
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -134,14 +119,12 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ count }}' =&gt; count($value),</span>
<span style="color:red;">                '{{ limit }}' =&gt; 4,</span>
<span style="color:red;">            )), $value, 4);</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ count }}' =&gt; count($value),</span>
<span style="color:green;">            '{{ limit }}' =&gt; 4,</span>
<span style="color:green;">        ), 'property.path', $value, 4);</span>
    }

    /**
<span style="color:teal;">@@ -154,14 +137,12 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
            'minMessage' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ count }}' =&gt; count($value),</span>
<span style="color:red;">                '{{ limit }}' =&gt; 4,</span>
<span style="color:red;">            )), $value, 4);</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ count }}' =&gt; count($value),</span>
<span style="color:green;">            '{{ limit }}' =&gt; 4,</span>
<span style="color:green;">        ), 'property.path', $value, 4);</span>
    }

    /**
<span style="color:teal;">@@ -175,14 +156,12 @@</span> abstract class CountValidatorTest extends \PHPUnit_Framework_TestCase
            'exactMessage' =&gt; 'myMessage'
        ));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span><span style="color:green;">$this-&gt;validator-&gt;validate($value, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(</span>
            '{{ count }}' =&gt; count($value),
            '{{ limit }}' =&gt; 4,
        <span style="color:red;">)),</span><span style="color:green;">), 'property.path',</span> $value, 4);<span style="color:red;">$this-&gt;validator-&gt;validate($value, $constraint);</span>
    }

    public function testDefaultOption()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CountryValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CountryValidatorTest.php</span>
<span style="font-weight:bold;">index 5fabee67fb..c6693020f8 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CountryValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CountryValidatorTest.php</span>
<span style="color:teal;">@@ -15,40 +15,32 @@</span> use Symfony\Component\Intl\Util\IntlTestHelper;
use Symfony\Component\Validator\Constraints\Country;
use Symfony\Component\Validator\Constraints\CountryValidator;

class CountryValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
<span style="color:red;">    protected $context;</span>
<span style="color:red;">    protected $validator;</span>

    protected function setUp()
    {
        <span style="color:red;">IntlTestHelper::requireIntl($this);</span><span style="color:green;">IntlTestHelper::requireFullIntl($this);</span>

        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new CountryValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">parent::setUp();</span>
    }

    protected function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new CountryValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Country());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Country());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -64,10 +56,9 @@</span> class CountryValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidCountries($country)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($country, new Country());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidCountries()
<span style="color:teal;">@@ -88,13 +79,11 @@</span> class CountryValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $country,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($country, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$country.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidCountries()
<span style="color:teal;">@@ -113,9 +102,9 @@</span> class CountryValidatorTest extends \PHPUnit_Framework_TestCase
        \Locale::setDefault('en_GB');

        $existingCountry = 'GB';
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($existingCountry, new Country());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/CurrencyValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/CurrencyValidatorTest.php</span>
<span style="font-weight:bold;">index ea6c2eb43a..0480b60ed7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/CurrencyValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/CurrencyValidatorTest.php</span>
<span style="color:teal;">@@ -15,40 +15,32 @@</span> use Symfony\Component\Intl\Util\IntlTestHelper;
use Symfony\Component\Validator\Constraints\Currency;
use Symfony\Component\Validator\Constraints\CurrencyValidator;

class CurrencyValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
<span style="color:red;">    protected $context;</span>
<span style="color:red;">    protected $validator;</span>

    protected function setUp()
    {
        <span style="color:red;">IntlTestHelper::requireIntl($this);</span><span style="color:green;">IntlTestHelper::requireFullIntl($this);</span>

        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new CurrencyValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">parent::setUp();</span>
    }

    protected function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new CurrencyValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Currency());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Currency());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -64,10 +56,9 @@</span> class CurrencyValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidCurrencies($currency)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($currency, new Currency());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -76,10 +67,10 @@</span> class CurrencyValidatorTest extends \PHPUnit_Framework_TestCase
    public function testValidCurrenciesWithCountrySpecificLocale($currency)
    {
        \Locale::setDefault('en_GB');
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($currency, new Currency());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidCurrencies()
<span style="color:teal;">@@ -102,13 +93,11 @@</span> class CurrencyValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $currency,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($currency, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$currency.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidCurrencies()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/DateTimeValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/DateTimeValidatorTest.php</span>
<span style="font-weight:bold;">index 0776848fdb..5addbf34de 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/DateTimeValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/DateTimeValidatorTest.php</span>
<span style="color:teal;">@@ -14,46 +14,32 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\DateTime;
use Symfony\Component\Validator\Constraints\DateTimeValidator;

class DateTimeValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new DateTimeValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new DateTimeValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new DateTime());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new DateTime());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDateTimeClassIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(new \DateTime(), new DateTime());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -69,10 +55,9 @@</span> class DateTimeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidDateTimes($dateTime)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($dateTime, new DateTime());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidDateTimes()
<span style="color:teal;">@@ -93,13 +78,11 @@</span> class DateTimeValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $dateTime,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($dateTime, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$dateTime.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidDateTimes()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/DateValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/DateValidatorTest.php</span>
<span style="font-weight:bold;">index b9cf8816b7..8fdacee94d 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/DateValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/DateValidatorTest.php</span>
<span style="color:teal;">@@ -14,46 +14,32 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\Date;
use Symfony\Component\Validator\Constraints\DateValidator;

class DateValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new DateValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new DateValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Date());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Date());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDateTimeClassIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(new \DateTime(), new Date());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -69,10 +55,9 @@</span> class DateValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidDates($date)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($date, new Date());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidDates()
<span style="color:teal;">@@ -93,13 +78,11 @@</span> class DateValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $date,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($date, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$date.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidDates()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/EmailValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/EmailValidatorTest.php</span>
<span style="font-weight:bold;">index 701ab1f556..e4722e159e 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/EmailValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/EmailValidatorTest.php</span>
<span style="color:teal;">@@ -14,38 +14,25 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\Email;
use Symfony\Component\Validator\Constraints\EmailValidator;

class EmailValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new EmailValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new EmailValidator(false);</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Email());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Email());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -61,10 +48,9 @@</span> class EmailValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidEmails($email)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($email, new Email());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidEmails()
<span style="color:teal;">@@ -85,13 +71,11 @@</span> class EmailValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $email,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($email, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$email.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidEmails()
<span style="color:teal;">@@ -100,7 +84,6 @@</span> class EmailValidatorTest extends \PHPUnit_Framework_TestCase
            array('example'),
            array('example@'),
            array('example@localhost'),
<span style="color:red;">            array('example@example.com@example.com'),</span>
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/EqualToValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/EqualToValidatorTest.php</span>
<span style="font-weight:bold;">index 46b1b56269..997ed74023 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/EqualToValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/EqualToValidatorTest.php</span>
<span style="color:teal;">@@ -50,10 +50,10 @@</span> class EqualToValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(1, <span style="color:green;">'1',</span> 2, '2', 'integer'),
            array('22', <span style="color:green;">'&quot;22&quot;',</span> '333', <span style="color:red;">&quot;'333'&quot;,</span><span style="color:green;">'&quot;333&quot;',</span> 'string'),
            array(new \DateTime('2001-01-01'), <span style="color:green;">'Jan 1, 2001, 12:00 AM',</span> new \DateTime('2000-01-01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(4), <span style="color:green;">'4',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/ExpressionValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/ExpressionValidatorTest.php</span>
<span style="font-weight:bold;">index b71138e5f6..1e75e1f0a2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/ExpressionValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/ExpressionValidatorTest.php</span>
<span style="color:teal;">@@ -14,184 +14,170 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\PropertyAccess\PropertyAccess;
use Symfony\Component\Validator\Constraints\Expression;
use Symfony\Component\Validator\Constraints\ExpressionValidator;
<span style="color:green;">use Symfony\Component\Validator\Tests\Fixtures\Entity;</span>

class ExpressionValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new ExpressionValidator(PropertyAccess::createPropertyAccessor());</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getClassName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(__CLASS__));</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new ExpressionValidator(PropertyAccess::createPropertyAccessor());</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Expression('value == 1'));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Expression('value == 1'));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testSucceedingExpressionAtObjectLevel()
    {
        $constraint = new <span style="color:red;">Expression('this.property</span><span style="color:green;">Expression('this.data</span> == 1');<span style="color:red;">$object = (object) array('property' =&gt; '1');</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(null));</span><span style="color:green;">$object = new Entity();</span>
<span style="color:green;">        $object-&gt;data = '1';</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$this-&gt;setObject($object);</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFailingExpressionAtObjectLevel()
    {
        $constraint = new Expression(array(
            'expression' =&gt; <span style="color:red;">'this.property</span><span style="color:green;">'this.data</span> == 1',
            'message' =&gt; 'myMessage',
        ));

        $object = <span style="color:red;">(object) array('property' =&gt; '2');</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue(null));</span><span style="color:green;">new Entity();</span>
<span style="color:green;">        $object-&gt;data = '2';</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span><span style="color:green;">$this-&gt;setObject($object);</span>

        $this-&gt;validator-&gt;validate($object, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage');</span>
    }

    public function testSucceedingExpressionAtPropertyLevel()
    {
        $constraint = new Expression('value == <span style="color:red;">this.expected');</span>

<span style="color:red;">        $object = (object) array('expected' =&gt; '1');</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span><span style="color:green;">this.data');</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span><span style="color:green;">$object = new Entity();</span>
<span style="color:green;">        $object-&gt;data = '1';</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getRoot')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue($object));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$this-&gt;setRoot($object);</span>
<span style="color:green;">        $this-&gt;setPropertyPath('data');</span>
<span style="color:green;">        $this-&gt;setProperty($object, 'data');</span>

        $this-&gt;validator-&gt;validate('1', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFailingExpressionAtPropertyLevel()
    {
        $constraint = new Expression(array(
            'expression' =&gt; 'value == <span style="color:red;">this.expected',</span><span style="color:green;">this.data',</span>
            'message' =&gt; 'myMessage',
        ));

        $object = <span style="color:red;">(object) array('expected' =&gt; '1');</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getRoot')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue($object));</span><span style="color:green;">new Entity();</span>
<span style="color:green;">        $object-&gt;data = '1';</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span><span style="color:green;">$this-&gt;setRoot($object);</span>
<span style="color:green;">        $this-&gt;setPropertyPath('data');</span>
<span style="color:green;">        $this-&gt;setProperty($object, 'data');</span>

        $this-&gt;validator-&gt;validate('2', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(), 'data');</span>
    }

    public function testSucceedingExpressionAtNestedPropertyLevel()
    {
        $constraint = new Expression('value == <span style="color:red;">this.expected');</span>

<span style="color:red;">        $object = (object) array('expected' =&gt; '1');</span>
<span style="color:red;">        $root = (object) array('nested' =&gt; $object);</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span><span style="color:green;">this.data');</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('nested.property'));</span><span style="color:green;">$object = new Entity();</span>
<span style="color:green;">        $object-&gt;data = '1';</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getRoot')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue($root));</span><span style="color:green;">$root = new Entity();</span>
<span style="color:green;">        $root-&gt;reference = $object;</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$this-&gt;setRoot($root);</span>
<span style="color:green;">        $this-&gt;setPropertyPath('reference.data');</span>
<span style="color:green;">        $this-&gt;setProperty($object, 'data');</span>

        $this-&gt;validator-&gt;validate('1', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFailingExpressionAtNestedPropertyLevel()
    {
        $constraint = new Expression(array(
            'expression' =&gt; 'value == <span style="color:red;">this.expected',</span><span style="color:green;">this.data',</span>
            'message' =&gt; 'myMessage',
        ));

        $object = <span style="color:red;">(object) array('expected' =&gt; '1');</span><span style="color:green;">new Entity();</span>
<span style="color:green;">        $object-&gt;data = '1';</span>

        $root = <span style="color:red;">(object) array('nested' =&gt; $object);</span><span style="color:green;">new Entity();</span>
<span style="color:green;">        $root-&gt;reference = $object;</span>

<span style="color:green;">        $this-&gt;setRoot($root);</span>
<span style="color:green;">        $this-&gt;setPropertyPath('reference.data');</span>
<span style="color:green;">        $this-&gt;setProperty($object, 'data');</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate('2', $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(), 'reference.data');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * When validatePropertyValue() is called with a class name</span>
<span style="color:green;">     * https://github.com/symfony/symfony/pull/11498</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testSucceedingExpressionAtPropertyLevelWithoutRoot()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new Expression('value == &quot;1&quot;');</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyName')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('property'));</span><span style="color:green;">$this-&gt;setRoot('1');</span>
<span style="color:green;">        $this-&gt;setPropertyPath('');</span>
<span style="color:green;">        $this-&gt;setProperty(null, 'property');</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getPropertyPath')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue('nested.property'));</span><span style="color:green;">$this-&gt;validator-&gt;validate('1', $constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
<span style="color:green;">    }</span>

    <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;any())</span>
<span style="color:red;">            -&gt;method('getRoot')</span>
<span style="color:red;">            -&gt;will($this-&gt;returnValue($root));</span><span style="color:green;">/**</span>
<span style="color:green;">     * When validatePropertyValue() is called with a class name</span>
<span style="color:green;">     * https://github.com/symfony/symfony/pull/11498</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testFailingExpressionAtPropertyLevelWithoutRoot()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $constraint = new Expression(array(</span>
<span style="color:green;">            'expression' =&gt; 'value == &quot;1&quot;',</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span><span style="color:green;">$this-&gt;setRoot('2');</span>
<span style="color:green;">        $this-&gt;setPropertyPath('');</span>
<span style="color:green;">        $this-&gt;setProperty(null, 'property');</span>

        $this-&gt;validator-&gt;validate('2', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(), '');</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/FalseValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/FalseValidatorTest.php</span>
<span style="font-weight:bold;">index 1bc16c20bd..e9abbb9a38 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/FalseValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/FalseValidatorTest.php</span>
<span style="color:teal;">@@ -14,38 +14,25 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;
use Symfony\Component\Validator\Constraints\False;
use Symfony\Component\Validator\Constraints\FalseValidator;

class FalseValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new FalseValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new FalseValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new False());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFalseIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(false, new False());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testTrueIsInvalid()
<span style="color:teal;">@@ -54,10 +41,10 @@</span> class FalseValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array());</span>

        $this-&gt;validator-&gt;validate(true, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'true'</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorPathTest.php b/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorPathTest.php</span>
<span style="font-weight:bold;">index c4b93cdcd3..f1f8db692a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorPathTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorPathTest.php</span>
<span style="color:teal;">@@ -26,12 +26,10 @@</span> class FileValidatorPathTest extends FileValidatorTest
            'notFoundMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ file }}' =&gt; 'foobar',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate('foobar', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ file }}' =&gt; '&quot;foobar&quot;',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorTest.php</span>
<span style="font-weight:bold;">index 853af4868f..6c8cb8abbb 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/FileValidatorTest.php</span>
<span style="color:teal;">@@ -11,50 +11,63 @@</span>

namespace Symfony\Component\Validator\Tests\Constraints;

<span style="color:green;">use Symfony\Component\HttpFoundation\File\UploadedFile;</span>
use Symfony\Component\Validator\Constraints\File;
use Symfony\Component\Validator\Constraints\FileValidator;
use <span style="color:red;">Symfony\Component\HttpFoundation\File\UploadedFile;</span><span style="color:green;">Symfony\Component\Validator\Validation;</span>

abstract class FileValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
<span style="color:red;">    protected $context;</span>
<span style="color:red;">    protected $validator;</span>
    protected $path;

    protected $file;

    <span style="color:green;">protected function getApiVersion()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return Validation::API_VERSION_2_5;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    protected function createValidator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new FileValidator();</span>
<span style="color:green;">    }</span>

    protected function setUp()
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new FileValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">parent::setUp();</span>

        $this-&gt;path = sys_get_temp_dir().DIRECTORY_SEPARATOR.'FileValidatorTest';
        $this-&gt;file = fopen($this-&gt;path, 'w');
    }

    protected function tearDown()
    {
        <span style="color:green;">parent::tearDown();</span>

<span style="color:green;">        if (is_resource($this-&gt;file)) {</span>
            fclose($this-&gt;file);
        <span style="color:green;">}</span>

<span style="color:green;">        if (file_exists($this-&gt;path)) {</span>
<span style="color:green;">            unlink($this-&gt;path);</span>
<span style="color:green;">        }</span>

<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span>
        $this-&gt;path = null;
        $this-&gt;file = null;
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new File());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new File());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -67,82 +80,138 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase

    public function testValidFile()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($this-&gt;path, new File());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidUploadedfile()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $file = new UploadedFile($this-&gt;path, 'originalName', null, null, null, true);
        $this-&gt;validator-&gt;validate($file, new File());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function <span style="color:red;">testTooLargeBytes()</span><span style="color:green;">provideMaxSizeExceededTests()</span>
    {
        <span style="color:red;">fwrite($this-&gt;file, str_repeat('0', 11));</span>

<span style="color:red;">        $constraint = new File(array(</span>
<span style="color:red;">            'maxSize'           =&gt; 10,</span>
<span style="color:red;">            'maxSizeMessage'    =&gt; 'myMessage',</span>
<span style="color:red;">        ));</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{</span><span style="color:green;">// We have various interesting</span> limit <span style="color:red;">}}'   =&gt; '10',</span>
<span style="color:red;">                '{{</span><span style="color:green;">-</span> size <span style="color:red;">}}'    =&gt; '11',</span>
<span style="color:red;">                '{{ suffix }}'  =&gt; 'bytes',</span>
<span style="color:red;">                '{{</span><span style="color:green;">combinations to test.</span>
<span style="color:green;">        // Assume a limit of 1000 bytes (1 kB). Then the following table</span>
<span style="color:green;">        // lists the violation messages for different</span> file <span style="color:red;">}}'    =&gt; $this-&gt;path,</span>
<span style="color:red;">            ));</span>

<span style="color:red;">        $this-&gt;validator-&gt;validate($this-&gt;getFile($this-&gt;path), $constraint);</span><span style="color:green;">sizes:</span>

<span style="color:green;">        // -----------+--------------------------------------------------------</span>
<span style="color:green;">        // Size       | Violation Message</span>
<span style="color:green;">        // -----------+--------------------------------------------------------</span>
<span style="color:green;">        // 1000 bytes | No violation</span>
<span style="color:green;">        // 1001 bytes | &quot;Size of 1001 bytes exceeded limit of 1000 bytes&quot;</span>
<span style="color:green;">        // 1004 bytes | &quot;Size of 1004 bytes exceeded limit of 1000 bytes&quot;</span>
<span style="color:green;">        //            | NOT: &quot;Size of 1 kB exceeded limit of 1 kB&quot;</span>
<span style="color:green;">        // 1005 bytes | &quot;Size of 1.01 kB exceeded limit of 1 kB&quot;</span>
<span style="color:green;">        // -----------+--------------------------------------------------------</span>

<span style="color:green;">        // As you see, we have two interesting borders:</span>

<span style="color:green;">        // 1000/1001 - The border as of which a violation occurs</span>
<span style="color:green;">        // 1004/1005 - The border as of which the message can be rounded to kB</span>

<span style="color:green;">        // Analogous for kB/MB.</span>

<span style="color:green;">        // Prior to Symfony 2.5, violation messages are always displayed in the</span>
<span style="color:green;">        // same unit used to specify the limit.</span>

<span style="color:green;">        // As of Symfony 2.5, the above logic is implemented.</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            // limit in bytes</span>
<span style="color:green;">            array(1001, 1000, '1001', '1000', 'bytes'),</span>
<span style="color:green;">            array(1004, 1000, '1004', '1000', 'bytes'),</span>
<span style="color:green;">            array(1005, 1000, '1005', '1000', 'bytes'),</span>

<span style="color:green;">            array(1000001, 1000000, '1000001', '1000000', 'bytes'),</span>
<span style="color:green;">            array(1004999, 1000000, '1004999', '1000000', 'bytes'),</span>
<span style="color:green;">            array(1005000, 1000000, '1005000', '1000000', 'bytes'),</span>

<span style="color:green;">            // limit in kB</span>
<span style="color:green;">            //array(1001, '1k') OK in 2.4, not in 2.5</span>
<span style="color:green;">            //array(1004, '1k') OK in 2.4, not in 2.5</span>
<span style="color:green;">            array(1005, '1k', '1.01', '1', 'kB'),</span>

<span style="color:green;">            //array(1000001, '1000k') OK in 2.4, not in 2.5</span>
<span style="color:green;">            array(1004999, '1000k', '1005', '1000', 'kB'),</span>
<span style="color:green;">            array(1005000, '1000k', '1005', '1000', 'kB'),</span>

<span style="color:green;">            // limit in MB</span>
<span style="color:green;">            //array(1000001, '1M') OK in 2.4, not in 2.5</span>
<span style="color:green;">            //array(1004999, '1M') OK in 2.4, not in 2.5</span>
<span style="color:green;">            array(1005000, '1M', '1.01', '1', 'MB'),</span>
<span style="color:green;">        );</span>
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @dataProvider provideMaxSizeExceededTests</span>
<span style="color:green;">     */</span>
    public function <span style="color:red;">testTooLargeKiloBytes()</span><span style="color:green;">testMaxSizeExceeded($bytesWritten, $limit, $sizeAsString, $limitAsString, $suffix)</span>
    {
        <span style="color:green;">fseek($this-&gt;file, $bytesWritten-1, SEEK_SET);</span>
        fwrite($this-&gt;file, <span style="color:red;">str_repeat('0', 1400));</span><span style="color:green;">'0');</span>
<span style="color:green;">        fclose($this-&gt;file);</span>

        $constraint = new File(array(
            'maxSize'           =&gt; <span style="color:red;">'1k',</span><span style="color:green;">$limit,</span>
            'maxSizeMessage'    =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ limit }}'   =&gt; '1',</span>
<span style="color:red;">                '{{ size }}'    =&gt; '1.4',</span>
<span style="color:red;">                '{{ suffix }}'  =&gt; 'kB',</span>
<span style="color:red;">                '{{ file }}'    =&gt; $this-&gt;path,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;getFile($this-&gt;path), $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ limit }}'   =&gt; $limitAsString,</span>
<span style="color:green;">            '{{ size }}'    =&gt; $sizeAsString,</span>
<span style="color:green;">            '{{ suffix }}'  =&gt; $suffix,</span>
<span style="color:green;">            '{{ file }}'    =&gt; '&quot;'.$this-&gt;path.'&quot;',</span>
<span style="color:green;">        ));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function provideMaxSizeNotExceededTests()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            // limit in bytes</span>
<span style="color:green;">            array(1000, 1000),</span>
<span style="color:green;">            array(1000000, 1000000),</span>

<span style="color:green;">            // limit in kB</span>
<span style="color:green;">            array(1000, '1k'),</span>
<span style="color:green;">            array(1000000, '1000k'),</span>

<span style="color:green;">            // as of Symfony 2.5, the following are not accepted anymore</span>
<span style="color:green;">            array(1001, '1k'),</span>
<span style="color:green;">            array(1004, '1k'),</span>
<span style="color:green;">            array(1000001, '1000k'),</span>

<span style="color:green;">            // limit in MB</span>
<span style="color:green;">            array(1000000, '1M'),</span>

<span style="color:green;">            // as of Symfony 2.5, the following are not accepted anymore</span>
<span style="color:green;">            array(1000001, '1M'),</span>
<span style="color:green;">            array(1004999, '1M'),</span>
<span style="color:green;">        );</span>
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @dataProvider provideMaxSizeNotExceededTests</span>
<span style="color:green;">     */</span>
    public function <span style="color:red;">testTooLargeMegaBytes()</span><span style="color:green;">testMaxSizeNotExceeded($bytesWritten, $limit)</span>
    {
        <span style="color:green;">fseek($this-&gt;file, $bytesWritten-1, SEEK_SET);</span>
        fwrite($this-&gt;file, <span style="color:red;">str_repeat('0', 1400000));</span><span style="color:green;">'0');</span>
<span style="color:green;">        fclose($this-&gt;file);</span>

        $constraint = new File(array(
            'maxSize'           =&gt; <span style="color:red;">'1M',</span><span style="color:green;">$limit,</span>
            'maxSizeMessage'    =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ limit }}'   =&gt; '1',</span>
<span style="color:red;">                '{{ size }}'    =&gt; '1.4',</span>
<span style="color:red;">                '{{ suffix }}'  =&gt; 'MB',</span>
<span style="color:red;">                '{{ file }}'    =&gt; $this-&gt;path,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;getFile($this-&gt;path), $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -175,14 +244,13 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;will($this-&gt;returnValue('image/jpg'))
        ;

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new File(array(
            'mimeTypes' =&gt; array('image/png', 'image/jpg'),
        ));

        $this-&gt;validator-&gt;validate($file, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidWildcardMimeType()
<span style="color:teal;">@@ -203,14 +271,13 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase
            -&gt;will($this-&gt;returnValue('image/jpg'))
        ;

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new File(array(
            'mimeTypes' =&gt; array('image/*'),
        ));

        $this-&gt;validator-&gt;validate($file, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testInvalidMimeType()
<span style="color:teal;">@@ -236,15 +303,13 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase
            'mimeTypesMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ type }}'    =&gt; '&quot;application/pdf&quot;',</span>
<span style="color:red;">                '{{ types }}'   =&gt; '&quot;image/png&quot;, &quot;image/jpg&quot;',</span>
<span style="color:red;">                '{{ file }}'    =&gt; $this-&gt;path,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($file, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ type }}'    =&gt; '&quot;application/pdf&quot;',</span>
<span style="color:green;">            '{{ types }}'   =&gt; '&quot;image/png&quot;, &quot;image/jpg&quot;',</span>
<span style="color:green;">            '{{ file }}'    =&gt; '&quot;'.$this-&gt;path.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function testInvalidWildcardMimeType()
<span style="color:teal;">@@ -270,15 +335,13 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase
            'mimeTypesMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ type }}'    =&gt; '&quot;application/pdf&quot;',</span>
<span style="color:red;">                '{{ types }}'   =&gt; '&quot;image/*&quot;, &quot;image/jpg&quot;',</span>
<span style="color:red;">                '{{ file }}'    =&gt; $this-&gt;path,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($file, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ type }}'    =&gt; '&quot;application/pdf&quot;',</span>
<span style="color:green;">            '{{ types }}'   =&gt; '&quot;image/*&quot;, &quot;image/jpg&quot;',</span>
<span style="color:green;">            '{{ file }}'    =&gt; '&quot;'.$this-&gt;path.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -293,12 +356,10 @@</span> abstract class FileValidatorTest extends \PHPUnit_Framework_TestCase
            'maxSize' =&gt; $maxSize
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $params);</span>

        $this-&gt;validator-&gt;validate($file, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', $params);</span>

    }

    public function uploadedFileErrorProvider()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanOrEqualValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanOrEqualValidatorTest.php</span>
<span style="font-weight:bold;">index 9393bec619..bb90f7c283 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanOrEqualValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanOrEqualValidatorTest.php</span>
<span style="color:teal;">@@ -51,9 +51,9 @@</span> class GreaterThanOrEqualValidatorTest extends AbstractComparisonValidatorTestCas
    public function provideInvalidComparisons()
    {
        return array(
            array(1, <span style="color:green;">'1',</span> 2, '2', 'integer'),
            array(new \DateTime('2000/01/01'), <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> new \DateTime('2005/01/01'), <span style="color:red;">'2005-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2005, 12:00 AM',</span> 'DateTime'),
            array('b', <span style="color:green;">'&quot;b&quot;',</span> 'c', <span style="color:red;">&quot;'c'&quot;,</span><span style="color:green;">'&quot;c&quot;',</span> 'string')
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanValidatorTest.php</span>
<span style="font-weight:bold;">index c9db80f78f..64c5dbff65 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/GreaterThanValidatorTest.php</span>
<span style="color:teal;">@@ -49,14 +49,14 @@</span> class GreaterThanValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(1, <span style="color:green;">'1',</span> 2, '2', 'integer'),
            array(2, <span style="color:green;">'2',</span> 2, '2', 'integer'),
            array(new \DateTime('2000/01/01'), <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> new \DateTime('2005/01/01'), <span style="color:red;">'2005-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2005, 12:00 AM',</span> 'DateTime'),
            array(new \DateTime('2000/01/01'), <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> new \DateTime('2000/01/01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(4), <span style="color:green;">'4',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
            array(new ComparisonTest_Class(5), <span style="color:green;">'5',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
            array('22', <span style="color:green;">'&quot;22&quot;',</span> '333', <span style="color:red;">&quot;'333'&quot;,</span><span style="color:green;">'&quot;333&quot;',</span> 'string'),
            array('22', <span style="color:green;">'&quot;22&quot;',</span> '22', <span style="color:red;">&quot;'22'&quot;,</span><span style="color:green;">'&quot;22&quot;',</span> 'string')
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/GroupSequenceTest.php b/src/Symfony/Component/Validator/Tests/Constraints/GroupSequenceTest.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..b3e8ec2191</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/GroupSequenceTest.php</span>
<span style="color:teal;">@@ -0,0 +1,27 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Component\Validator\Tests\Constraints;</span>

<span style="color:green;">use Symfony\Component\Validator\Constraints\GroupSequence;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">class GroupSequenceTest extends \PHPUnit_Framework_TestCase</span>
<span style="color:green;">{</span>
<span style="color:green;">    public function testCreateDoctrineStyle()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $sequence = new GroupSequence(array('value' =&gt; array('Group 1', 'Group 2')));</span>

<span style="color:green;">        $this-&gt;assertSame(array('Group 1', 'Group 2'), $sequence-&gt;groups);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/IbanValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/IbanValidatorTest.php</span>
<span style="font-weight:bold;">index 60ba94c32c..8cf7f5ae53 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/IbanValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/IbanValidatorTest.php</span>
<span style="color:teal;">@@ -13,31 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Iban;
use Symfony\Component\Validator\Constraints\IbanValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class IbanValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new IbanValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())-&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Iban());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())-&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Iban());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -45,15 +41,16 @@</span> class IbanValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIbans($iban)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())-&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($iban, new Iban());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidIbans()
    {
        return array(
            array('CH9300762011623852957'), // Switzerland without spaces
            <span style="color:green;">array('CH93  0076 2011 6238 5295 7'), // Switzerland with multiple spaces</span>

            //Country list
            //http://www.rbs.co.uk/corporate/international/g0/guide-to-international-business/regulatory-information/iban/iban-example.ashx
<span style="color:teal;">@@ -160,13 +157,11 @@</span> class IbanValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $iban,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($iban, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$iban.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidIbans()
<span style="color:teal;">@@ -182,6 +177,7 @@</span> class IbanValidatorTest extends \PHPUnit_Framework_TestCase
            array('foo'),
            array('123'),
            array('0750447346'),
            <span style="color:green;">array('CH930076201162385295]'),</span>

            //Ibans with lower case values are invalid
            array('Ae260211000000230064016'),
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/IdenticalToValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/IdenticalToValidatorTest.php</span>
<span style="font-weight:bold;">index c5267f1820..dfe0f97af6 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/IdenticalToValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/IdenticalToValidatorTest.php</span>
<span style="color:teal;">@@ -52,12 +52,12 @@</span> class IdenticalToValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(1, <span style="color:green;">'1',</span> 2, '2', 'integer'),
            array(2, '2', <span style="color:red;">&quot;'2'&quot;,</span><span style="color:green;">'2', '&quot;2&quot;',</span> 'string'),
            array('22', <span style="color:green;">'&quot;22&quot;',</span> '333', <span style="color:red;">&quot;'333'&quot;,</span><span style="color:green;">'&quot;333&quot;',</span> 'string'),
            array(new \DateTime('2001-01-01'), <span style="color:green;">'Jan 1, 2001, 12:00 AM',</span> new \DateTime('2001-01-01'), <span style="color:red;">'2001-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2001, 12:00 AM',</span> 'DateTime'),
            array(new \DateTime('2001-01-01'), <span style="color:green;">'Jan 1, 2001, 12:00 AM',</span> new \DateTime('1999-01-01'), <span style="color:red;">'1999-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 1999, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(4), <span style="color:green;">'4',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/ImageValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/ImageValidatorTest.php</span>
<span style="font-weight:bold;">index 114c2d2f04..c01ba0a6be 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/ImageValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/ImageValidatorTest.php</span>
<span style="color:teal;">@@ -13,8 +13,9 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Image;
use Symfony\Component\Validator\Constraints\ImageValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class ImageValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected $context;
    protected $validator;
<span style="color:teal;">@@ -23,11 +24,15 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
    protected $imageLandscape;
    protected $imagePortrait;

    <span style="color:green;">protected function createValidator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new ImageValidator();</span>
<span style="color:green;">    }</span>

    protected function setUp()
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new ImageValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span><span style="color:green;">parent::setUp();</span>

        $this-&gt;image = __DIR__.'/Fixtures/test.gif';
        $this-&gt;imageLandscape = __DIR__.'/Fixtures/test_landscape.gif';
        $this-&gt;imagePortrait = __DIR__.'/Fixtures/test_portrait.gif';
<span style="color:teal;">@@ -35,33 +40,27 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Image());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Image());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidImage()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, new Image());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testValidSize()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Image(array(
            'minWidth' =&gt; 1,
            'maxWidth' =&gt; 2,
<span style="color:teal;">@@ -70,6 +69,8 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
        ));

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testWidthTooSmall()
<span style="color:teal;">@@ -79,14 +80,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'minWidthMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ width }}' =&gt; '2',</span>
<span style="color:red;">                '{{ min_width }}' =&gt; '3',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ width }}' =&gt; '2',</span>
<span style="color:green;">            '{{ min_width }}' =&gt; '3',</span>
<span style="color:green;">        ));</span>
    }

    public function testWidthTooBig()
<span style="color:teal;">@@ -96,14 +95,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'maxWidthMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ width }}' =&gt; '2',</span>
<span style="color:red;">                '{{ max_width }}' =&gt; '1',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ width }}' =&gt; '2',</span>
<span style="color:green;">            '{{ max_width }}' =&gt; '1',</span>
<span style="color:green;">        ));</span>
    }

    public function testHeightTooSmall()
<span style="color:teal;">@@ -113,14 +110,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'minHeightMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ height }}' =&gt; '2',</span>
<span style="color:red;">                '{{ min_height }}' =&gt; '3',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ height }}' =&gt; '2',</span>
<span style="color:green;">            '{{ min_height }}' =&gt; '3',</span>
<span style="color:green;">        ));</span>
    }

    public function testHeightTooBig()
<span style="color:teal;">@@ -130,14 +125,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'maxHeightMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ height }}' =&gt; '2',</span>
<span style="color:red;">                '{{ max_height }}' =&gt; '1',</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ height }}' =&gt; '2',</span>
<span style="color:green;">            '{{ max_height }}' =&gt; '1',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -195,14 +188,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'minRatioMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ ratio }}' =&gt; 1,</span>
<span style="color:red;">                '{{ min_ratio }}' =&gt; 2,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ ratio }}' =&gt; 1,</span>
<span style="color:green;">            '{{ min_ratio }}' =&gt; 2,</span>
<span style="color:green;">        ));</span>
    }

    public function testRatioTooBig()
<span style="color:teal;">@@ -212,14 +203,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'maxRatioMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ ratio }}' =&gt; 1,</span>
<span style="color:red;">                '{{ max_ratio }}' =&gt; 0.5,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ ratio }}' =&gt; 1,</span>
<span style="color:green;">            '{{ max_ratio }}' =&gt; 0.5,</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -253,14 +242,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'allowSquareMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ width }}' =&gt; 2,</span>
<span style="color:red;">                '{{ height }}' =&gt; 2,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;image, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ width }}' =&gt; 2,</span>
<span style="color:green;">            '{{ height }}' =&gt; 2,</span>
<span style="color:green;">        ));</span>
    }

    public function testLandscapeNotAllowed()
<span style="color:teal;">@@ -270,14 +257,12 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'allowLandscapeMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ width }}' =&gt; 2,</span>
<span style="color:red;">                '{{ height }}' =&gt; 1,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;imageLandscape, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ width }}' =&gt; 2,</span>
<span style="color:green;">            '{{ height }}' =&gt; 1,</span>
<span style="color:green;">        ));</span>
    }

    public function testPortraitNotAllowed()
<span style="color:teal;">@@ -287,13 +272,11 @@</span> class ImageValidatorTest extends \PHPUnit_Framework_TestCase
            'allowPortraitMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ width }}' =&gt; 1,</span>
<span style="color:red;">                '{{ height }}' =&gt; 2,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($this-&gt;imagePortrait, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ width }}' =&gt; 1,</span>
<span style="color:green;">            '{{ height }}' =&gt; 2,</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/IpValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/IpValidatorTest.php</span>
<span style="font-weight:bold;">index bdf6192880..bc849278de 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/IpValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/IpValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Ip;
use Symfony\Component\Validator\Constraints\IpValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class IpValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new IpValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new IpValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Ip());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Ip());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -61,7 +49,7 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidValidatorVersion()
    {
<span style="color:red;">$ip =</span>        new Ip(array(
            'version' =&gt; 666,
        ));
    }
<span style="color:teal;">@@ -71,12 +59,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIpsV4($ip)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($ip, new Ip(array(
            'version' =&gt; Ip::V4,
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidIpsV4()
<span style="color:teal;">@@ -98,12 +85,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIpsV6($ip)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($ip, new Ip(array(
            'version' =&gt; Ip::V6,
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidIpsV6()
<span style="color:teal;">@@ -136,12 +122,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIpsAll($ip)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($ip, new Ip(array(
            'version' =&gt; Ip::ALL,
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidIpsAll()
<span style="color:teal;">@@ -159,13 +144,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidIpsV4()
<span style="color:teal;">@@ -193,13 +176,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPrivateIpsV4()
<span style="color:teal;">@@ -221,13 +202,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidReservedIpsV4()
<span style="color:teal;">@@ -249,13 +228,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPublicIpsV4()
<span style="color:teal;">@@ -273,13 +250,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidIpsV6()
<span style="color:teal;">@@ -311,13 +286,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPrivateIpsV6()
<span style="color:teal;">@@ -339,13 +312,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidReservedIpsV6()
<span style="color:teal;">@@ -366,13 +337,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPublicIpsV6()
<span style="color:teal;">@@ -390,13 +359,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidIpsAll()
<span style="color:teal;">@@ -414,13 +381,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPrivateIpsAll()
<span style="color:teal;">@@ -438,13 +403,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidReservedIpsAll()
<span style="color:teal;">@@ -462,13 +425,11 @@</span> class IpValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $ip,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($ip, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$ip.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidPublicIpsAll()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/IsbnValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/IsbnValidatorTest.php</span>
<span style="font-weight:bold;">index 7f0859b999..bb49937dfd 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/IsbnValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/IsbnValidatorTest.php</span>
<span style="color:teal;">@@ -13,20 +13,16 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Isbn;
use Symfony\Component\Validator\Constraints\IsbnValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

/**
 * @see https://en.wikipedia.org/wiki/Isbn
 */
class IsbnValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    public</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new IsbnValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
    }

    public function getValidIsbn10()
<span style="color:teal;">@@ -44,6 +40,7 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
            array('0321812700'),
            array('0-45122-5244'),
            array('0-4712-92311'),
            <span style="color:green;">array('0-9752298-0-X')</span>
        );
    }

<span style="color:teal;">@@ -58,6 +55,11 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
            array('0-4X19-92611'),
            array('0_45122_5244'),
            array('2870#971#648'),
            <span style="color:green;">//array('0-9752298-0-x'),</span>
<span style="color:green;">            array('1A34567890'),</span>
<span style="color:green;">            // chr(1) evaluates to 0</span>
<span style="color:green;">            // 2070546810 is valid</span>
<span style="color:green;">            array('2'.chr(1).'70546810'),</span>
        );
    }

<span style="color:teal;">@@ -92,6 +94,10 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
            array('980-0474292319'),
            array('978_0451225245'),
            array('978#0471292319'),
            <span style="color:green;">array('978-272C442282'),</span>
<span style="color:green;">            // chr(1) evaluates to 0</span>
<span style="color:green;">            // 978-2070546817 is valid</span>
<span style="color:green;">            array('978-2'.chr(1).'70546817'),</span>
        );
    }

<span style="color:teal;">@@ -114,21 +120,19 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
    public function testNullIsValid()
    {
        $constraint = new Isbn(true);
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
        $constraint = new Isbn(true);
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -137,6 +141,7 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
    public function testExpectsStringCompatibleType()
    {
        $constraint = new Isbn(true);

        $this-&gt;validator-&gt;validate(new \stdClass(), $constraint);
    }

<span style="color:teal;">@@ -145,12 +150,13 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIsbn10($isbn)
    {
        $constraint = new <span style="color:red;">Isbn(array('isbn10'</span><span style="color:green;">Isbn(array(</span>
<span style="color:green;">            'isbn10'</span> =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">true,</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -158,13 +164,16 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidIsbn10($isbn)
    {
        $constraint = new <span style="color:red;">Isbn(array('isbn10'</span><span style="color:green;">Isbn(array(</span>
<span style="color:green;">            'isbn10'</span> =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;isbn10Message);</span><span style="color:green;">true,</span>
<span style="color:green;">            'isbn10Message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$isbn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -172,12 +181,11 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIsbn13($isbn)
    {
        $constraint = new Isbn(array('isbn13' =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">true,));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -185,13 +193,16 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidIsbn13($isbn)
    {
        $constraint = new <span style="color:red;">Isbn(array('isbn13'</span><span style="color:green;">Isbn(array(</span>
<span style="color:green;">            'isbn13'</span> =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;isbn13Message);</span><span style="color:green;">true,</span>
<span style="color:green;">            'isbn13Message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$isbn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -199,12 +210,14 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidIsbn($isbn)
    {
        $constraint = new <span style="color:red;">Isbn(array('isbn10'</span><span style="color:green;">Isbn(array(</span>
<span style="color:green;">            'isbn10'</span> =&gt; true,
            'isbn13' =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">true,</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -212,12 +225,16 @@</span> class IsbnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidIsbn($isbn)
    {
        $constraint = new <span style="color:red;">Isbn(array('isbn10'</span><span style="color:green;">Isbn(array(</span>
<span style="color:green;">            'isbn10'</span> =&gt; true,
            'isbn13' =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;bothIsbnMessage);</span><span style="color:green;">true,</span>
<span style="color:green;">            'bothIsbnMessage' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($isbn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$isbn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/IssnValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/IssnValidatorTest.php</span>
<span style="font-weight:bold;">index 3f53e738b3..b48357a880 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/IssnValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/IssnValidatorTest.php</span>
<span style="color:teal;">@@ -13,20 +13,16 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Issn;
use Symfony\Component\Validator\Constraints\IssnValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

/**
 * @see https://en.wikipedia.org/wiki/Issn
 */
class IssnValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    public</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new IssnValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
    }

    public function getValidLowerCasedIssn()
<span style="color:teal;">@@ -110,21 +106,19 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
    public function testNullIsValid()
    {
        $constraint = new Issn();
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
        $constraint = new Issn();
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -141,13 +135,16 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testCaseSensitiveIssns($issn)
    {
        $constraint = new <span style="color:red;">Issn(array('caseSensitive'</span><span style="color:green;">Issn(array(</span>
<span style="color:green;">            'caseSensitive'</span> =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;message);</span><span style="color:green;">true,</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$issn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -155,13 +152,16 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testRequireHyphenIssns($issn)
    {
        $constraint = new <span style="color:red;">Issn(array('requireHyphen'</span><span style="color:green;">Issn(array(</span>
<span style="color:green;">            'requireHyphen'</span> =&gt; <span style="color:red;">true));</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;message);</span><span style="color:green;">true,</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$issn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -170,11 +170,10 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
    public function testValidIssn($issn)
    {
        $constraint = new Issn();
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -182,13 +181,15 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidFormatIssn($issn)
    {
        $constraint = new <span style="color:red;">Issn();</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;message);</span><span style="color:green;">Issn(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$issn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -196,13 +197,15 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidValueIssn($issn)
    {
        $constraint = new <span style="color:red;">Issn();</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;message);</span><span style="color:green;">Issn(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$issn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -210,11 +213,14 @@</span> class IssnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidIssn($issn)
    {
        $constraint = new <span style="color:red;">Issn();</span>
<span style="color:red;">        $this-&gt;context</span>
<span style="color:red;">            -&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">Issn(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($issn, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$issn.'&quot;',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LanguageValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LanguageValidatorTest.php</span>
<span style="font-weight:bold;">index 3588887d74..ad2b1e8971 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LanguageValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LanguageValidatorTest.php</span>
<span style="color:teal;">@@ -15,40 +15,32 @@</span> use Symfony\Component\Intl\Util\IntlTestHelper;
use Symfony\Component\Validator\Constraints\Language;
use Symfony\Component\Validator\Constraints\LanguageValidator;

class LanguageValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">IntlTestHelper::requireIntl($this);</span>

<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new LanguageValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
    }

    protected function <span style="color:red;">tearDown()</span><span style="color:green;">setUp()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">IntlTestHelper::requireFullIntl($this);</span>

<span style="color:green;">        parent::setUp();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Language());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Language());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -64,10 +56,9 @@</span> class LanguageValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidLanguages($language)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($language, new Language());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidLanguages()
<span style="color:teal;">@@ -88,13 +79,11 @@</span> class LanguageValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $language,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($language, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$language.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidLanguages()
<span style="color:teal;">@@ -109,11 +98,11 @@</span> class LanguageValidatorTest extends \PHPUnit_Framework_TestCase
    {
        \Locale::setDefault('fr_FR');
        $existingLanguage = 'en';
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($existingLanguage, new Language(array(
            'message' =&gt; 'aMessage'
        )));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LengthValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LengthValidatorTest.php</span>
<span style="font-weight:bold;">index db6339449d..31039c08ae 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LengthValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LengthValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Length;
use Symfony\Component\Validator\Constraints\LengthValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class LengthValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new LengthValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function tearDown()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Length(6));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Length(6));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -111,11 +99,10 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            $this-&gt;markTestSkipped('mb_strlen does not exist');
        }

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Length(array('min' =&gt; 5));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -127,11 +114,10 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            $this-&gt;markTestSkipped('mb_strlen does not exist');
        }

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Length(array('max' =&gt; 3));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -143,11 +129,10 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            $this-&gt;markTestSkipped('mb_strlen does not exist');
        }

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Length(4);
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -164,14 +149,12 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            'minMessage' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; (string) $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 4,</span>
<span style="color:red;">            )), $this-&gt;identicalTo($value), 4);</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$value.'&quot;',</span>
<span style="color:green;">            '{{ limit }}' =&gt; 4,</span>
<span style="color:green;">        ), 'property.path', $value, 4);</span>
    }

    /**
<span style="color:teal;">@@ -188,14 +171,12 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; (string) $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 4,</span>
<span style="color:red;">            )), $this-&gt;identicalTo($value), 4);</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$value.'&quot;',</span>
<span style="color:green;">            '{{ limit }}' =&gt; 4,</span>
<span style="color:green;">        ), 'property.path', $value, 4);</span>
    }

    /**
<span style="color:teal;">@@ -213,14 +194,12 @@</span> class LengthValidatorTest extends \PHPUnit_Framework_TestCase
            'exactMessage' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; (string) $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 4,</span>
<span style="color:red;">            )), $this-&gt;identicalTo($value), 4);</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$value.'&quot;',</span>
<span style="color:green;">            '{{ limit }}' =&gt; 4,</span>
<span style="color:green;">        ), 'property.path', $value, 4);</span>
    }

    public function testConstraintGetDefaultOption()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LessThanOrEqualValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LessThanOrEqualValidatorTest.php</span>
<span style="font-weight:bold;">index 15d68e9382..0f4f749b8b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LessThanOrEqualValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LessThanOrEqualValidatorTest.php</span>
<span style="color:teal;">@@ -53,10 +53,10 @@</span> class LessThanOrEqualValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(2, <span style="color:green;">'2',</span> 1, '1', 'integer'),
            array(new \DateTime('2010-01-01'), <span style="color:green;">'Jan 1, 2010, 12:00 AM',</span> new \DateTime('2000-01-01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(5), <span style="color:green;">'5',</span> new ComparisonTest_Class(4), '4', __NAMESPACE__.'\ComparisonTest_Class'),
            array('c', <span style="color:green;">'&quot;c&quot;',</span> 'b', <span style="color:red;">&quot;'b'&quot;,</span><span style="color:green;">'&quot;b&quot;',</span> 'string')
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LessThanValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LessThanValidatorTest.php</span>
<span style="font-weight:bold;">index 8d42d83f31..408251d214 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LessThanValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LessThanValidatorTest.php</span>
<span style="color:teal;">@@ -49,13 +49,13 @@</span> class LessThanValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(3, <span style="color:green;">'3',</span> 2, '2', 'integer'),
            array(2, <span style="color:green;">'2',</span> 2, '2', 'integer'),
            array(new \DateTime('2010-01-01'), <span style="color:green;">'Jan 1, 2010, 12:00 AM',</span> new \DateTime('2000-01-01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new \DateTime('2000-01-01'), <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> new \DateTime('2000-01-01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(5), <span style="color:green;">'5',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
            array(new ComparisonTest_Class(6), <span style="color:green;">'6',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
            array('333', <span style="color:green;">'&quot;333&quot;',</span> '22', <span style="color:red;">&quot;'22'&quot;,</span><span style="color:green;">'&quot;22&quot;',</span> 'string'),
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LocaleValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LocaleValidatorTest.php</span>
<span style="font-weight:bold;">index 41feba0c71..8c76485e53 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LocaleValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LocaleValidatorTest.php</span>
<span style="color:teal;">@@ -15,40 +15,32 @@</span> use Symfony\Component\Intl\Util\IntlTestHelper;
use Symfony\Component\Validator\Constraints\Locale;
use Symfony\Component\Validator\Constraints\LocaleValidator;

class LocaleValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected <span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span><span style="color:green;">function createValidator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new LocaleValidator();</span>
<span style="color:green;">    }</span>

    protected function setUp()
    {
        IntlTestHelper::requireIntl($this);

        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new LocaleValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function tearDown()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">parent::setUp();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Locale());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Locale());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -64,10 +56,9 @@</span> class LocaleValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidLocales($locale)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($locale, new Locale());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidLocales()
<span style="color:teal;">@@ -90,13 +81,11 @@</span> class LocaleValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $locale,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($locale, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$locale.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidLocales()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/LuhnValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/LuhnValidatorTest.php</span>
<span style="font-weight:bold;">index 11c6a7cad5..9b02bf6492 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/LuhnValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/LuhnValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Luhn;
use Symfony\Component\Validator\Constraints\LuhnValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class LuhnValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new LuhnValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new LuhnValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Luhn());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Luhn());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -53,10 +41,9 @@</span> class LuhnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidNumbers($number)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($number, new Luhn());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidNumbers()
<span style="color:teal;">@@ -88,13 +75,15 @@</span> class LuhnValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testInvalidNumbers($number)
    {
        $constraint = new <span style="color:red;">Luhn();</span>

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with($constraint-&gt;message);</span><span style="color:green;">Luhn(array(</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate($number, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$number.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidNumbers()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/NotBlankValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/NotBlankValidatorTest.php</span>
<span style="font-weight:bold;">index 7273986a87..fe28951466 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/NotBlankValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/NotBlankValidatorTest.php</span>
<span style="color:teal;">@@ -13,23 +13,13 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\NotBlank;
use Symfony\Component\Validator\Constraints\NotBlankValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class NotBlankValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new NotBlankValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function tearDown()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span>
    }

    /**
<span style="color:teal;">@@ -37,10 +27,9 @@</span> class NotBlankValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValues($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($value, new NotBlank());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidValues()
<span style="color:teal;">@@ -60,11 +49,11 @@</span> class NotBlankValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span>

        $this-&gt;validator-&gt;validate(null, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'null',</span>
<span style="color:green;">        ));</span>
    }

    public function testBlankIsInvalid()
<span style="color:teal;">@@ -73,11 +62,11 @@</span> class NotBlankValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span>

        $this-&gt;validator-&gt;validate('', $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function testFalseIsInvalid()
<span style="color:teal;">@@ -86,11 +75,11 @@</span> class NotBlankValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span>

        $this-&gt;validator-&gt;validate(false, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'false',</span>
<span style="color:green;">        ));</span>
    }

    public function testEmptyArrayIsInvalid()
<span style="color:teal;">@@ -99,10 +88,10 @@</span> class NotBlankValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage');</span>

        $this-&gt;validator-&gt;validate(array(), $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'array',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/NotEqualToValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/NotEqualToValidatorTest.php</span>
<span style="font-weight:bold;">index 3ad33a6f0c..d0342bfe35 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/NotEqualToValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/NotEqualToValidatorTest.php</span>
<span style="color:teal;">@@ -49,11 +49,11 @@</span> class NotEqualToValidatorTest extends AbstractComparisonValidatorTestCase
    public function provideInvalidComparisons()
    {
        return array(
            array(3, <span style="color:green;">'3',</span> 3, '3', 'integer'),
            array('2', <span style="color:green;">'&quot;2&quot;',</span> 2, '2', 'integer'),
            array('a', <span style="color:green;">'&quot;a&quot;',</span> 'a', <span style="color:red;">&quot;'a'&quot;,</span><span style="color:green;">'&quot;a&quot;',</span> 'string'),
            array(new \DateTime('2000-01-01'), <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> new \DateTime('2000-01-01'), <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array(new ComparisonTest_Class(5), <span style="color:green;">'5',</span> new ComparisonTest_Class(5), '5', __NAMESPACE__.'\ComparisonTest_Class'),
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/NotIdenticalToValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/NotIdenticalToValidatorTest.php</span>
<span style="font-weight:bold;">index f5b4a90c08..b1e31a40b7 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/NotIdenticalToValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/NotIdenticalToValidatorTest.php</span>
<span style="color:teal;">@@ -53,10 +53,10 @@</span> class NotIdenticalToValidatorTest extends AbstractComparisonValidatorTestCase
        $object = new ComparisonTest_Class(2);

        return array(
            array(3, <span style="color:green;">'3',</span> 3, '3', 'integer'),
            array('a', <span style="color:green;">'&quot;a&quot;',</span> 'a', <span style="color:red;">&quot;'a'&quot;,</span><span style="color:green;">'&quot;a&quot;',</span> 'string'),
            array($date, <span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> $date, <span style="color:red;">'2000-01-01 00:00:00',</span><span style="color:green;">'Jan 1, 2000, 12:00 AM',</span> 'DateTime'),
            array($object, <span style="color:green;">'2',</span> $object, '2', __NAMESPACE__.'\ComparisonTest_Class'),
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/NotNullValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/NotNullValidatorTest.php</span>
<span style="font-weight:bold;">index 96f74a1ba0..8224423e9b 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/NotNullValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/NotNullValidatorTest.php</span>
<span style="color:teal;">@@ -13,23 +13,13 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\NotNull;
use Symfony\Component\Validator\Constraints\NotNullValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class NotNullValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new NotNullValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new NotNullValidator();</span>
    }

    /**
<span style="color:teal;">@@ -37,10 +27,9 @@</span> class NotNullValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValues($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($value, new NotNull());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidValues()
<span style="color:teal;">@@ -59,11 +48,8 @@</span> class NotNullValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(null, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage');</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/NullValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/NullValidatorTest.php</span>
<span style="font-weight:bold;">index d343c869fd..b659bc029a 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/NullValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/NullValidatorTest.php</span>
<span style="color:teal;">@@ -13,61 +13,49 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Null;
use Symfony\Component\Validator\Constraints\NullValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class NullValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new NullValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected function tearDown()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Null());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
     * @dataProvider getInvalidValues
     */
    public function testInvalidValues($value, <span style="color:red;">$readableValue)</span><span style="color:green;">$valueAsString)</span>
    {
        $constraint = new Null(array(
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $readableValue,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $valueAsString,</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidValues()
    {
        return array(
            array(0, <span style="color:red;">0),</span><span style="color:green;">'0'),</span>
            array(false, <span style="color:red;">false),</span><span style="color:green;">'false'),</span>
            array(true, <span style="color:red;">true),</span><span style="color:green;">'true'),</span>
            array('', <span style="color:red;">''),</span><span style="color:green;">'&quot;&quot;'),</span>
            array('foo bar', <span style="color:red;">'foo bar'),</span><span style="color:green;">'&quot;foo bar&quot;'),</span>
            array(new \DateTime(), <span style="color:red;">'DateTime'),</span><span style="color:green;">'object'),</span>
<span style="color:green;">            array(new \stdClass(), 'object'),</span>
            array(array(), <span style="color:red;">'Array'),</span><span style="color:green;">'array'),</span>
        );
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/RangeValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/RangeValidatorTest.php</span>
<span style="font-weight:bold;">index c44b0ea6ce..9c043a6d56 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/RangeValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/RangeValidatorTest.php</span>
<span style="color:teal;">@@ -13,25 +13,20 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Range;
use Symfony\Component\Validator\Constraints\RangeValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class RangeValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected</span> function <span style="color:red;">setUp()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator =</span><span style="color:green;">return</span> new RangeValidator();<span style="color:red;">$this-&gt;validator-&gt;initialize($this-&gt;context);</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Range(array('min' =&gt; 10, 'max' =&gt; 20)));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getTenToTwenty()
<span style="color:teal;">@@ -73,11 +68,10 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesMin($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Range(array('min' =&gt; 10));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -85,11 +79,10 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesMax($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Range(array('max' =&gt; 20));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -97,11 +90,10 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValuesMinMax($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Range(array('min' =&gt; 10, 'max' =&gt; 20));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -114,14 +106,12 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'minMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 10,</span>
<span style="color:red;">        )));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $value,</span>
<span style="color:green;">            '{{ limit }}' =&gt; 10,</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -134,14 +124,12 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 20,</span>
<span style="color:red;">            )));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $value,</span>
<span style="color:green;">            '{{ limit }}' =&gt; 20,</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -156,14 +144,12 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMaxMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMaxMessage', $this-&gt;identicalTo(array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $value,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 20,</span>
<span style="color:red;">            )));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMaxMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $value,</span>
<span style="color:green;">            '{{ limit }}' =&gt; 20,</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -178,14 +164,12 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMaxMessage',
        ));

        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMinMessage', $this-&gt;identicalTo(array(</span><span style="color:green;">$this-&gt;validator-&gt;validate($value, $constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMinMessage', array(</span>
            '{{ value }}' =&gt; $value,
            '{{ limit }}' =&gt; 10,
        <span style="color:red;">)));</span>

<span style="color:red;">        $this-&gt;validator-&gt;validate($value, $constraint);</span><span style="color:green;">));</span>
    }

    public function getInvalidValues()
<span style="color:teal;">@@ -207,14 +191,12 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'minMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 9,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 10,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(9, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 9,</span>
<span style="color:green;">            '{{ limit }}' =&gt; 10,</span>
<span style="color:green;">        ));</span>
    }

    public function testMaxMessageIsSet()
<span style="color:teal;">@@ -225,13 +207,24 @@</span> class RangeValidatorTest extends \PHPUnit_Framework_TestCase
            'maxMessage' =&gt; 'myMessage',
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; 21,</span>
<span style="color:red;">                '{{ limit }}' =&gt; 20,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(21, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 21,</span>
<span style="color:green;">            '{{ limit }}' =&gt; 20,</span>
<span style="color:green;">        ));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testNonNumeric()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;validator-&gt;validate('abcd', new Range(array(</span>
<span style="color:green;">            'min' =&gt; 10,</span>
<span style="color:green;">            'max' =&gt; 20,</span>
<span style="color:green;">            'invalidMessage' =&gt; 'myMessage',</span>
<span style="color:green;">        )));</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;abcd&quot;',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/RegexValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/RegexValidatorTest.php</span>
<span style="font-weight:bold;">index 1ea79fb8e2..91f0c0532f 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/RegexValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/RegexValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Regex;
use Symfony\Component\Validator\Constraints\RegexValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class RegexValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new RegexValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new RegexValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Regex(array('pattern' =&gt; '/^[0-9]+$/')));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Regex(array('pattern' =&gt; '/^[0-9]+$/')));

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -61,11 +49,10 @@</span> class RegexValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValues($value)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Regex(array('pattern' =&gt; '/^[0-9]+$/'));
        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidValues()
<span style="color:teal;">@@ -88,13 +75,11 @@</span> class RegexValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $value,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$value.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidValues()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/TimeValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/TimeValidatorTest.php</span>
<span style="font-weight:bold;">index ba398ab373..4cc5f028b4 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/TimeValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/TimeValidatorTest.php</span>
<span style="color:teal;">@@ -13,47 +13,34 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Time;
use Symfony\Component\Validator\Constraints\TimeValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class TimeValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new TimeValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new TimeValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Time());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Time());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testDateTimeClassIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(new \DateTime(), new Time());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -69,10 +56,9 @@</span> class TimeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidTimes($time)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($time, new Time());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidTimes()
<span style="color:teal;">@@ -93,13 +79,11 @@</span> class TimeValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $time,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($time, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$time.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidTimes()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/TrueValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/TrueValidatorTest.php</span>
<span style="font-weight:bold;">index 25901793a0..e401b87022 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/TrueValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/TrueValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\True;
use Symfony\Component\Validator\Constraints\TrueValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class TrueValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new TrueValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new TrueValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new True());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testTrueIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(true, new True());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testFalseIsInvalid()
<span style="color:teal;">@@ -54,11 +42,10 @@</span> class TrueValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate(false, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; 'false',</span>
<span style="color:green;">        ));</span>
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/TypeValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/TypeValidatorTest.php</span>
<span style="font-weight:bold;">index e5e6d0bf02..1391846387 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/TypeValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/TypeValidatorTest.php</span>
<span style="color:teal;">@@ -13,49 +13,48 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Type;
use Symfony\Component\Validator\Constraints\TypeValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class TypeValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected static $file;

    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new TypeValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new TypeValidator();</span>
    }

    public function testNullIsValid()
    {
        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$constraint = new Type(array('type' =&gt; 'integer'));</span>

        $this-&gt;validator-&gt;validate(null, <span style="color:red;">new Type(array('type' =&gt; 'integer')));</span><span style="color:green;">$constraint);</span>

<span style="color:green;">        $this-&gt;assertNoViolation();</span>
    }

    public function testEmptyIsValidIfString()
    {
        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$constraint = new Type(array('type' =&gt; 'string'));</span>

<span style="color:green;">        $this-&gt;validator-&gt;validate('', $constraint);</span>

        <span style="color:red;">$this-&gt;validator-&gt;validate('', new Type(array('type' =&gt; 'string')));</span><span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyIsInvalidIfNoString()
    {
        <span style="color:red;">$this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation');</span><span style="color:green;">$constraint = new Type(array(</span>
<span style="color:green;">            'type' =&gt; 'integer',</span>
<span style="color:green;">            'message' =&gt; 'myMessage',</span>
<span style="color:green;">        ));</span>

        $this-&gt;validator-&gt;validate('', <span style="color:red;">new Type(array('type'</span><span style="color:green;">$constraint);</span>

<span style="color:green;">        $this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}'</span> =&gt; <span style="color:red;">'integer')));</span><span style="color:green;">'&quot;&quot;',</span>
<span style="color:green;">            '{{ type }}' =&gt; 'integer',</span>
<span style="color:green;">        ));</span>
    }

    /**
<span style="color:teal;">@@ -63,12 +62,11 @@</span> class TypeValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidValues($value, $type)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Type(array('type' =&gt; $type));

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidValues()
<span style="color:teal;">@@ -118,14 +116,12 @@</span> class TypeValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $valueAsString,</span>
<span style="color:red;">                '{{ type }}' =&gt; $type,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($value, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; $valueAsString,</span>
<span style="color:green;">            '{{ type }}' =&gt; $type,</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidValues()
<span style="color:teal;">@@ -134,50 +130,51 @@</span> class TypeValidatorTest extends \PHPUnit_Framework_TestCase
        $file = $this-&gt;createFile();

        return array(
            array('foobar', 'numeric', <span style="color:red;">'foobar'),</span><span style="color:green;">'&quot;foobar&quot;'),</span>
            array('foobar', 'boolean', <span style="color:red;">'foobar'),</span><span style="color:green;">'&quot;foobar&quot;'),</span>
            array('0', 'integer', <span style="color:red;">'0'),</span><span style="color:green;">'&quot;0&quot;'),</span>
            array('1.5', 'float', <span style="color:red;">'1.5'),</span><span style="color:green;">'&quot;1.5&quot;'),</span>
            array(12345, 'string', '12345'),
            array($object, 'boolean', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($object, 'numeric', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($object, 'integer', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($object, 'float', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($object, 'string', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($object, 'resource', <span style="color:red;">'stdClass'),</span><span style="color:green;">'object'),</span>
            array($file, 'boolean', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array($file, 'numeric', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array($file, 'integer', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array($file, 'float', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array($file, 'string', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array($file, 'object', <span style="color:red;">(string) $file),</span><span style="color:green;">'resource'),</span>
            array('12a34', 'digit', <span style="color:red;">'12a34'),</span><span style="color:green;">'&quot;12a34&quot;'),</span>
            array('1a#23', 'alnum', <span style="color:red;">'1a#23'),</span><span style="color:green;">'&quot;1a#23&quot;'),</span>
            array('abcd1', 'alpha', <span style="color:red;">'abcd1'),</span><span style="color:green;">'&quot;abcd1&quot;'),</span>
            array(&quot;\nabc&quot;, 'cntrl', <span style="color:red;">&quot;\nabc&quot;),</span><span style="color:green;">&quot;\&quot;\nabc\&quot;&quot;),</span>
            array(&quot;abc\n&quot;, 'graph', <span style="color:red;">&quot;abc\n&quot;),</span><span style="color:green;">&quot;\&quot;abc\n\&quot;&quot;),</span>
            array('abCDE', 'lower', <span style="color:red;">'abCDE'),</span><span style="color:green;">'&quot;abCDE&quot;'),</span>
            array('ABcde', 'upper', <span style="color:red;">'ABcde'),</span><span style="color:green;">'&quot;ABcde&quot;'),</span>
            array(&quot;\nabc&quot;, 'print', <span style="color:red;">&quot;\nabc&quot;),</span><span style="color:green;">&quot;\&quot;\nabc\&quot;&quot;),</span>
            array('abc&amp;$!', 'punct', <span style="color:red;">'abc&amp;$!'),</span><span style="color:green;">'&quot;abc&amp;$!&quot;'),</span>
            array(&quot;\nabc&quot;, 'space', <span style="color:red;">&quot;\nabc&quot;),</span><span style="color:green;">&quot;\&quot;\nabc\&quot;&quot;),</span>
            array('AR1012', 'xdigit', <span style="color:red;">'AR1012'),</span><span style="color:green;">'&quot;AR1012&quot;'),</span>
        );
    }

    protected function createFile()
    {
        if <span style="color:red;">(!self::$file)</span><span style="color:green;">(!static::$file)</span> {
            <span style="color:red;">self::$file</span><span style="color:green;">static::$file</span> = fopen(__FILE__, 'r');
        }

        return <span style="color:red;">self::$file;</span><span style="color:green;">static::$file;</span>
    }

    public static function tearDownAfterClass()
    {
        if <span style="color:red;">(self::$file)</span><span style="color:green;">(static::$file)</span> {
            <span style="color:red;">fclose(self::$file);</span><span style="color:green;">fclose(static::$file);</span>
<span style="color:green;">            static::$file = null;</span>
        }
    }
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Constraints/UrlValidatorTest.php b/src/Symfony/Component/Validator/Tests/Constraints/UrlValidatorTest.php</span>
<span style="font-weight:bold;">index e74bc18c40..0d4e8e3394 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Constraints/UrlValidatorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Constraints/UrlValidatorTest.php</span>
<span style="color:teal;">@@ -13,39 +13,27 @@</span> namespace Symfony\Component\Validator\Tests\Constraints;

use Symfony\Component\Validator\Constraints\Url;
use Symfony\Component\Validator\Constraints\UrlValidator;
<span style="color:green;">use Symfony\Component\Validator\Validation;</span>

class UrlValidatorTest extends <span style="color:red;">\PHPUnit_Framework_TestCase</span><span style="color:green;">AbstractConstraintValidatorTest</span>
{
    protected<span style="color:red;">$context;</span>
<span style="color:red;">    protected $validator;</span>

<span style="color:red;">    protected function setUp()</span>
<span style="color:red;">    {</span>
<span style="color:red;">        $this-&gt;context = $this-&gt;getMock('Symfony\Component\Validator\ExecutionContext', array(), array(), '', false);</span>
<span style="color:red;">        $this-&gt;validator = new UrlValidator();</span>
<span style="color:red;">        $this-&gt;validator-&gt;initialize($this-&gt;context);</span>
<span style="color:red;">    }</span>

<span style="color:red;">    protected</span> function <span style="color:red;">tearDown()</span><span style="color:green;">createValidator()</span>
    {
        <span style="color:red;">$this-&gt;context = null;</span>
<span style="color:red;">        $this-&gt;validator = null;</span><span style="color:green;">return new UrlValidator();</span>
    }

    public function testNullIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate(null, new Url());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function testEmptyStringIsValid()
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate('', new Url());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    /**
<span style="color:teal;">@@ -61,10 +49,9 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testValidUrls($url)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $this-&gt;validator-&gt;validate($url, new Url());

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidUrls()
<span style="color:teal;">@@ -72,6 +59,7 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
        return array(
            array('http://a.pl'),
            array('http://www.google.com'),
            <span style="color:green;">//array('http://www.google.com.') OK as of 2.5</span>
            array('http://www.google.museum'),
            array('https://google.com/'),
            array('https://google.com:80/'),
<span style="color:teal;">@@ -85,6 +73,7 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
            array('http://symfony.com/#?'),
            array('http://www.symfony.com/doc/current/book/validation.html#supported-constraints'),
            array('http://very.long.domain.name.com/'),
            <span style="color:green;">//array('http://localhost/') OK as of 2.5</span>
            array('http://127.0.0.1/'),
            array('http://127.0.0.1:80/'),
            array('http://[::1]/'),
<span style="color:teal;">@@ -114,6 +103,8 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
            array('http://xn--espaa-rta.xn--ca-ol-fsay5a/'),
            array('http://xn--d1abbgf6aiiy.xn--p1ai/'),
            array('http://☎.com/'),
            <span style="color:green;">array('http://username:password@symfony.com'),</span>
<span style="color:green;">            array('http://user-name@symfony.com'),</span>
        );
    }

<span style="color:teal;">@@ -126,13 +117,11 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
            'message' =&gt; 'myMessage'
        ));

<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;once())</span>
<span style="color:red;">            -&gt;method('addViolation')</span>
<span style="color:red;">            -&gt;with('myMessage', array(</span>
<span style="color:red;">                '{{ value }}' =&gt; $url,</span>
<span style="color:red;">            ));</span>

        $this-&gt;validator-&gt;validate($url, $constraint);

        <span style="color:green;">$this-&gt;assertViolation('myMessage', array(</span>
<span style="color:green;">            '{{ value }}' =&gt; '&quot;'.$url.'&quot;',</span>
<span style="color:green;">        ));</span>
    }

    public function getInvalidUrls()
<span style="color:teal;">@@ -152,6 +141,11 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
            array('http://127.0.0.1:aa/'),
            array('ftp://[::1]/'),
            array('http://[::1'),
            <span style="color:green;">array('http://hello.☎/'),</span>
<span style="color:green;">            array('http://:password@symfony.com'),</span>
<span style="color:green;">            array('http://:password@@symfony.com'),</span>
<span style="color:green;">            array('http://username:passwordsymfony.com'),</span>
<span style="color:green;">            array('http://usern@me:password@symfony.com'),</span>
        );
    }

<span style="color:teal;">@@ -160,14 +154,13 @@</span> class UrlValidatorTest extends \PHPUnit_Framework_TestCase
     */
    public function testCustomProtocolIsValid($url)
    {
<span style="color:red;">        $this-&gt;context-&gt;expects($this-&gt;never())</span>
<span style="color:red;">            -&gt;method('addViolation');</span>

        $constraint = new Url(array(
            'protocols' =&gt; array('ftp', 'file', 'git')
        ));

        $this-&gt;validator-&gt;validate($url, $constraint);

        <span style="color:green;">$this-&gt;assertNoViolation();</span>
    }

    public function getValidCustomUrls()
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Fixtures/Countable.php b/src/Symfony/Component/Validator/Tests/Fixtures/Countable.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..282d78d45a</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Fixtures/Countable.php</span>
<span style="color:teal;">@@ -0,0 +1,27 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Component\Validator\Tests\Fixtures;</span>

<span style="color:green;">class Countable implements \Countable</span>
<span style="color:green;">{</span>
<span style="color:green;">    private $content;</span>

<span style="color:green;">    public function __construct(array $content)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;content = $content;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function count()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return count($this-&gt;content);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Fixtures/CustomArrayObject.php b/src/Symfony/Component/Validator/Tests/Fixtures/CustomArrayObject.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..41eac961ac</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Fixtures/CustomArrayObject.php</span>
<span style="color:teal;">@@ -0,0 +1,70 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Component\Validator\Tests\Fixtures;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * This class is a hand written simplified version of PHP native `ArrayObject`</span>
<span style="color:green;"> * class, to show that it behaves differently than the PHP native implementation.</span>
<span style="color:green;"> */</span>
<span style="color:green;">class CustomArrayObject implements \ArrayAccess, \IteratorAggregate, \Countable, \Serializable</span>
<span style="color:green;">{</span>
<span style="color:green;">    private $array;</span>

<span style="color:green;">    public function __construct(array $array = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;array = $array ?: array();</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function offsetExists($offset)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array_key_exists($offset, $this-&gt;array);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function offsetGet($offset)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return $this-&gt;array[$offset];</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function offsetSet($offset, $value)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        if (null === $offset) {</span>
<span style="color:green;">            $this-&gt;array[] = $value;</span>
<span style="color:green;">        } else {</span>
<span style="color:green;">            $this-&gt;array[$offset] = $value;</span>
<span style="color:green;">        }</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function offsetUnset($offset)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        unset($this-&gt;array[$offset]);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getIterator()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return new \ArrayIterator($this-&gt;array);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function count()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return count($this-&gt;array);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function serialize()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return serialize($this-&gt;array);</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function unserialize($serialized)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;array = (array) unserialize((string) $serialized);</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Fixtures/Entity.php b/src/Symfony/Component/Validator/Tests/Fixtures/Entity.php</span>
<span style="font-weight:bold;">index 70bdc5aec6..4979d53fbc 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Fixtures/Entity.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Fixtures/Entity.php</span>
<span style="color:teal;">@@ -37,6 +37,7 @@</span> class Entity extends EntityParent implements EntityInterface
    public $reference;
    private $internal;
    public $data = 'Overridden data';
    <span style="color:green;">public $initialized = false;</span>

    public function __construct($internal = null)
    {
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Fixtures/StubGlobalExecutionContext.php b/src/Symfony/Component/Validator/Tests/Fixtures/StubGlobalExecutionContext.php</span>
<span style="font-weight:bold;">new file mode 100644</span>
<span style="font-weight:bold;">index 0000000000..bfe096a86d</span>
<span style="font-weight:bold;">--- /dev/null</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Fixtures/StubGlobalExecutionContext.php</span>
<span style="color:teal;">@@ -0,0 +1,69 @@</span>
<span style="color:green;">&lt;?php</span>

<span style="color:green;">/*</span>
<span style="color:green;"> * This file is part of the Symfony package.</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * (c) Fabien Potencier &lt;fabien@symfony.com&gt;</span>
<span style="color:green;"> *</span>
<span style="color:green;"> * For the full copyright and license information, please view the LICENSE</span>
<span style="color:green;"> * file that was distributed with this source code.</span>
<span style="color:green;"> */</span>

<span style="color:green;">namespace Symfony\Component\Validator\Tests\Fixtures;</span>

<span style="color:green;">use Symfony\Component\Validator\ConstraintViolationList;</span>
<span style="color:green;">use Symfony\Component\Validator\GlobalExecutionContextInterface;</span>
<span style="color:green;">use Symfony\Component\Validator\ValidationVisitorInterface;</span>

<span style="color:green;">/**</span>
<span style="color:green;"> * @since  2.3.19</span>
<span style="color:green;"> * @author Bernhard Schussek &lt;bschussek@gmail.com&gt;</span>
<span style="color:green;"> */</span>
<span style="color:green;">class StubGlobalExecutionContext implements GlobalExecutionContextInterface</span>
<span style="color:green;">{</span>
<span style="color:green;">    private $violations;</span>

<span style="color:green;">    private $root;</span>

<span style="color:green;">    private $visitor;</span>

<span style="color:green;">    function __construct($root = null, ValidationVisitorInterface $visitor = null)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;violations = new ConstraintViolationList();</span>
<span style="color:green;">        $this-&gt;root = $root;</span>
<span style="color:green;">        $this-&gt;visitor = $visitor;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getViolations()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return $this-&gt;violations;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function setRoot($root)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;root = $root;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getRoot()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return $this-&gt;root;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function setVisitor(ValidationVisitorInterface $visitor)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;visitor = $visitor;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getVisitor()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return $this-&gt;visitor;</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getValidatorFactory()</span>
<span style="color:green;">    {</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getMetadataFactory()</span>
<span style="color:green;">    {</span>
<span style="color:green;">    }</span>
<span style="color:green;">}</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/Mapping/ClassMetadataTest.php b/src/Symfony/Component/Validator/Tests/Mapping/ClassMetadataTest.php</span>
<span style="font-weight:bold;">index 9ead7d134e..08ae9600ce 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/Mapping/ClassMetadataTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/Mapping/ClassMetadataTest.php</span>
<span style="color:teal;">@@ -222,4 +222,20 @@</span> class ClassMetadataTest extends \PHPUnit_Framework_TestCase
        $metadata-&gt;setGroupSequenceProvider(true);
        $this-&gt;assertTrue($metadata-&gt;isGroupSequenceProvider());
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * https://github.com/symfony/symfony/issues/11604</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testGetMemberMetadatasReturnsEmptyArrayWithoutConfiguredMetadata()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertCount(0, $this-&gt;metadata-&gt;getMemberMetadatas('foo'), '-&gt;getMemberMetadatas() returns an empty collection if no metadata is configured for the given property');</span>
<span style="color:green;">    }</span>

<span style="color:green;">    /**</span>
<span style="color:green;">     * https://github.com/symfony/symfony/issues/11604</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testGetPropertyMetadataReturnsEmptyArrayWithoutConfiguredMetadata()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertCount(0, $this-&gt;metadata-&gt;getPropertyMetadata('foo'), '-&gt;getPropertyMetadata() returns an empty collection if no metadata is configured for the given property');</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/Tests/ValidationVisitorTest.php b/src/Symfony/Component/Validator/Tests/ValidationVisitorTest.php</span>
<span style="font-weight:bold;">index 2868f57a82..f2838737a2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/Tests/ValidationVisitorTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/Tests/ValidationVisitorTest.php</span>
<span style="color:teal;">@@ -11,6 +11,8 @@</span>

namespace Symfony\Component\Validator\Tests;

<span style="color:green;">use Symfony\Component\Validator\Constraints\Callback;</span>
<span style="color:green;">use Symfony\Component\Validator\ExecutionContextInterface;</span>
use Symfony\Component\Validator\Tests\Fixtures\FakeMetadataFactory;
use Symfony\Component\Validator\Constraints\Valid;
use Symfony\Component\Validator\Tests\Fixtures\Reference;
<span style="color:teal;">@@ -561,4 +563,50 @@</span> class ValidationVisitorTest extends \PHPUnit_Framework_TestCase

        $this-&gt;visitor-&gt;validate($entity, 'Default', '');
    }

    <span style="color:green;">public function testInitializeObjectsOnFirstValidation()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $test = $this;</span>
<span style="color:green;">        $entity = new Entity();</span>
<span style="color:green;">        $entity-&gt;initialized = false;</span>

<span style="color:green;">        // prepare initializers that set &quot;initialized&quot; to true</span>
<span style="color:green;">        $initializer1 = $this-&gt;getMock('Symfony\\Component\\Validator\\ObjectInitializerInterface');</span>
<span style="color:green;">        $initializer2 = $this-&gt;getMock('Symfony\\Component\\Validator\\ObjectInitializerInterface');</span>

<span style="color:green;">        $initializer1-&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('initialize')</span>
<span style="color:green;">            -&gt;with($entity)</span>
<span style="color:green;">            -&gt;will($this-&gt;returnCallback(function ($object) {</span>
<span style="color:green;">                $object-&gt;initialized = true;</span>
<span style="color:green;">            }));</span>

<span style="color:green;">        $initializer2-&gt;expects($this-&gt;once())</span>
<span style="color:green;">            -&gt;method('initialize')</span>
<span style="color:green;">            -&gt;with($entity);</span>

<span style="color:green;">        $this-&gt;visitor = new ValidationVisitor('Root', $this-&gt;metadataFactory, new ConstraintValidatorFactory(), new DefaultTranslator(), null, array(</span>
<span style="color:green;">            $initializer1,</span>
<span style="color:green;">            $initializer2</span>
<span style="color:green;">        ));</span>

<span style="color:green;">        // prepare constraint which</span>
<span style="color:green;">        // * checks that &quot;initialized&quot; is set to true</span>
<span style="color:green;">        // * validates the object again</span>
<span style="color:green;">        $callback = function ($object, ExecutionContextInterface $context) use ($test) {</span>
<span style="color:green;">            $test-&gt;assertTrue($object-&gt;initialized);</span>

<span style="color:green;">            // validate again in same group</span>
<span style="color:green;">            $context-&gt;validate($object);</span>

<span style="color:green;">            // validate again in other group</span>
<span style="color:green;">            $context-&gt;validate($object, '', 'SomeGroup');</span>
<span style="color:green;">        };</span>

<span style="color:green;">        $this-&gt;metadata-&gt;addConstraint(new Callback(array($callback)));</span>

<span style="color:green;">        $this-&gt;visitor-&gt;validate($entity, 'Default', '');</span>

<span style="color:green;">        $this-&gt;assertTrue($entity-&gt;initialized);</span>
<span style="color:green;">    }</span>
}
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Validator/ValidationVisitor.php b/src/Symfony/Component/Validator/ValidationVisitor.php</span>
<span style="font-weight:bold;">index ddff8adc60..510c61e2eb 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Validator/ValidationVisitor.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Validator/ValidationVisitor.php</span>
<span style="color:teal;">@@ -127,16 +127,19 @@</span> class ValidationVisitor implements ValidationVisitorInterface, GlobalExecutionCo
                return;
            }

            <span style="color:green;">// Initialize if the object wasn't initialized before</span>
<span style="color:green;">            if (!isset($this-&gt;validatedObjects[$hash])) {</span>
<span style="color:green;">                foreach ($this-&gt;objectInitializers as $initializer) {</span>
<span style="color:green;">                    if (!$initializer instanceof ObjectInitializerInterface) {</span>
<span style="color:green;">                        throw new \LogicException('Validator initializers must implement ObjectInitializerInterface.');</span>
<span style="color:green;">                    }</span>
<span style="color:green;">                    $initializer-&gt;initialize($value);</span>
<span style="color:green;">                }</span>
<span style="color:green;">            }</span>

            // Remember validating this object before starting and possibly
            // traversing the object graph
            $this-&gt;validatedObjects[$hash][$group] = true;

<span style="color:red;">            foreach ($this-&gt;objectInitializers as $initializer) {</span>
<span style="color:red;">                if (!$initializer instanceof ObjectInitializerInterface) {</span>
<span style="color:red;">                    throw new \LogicException('Validator initializers must implement ObjectInitializerInterface.');</span>
<span style="color:red;">                }</span>
<span style="color:red;">                $initializer-&gt;initialize($value);</span>
<span style="color:red;">            }</span>
        }

        // Validate arrays recursively by default, otherwise every driver needs
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Yaml/Inline.php b/src/Symfony/Component/Yaml/Inline.php</span>
<span style="font-weight:bold;">index b0d6a031f8..1b34edebd2 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Yaml/Inline.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Yaml/Inline.php</span>
<span style="color:teal;">@@ -32,12 +32,13 @@</span> class Inline
     * @param string  $value                  A YAML string
     * @param bool    $exceptionOnInvalidType true if an exception must be thrown on invalid types (a PHP resource or object), false otherwise
     * @param bool    $objectSupport          true if object support is enabled, false otherwise
     <span style="color:green;">* @param array   $references             Mapping of variable names to values</span>
     *
     * @return array A PHP array representing the YAML string
     *
     * @throws ParseException
     */
    public static function parse($value, $exceptionOnInvalidType = false, $objectSupport = <span style="color:red;">false)</span><span style="color:green;">false, $references = array())</span>
    {
        self::$exceptionOnInvalidType = $exceptionOnInvalidType;
        self::$objectSupport = $objectSupport;
<span style="color:teal;">@@ -56,15 +57,15 @@</span> class Inline
        $i = 0;
        switch ($value[0]) {
            case '[':
                $result = self::parseSequence($value, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                ++$i;
                break;
            case '{':
                $result = self::parseMapping($value, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                ++$i;
                break;
            default:
                $result = self::parseScalar($value, null, array('&quot;', &quot;'&quot;), <span style="color:red;">$i);</span><span style="color:green;">$i, true, $references);</span>
        }

        // some comments are allowed at the end
<span style="color:teal;">@@ -184,14 +185,15 @@</span> class Inline
     * @param scalar $scalar
     * @param string $delimiters
     * @param array  $stringDelimiters
     * @param int    &amp;$i
     * @param bool   $evaluate
     <span style="color:green;">* @param array  $references</span>
     *
     * @return string A YAML string
     *
     * @throws ParseException When malformed inline YAML string is parsed
     */
    public static function parseScalar($scalar, $delimiters = null, $stringDelimiters = array('&quot;', &quot;'&quot;), &amp;$i = 0, $evaluate = <span style="color:red;">true)</span><span style="color:green;">true, $references = array())</span>
    {
        if (in_array($scalar[$i], $stringDelimiters)) {
            // quoted scalar
<span style="color:teal;">@@ -221,7 +223,7 @@</span> class Inline
            }

            if ($evaluate) {
                $output = <span style="color:red;">self::evaluateScalar($output);</span><span style="color:green;">self::evaluateScalar($output, $references);</span>
            }
        }

<span style="color:teal;">@@ -262,13 +264,14 @@</span> class Inline
     * Parses a sequence to a YAML string.
     *
     * @param string $sequence
     * @param int    &amp;$i
     <span style="color:green;">* @param array  $references</span>
     *
     * @return string A YAML string
     *
     * @throws ParseException When malformed inline YAML string is parsed
     */
    private static function parseSequence($sequence, &amp;$i = <span style="color:red;">0)</span><span style="color:green;">0, $references = array())</span>
    {
        $output = array();
        $len = strlen($sequence);
<span style="color:teal;">@@ -279,11 +282,11 @@</span> class Inline
            switch ($sequence[$i]) {
                case '[':
                    // nested sequence
                    $output[] = self::parseSequence($sequence, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                    break;
                case '{':
                    // nested mapping
                    $output[] = self::parseMapping($sequence, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                    break;
                case ']':
                    return $output;
<span style="color:teal;">@@ -292,12 +295,14 @@</span> class Inline
                    break;
                default:
                    $isQuoted = in_array($sequence[$i], array('&quot;', &quot;'&quot;));
                    $value = self::parseScalar($sequence, array(',', ']'), array('&quot;', &quot;'&quot;), <span style="color:red;">$i);</span><span style="color:green;">$i, true, $references);</span>

                    <span style="color:green;">// the value can be an array</span> if <span style="color:red;">(!$isQuoted</span><span style="color:green;">a reference has been resolved to an array var</span>
<span style="color:green;">                    if (!is_array($value) &amp;&amp; !$isQuoted</span> &amp;&amp; false !== strpos($value, ': ')) {
                        // embedded mapping?
                        try {
                            <span style="color:green;">$pos = 0;</span>
                            $value = <span style="color:red;">self::parseMapping('{'.$value.'}');</span><span style="color:green;">self::parseMapping('{'.$value.'}', $pos, $references);</span>
                        } catch (\InvalidArgumentException $e) {
                            // no, it's not
                        }
<span style="color:teal;">@@ -318,13 +323,14 @@</span> class Inline
     * Parses a mapping to a YAML string.
     *
     * @param string $mapping
     * @param int    &amp;$i
     <span style="color:green;">* @param array  $references</span>
     *
     * @return string A YAML string
     *
     * @throws ParseException When malformed inline YAML string is parsed
     */
    private static function parseMapping($mapping, &amp;$i = <span style="color:red;">0)</span><span style="color:green;">0, $references = array())</span>
    {
        $output = array();
        $len = strlen($mapping);
<span style="color:teal;">@@ -350,19 +356,19 @@</span> class Inline
                switch ($mapping[$i]) {
                    case '[':
                        // nested sequence
                        $output[$key] = self::parseSequence($mapping, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                        $done = true;
                        break;
                    case '{':
                        // nested mapping
                        $output[$key] = self::parseMapping($mapping, <span style="color:red;">$i);</span><span style="color:green;">$i, $references);</span>
                        $done = true;
                        break;
                    case ':':
                    case ' ':
                        break;
                    default:
                        $output[$key] = self::parseScalar($mapping, array(',', '}'), array('&quot;', &quot;'&quot;), <span style="color:red;">$i);</span><span style="color:green;">$i, true, $references);</span>
                        $done = true;
                        --$i;
                }
<span style="color:teal;">@@ -382,13 +388,31 @@</span> class Inline
     * Evaluates scalars and replaces magic values.
     *
     * @param string $scalar
     <span style="color:green;">* @param array  $references</span>
     *
     * @return string A YAML string
     <span style="color:green;">*</span>
<span style="color:green;">     * @throws ParseException when object parsing support was disabled and the parser detected a PHP object</span>
     */
    private static function <span style="color:red;">evaluateScalar($scalar)</span><span style="color:green;">evaluateScalar($scalar, $references = array())</span>
    {
        $scalar = trim($scalar);
        $scalarLower = strtolower($scalar);

        <span style="color:green;">if (0 === strpos($scalar, '*')) {</span>
<span style="color:green;">            if (false !== $pos = strpos($scalar, '#')) {</span>
<span style="color:green;">                $value = substr($scalar, 1, $pos - 2);</span>
<span style="color:green;">            } else {</span>
<span style="color:green;">                $value = substr($scalar, 1);</span>
<span style="color:green;">            }</span>

<span style="color:green;">            if (!array_key_exists($value, $references)) {</span>
<span style="color:green;">                throw new ParseException(sprintf('Reference &quot;%s&quot; does not exist.', $value));</span>
<span style="color:green;">            }</span>

<span style="color:green;">            return $references[$value];</span>
<span style="color:green;">        }</span>

        switch (true) {
            case 'null' === $scalarLower:
            case '' === $scalar:
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Yaml/Parser.php b/src/Symfony/Component/Yaml/Parser.php</span>
<span style="font-weight:bold;">index 9bde67b57b..addb387a48 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Yaml/Parser.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Yaml/Parser.php</span>
<span style="color:teal;">@@ -114,14 +114,14 @@</span> class Parser
                        $data[] = $this-&gt;parseValue($values['value'], $exceptionOnInvalidType, $objectSupport);
                    }
                }
            } elseif (preg_match('#^(?P&lt;key&gt;'.Inline::REGEX_QUOTED_STRING.'|[^ \'&quot;\[\{].*?) *\:(\s+(?P&lt;value&gt;.+?))?\s*$#u', $this-&gt;currentLine, $values) &amp;&amp; <span style="color:red;">false</span><span style="color:green;">(false</span> === strpos($values['key'],' <span style="color:red;">#'))</span><span style="color:green;">#') || in_array($values['key'][0], array('&quot;', &quot;'&quot;))))</span> {
                if ($context &amp;&amp; 'sequence' == $context) {
                    throw new ParseException('You cannot define a mapping item when in a sequence');
                }
                $context = 'mapping';

                // force correct settings
                Inline::parse(null, $exceptionOnInvalidType, <span style="color:red;">$objectSupport);</span><span style="color:green;">$objectSupport, $this-&gt;refs);</span>
                try {
                    $key = Inline::parseScalar($values['key']);
                } catch (ParseException $e) {
<span style="color:teal;">@@ -197,7 +197,7 @@</span> class Parser
                $lineCount = count($this-&gt;lines);
                if (1 === $lineCount || (2 === $lineCount &amp;&amp; empty($this-&gt;lines[1]))) {
                    try {
                        $value = Inline::parse($this-&gt;lines[0], $exceptionOnInvalidType, <span style="color:red;">$objectSupport);</span><span style="color:green;">$objectSupport, $this-&gt;refs);</span>
                    } catch (ParseException $e) {
                        $e-&gt;setParsedLine($this-&gt;getRealCurrentLineNb() + 1);
                        $e-&gt;setSnippet($this-&gt;currentLine);
<span style="color:teal;">@@ -404,7 +404,7 @@</span> class Parser
        }

        try {
            return Inline::parse($value, $exceptionOnInvalidType, <span style="color:red;">$objectSupport);</span><span style="color:green;">$objectSupport, $this-&gt;refs);</span>
        } catch (ParseException $e) {
            $e-&gt;setParsedLine($this-&gt;getRealCurrentLineNb() + 1);
            $e-&gt;setSnippet($this-&gt;currentLine);
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Yaml/Tests/Fixtures/sfComments.yml b/src/Symfony/Component/Yaml/Tests/Fixtures/sfComments.yml</span>
<span style="font-weight:bold;">index 46addfcd3d..6a7ffeca46 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Yaml/Tests/Fixtures/sfComments.yml</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Yaml/Tests/Fixtures/sfComments.yml</span>
<span style="color:teal;">@@ -63,3 +63,11 @@</span> brief: &gt;
yaml: 'foo#bar: baz'
php: |
    array('foo#bar' =&gt; 'baz')
<span style="color:green;">---</span>
<span style="color:green;">test: 'Hash key ending with a space and a #'</span>
<span style="color:green;">brief: &gt;</span>
<span style="color:green;">    'Hash key ending with a space and a #'</span>
<span style="color:green;">yaml: |</span>
<span style="color:green;">    'foo #': baz</span>
<span style="color:green;">php: |</span>
<span style="color:green;">    array('foo #' =&gt; 'baz')</span>
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Yaml/Tests/InlineTest.php b/src/Symfony/Component/Yaml/Tests/InlineTest.php</span>
<span style="font-weight:bold;">index dc497ca21c..affe4f9c23 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Yaml/Tests/InlineTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Yaml/Tests/InlineTest.php</span>
<span style="color:teal;">@@ -115,6 +115,38 @@</span> class InlineTest extends \PHPUnit_Framework_TestCase
        $this-&gt;assertSame($expect, Inline::parseScalar($value));
    }

    <span style="color:green;">/**</span>
<span style="color:green;">     * @dataProvider getDataForParseReferences</span>
<span style="color:green;">     */</span>
<span style="color:green;">    public function testParseReferences($yaml, $expected)</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertSame($expected, Inline::parse($yaml, false, false, array('var' =&gt; 'var-value')));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function getDataForParseReferences()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        return array(</span>
<span style="color:green;">            'scalar' =&gt; array('*var', 'var-value'),</span>
<span style="color:green;">            'list' =&gt; array('[ *var ]', array('var-value')),</span>
<span style="color:green;">            'list-in-list' =&gt; array('[[ *var ]]', array(array('var-value'))),</span>
<span style="color:green;">            'map-in-list' =&gt; array('[ { key: *var } ]', array(array('key' =&gt; 'var-value'))),</span>
<span style="color:green;">            'embedded-mapping-in-list' =&gt; array('[ key: *var ]', array(array('key' =&gt; 'var-value'))),</span>
<span style="color:green;">            'map' =&gt; array('{ key: *var }', array('key' =&gt; 'var-value')),</span>
<span style="color:green;">            'list-in-map' =&gt; array('{ key: [*var] }', array('key' =&gt; array('var-value'))),</span>
<span style="color:green;">            'map-in-map' =&gt; array('{ foo: { bar: *var } }', array('foo' =&gt; array('bar' =&gt; 'var-value'))),</span>
<span style="color:green;">        );</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testParseMapReferenceInSequence()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $foo = array(</span>
<span style="color:green;">            'a' =&gt; 'Steve',</span>
<span style="color:green;">            'b' =&gt; 'Clark',</span>
<span style="color:green;">            'c' =&gt; 'Brian',</span>
<span style="color:green;">        );</span>
<span style="color:green;">        $this-&gt;assertSame(array($foo), Inline::parse('[*foo]', false, false, array('foo' =&gt; $foo)));</span>
<span style="color:green;">    }</span>

    protected function getTestsForParse()
    {
        return array(
<span style="font-weight:bold;">diff --git a/src/Symfony/Component/Yaml/Tests/ParserTest.php b/src/Symfony/Component/Yaml/Tests/ParserTest.php</span>
<span style="font-weight:bold;">index 2335efc559..01c7b53995 100644</span>
<span style="font-weight:bold;">--- a/src/Symfony/Component/Yaml/Tests/ParserTest.php</span>
<span style="font-weight:bold;">+++ b/src/Symfony/Component/Yaml/Tests/ParserTest.php</span>
<span style="color:teal;">@@ -602,6 +602,32 @@</span> EOT
            &lt;/body&gt;

        footer # comment3
<span style="color:green;">EOF</span>
<span style="color:green;">        ));</span>
<span style="color:green;">    }</span>

<span style="color:green;">    public function testReferenceResolvingInInlineStrings()</span>
<span style="color:green;">    {</span>
<span style="color:green;">        $this-&gt;assertEquals(array(</span>
<span style="color:green;">            'var' =&gt; 'var-value',</span>
<span style="color:green;">            'scalar' =&gt; 'var-value',</span>
<span style="color:green;">            'list' =&gt; array('var-value'),</span>
<span style="color:green;">            'list_in_list' =&gt; array(array('var-value')),</span>
<span style="color:green;">            'map_in_list' =&gt; array(array('key' =&gt; 'var-value')),</span>
<span style="color:green;">            'embedded_mapping' =&gt; array(array('key' =&gt; 'var-value')),</span>
<span style="color:green;">            'map' =&gt; array('key' =&gt; 'var-value'),</span>
<span style="color:green;">            'list_in_map' =&gt; array('key' =&gt; array('var-value')),</span>
<span style="color:green;">            'map_in_map' =&gt; array('foo' =&gt; array('bar' =&gt; 'var-value')),</span>
<span style="color:green;">        ), Yaml::parse(&lt;&lt;&lt;EOF</span>
<span style="color:green;">var:  &amp;var var-value</span>
<span style="color:green;">scalar: *var</span>
<span style="color:green;">list: [ *var ]</span>
<span style="color:green;">list_in_list: [[ *var ]]</span>
<span style="color:green;">map_in_list: [ { key: *var } ]</span>
<span style="color:green;">embedded_mapping: [ key: *var ]</span>
<span style="color:green;">map: { key: *var }</span>
<span style="color:green;">list_in_map: { key: [*var] }</span>
<span style="color:green;">map_in_map: { foo: { bar: *var } }</span>
EOF
        ));
    }
</pre>
</body>
</html>
